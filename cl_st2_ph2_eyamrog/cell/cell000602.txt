Title: Lineage tracing reveals the phylodynamics, plasticity, and paths of tumor evolution


Abstract: Summary

Tumor evolution is driven by the progressive acquisition of genetic and epigenetic alterations that enable uncontrolled growth and expansion to neighboring and distal tissues. The study of phylogenetic relationships between cancer cells provides key insights into these processes. Here, we introduced an evolving lineage-tracing system with a single-cell RNA-seq readout into a mouse model of Kras;Trp53 (KP)-driven lung adenocarcinoma and tracked tumor evolution from single-transformed cells to metastatic tumors at unprecedented resolution. We found that the loss of the initial, stable alveolar-type2-like state was accompanied by a transient increase in plasticity. This was followed by the adoption of distinct transcriptional programs that enable rapid expansion and, ultimately, clonal sweep of stable subclones capable of metastasizing. Finally, tumors develop through stereotypical evolutionary trajectories, and perturbing additional tumor suppressors accelerates progression by creating novel trajectories. Our study elucidates the hierarchical nature of tumor evolution and, more broadly, enables in-depth studies of tumor progression.

Section: Introduction

Cancer is an evolutionary process characterized by the dynamic interplay of cellular subpopulations, each driven by progressive genetic and epigenetic changes ( Nowell, 1976 87. Nowell, P.C. The clonal evolution of tumor cell populations Science. 1976; 194 :23-28 Crossref PubMed Google Scholar ). Throughout this process, cancer cells can acquire phenotypic heterogeneity that increases fitness by enabling them to grow more aggressively, invade neighboring tissues, evade the immune system and therapeutic challenges, and metastasize to distant sites ( Hanahan and Weinberg, 2011 42. Hanahan, D. ∙ Weinberg, R.A. Hallmarks of cancer: the next generation Cell. 2011; 144 :646-674 Full Text Full Text (PDF) Scopus (39262) PubMed Google Scholar ; Vogelstein et al., 2013 131. Vogelstein, B. ∙ Papadopoulos, N. ∙ Velculescu, V.E. ... Cancer genome landscapes Science. 2013; 339 :1546-1558 Crossref Scopus (4862) PubMed Google Scholar ; McGranahan and Swanton, 2017 77. McGranahan, N. ∙ Swanton, C. Clonal heterogeneity and tumor evolution: past, present, and the future Cell. 2017; 168 :613-628 Full Text Full Text (PDF) Scopus (1136) PubMed Google Scholar ). Interrogating the molecular bases of subclonal selection and metastatic seeding, the origins of and transitions between transcriptional states as well as the identities and genetic determinants of evolutionary paths that tumors undergo will not only illuminate fundamental principles governing tumor evolution but also have immediate clinical implications ( Black and McGranahan, 2021 10. Black, J.R.M. ∙ McGranahan, N. Genetic and non-genetic clonal diversity in cancer evolution Nat. Rev. Cancer. 2021; 21 :379-392 Crossref Scopus (35) PubMed Google Scholar ). To fully understand these processes, it is essential to study the evolutionary dynamics giving rise to a tumor in its native setting, preferably in experimentally defined conditions ( Amirouchene-Angelozzi et al., 2017 4. Amirouchene-Angelozzi, N. ∙ Swanton, C. ∙ Bardelli, A. Tumor evolution as a therapeutic target Cancer Discov. 2017; 7 :805-817 Crossref Scopus (105) Google Scholar ).
Tumor phylogenetic analysis, the study of lineage relationships among the cells comprising the tumor population descended from a single-transformed progenitor, can provide key insights into the dynamics of tumor progression. Classically, phylogenies have been constructed using naturally occurring somatic genomic variations (mutations or copy number variations [CNVs]) as natural lineage tracers. These efforts have illuminated several key evolutionary processes underpinning tumor development ( Vogelstein et al., 1988 132. Vogelstein, B. ∙ Fearon, E.R. ∙ Hamilton, S.R. ... Genetic alterations during colorectal-tumor development N. Engl. J. Med. 1988; 319 :525-532 Crossref PubMed Google Scholar ; Sjöblom et al., 2006 115. Sjöblom, T. ∙ Jones, S. ∙ Wood, L.D. ... The Consensus coding sequences of human breast and colorectal cancers Science. 2006; 314 :268-274 Crossref Scopus (2783) PubMed Google Scholar ; Schwartz and Schäffer, 2017 110. Schwartz, R. ∙ Schäffer, A.A. The evolution of tumour phylogenetics: principles and practice Nat. Rev. Genet. 2017; 18 :213-229 Crossref Scopus (111) PubMed Google Scholar ; Ludwig et al., 2019 70. Ludwig, L.S. ∙ Lareau, C.A. ∙ Ulirsch, J.C. ... Lineage tracing in humans enabled by mitochondrial mutations and single-cell genomics Cell. 2019; 176 :1325-1339.e22 Full Text Full Text (PDF) Scopus (160) PubMed Google Scholar ; Gao et al., 2021 36. Gao, R. ∙ Bai, S. ∙ Henderson, Y.C. ... Delineating copy number and clonal substructure in human tumors from single-cell transcriptomes Nat. Biotechnol. 2021; 39 :599-608 Crossref Scopus (38) PubMed Google Scholar ; Gerstung et al., 2020 40. Gerstung, M. ∙ Jolly, C. ∙ Leshchiner, I. ... The evolutionary history of 2,658 cancers Nature. 2020; 578 :122-128 Crossref Scopus (283) PubMed Google Scholar ; Sottoriva et al., 2015 117. Sottoriva, A. ∙ Kang, H. ∙ Ma, Z. ... A big bang model of human colorectal tumor growth Nat. Genet. 2015; 47 :209-216 Crossref Scopus (600) PubMed Google Scholar ), including the acquisition of critical subclonal genetic or epigenetic changes ( Gerlinger et al., 2014 39. Gerlinger, M. ∙ McGranahan, N. ∙ Dewhurst, S.M. ... Cancer: evolution within a lifetime Annu. Rev. Genet. 2014; 48 :215-236 Crossref Scopus (136) PubMed Google Scholar ; Williams et al., 2018 138. Williams, M.J. ∙ Werner, B. ∙ Heide, T. ... Quantification of subclonal selection in cancer from bulk sequencing data Nat. Genet. 2018; 50 :895-903 Crossref Scopus (113) PubMed Google Scholar ; Neftel et al., 2019 84. Neftel, C. ∙ Laffy, J. ∙ Filbin, M.G. ... An integrative model of cellular states, plasticity, and genetics for glioblastoma Cell. 2019; 178 :835-849.e21 Full Text Full Text (PDF) Scopus (515) PubMed Google Scholar ), the timing and routes of metastatic dissemination ( Turajlic and Swanton, 2016 130. Turajlic, S. ∙ Swanton, C. Metastasis as an evolutionary process Science. 2016; 352 :169-175 Crossref Scopus (312) PubMed Google Scholar ; Hu and Curtis, 2020 48. Hu, Z. ∙ Curtis, C. Looking backward in time to define the chronology of metastasis Nat. Commun. 2020; 11 :3213 Crossref Scopus (12) PubMed Google Scholar ), and the development of therapeutic resistance ( Maynard et al., 2020 74. Maynard, A. ∙ McCoach, C.E. ∙ Rotow, J.K. ... Therapy-induced evolution of human lung cancer revealed by single-cell RNA sequencing Cell. 2020; 182 :1232-1251.e22 Full Text Full Text (PDF) Scopus (106) PubMed Google Scholar ; Powles et al., 2021 96. Powles, T. ∙ Assaf, Z.J. ∙ Davarpanah, N. ... ctDNA guiding adjuvant immunotherapy in urothelial carcinoma Nature. 2021; 595 :432-437 Crossref Scopus (63) PubMed Google Scholar ; Abbosh et al., 2017 1. Abbosh, C. ∙ Birkbak, N.J. ∙ Wilson, G.A. ... Phylogenetic ctDNA analysis depicts early-stage lung cancer evolution Nature. 2017; 545 :446-451 Crossref Scopus (787) PubMed Google Scholar ; Kim et al., 2018 59. Kim, C. ∙ Gao, Ruli ∙ Sei, E. ... Chemoresistance evolution in triple-negative breast cancer delineated by single-cell sequencing Cell. 2018; 173 :879-893.e13 Full Text Full Text (PDF) Scopus (390) PubMed Google Scholar ; Salehi et al., 2021 107. Salehi, S. ∙ Kabeer, F. ∙ Ceglia, N. ... Clonal fitness inferred from time-series modelling of single-cell cancer genomes Nature. 2021; 595 :585-590 Crossref Scopus (7) PubMed Google Scholar ). Although progress has been enabled by innovative computational methods ( Potter et al., 2013 95. Potter, N.E. ∙ Ermini, L. ∙ Papaemmanuil, E. ... Single-cell mutational profiling and clonal phylogeny in cancer Genome Res. 2013; 23 :2115-2125 Crossref Scopus (94) PubMed Google Scholar ; El-Kebir et al., 2016 29. El-Kebir, M. ∙ Satas, G. ∙ Oesper, L. ... Inferring the mutational history of a tumor using multi-state perfect phylogeny mixtures Cell Syst. 2016; 3 :43-53 Full Text Full Text (PDF) PubMed Google Scholar ; Malikic et al., 2019 72. Malikic, S. ∙ Jahn, K. ∙ Kuipers, J. ... Integrative inference of subclonal tumour evolution from single-cell and bulk sequencing data Nat. Commun. 2019; 10 :2750 Crossref Scopus (49) PubMed Google Scholar ; Satas et al., 2020 108. Satas, G. ∙ Zaccaria, S. ∙ Mon, G. ... SCARLET: single-cell tumor phylogeny inference with copy-number constrained mutation losses Cell Syst. 2020; 10 :323-332.e8 Full Text Full Text (PDF) Scopus (18) PubMed Google Scholar ), these studies are limited by the inherent variation in naturally occurring somatic mutations, incomplete or low cell sampling, and other confounding variables (e.g. environmental exposures and genetic background) and are not amenable to further perturbations or functional studies.
Genetically engineered mouse models (GEMMs) of cancer provide a critical tool for modeling tumor progression as they allow one to study tumor evolution in its native microenvironment and experimentally defined conditions ( Hann and Balmain, 2001 43. Hann, B. ∙ Balmain, A. Building ‘validated’ mouse models of human cancer Curr. Opin. Cell Biol. 2001; 13 :778-784 Crossref Scopus (0) PubMed Google Scholar ; Frese and Tuveson, 2007 33. Frese, K.K. ∙ Tuveson, D.A. Maximizing mouse cancer models Nat. Rev. Cancer. 2007; 7 :645-658 Crossref Scopus (536) PubMed Google Scholar ). The Kras LSL-G12D/+ ; Trp53 fl/fl (KP) model of lung adenocarcinoma allows tumor initiation via viral delivery of Cre recombinase to a small number of lung epithelial cells, leading to activation of oncogenic Kras , homozygous deletion of the p53 tumor suppressor gene, and clonal tumor outgrowth. It faithfully models the major steps of tumor evolution from nascent cell transformation to aggressive metastasis, recapitulating human lung adenocarcinoma progression both molecularly and histopathologically ( Jackson et al., 2001 52. Jackson, E.L. ∙ Willis, N. ∙ Mercer, K. ... Analysis of lung tumor initiation and progression using conditional expression of oncogenic K-Ras Genes Dev. 2001; 15 :3243-3248 Crossref Scopus (1370) PubMed Google Scholar ; Jackson et al., 2005 51. Jackson, E.L. ∙ Olive, K.P. ∙ Tuveson, D.A. ... The differential effects of mutant p53 alleles on advanced murine lung cancer Cancer Res. 2005; 65 :10280-10288 Crossref Scopus (387) PubMed Google Scholar ; Winslow et al., 2011 139. Winslow, M.M. ∙ Dayton, T.L. ∙ Verhaak, R.G.W. ... Suppression of lung adenocarcinoma progression by Nkx2-1 Nature. 2011; 473 :101-104 Crossref Scopus (310) PubMed Google Scholar ). Moreover, recent work has revealed that substantial transcriptomic and epigenomic heterogeneities emerge during tumor evolution in this model ( Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ; LaFave et al., 2020 62. LaFave, L.M. ∙ Kartha, V.K. ∙ Ma, S. ... Epigenomic State transitions characterize tumor progression in mouse lung adenocarcinoma Cancer Cell. 2020; 38 :212-228.e13 Full Text Full Text (PDF) Scopus (58) PubMed Google Scholar ), consistent with human tumors ( Laughney et al., 2020 64. Laughney, A.M. ∙ Hu, J. ∙ Campbell, N.R. ... Regenerative lineages and immune-mediated pruning in lung cancer metastasis Nat. Med. 2020; 26 :259-269 Crossref Scopus (106) PubMed Google Scholar ). The tractability of this model provides an appealing opportunity to probe several unanswered but crucial questions regarding how tumors evolve including the following: how a single-transformed cell expands into an aggressive tumor, how various cell states relate to one another and contribute to tumor evolution, how different transcriptional states transition between each other, and how metastases and primary tumors are evolutionarily related.
Approaches that permit simultaneous measurements of cell lineage and cell state information have the potential to provide unique insights into these questions ( Tammela and Sage, 2020 122. Tammela, T. ∙ Sage, J. Investigating tumor heterogeneity in mouse models Annu. Rev. Cancer Biol. 2020; 4 :99-119 Crossref Scopus (13) PubMed Google Scholar ; Wagner and Klein, 2020 133. Wagner, D.E. ∙ Klein, A.M. Lineage tracing meets single-cell omics: opportunities and challenges Nat. Rev. Genet. 2020; 21 :410-427 Crossref Scopus (126) PubMed Google Scholar ; Stadler et al., 2021 120. Stadler, T. ∙ Pybus, O.G. ∙ Stumpf, M.P.H. Phylodynamics for cell biologists Science. 2021; 371 :p.eaah6266 Crossref Scopus (7) Google Scholar ). Although previous studies have used synthetic “static” barcoding techniques to study clonal relationships ( Bhang et al., 2015 8. Bhang, H.-E.C. ∙ Ruddy, D.A. ∙ Krishnamurthy Radhakrishna, V.K. ... Studying clonal dynamics in response to cancer therapy using high-complexity barcoding Nat. Med. 2015; 21 :440-448 Crossref Scopus (254) PubMed Google Scholar ; Livet et al., 2007 68. Livet, J. ∙ Weissman, T.A. ∙ Kang, H. ... Transgenic strategies for combinatorial expression of fluorescent proteinS in the nervous system Nature. 2007; 450 :56-62 Crossref Scopus (1298) PubMed Google Scholar ; Lan et al., 2017 63. Lan, X. ∙ Jörg, D.J. ∙ Cavalli, F.M.G. ... Fate mapping of human glioblastoma reveals an invariant stem cell hierarchy Nature. 2017; 549 :227-232 Crossref Scopus (185) PubMed Google Scholar ; Pei et al., 2017 92. Pei, W. ∙ Feyerabend, T.B. ∙ Rössler, J. ... Polylox barcoding reveals haematopoietic stem cell fates realized in vivo Nature. 2017; 548 :456-460 Crossref Scopus (205) PubMed Google Scholar ; Driessens et al., 2012 26. Driessens, G. ∙ Beck, B. ∙ Caauwe, A. ... Defining the mode of tumour growth by clonal analysis Nature. 2012; 488 :527-530 Crossref Scopus (554) PubMed Google Scholar ; Schepers et al., 2012 109. Schepers, A.G. ∙ Snippert, H.J. ∙ Stange, D.E. ... Lineage tracing reveals Lgr5+ stem cell activity in mouse intestinal adenomas Science. 2012; 337 :730-735 Crossref Scopus (819) PubMed Google Scholar ), studying the evolution of individual tumors at subclonal resolution remains challenging. This limitation is in large part due to the low mutational burden in GEMM tumors, thus offering little lineage resolution within individual tumors ( Westcott et al., 2015 137. Westcott, P.M.K. ∙ Halliwill, K.D. ∙ To, M.D. ... The mutational landscapes of genetic and chemical models of kras-driven lung cancer Nature. 2015; 517 :489-492 Crossref Scopus (214) PubMed Google Scholar ; McFadden et al., 2016 75. McFadden, D.G. ∙ Politi, K. ∙ Bhutkar, A. ... Mutational landscape of EGFR-, MYC-, and Kras-driven genetically engineered mouse models of lung adenocarcinoma Proc. Natl. Acad. Sci. USA. 2016; 113 :E6409-E6417 Crossref Scopus (105) PubMed Google Scholar ). The recent development of high-resolution CRISPR/Cas9-evolving lineage tracing paired with single-cell RNA-seq (scRNA-seq) readouts overcomes these limitations. Generally, such continuous lineage-tracing approaches leverage Cas9-induced DNA cleavage and subsequent repair to progressively generate heritable insertions and deletions (“indels”) at synthetic DNA target sites engineered into the genomes of living cells ( McKenna et al., 2016 79. McKenna, A. ∙ Findlay, G.M. ∙ Gagnon, J.A. ... Whole-organism lineage tracing by combinatorial and cumulative genome editing Science. 2016; 353 :p.aaf7907 Crossref Scopus (353) Google Scholar ; Frieda et al., 2017 34. Frieda, K.L. ∙ Linton, J.M. ∙ Hormoz, S. ... Synthetic recording and in situ readout of lineage information in single cells Nature. 2017; 541 :107-111 Crossref Scopus (221) PubMed Google Scholar ; Kalhor et al., 2018 57. Kalhor, R. ∙ Kalhor, K. ∙ Mejia, L. ... Developmental barcoding of whole mouse via homing CRISPR Science. 2018; 361 :eaat9804 Crossref Scopus (154) PubMed Google Scholar ; Chan et al., 2019 17. Chan, M.M. ∙ Smith, Z.D. ∙ Grosswendt, S. ... Molecular recording of mammalian embryogenesis Nature. 2019; 570 :77-82 Crossref Scopus (125) PubMed Google Scholar ; McKenna and Gagnon, 2019 80. McKenna, A. ∙ Gagnon, J.A. Recording development with single cell dynamic lineage tracing Development. 2019; 146 :dev169730 Crossref Scopus (61) PubMed Google Scholar ). Importantly, these DNA target sites are transcribed into polyadenylated mRNAs, allowing them to be captured and profiled along with all other cellular mRNAs using scRNA-seq. In doing so, this approach makes it possible to directly link the current cell state (as measured by scRNA-seq) with its inferred or putative past lineage history (as captured by the lineage tracer) and to do so on a massive scale ( Alemany et al., 2018 3. Alemany, A. ∙ Florescu, M. ∙ Baron, C.S. ... Whole-organism clone tracing using single-cell sequencing Nature. 2018; 556 :108-112 Crossref Scopus (215) PubMed Google Scholar ; Spanjaard et al., 2018 118. Spanjaard, B. ∙ Hu, B. ∙ Mitic, N. ... Simultaneous lineage tracing and cell-type identification using CRISPR-Cas9-induced genetic scars Nat. Biotechnol. 2018; 36 :469-473 Crossref Scopus (223) PubMed Google Scholar ; Raj et al., 2018 100. Raj, B. ∙ Wagner, D.E. ∙ McKenna, A. ... Simultaneous single-cell profiling of lineages and cell types in the vertebrate brain Nat. Biotechnol. 2018; 36 :442-450 Crossref Scopus (262) PubMed Google Scholar ; Chan et al., 2019 17. Chan, M.M. ∙ Smith, Z.D. ∙ Grosswendt, S. ... Molecular recording of mammalian embryogenesis Nature. 2019; 570 :77-82 Crossref Scopus (125) PubMed Google Scholar ; Bowling et al., 2020 11. Bowling, S. ∙ Sritharan, D. ∙ Osorio, F.G. ... An engineered CRISPR-Cas9 mouse line for simultaneous readout of lineage histories and gene expression profiles in single cells Cell. 2020; 181 :1410-1422 Full Text Full Text (PDF) Scopus (64) PubMed Google Scholar ). Recently, this technology has been introduced into cancer cell lines before transplanting them into mice to track metastatic behaviors in vivo ( Simeonov et al., 2021 113. Simeonov, KamenP. ∙ Byrns, C.N. ∙ Clark, M.L. ... Single-cell lineage tracing of metastatic cancer reveals selection of hybrid EMT states Cancer Cell. 2021; 39 :1150-1162.e9 Full Text Full Text (PDF) Scopus (33) PubMed Google Scholar ; Quinn et al., 2021 98. Quinn, J.J. ∙ Jones, M.G. ∙ Okimoto, R.A. ... Single-cell lineages reveal the rates, routes, and drivers of metastasis in cancer xenografts Science. 2021; 371 :p.eabc1944 Crossref Scopus (45) Google Scholar ; Zhang et al., 2021 145. Zhang, W. ∙ Bado, I.L. ∙ Hu, J. ... The bone microenvironment invigorates metastatic seeds for further dissemination Cell. 2021; 184 :2471-2486.e20 Full Text Full Text (PDF) Scopus (27) PubMed Google Scholar ).
Here, we have developed an autochthonous “KP-Tracer” mouse model that allows us to simultaneously initiate an engineered lineage-tracing system and induce Kras and Trp53 oncogenic mutations in individual lung epithelial cells. This enabled continuous and comprehensive monitoring of the processes by which a single-cell harboring oncogenic mutations evolves into an aggressive tumor. The resulting tumor phylogenies reveal that rare subclones drive tumor expansion by adopting distinct fitness-associated transcriptional programs. By integrating lineage and transcriptome data, we uncovered changes in cancer cell plasticity and parallel evolutionary paths of tumor evolution in this model, which could be profoundly altered by perturbing additional tumor suppressor genes commonly mutated in human tumors. We have also identified the subclonal origins, spatial locations, and cellular states of metastatic progression. Collectively, this technology allowed us to reconstruct the lifespan of a tumor from a single-transformed cell to a complex and aggressive tumor population at unprecedented scale and resolution.

Section: Results

To generate high-resolution tumor phylogenies, we developed a lineage-tracing competent mouse model of lung adenocarcinoma capable of months-long continuous cell lineage tracing ( Figure 1 A). Specifically, we engineered mouse embryonic stem cells (mESCs) harboring the conditional alleles Kras LSL-G12D/+ and Trp53 fl/fl (KP) to additionally encode conditional SpCas9 and mNeonGreen fluorophore at the Rosa26 locus; Rosa26 LSL-Cas9-P2A-mNeonGreen (KPCas9). We then engineered these mESCs with a refined version of our lineage-tracing technology ( Chan et al., 2019 17. Chan, M.M. ∙ Smith, Z.D. ∙ Grosswendt, S. ... Molecular recording of mammalian embryogenesis Nature. 2019; 570 :77-82 Crossref Scopus (125) PubMed Google Scholar ; Quinn et al., 2021 98. Quinn, J.J. ∙ Jones, M.G. ∙ Okimoto, R.A. ... Single-cell lineages reveal the rates, routes, and drivers of metastasis in cancer xenografts Science. 2021; 371 :p.eabc1944 Crossref Scopus (45) Google Scholar ). Specifically, we introduced a library of piggyBac transposon-based lineage-tracing vector containing two essential components: first, target sites for lineage tracing, consisting of three cut sites positioned within the 3′ UTR of a mCherry fluorescent reporter and a 14-base-pair randomer integration barcode (“intBC”) to distinguish individual copies; second, three constitutively expressed single-guide RNAs (sgRNAs) for directing Cas9 to each of the three individual cut sites within the target sites, thereby generating indels for lineage tracing ( Figure S1 A). A key enabling feature is that the speed of tracing (i.e., indel generation kinetics) can be tuned to match the tumor developmental timescale by engineering mismatches between sgRNAs and target sites ( Chan et al., 2019 17. Chan, M.M. ∙ Smith, Z.D. ∙ Grosswendt, S. ... Molecular recording of mammalian embryogenesis Nature. 2019; 570 :77-82 Crossref Scopus (125) PubMed Google Scholar ; Quinn et al., 2021 98. Quinn, J.J. ∙ Jones, M.G. ∙ Okimoto, R.A. ... Single-cell lineages reveal the rates, routes, and drivers of metastasis in cancer xenografts Science. 2021; 371 :p.eabc1944 Crossref Scopus (45) Google Scholar ). We isolated engineered mESC clones by fluorescence-activated cell sorting (FACS) based on high mCherry expression ( Figures S1 B and S1C) and selected clones with 10–30 integrated target sites by quantitative PCR (qPCR) and DNA sequencing ( Figures S1 D and S1E). Finally, we generated chimeric mice (hereafter “KP-Tracer” mice) from five validated mESC clones to ensure that evolutionary behavior was not idiosyncratic to a specific clone ( Zhou et al., 2010 147. Zhou, Y. ∙ Rideout, 3rd, W.M. ∙ Zi, T. ... Chimeric mouse tumor models reveal differences in pathway activation between ERBB family- and KRAS-dependent lung adenocarcinomas Nat. Biotechnol. 2010; 28 :71-78 Crossref Scopus (0) PubMed Google Scholar ; Premsrirut et al., 2011 97. Premsrirut, P.K. ∙ Dow, L.E. ∙ Kim, S.Y. ... A rapid and scalable system for studying gene function in mice using conditional RNA interference Cell. 2011; 145 :145-158 Full Text Full Text (PDF) Scopus (227) PubMed Google Scholar ).
In KP-Tracer mice, intratracheal administration of lentivirus expressing Cre recombinase simultaneously initiates lung tumors by activating conditional oncogenic alleles and lineage tracing by inducing the expression of Cas9 that, together with the expressed sgRNAs, causes accumulation of indels in the target sites ( DuPage et al., 2009 27. DuPage, M. ∙ Dooley, A.L. ∙ Jacks, T. Conditional mouse lung cancer models using adenoviral or lentiviral delivery of Cre recombinase Nat. Protoc. 2009; 4 :1064-1072 Crossref Scopus (508) PubMed Google Scholar ). Previous static lineage tracing studies, using lentiviral barcoding or multicolor reporters, have shown that KP tumors induced with this strategy are clonal and homogenously contain oncogenic Kras;p53 mutations ( Chuang et al., 2017 20. Chuang, C.H. ∙ Greenside, P.G. ∙ Rogers, Z.N. ... Molecular definition of a metastatic lung cancer state reveals a targetable CD109–Janus kinase–Stat Axis Nat. Medicine. 2017; 23 :291-300 Crossref Scopus (0) PubMed Google Scholar ; Caswell et al., 2014 15. Caswell, D.R. ∙ Chuang, C.-H. ∙ Yang, D. ... Obligate progression precedes lung adenocarcinoma dissemination Cancer Discov. 2014; 4 :781-789 Crossref Scopus (34) PubMed Google Scholar ). To validate tumor clonality, we induced tumors with a barcoded lentiviral-Cre construct (lenti-Cre-BC) providing a unique clonal barcode for each tumor ( Adamson et al., 2016 2. Adamson, B. ∙ Norman, T.M. ∙ Jost, M. ... A multiplexed single-cell CRISPR screening platform enables systematic dissection of the unfolded protein response Cell. 2016; 167 :1867-1882.e21 Full Text Full Text (PDF) Scopus (420) PubMed Google Scholar ).
Individual tumors with strong mCherry and mNeonGreen expression (indicating target site and Cre, respectively) and clear boundary separation from adjacent tumors were harvested 5–6 months after tumor initiation, microdissected, and dissociated completely to ensure unbiased cell sampling ( Figure 1 B; Table S1 ). After being labeled with Multiplexing Using Lipid-Tagged Indices for scRNA-seq (MULTI-seq) ( McGinnis et al., 2019 76. McGinnis, C.S. ∙ Patterson, D.M. ∙ Winkler, J. ... MULTI-Seq: sample multiplexing for single-cell RNA sequencing using lipid-tagged indices Nat. Methods. 2019; 16 :619-626 Crossref Scopus (124) PubMed Google Scholar ) and purified by FACS ( STAR Methods ), cancer cells were subjected to scRNA-seq analysis to measure cell state, lineage, sample identity, and tumor clonality. After integrating all four datasets for each cell ( Figure 1 C; STAR Methods ), we proceeded with paired lineage and transcriptome measurements for 40,386 cells with a median of 9,680 UMIs and 2,877 genes detected across 35 tumors (29 primary tumors and 6 metastases; a median of 511 cells were detected per primary tumor). Importantly, target sites were consistently expressed across tumors ( Figures 1 D, S1 F, and S1G).
After preprocessing target site data based on lineage-tracing sequencing quality control and ensuring tumor clonality with lenti-Cre-BC information ( Figure 1 C; STAR Methods ), we reconstructed phylogenies for each tumor with Cassiopeia ( Jones et al., 2020 55. Jones, M.G. ∙ Khodaverdian, A. ∙ Quinn, J.J. ... Inference of single-cell phylogenies from lineage tracing data using Cassiopeia Genome Biol. 2020; 21 :92 Crossref Scopus (14) PubMed Google Scholar ). Figure 1 E displays the inferred phylogeny and its corresponding indel status (summarized in an “allele heatmap”) of a single-representative tumor, consisting of 772 cells. The resulting tree revealed a rich subclonal structure and deep lineage relationships, with a median depth of 12 and a maximum depth of 15. As a validation of the integrity of our lineage reconstruction, we observed strong correlations between phylogenetic and allelic distances across our trees ( Figure 1 F; Table S1 ). With these high-resolution tumor phylogenies, we next turned to studying the relationship between subclonal dynamics and cellular state as determined by gene expression.
A key question in tumor evolution is how subclonal selection, based on the acquisition of growth-promoting genetic or epigenetic changes, and the resulting population dynamics lead to the expansion of aggressive subclones relative to other parts of the same tumor ( Nowell, 1976 87. Nowell, P.C. The clonal evolution of tumor cell populations Science. 1976; 194 :23-28 Crossref PubMed Google Scholar ; McGranahan and Swanton, 2017 77. McGranahan, N. ∙ Swanton, C. Clonal heterogeneity and tumor evolution: past, present, and the future Cell. 2017; 168 :613-628 Full Text Full Text (PDF) Scopus (1136) PubMed Google Scholar ; Davis et al., 2017 21. Davis, A. ∙ Gao, Ruli ∙ Navin, N. Tumor evolution: linear, branching, neutral or punctuated? Biochim. Biophys. Acta Rev. Cancer. 2017; 1867 :151-161 Crossref Scopus (143) PubMed Google Scholar ; Sottoriva et al., 2015 117. Sottoriva, A. ∙ Kang, H. ∙ Ma, Z. ... A big bang model of human colorectal tumor growth Nat. Genet. 2015; 47 :209-216 Crossref Scopus (600) PubMed Google Scholar ). To examine the subclonal dynamics in KP tumors, we adapted a statistical test that compares the relative size of each subclone with what would be expected in a “neutral” model of evolution where no subclone is under selection ( STAR Methods ( Griffiths and Tavaré, 1998 41. Griffiths, R.C. ∙ Tavaré, S. The age of a mutation in a general coalescent tree Commun. Stat. Stochast. Models. 1998; 14 :273-295 Crossref Google Scholar ; Speidel et al., 2019 119. Speidel, L. ∙ Forest, M. ∙ Shi, S. ... A method for genome-wide genealogy estimation for thousands of samples Nat. Genet. 2019; 51 :1321-1329 Crossref Scopus (90) PubMed Google Scholar )). Using this method on a high-quality subset (21/29) of primary tumors ( Figure S1 H; STAR Methods ), we found examples of tumors that appeared to be neutrally evolving (i.e., with no evidence for positive selection) and tumors with subclones showing clear signs of positive selection ( Figure 2 A). Tumors predominantly had one or sometimes two subclones undergoing expansion, and across tumors, there was a broad distribution in the proportion of cells within expansions ( Figure 2 B). The proportion of expanding cells in each tumor was poorly explained by individual technical covariates, including the age of the tumor (R 2 = 0.25 ± 0.14), the depth of the tumor phylogeny (R 2 = 0.23 ± 0.15), the number of cells in the tumor (R 2 = 0.09 ± 0.07), and the proportion of unique cell lineage states (R 2 = 0.28 ± 0.15, Figures S2 A–S2D), although an additive linear model with all of these covariates was a stronger predictor (R 2 = 0.52).
Several lines of evidence support the accuracy of the inferred phylogenies and subclonal dynamics. First, lineage trees inferred by an alternative phylogenetic reconstruction algorithm, Neighbor Joining, revealed consistent subclonal expansion proportions ( Saitou and Nei, 1987 106. Saitou, N. ∙ Nei, M. The neighbor-joining method: A new method for reconstructing phylogenetic trees Mol. Biol. Evol. 1987; 4 :406-425 PubMed Google Scholar ; Pearson’s ρ = 0.87, Figure S2 E). Second, copy number variation (CNV)—a common feature for inferring subclonal structure in tumors ( Tarabichi et al., 2021 125. Tarabichi, M. ∙ Salcedo, A. ∙ Deshwar, A.G. ... A practical guide to cancer subclonal reconstruction from DNA sequencing Nat. Methods. 2021; 18 :144-155 Crossref Scopus (25) PubMed Google Scholar )—corroborated tumor subclonal structure. Specifically, despite the low-resolution lineages inferred from detected CNVs, in the majority of tumors (20/21), the relationships from subclonal CNVs were significantly similar to the relationships inferred from our Cas9 lineage-tracing trees ( Figures S2 G–S2I; Permutation Test; see STAR Methods ). Furthermore, expanding subclones were significantly enriched for CNVs (Mann-Whitney U test p < 0.0001, Figures 2 C, 2D, and S2 J), and independent subclonal expansions from the same tumor could harbor distinct CNV patterns ( Figure S2 K). Third, cancer cells in expansions had significantly higher expression of cell-cycle genes (Mann-Whitney U test; Figures 2 E and S2 F; STAR Methods ). Together with our tumor spatial-lineage analysis (see below), these orthogonal data strongly support the fidelity of our tumor phylogeny and expansion calling and indicate the aggressive nature of subclonal expansions.
In population genetics, the relative “fitness” of a sample can be defined as the growth advantage of an individual compared with the rest of the population ( Williams et al., 2018 138. Williams, M.J. ∙ Werner, B. ∙ Heide, T. ... Quantification of subclonal selection in cancer from bulk sequencing data Nat. Genet. 2018; 50 :895-903 Crossref Scopus (113) PubMed Google Scholar ). The fine-scale structure of our lineages offers us the opportunity to predict fitness at single-cell resolution ( Figure 2 F; STAR Methods , Neher et al., 2014 85. Neher, R.A. ∙ Russell, C.A. ∙ Shraiman, B.I. Predicting evolution from the shape of genealogical trees eLife. 2014; 3 :e03568 Crossref Scopus (90) Google Scholar ). This analysis revealed a spectrum of intratumoral fitness distributions across tumors ( Figure 2 G) with expanding cells consistently having higher single-cell fitness scores (Mann-Whitney U test p < 0.0001, Figures 2 F and 2H). Overall, these results argue that we can quantitatively infer the relative fitness of individual cells within a tumor and that cell fitness is consistent with the subclonal dynamics revealed by the tumor phylogeny.
With quantitative measurements of single-cell fitness in each tumor, we next sought to identify the molecular features consistently associated with subclonal expansions. Consistent with KP tumor progression being driven largely by epigenetic rather than genetic changes ( LaFave et al., 2020 62. LaFave, L.M. ∙ Kartha, V.K. ∙ Ma, S. ... Epigenomic State transitions characterize tumor progression in mouse lung adenocarcinoma Cancer Cell. 2020; 38 :212-228.e13 Full Text Full Text (PDF) Scopus (58) PubMed Google Scholar ; Arnal-Estapé et al., 2020 5. Arnal-Estapé, A. ∙ Cai, W.L. ∙ Albert, A.E. ... Tumor progression and chromatin landscape of lung cancer are regulated by the lineage factor GATA6 Oncogene. 2020; 39 :3726-3737 Crossref Scopus (0) PubMed Google Scholar ; Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ), we observed that CNV profiles within expansions were largely inconsistent across tumors ( Figure S2 L). We therefore examined the transcriptomic differences underpinning expansion. By integrating the scRNA-seq data across tumors, we detected 15 distinct subpopulations characterized by marker genes consistent with previous work in the KP model: spanning from an early-stage alveolar type 2 (AT2)-like population, characterized by expression of Lyz2 and Sftpc , to late-stage Epithelial-Mesenchymal transition (EMT)-related clusters characterized by expressions of Vim, Twist1 , and Zeb2 (( Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ; LaFave et al., 2020 62. LaFave, L.M. ∙ Kartha, V.K. ∙ Ma, S. ... Epigenomic State transitions characterize tumor progression in mouse lung adenocarcinoma Cancer Cell. 2020; 38 :212-228.e13 Full Text Full Text (PDF) Scopus (58) PubMed Google Scholar ); Figures 3 A and S3 A; Table S2 ). Notably, although normal AT2 cells appeared similar to the tumor AT2-like state, the transcriptome of cancer cells could be clearly distinguished from normal AT2 cells ( Figure S3 B; STAR Methods ). Together, the agreement of transcriptomic states observed here and in previous studies implies that the continuous lineage-tracing system did not strongly perturb tumor progression.
Combining the aforementioned single-cell fitness scores with single-cell transcriptomes for each tumor, we next identified genes associated with changes in fitness for each tumor ( Figure 3 B; STAR Methods ). We then utilized a majority vote meta-analysis of differentially expressed genes across tumors to find genes consistently associated with fitness differences ( Figure 3 C; STAR Methods ; Table S3 ). The resulting consensus genes associated with elevated fitness revealed broad transcriptomic changes and were enriched for gene sets associated with ribosome biogenesis, stem cell differentiation, and wound healing ( Table S3 ).
The genes detected in our majority vote meta-analysis represented a transcriptional program (hereafter referred to as the “FitnessSignature”) consistently associated with tumor expansions that could be used to describe state trajectories underlying tumor evolution. Indeed, the AT2-like cluster had the lowest FitnessSignature score, whereas the Mesenchymal clusters scored highest ( Figures 3 D and 3E; STAR Methods ). Interestingly, the ranking of Leiden clusters in between these extremes suggested that an increase in FitnessSignature was concomitant with transitions from the AT2-like state through various Gastric, Endoderm-like, or Lung Mixed states to an eventual Mesenchymal state ( Figures 3 D and 3E). Importantly, the FitnessSignature scores were significantly associated with poor prognosis in patients with lung adenocarcinoma from The Cancer Genome Atlas (TCGA; The Cancer Genome Atlas Research Network, 2014 13. Cancer Genome Atlas Research Network Comprehensive molecular profiling of lung adenocarcinoma Nature. 2014; 511 :543-550 Crossref Scopus (3216) PubMed Google Scholar ; Figure 3 F; STAR Methods ).
Consistent with previous studies showing increased transcriptional heterogeneity during KP tumor evolution ( Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ), we observed that tumors occupied qualitatively different transcriptional states ( Figure S3 E). This progression could be categorized into three nonoverlapping gene modules decomposed from the FitnessSignature ( Figures S3 F and S3G; STAR Methods ): Module 1 contained genes enriched for gastric and endoderm signatures ( Tff1 , Hnf4a , and Gkn2 ), Module 2 contained a subset of EMT marker genes and some neuronal genes ( Hmga2 , Inhba , and Gap43 ), and Module 3 contained classical mesenchymal and prometastasis genes ( Vim , Twist1 , Cdh2 , Cd109 , and Runx2 ) ( Figures 3 G and 3H; Table S3 ). Additionally, tumor subclonal expansions could preferentially employ a particular module, although some expansions exhibited coexpression of multiple modules ( Figures 3 I, S3 I, and S3J; STAR Methods ). Importantly, the expression of each of these modules was predictive of worse patient survival in the TCGA lung adenocarcinoma cohort ( Figure S3 H; STAR Methods ). Collectively, these results argue that increased cell fitness in lung adenocarcinoma can be achieved via at least three distinct transcriptional modules.
We next investigated the dynamics of intratumoral transcriptional diversity, as such behavior can be a driver of tumor aggressiveness and therapeutic resistance ( Patel et al., 2014 91. Patel, A.P. ∙ Tirosh, I. ∙ Trombetta, J.J. ... Single-cell RNA-Seq highlights intratumoral heterogeneity in primary glioblastoma Science. 2014; 344 :1396-1401 Crossref Scopus (2181) PubMed Google Scholar ; Rathert et al., 2015 101. Rathert, P. ∙ Roth, M. ∙ Neumann, T. ... Transcriptional plasticity promotes primary and acquired resistance to BET inhibition Nature. 2015; 525 :543-547 Crossref Scopus (323) PubMed Google Scholar ; Shaffer et al., 2017 111. Shaffer, S.M. ∙ Dunagin, M.C. ∙ Torborg, S.R. ... Rare cell variability and drug-induced reprogramming as a mode of cancer drug resistance Nature. 2017; 546 :431-435 Crossref Scopus (484) PubMed Google Scholar ; Kim et al., 2018 59. Kim, C. ∙ Gao, Ruli ∙ Sei, E. ... Chemoresistance evolution in triple-negative breast cancer delineated by single-cell sequencing Cell. 2018; 173 :879-893.e13 Full Text Full Text (PDF) Scopus (390) PubMed Google Scholar ; Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ; Maynard et al., 2020 74. Maynard, A. ∙ McCoach, C.E. ∙ Rotow, J.K. ... Therapy-induced evolution of human lung cancer revealed by single-cell RNA sequencing Cell. 2020; 182 :1232-1251.e22 Full Text Full Text (PDF) Scopus (106) PubMed Google Scholar ). In our model, tumors varied widely in the transcriptional states they occupied, rarely being dominated by a single state. Although tumors with low FitnessSignature scores were enriched for the AT2-like state, increases in the fitness score were associated with Gastric-like, Lung Mixed, and Mesenchymal states ( Figure S4 A). Moreover, tumors had generally similar levels of transcriptional state heterogeneity, as measured by the Shannon’s Entropy Index (( Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ; LaFave et al., 2020 62. LaFave, L.M. ∙ Kartha, V.K. ∙ Ma, S. ... Epigenomic State transitions characterize tumor progression in mouse lung adenocarcinoma Cancer Cell. 2020; 38 :212-228.e13 Full Text Full Text (PDF) Scopus (58) PubMed Google Scholar ); Figure S4 B).
How is this intratumoral diversity established and maintained? In principle, this diversity reflected by the entropy index can be achieved either by rare transitions and stable commitment to distinct states or by frequent transitions between these states. Lineage tracing is uniquely positioned to distinguish these two models as it directly reports how intermixed transcriptomic states are in subclonal lineages, thus providing a measure of effective plasticity. Interestingly, tumor subclones exhibited varying amounts of plasticity: some tumor subclones were dominated by a single-transcriptomic state, suggesting strong stability ( Figure 4 A), whereas others were characterized by strong mixing between transcriptomic states ( Figure 4 B). Using tumor phylogenies, we estimated the frequency of cellular state changes for each tumor to create an empirical measurement of the tree plasticity (hereafter referred to as the “EffectivePlasticity” score) and extended this measure to a single-cell statistic (“scEffectivePlasticity”) by averaging together the EffectivePlasticity scores for all the subclades that contained a particular cell ( Quinn et al., 2021 98. Quinn, J.J. ∙ Jones, M.G. ∙ Okimoto, R.A. ... Single-cell lineages reveal the rates, routes, and drivers of metastasis in cancer xenografts Science. 2021; 371 :p.eabc1944 Crossref Scopus (45) Google Scholar ; STAR Methods ). Importantly, this scEffectivePlasticity statistic was consistent with alternative approaches that quantified the effective plasticity by comparing transcriptional states between cells with similar indel states (without relying on trees; Figures S4 C–S4E) or by computing dissimilarity in gene expression profiles between nearest neighbors on the phylogeny ( Figures S4 F–S4H; STAR Methods ).
In two representative tumors, we observed that cells from the AT2-like state exhibited consistently low scEffectivePlasticity, whereas other states like the Gastric- and AT1-like state had elevated scEffectivePlasticity scores ( Figures 4 C and 4D). To systematically quantify the relative effective plasticity of different cell states, we averaged scEffectivePlasticity scores for each Leiden cluster on a tumor-by-tumor basis ( Figure 4 E). Mesenchymal (Leiden clusters 1 & 2) and AT2-like clusters (Leiden cluster 4) represented the most stable states, whereas the previously reported “High-Plasticity Cell State” ( Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ; Leiden cluster 5), Gastric-like (Leiden clusters 3, 8, 12), and Endoderm-like states (Leiden cluster 0) exhibited high EffectivePlasticity ( Figure 4 F).
We next investigated the relationship of tumor plasticity, as measured by EffectivePlasticity, and aggressiveness, as measured by the FitnessSignature. Although previous studies have indicated that transcriptional heterogeneity is a hallmark of tumor progression ( Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ), we found that the average EffectivePlasticity score was maximized when the FitnessSignature score was in the intermediate regime and minimized when the FitnessSignature was on the low or high extremes ( Figures 4 G, S4 I, and S4J). Taken together, these findings support a model of tumor progression, whereby the loss of AT2-like state was accompanied by rapid, parallel transitions to generate high transcriptomic heterogeneity, which permitted selection of increasingly stable states with higher-fitness and ultimately resulted in subclonal expansion and tumor progression ( Figure 4 H).
In principle, the observed cellular plasticity and subsequent transcriptional heterogeneity in the KP model could arise from either random or structured evolutionary paths through transcriptional states. To investigate the consistency of evolutionary paths across tumors, we developed a statistic termed “Evolutionary Coupling,” which extends a clonal coupling statistic ( Weinreb et al., 2020 136. Weinreb, C. ∙ Rodriguez-Fraticelli, A. ∙ Camargo, F.D. ... Lineage tracing on transcriptional landscapes links state to Fate during differentiation Science. 2020; 367 :p.eaaw3381 Crossref Scopus (163) Google Scholar ; Wagner et al., 2018 134. Wagner, D.E. ∙ Weinreb, C. ∙ Collins, Z.M. ... Single-cell mapping of gene expression landscapes and lineage in the zebrafish embryo Science. 2018; 360 :981-987 Crossref Scopus (339) PubMed Google Scholar ) to quantify the phylogenetic distance between pairs of cell states ( STAR Methods ).
Applying this approach to individual tumors uncovered distinct coupling patterns between transcriptomic states. In one example tumor, the Lung Mixed state was more closely related to the High-Plasticity state than to the AT2-like state ( Figures 5 A and 5B). In another tumor, the Gastric-like and High-Plasticity states clustered together, whereas the AT1-like and Early Gastric states clustered together ( Figures 5 C and 5D). Relationships for these two tumors were consistent with alternative definitions for interstate coupling, inferred directly from the indel information (without relying on trees; Figures S5 A and S5B; STAR Methods ) or based on local neighborhoods on the tree ( Figure S5 C and S5D; STAR Methods ); these statistics were generally consistent across trees ( Figure S5 E).
A data-driven hierarchical clustering of the full set of tumors based on their transcriptional state occupancy and Evolutionary Couplings revealed that tumors could be classified into three distinct groups (“Fate Clusters”; Figures 5 E and S5 F; STAR Methods ; Table S4 ). Although some transcriptional states were shared between Fate Clusters 1 and 2 (including the AT2-like, AT1-like, and High-Plasticity states), Fate Cluster 1 was predominantly distinguished by couplings that include the Gastric-like (Leiden clusters 3, 8, and 12) and Endoderm-like states (Leiden cluster 0; Figure 5 F, left, Figure S5 G) and Fate Cluster 2 by evolution toward the Lung Mixed state (Leiden cluster 10; Figure 5 F, middle, Figure S5 G). Fate Cluster 3 was more difficult to interpret as it lacked couplings with the AT2-like state and instead was dominated by high-fitness states, such as early EMT (Leiden clusters 7 and 13) and Mesenchymal states (Leiden clusters 1 and 2; Figure 5 F, right, Figure S5 G).
We thus hypothesized that the majority of differences between tumors was driven by tendencies toward Fate Clusters 1 or 2. Indeed, Principal Component Analysis (PCA) on Evolutionary Couplings and state composition revealed that the first two principal components explained a substantial amount of the observed variance (∼32%; Figure S5 H), and couplings involving the Gastric & Endoderm states (Fate Cluster 1; Leiden clusters 3, 8, 0) or the Lung Mixed state (Fate Cluster 2; Leiden cluster 10) were among the strongest features distinguishing tumors ( Figure S5 I). Taken together, these distinct coupling patterns argue that tumor progression from the initial AT2 state preferentially follows one of two nonoverlapping evolutionary paths, characterized by Fate Clusters 1 and 2, to aggressive states like those found in Fate Cluster 3.
To characterize the transcriptional changes that underlie these two alternative fates (Fate Clusters 1 & 2), we developed “Phylotime”: a single-cell statistic that quantifies the evolutionary distance between an individual cell and cells in the progenitor, AT2-like state ( STAR Methods ). Importantly, estimates of Phylotime were consistent with different metrics for approximating distances on the tree: either by the absolute number of mutations or the number of mutation-bearing edges ( Figures S5 J and S5K). Integrating Phylotimes from tumors within Fate Clusters 1 and 2 confirmed two separate evolutionary routes ( Figure 5 G) and highlighted distinct transcriptional changes associated with Phylotime along each route ( Figure 5 H; STAR Methods ; Table S5 ). Specifically, although expressions of early markers like Lyz2 and Sftpc were shared in early Phylotime of both Fate Clusters, late Phylotime in Fate Cluster 1 was enriched for gastric and endoderm markers like Gkn2 , whereas late Phylotime in Fate Cluster 2 was characterized by markers of airway progenitors, such as Sox2 and Scgb1a1 ( Leeman et al. 2014 66. Leeman, K.T. ∙ Christine, M.F. ∙ Carla, F.K. “Lung Stem and Progenitor Cells in Tissue Homeostasis and Disease” Current Topics in Developmental Biology. 2014; 107 :207-233 Crossref Scopus (0) PubMed Google Scholar ), and markers of tumor propagating cells, like Cd24a and Itgb4 ( Zheng et al. 2013 146. Zheng, Y. ∙ Cecile, C. ∙ Leanne, C.S. ... “A Rare Population of CD24+ ITGB4+ Notchhi Cells Drives Tumor Propagation in NSCLC and Requires Notch3 for Self-Renewal”. Cancer Cell. 2013; 24 :59-74 Full Text Full Text (PDF) Scopus (0) PubMed Google Scholar ; Bierie et al. 2017 9. Bierie, B. ∙ Sarah, E.P. ∙ Cornelia, K. ... “Integrin-β4 Identifies Cancer Stem Cell-Enriched Populations of Partially Mesenchymal Carcinoma Cells.” Proceedings of the National Academy of Sciences of the United States of America. 2017; 114 :E2337-E2346 Crossref Scopus (0) PubMed Google Scholar ). Although Fate Cluster 3 tumors generally had poor couplings with earlier states, our data suggest that tumors can evolve from either the Fate Cluster 1 or Fate Cluster 2 into an EMT state and progress to late-stage Mesenchymal states ( Figure S5 L). Overall, our analysis provides evidence that KP tumors could evolve predominantly through one of two major paths with one toward Gastric-like and Endoderm-like state and the other through the Lung Mixed state, with distinct transcriptional changes associated with each evolutionary trajectory (summarized in Figure 5 I).
Tumor suppressor genes regulate diverse cellular activities, and their loss is associated with increased tumor aggressiveness ( Weinberg, 1991 135. Weinberg, R.A. Tumor suppressor genes Science. 1991; 254 :1138-1146 Crossref PubMed Google Scholar ; Sherr, 2004 112. Sherr, C.J. Principles of tumor suppression Cell. 2004; 116 :235-246 Full Text Full Text (PDF) Scopus (755) PubMed Google Scholar ); however, it remains unclear how these genes affect tumor evolutionary dynamics in vivo . Here, we combined genetic perturbations with our quantitative phylodynamic approaches to interrogate how additional oncogenic mutations altered KP tumor evolutionary trajectories.
We focused on two frequently mutated tumor suppressors in human lung adenocarcinoma, LKB1 and APC ( Ding et al., 2008 25. Ding, L. ∙ Getz, G. ∙ Wheeler, D.A. ... Somatic mutations affect key pathways in lung adenocarcinoma Nature. 2008; 455 :1069-1075 Crossref Scopus (2099) PubMed Google Scholar ; The Cancer Genome Atlas Research Network, 2014 13. Cancer Genome Atlas Research Network Comprehensive molecular profiling of lung adenocarcinoma Nature. 2014; 511 :543-550 Crossref Scopus (3216) PubMed Google Scholar ; Skoulidis et al., 2015 116. Skoulidis, F. ∙ Byers, L.A. ∙ Diao, L. ... Co-occurring genomic alterations define major subsets of KRAS-mutant lung adenocarcinoma with distinct biology, immune profiles, and therapeutic vulnerabilities Cancer Discov. 2015; 5 :860-877 Crossref Scopus (485) PubMed Google Scholar ). Both genes have been studied extensively in both human and mouse models and appear to regulate progression through distinct mechanisms ( Ji et al., 2007 54. Ji, H. ∙ Ramsey, M.R. ∙ Hayes, D.N. ... LKB1 modulates lung cancer differentiation and metastasis Nature. 2007; 448 :807-810 Crossref Scopus (761) PubMed Google Scholar ; Carretero et al., 2010 14. Carretero, J. ∙ Shimamura, T. ∙ Rikova, K. ... Integrative genomic and proteomic analyses identify targets for LKB1-deficient metastatic lung tumors Cancer Cell. 2010; 17 :547-559 Full Text Full Text (PDF) Scopus (188) PubMed Google Scholar ; Nguyen et al., 2009 86. Nguyen, D.X. ∙ Chiang, A.C. ∙ Zhang, X.H.-F. ... WNT/TCF signaling through LEF1 and HOXB9 mediates lung adenocarcinoma metastasis Cell. 2009; 138 :51-62 Full Text Full Text (PDF) Scopus (438) PubMed Google Scholar ; Hollstein et al., 2019 47. Hollstein, P.E. ∙ Eichner, L.J. ∙ Brun, S.N. ... The AMPK-related kinases SIK1 and SIK3 mediate key tumor-suppressive effects of LKB1 in NSCLC Cancer Discov. 2019; 9 :1606-1627 Crossref Scopus (38) PubMed Google Scholar ; Tammela et al., 2017 123. Tammela, T. ∙ Sanchez-Rivera, F.J. ∙ Cetinbas, N.M. ... A Wnt-producing niche drives proliferative potential and progression in lung adenocarcinoma Nature. 2017; 545 :355-359 Crossref Scopus (176) PubMed Google Scholar ; Murray et al., 2019 82. Murray, C.W. ∙ Brady, J.J. ∙ Tsai, M.K. ... An LKB1–SIK axis suppresses lung tumor growth and controls differentiation Cancer Discov. 2019; 9 :1590-1605 Crossref Scopus (0) PubMed Google Scholar ; Kerk et al., 2021 58. Kerk, S.A. ∙ Papagiannakopoulos, T. ∙ Shah, Y.M. ... Metabolic networks in mutant KRAS-driven tumours: tissue specificities and the microenvironment Nat. Rev. Cancer. 2021; 21 :510-525 Crossref Scopus (8) PubMed Google Scholar ; Parsons et al., 2021 90. Parsons, M.J. ∙ Tammela, T. ∙ Dow, L.E. WNT as a driver and dependency in cancer Cancer Discov. 2021; 11 :2413-2429 Crossref Scopus (10) PubMed Google Scholar ). We engineered our lenti-Cre-BC vector to carry an additional sgRNA targeting Lkb1 or Apc , such that delivery of this vector simultaneously initiated tumor induction, lineage tracing, and disruption of the targeted tumor suppressor gene. With this system, we collected data from 18,321 cells across 57 KP tumors with Lkb1 knockout (24 primary and 33 metastatic tumors; referred to as KPL tumors) and 13,825 cells across 35 KP tumors with Apc knockout (23 primary and 12 metastatic tumors; referred to as KPA tumors). Targeting of either Lkb1 or Apc increased tumor burden ( Rogers et al., 2018 104. Rogers, Z.N. ∙ McFarland, C.D. ∙ Winters, I.P. ... Mapping the in vivo fitness landscape of lung adenocarcinoma tumor suppression in mice Nat. Genet. 2018; 50 :483-486 Crossref Scopus (53) PubMed Google Scholar ), but did not appear to alter the number and relative size of subclonal expansions ( Figures S6 A and S6B). However, genes associated with tumor fitness were largely distinct across genetic backgrounds ( Figure S6 C; Table S3 ).
To examine whether perturbations alter the transcriptional landscape of KP tumors, we integrated transcriptional states of KPL and KPA tumors with the prior KP dataset. Although many cells could be classified into existing Leiden clusters identified in the KP analysis, the additional perturbations also created four new transcriptional states ( Figure 6 A; STAR Methods ). As expected from Apc ′s role as a negative regulator of Wnt signaling ( Barker et al., 2009 6. Barker, N. ∙ Ridgway, R.A. ∙ van Es, J.H. ... Crypt stem cells as the cells-of-origin of intestinal cancer Nature. 2009; 457 :608-611 Crossref Scopus (1563) PubMed Google Scholar ), Axin2 expression was high in the three KPA-specific clusters, indicative of elevated Wnt signaling ( Figure S6 D), as was the expression of Wnt antagonists such as Notum and Nkd1 that were recently reported to increase the ability of cancer cells to compete with the neighboring niche in human APC mutant colon tumors (( Flanagan et al., 2021 31. Flanagan, D.J. ∙ Pentinmikko, N. ∙ Luopajärvi, K. ... NOTUM from Apc-mutant cells biases clonal competition to initiate cancer Nature. 2021; 594 :430-435 Crossref Scopus (28) PubMed Google Scholar ; Neerven et al., 2021 83. Neerven, S.M. van ∙ de Groot, N.E. ∙ Nijman, L.E. ... Apc-mutant cells act as supercompetitors in intestinal tumour initiation Nature. 2021; 594 :436-441 Crossref Scopus (22) PubMed Google Scholar ); Figure S6 D; Table S3 ). Moreover, targeting of Lkb1 or Apc resulted in changes to the relative occupancies of transcriptomic states: KPL tumors were primarily enriched in the Pre-EMT state (Leiden cluster 9), whereas KPA tumors were enriched in Apc-specific early, mesenchymal, and metastatic states (Leiden clusters 15, 16, and 17; Figures 6 B, 6C, and S6 E).
Interestingly, although most cell states had comparable EffectivePlasticity across tumor genotypes ( Figure S6 F), the Pre-EMT state (Leiden cluster 9) in KPL tumors had significantly less EffectivePlasticity, indicating stabilization of this cell state (p < 0.05, Mann-Whitney U test; Figure 6 D). We next identified genes differentially expressed in cells from KPL tumors in the Pre-EMT cluster ( Figure 6 E; Table S2 ; STAR Methods ), which included gene programs that can promote prometastatic chromatin remodeling ( Sox17 ; Pierce et al., 2021 93. Pierce, S.E. ∙ Granja, J.M. ∙ Corces, M.R. ... LKB1 inactivation modulates chromatin accessibility to drive metastatic progression Nat. Cell Biol. 2021; 23 :915-924 Crossref Scopus (3) PubMed Google Scholar ), tumor progression ( Ifitm1 and loss of Gata6 ; Yan et al., 2019 143. Yan, J. ∙ Jiang, Y. ∙ Lu, J. ... Inhibiting of proliferation, migration, and invasion in lung cancer induced by silencing interferon-induced transmembrane Protein 1 (IFITM1) BioMed Res. Int. 2019; 2019 :9085435 Crossref Scopus (22) PubMed Google Scholar ; Cheung et al., 2013 18. Cheung, W.K.C. ∙ Zhao, M. ∙ Liu, Zongzhi ... Control of alveolar differentiation by the lineage transcription factors GATA6 and HOPX inhibits lung adenocarcinoma metastasis Cancer Cell. 2013; 23 :725-738 Full Text Full Text (PDF) Scopus (96) PubMed Google Scholar ), metastatic ability ( Mmp7 ; He et al., 2018 45. He, W. ∙ Zhang, H. ∙ Wang, Y. ... CTHRC1 induces non-small cell lung cancer (NSCLC) invasion through upregulating MMP-7/MMP-9 BMC Cancer. 2018; 18 :400 Crossref Scopus (39) PubMed Google Scholar ), and tumor fitness by modulating cancer-immune cell interaction ( Cd24a, Il33 , and loss of Apoe ; Sinjab et al., 2021 114. Sinjab, A. ∙ Han, G. ∙ Treekitkarnmongkol, W. ... Resolving the spatial and cellular architecture of lung adenocarcinoma by multiregion single-cell sequencing Cancer Discov. 2021; 11 :2506-2523 Crossref Scopus (9) PubMed Google Scholar ; Li et al., 2019 67. Li, A. ∙ Herbst, R.H. ∙ Canner, D. ... IL-33 signaling alters regulatory T cell diversity in support of tumor development Cell Rep. 2019; 29 :2998-3008.e8 Full Text Full Text (PDF) Scopus (16) PubMed Google Scholar ; Tavazoie et al., 2018 126. Tavazoie, M.F. ∙ Pollack, I. ∙ Tanqueco, R. ... LXR/ApoE activation restricts innate immune suppression in cancer Cell. 2018; 172 :825-840.e18 Full Text Full Text (PDF) Scopus (175) PubMed Google Scholar ). These together potentially explain why the Pre-EMT state was uniquely stabilized in KPL tumors.
To examine how loss of tumor suppressors altered evolutionary trajectories, we performed PCA on the transcriptional state occupancy and Evolutionary Couplings of individual tumors and found that tumors broadly segregated according to their genotypes ( Figure 6 F; STAR Methods ; Table S4 ). Specifically, KPA tumors created a unique trajectory including a coupling between the AT2-like and the Apc-early states (Leiden clusters 4 and 16), whereas KPL tumors were characterized by couplings between the Pre-EMT state and nearby states ( Figure 6 G).
In summary, although the targeting of the tumor suppressors Lkb1 or Apc both increased tumor growth, their effects on cell states, plasticity, and paths of evolution varied substantially. Specifically, KPL tumors quickly progressed to and became stabilized in the Pre-EMT state, whereas KPA tumors largely exploited a distinct path through new Apc- specific states ( Figure S6 G and summarized in Figure 6 H; Table S4 ). Together, our analyses highlight how lineage tracing offers rich information for dissecting the multifaceted role of tumor suppressors in tumor evolution.
Metastases account for 90% of cancer mortality, yet remain difficult to study because of their spatially and temporally sporadic nature ( Ganesh and Massagué, 2021 35. Ganesh, K. ∙ Massagué, J. Targeting metastatic cancer Nat. Med. 2021; 27 :34-44 Crossref Scopus (101) PubMed Google Scholar ). An outstanding question is how metastases originate from the primary tumor. Here, we integrated lineage tracing with spatial and transcriptomic information to investigate the subclonal origins and evolution of metastases.
We first focused on a single-primary tumor, which consisted of two independent subclonal expansions (3724_NT_T1; Figure 2 B), and its four related metastases (three in liver and one in soft tissue; Figures 7 A and S7 A). We performed multiregional analysis of the primary tumor ( Figure 7 A, inset) and inferred a combined phylogeny relating all cells in the primary tumor and metastases. Integrating lineage-spatial information revealed that individual metastases originated from distinct spatial locations ( Figures 7 A–7C; STAR Methods ) and phylogenetically originated from specific subclonal expansions in the primary tumor ( Figures 7 C and 7D).
To investigate the consistency of these results, we extended this phylogenetic analysis to five other tumor-metastasis families, across KP, KPL, and KPA backgrounds. Importantly, metastases were consistently more closely related phylogenetically to specific subclonal expansions, regardless of the tumor genotype ( Figures 7 D and S7 D). Collectively, our results argue that metastases generally originated from subclonal expansions within primary tumors. Independent metastases from the same primary tumor could arise from spatially and phylogenetically distinct subclones.
We next evaluated to what degree metastases preserved the transcriptional state of their origins in the primary tumor. Analysis of metastases arising from an example primary tumor (3724_NT_T1) revealed that liver metastases were more similar to the subclone from which they originated, whereas the soft tissue metastasis evolved to a new transcriptional state ( Figures 7 E and 7F). This was further quantified by measurements of total transcriptional distance between each metastasis and the subclonal expansions in the metastatic primary tumor ( Figure 7 G). Liver metastases were significantly more similar to its originating subclonal expansion (p < 0.0001, one-sided Mann-Whitney U test), whereas the soft tissue metastasis did not clearly resemble its subclonal origin ( Figure 7 G; STAR Methods ). Consistently, metastases from KP, KPL, and KPA mice were significantly more similar, as measured by transcriptional state, to their respective expanding subclades in the primary tumor as compared with nonexpanding regions, further suggesting that progression at the primary site is a prerequisite for metastasis ( LaFave et al., 2020 62. LaFave, L.M. ∙ Kartha, V.K. ∙ Ma, S. ... Epigenomic State transitions characterize tumor progression in mouse lung adenocarcinoma Cancer Cell. 2020; 38 :212-228.e13 Full Text Full Text (PDF) Scopus (58) PubMed Google Scholar ; Figure S7 E).
In addition, our high-resolution lineage tracing offered evidence of complex metastatic behaviors, including multisubclonal seeding from a primary tumor to the lymph node, and cross-seeding from one metastatic primary tumor to another primary tumor, or from one metastasis to another ( Figures S7 A–S7C). Collectively, these results highlight the ability of phylogenetic analysis to trace the origins and evolution of metastases.

Section: Discussion

In this study, we developed a genetically engineered mouse model of lung adenocarcinoma that allows Cre-inducible initiation of oncogenic mutations and simultaneous continuous in vivo lineage tracing of tumor development over many months, paired with a single-cell transcriptomic readout. This model system enabled us to track at an unprecedented resolution the recurring patterns of tumor evolution from activation of oncogenic mutations in single cells as they grow into large, aggressive, and ultimately metastatic tumors. Three principles emerged from our study, linking together tumor phylodynamics, fitness, plasticity, parallel evolutionary trajectories, origins of metastasis, and genetic determinants of tumor evolution.
First, tumors were driven by rare subclonal expansions that utilized distinct fitness-associated transcriptional programs and enabled both tumor progression at the primary site and metastasis to distant tissues. The expansions identified by tree topology argue for subclonal selection, distinct from evolutionary models lacking selective sweeps observed in other cancer types ( Sottoriva et al., 2015 117. Sottoriva, A. ∙ Kang, H. ∙ Ma, Z. ... A big bang model of human colorectal tumor growth Nat. Genet. 2015; 47 :209-216 Crossref Scopus (600) PubMed Google Scholar ). The identification of gene expression states associated with tumor fitness revealed a set of transcriptional fitness modules underlying KP-Tracer tumor development. Importantly, these signatures of aggressive tumors found in our mouse model were predictive of the outcome of human disease. Despite the higher somatic mutation burden and longer developing timescales of human tumors ( Campbell et al., 2017 12. Campbell, B.B. ∙ Light, N. ∙ Fabrizio, D. ... Comprehensive analysis of hypermutation in human cancer Cell. 2017; 171 :1042-1056.e10 Full Text Full Text (PDF) Scopus (397) PubMed Google Scholar ; Jamal-Hanjani et al., 2017 53. Jamal-Hanjani, M. ∙ Wilson, G.A. ∙ McGranahan, N. ... Tracking the evolution of non-small-cell lung cancer N. Engl. J. Med. 2017; 376 :2109-2121 Crossref Scopus (1152) PubMed Google Scholar ; Gerstung et al., 2020 40. Gerstung, M. ∙ Jolly, C. ∙ Leshchiner, I. ... The evolutionary history of 2,658 cancers Nature. 2020; 578 :122-128 Crossref Scopus (283) PubMed Google Scholar ; Hill et al., 2021 46. Hill, W. ∙ Caswell, D.R. ∙ Swanton, C. Capturing cancer evolution using genetically engineered mouse models (GEMMs) Trends Cell Biol. 2021; 31 :1007-1018 Full Text Full Text (PDF) Scopus (0) PubMed Google Scholar ), our data uncovered critical fitness gene programs that are conserved in both mouse and human lung adenocarcinomas. Notably, we found that metastases consistently originated from expanding subclones, regardless of additional loss of Lkb1 or Apc . They often retained the same transcriptional state as their original subclones but could further adopt distinct transcriptional states. This underscored the importance of tumor progression at the primary site in enabling metastasis ( Caswell et al., 2014 15. Caswell, D.R. ∙ Chuang, C.-H. ∙ Yang, D. ... Obligate progression precedes lung adenocarcinoma dissemination Cancer Discov. 2014; 4 :781-789 Crossref Scopus (34) PubMed Google Scholar ; Turajlic and Swanton, 2016 130. Turajlic, S. ∙ Swanton, C. Metastasis as an evolutionary process Science. 2016; 352 :169-175 Crossref Scopus (312) PubMed Google Scholar ; Hu et al., 2020 49. Hu, Z. ∙ Li, Z. ∙ Ma, Z. ... Multi-cancer analysis of clonality and the timing of systemic spread in paired primary tumors and metastases Nat. Genet. 2020; 52 :701-708 Crossref Scopus (89) PubMed Google Scholar ; LaFave et al., 2020 62. LaFave, L.M. ∙ Kartha, V.K. ∙ Ma, S. ... Epigenomic State transitions characterize tumor progression in mouse lung adenocarcinoma Cancer Cell. 2020; 38 :212-228.e13 Full Text Full Text (PDF) Scopus (58) PubMed Google Scholar ) and argues against alternative models in which metastases arise early during tumor evolution ( Hüsemann et al., 2008 50. Hüsemann, Y. ∙ Geigl, J.B. ∙ Schubert, F. ... Systemic spread is an early step in breast cancer Cancer Cell. 2008; 13 :58-68 Full Text Full Text (PDF) Scopus (873) PubMed Google Scholar ; Podsypanina et al., 2008 94. Podsypanina, K. ∙ Du, Y.-C.N. ∙ Jechlinger, M. ... Seeding and propagation of untransformed mouse mammary cells in the lung Science. 2008; 321 :1841-1844 Crossref Scopus (241) PubMed Google Scholar ; Klein, 2009 60. Klein, C.A. Parallel progression of primary tumours and metastases Nat. Rev. Cancer. 2009; 9 :302-312 Crossref Scopus (781) PubMed Google Scholar ; Rhim et al., 2012 102. Rhim, A.D. ∙ Mirek, E.T. ∙ Aiello, N.M. ... EMT and dissemination precede pancreatic tumor formation Cell. 2012; 148 :349-361 Full Text Full Text (PDF) Scopus (1411) PubMed Google Scholar ; Sottoriva et al., 2015 117. Sottoriva, A. ∙ Kang, H. ∙ Ma, Z. ... A big bang model of human colorectal tumor growth Nat. Genet. 2015; 47 :209-216 Crossref Scopus (600) PubMed Google Scholar ).
Second, our analysis revealed that tumor progression is accompanied by transient increases in lineage plasticity. This period of high plasticity is followed by clonal sweeps of subclones with aggressive cell states that can remain stable even following metastasis to new environments. Our ability to monitor how often cells are transitioning between transcriptomic states also allowed us to untangle the relationship between intratumoral heterogeneity and lineage plasticity and shed light on the dynamics of the transcriptomic heterogeneity observed in the KP mouse model and human NSCLC ( Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ; Laughney et al., 2020 64. Laughney, A.M. ∙ Hu, J. ∙ Campbell, N.R. ... Regenerative lineages and immune-mediated pruning in lung cancer metastasis Nat. Med. 2020; 26 :259-269 Crossref Scopus (106) PubMed Google Scholar ). The finding that KP tumors progress via parallel, rapid transitions between cell states is consistent with previous work suggesting that epigenetic instability is a major driver of tumor progression in this model ( LaFave et al., 2020 62. LaFave, L.M. ∙ Kartha, V.K. ∙ Ma, S. ... Epigenomic State transitions characterize tumor progression in mouse lung adenocarcinoma Cancer Cell. 2020; 38 :212-228.e13 Full Text Full Text (PDF) Scopus (58) PubMed Google Scholar ; Marjanovic et al., 2020 73. Marjanovic, N.D. ∙ Hofree, M. ∙ Chan, J.E. ... Emergence of a high-plasticity cell state during lung cancer evolution Cancer Cell. 2020; 38 :229-246.e13 Full Text Full Text (PDF) Scopus (71) PubMed Google Scholar ). Given the essential role of cellular plasticity in tumor progression and therapeutic resistance ( Chaffer et al., 2013 16. Chaffer, C.L. ∙ Marjanovic, N.D. ∙ Lee, T. ... Poised chromatin at the ZEB1 promoter enables breast cancer cell plasticity and enhances tumorigenicity Cell. 2013; 154 :61-74 Full Text Full Text (PDF) Scopus (584) PubMed Google Scholar ; Easwaran et al., 2014 28. Easwaran, H. ∙ Tsai, H.C. ∙ Baylin, S.B. Cancer epigenetics: tumor heterogeneity, plasticity of stem-like states, and drug resistance Mol. Cell. 2014; 54 :716-727 Full Text Full Text (PDF) Scopus (569) PubMed Google Scholar ; Ge et al., 2017 38. Ge, Y. ∙ Gomez, N.C. ∙ Adam, R.C. ... Stem cell lineage infidelity drives wound repair and cancer Cell. 2017; 169 :636-650.e14 Full Text Full Text (PDF) Scopus (156) PubMed Google Scholar ; Flavahan et al., 2017 32. Flavahan, W.A. ∙ Gaskell, E. ∙ Bernstein, B.E. Epigenetic plasticity and the hallmarks of cancer Science. 2017; 357 :p.eaal2380 Crossref Scopus (508) Google Scholar ; Yuan et al., 2019 144. Yuan, S. ∙ Norgard, R.J. ∙ Stanger, B.Z. Cellular plasticity in cancer Cancer Discov. 2019; 9 :837-851 Crossref Scopus (120) PubMed Google Scholar ; Quintanal-Villalonga et al., 2020 99. Quintanal-Villalonga, Á. ∙ Chan, J.M. ∙ Yu, H.A. ... Nat. Rev. Clin. Oncol. 2020; 17 :360-371 Crossref Scopus (0) PubMed Google Scholar ), the ability of our lineage-tracing system to quantitatively explore plasticity provides a critical tool for understanding the role that cell state plasticity plays in various aspects of tumor evolution.
Third, tumors evolved through stereotypical trajectories and introduction of additional oncogenic mutations increased the speed of tumor evolution by creating new evolutionary trajectories. Traditionally, although cellular trajectories inferred by pseudotemporal approaches have proved to be a versatile tool for scRNA-seq datasets ( Trapnell et al., 2014 128. Trapnell, C. ∙ Cacchiarelli, D. ∙ Grimsby, J. ... The dynamics and regulators of cell Fate decisions are revealed by pseudotemporal ordering of single cells Nat. Biotechnol. 2014; 32 :381-386 Crossref Scopus (1984) PubMed Google Scholar ; La Manno et al., 2018 61. La Manno, G. ∙ Soldatov, R. ∙ Zeisel, A. ... RNA velocity of single cells Nature. 2018; 560 :494-498 Crossref Scopus (894) PubMed Google Scholar ), they make the inviolable assumption that transcriptional similarity indicates developmental relationship ( Tritschler et al., 2019 129. Tritschler, S. ∙ Büttner, M. ∙ Fischer, D.S. ... Concepts and limitations for learning developmental trajectories from single cell genomics Development. 2019; 146 p.dev, 170506 Crossref Scopus (68) Google Scholar ). Overcoming this, our measurement of cell state coupling directly from phylogenies enabled the discovery of two distinct evolutionary paths that are substantiated by transcriptional differences. Moreover, CRISPR targeting of tumor suppressors Lkb1 and Apc altered the cellular plasticity and observed evolutionary paths in a genotype-specific way, which can be explained by alterations in transcriptional landscape. Collectively, our approach offers an orthogonal and more quantitative evaluation of the multifaceted role genes play in tumor evolution as compared with traditional growth-based fitness analysis. Future studies combining the KP-Tracer model and high-throughput in vivo functional genomics will be foundational in assessing the evolutionary consequences of any genes of interest in lung adenocarcinoma progression ( Winters et al., 2018 140. Winters, I.P. ∙ Murray, C.W. ∙ Winslow, M.M. Towards quantitative and multiplexed in vivo functional cancer genomics Nat. Rev. Genet. 2018; 19 :741-755 Crossref Scopus (29) PubMed Google Scholar ).
In summary, our results represent the first report of tracing the evolutionary history of a tumor from a single-transformed cell to an aggressive tumor using a CRISPR-based lineage tracer in an autochthonous mouse model. The continuous and high-resolution tumor lineage tracing in this setting offers a major advance in tumor evolution modeling by enabling quantitative inference of fitness landscapes, cellular plasticity, evolutionary paths, origins of metastases, and the role of tumor suppressors in altering all these facets of tumor development. With the expanding lineage-tracing toolkit and integration of other emerging data modalities, we expect that the experimental and computational framework presented here will greatly improve future efforts at building high-dimensional, quantitative, and predictive models of tumor evolution, thus shedding light on new therapeutic strategies.
Our findings highlight several opportunities for future efforts. First, we were limited in our ability to describe the directionality of transitions or to rule out the possibility of unobserved intermediates. This issue could be resolved experimentally by harvesting samples from multiple time points of tumor development or expanding our lineage-tracing technology to develop multichannel molecular recorders for simultaneous recording of marker gene expression of intermediate states ( Frieda et al., 2017 34. Frieda, K.L. ∙ Linton, J.M. ∙ Hormoz, S. ... Synthetic recording and in situ readout of lineage information in single cells Nature. 2017; 541 :107-111 Crossref Scopus (221) PubMed Google Scholar ; Tang and Liu, 2018 124. Tang, W. ∙ Liu, D.R. Rewritable multi-event analog recording in bacterial and mammalian cells Science. 2018; 360 :p.eaap8992 Crossref Scopus (99) Google Scholar ). Alternatively, enhancing the interpretability of branch lengths by engineering a “molecular clock” or probabilistic models of Cas9 editing ( Park et al., 2021 89. Park, J. ∙ Lim, J.M. ∙ Jung, I. ... Recording of elapsed time and temporal information about biological events using Cas9 Cell. 2021; 184 :1047-1063.e23 Full Text Full Text (PDF) Scopus (7) PubMed Google Scholar ) could aid in the reconstruction of unobserved intermediate states ( Ouardini et al., 2021 88. Ouardini, K. ∙ Lopez, R. ∙ Jones, M.G. ... Reconstructing unobserved cellular states from paired single-cell lineage tracing and transcriptomics data Preprint at bioRxiv. 2021; Crossref Scopus (0) Google Scholar ). Second, our fitness-inference approach assumes that evolution occurs via small effect size mutations, which may overlook the impact of mutations with large impact such as CNVs in other tumor models ( Neher et al., 2014 85. Neher, R.A. ∙ Russell, C.A. ∙ Shraiman, B.I. Predicting evolution from the shape of genealogical trees eLife. 2014; 3 :e03568 Crossref Scopus (90) Google Scholar ). Third, future integration of emerging data modalities with lineage tracing, such as combined genomic, multiomic, and spatial analyses ( Mimitou et al., 2021 81. Mimitou, E.P. ∙ Lareau, C.A. ∙ Chen, K.Y. ... Scalable, multimodal profiling of chromatin accessibility, gene expression and protein levels in single cells Nat. Biotechnol. 2021; 39 :1246-1258 Crossref Scopus (42) PubMed Google Scholar ; Ma et al., 2020 71. Ma, S. ∙ Zhang, B. ∙ LaFave, L.M. ... Chromatin potential identified by shared single-cell profiling of RNA and chromatin Cell. 2020; 183 :1103-1116.e20 Full Text Full Text (PDF) Scopus (120) PubMed Google Scholar ; Lee et al., 2014 65. Lee, J.H. ∙ Daugharthy, E.R. ∙ Scheiman, J. ... Highly multiplexed subcellular RNA sequencing in situ Science. 2014; 343 :1360-1363 Crossref Scopus (532) PubMed Google Scholar ; Stickels et al., 2021 121. Stickels, R.R. ∙ Murray, E. ∙ Kumar, P. ... Highly sensitive spatial transcriptomics at near-cellular resolution with slide-seqV2 Nat. Biotechnol. 2021; 39 :313-319 Crossref Scopus (85) PubMed Google Scholar ; Chow et al., 2021 19. Chow, K.K. ∙ Budde, M.W. ∙ Granados, A.A. ... Imaging cell lineage with a synthetic digital recording system Science. 2021; 372 :p.eabb3099 Crossref Scopus (21) Google Scholar ), will illuminate how genetic and epigenetic changes and the tumor microenvironment influence tumor evolution.

Section: STAR★Methods

REAGENT or RESOURCE SOURCE IDENTIFIER Chemicals, enzymes, and antibodies Collagenase Type IV Thermo Fisher Scientific Cat#: 17104019 Dispase Thermo Fisher Scientific Cat#: 17105041 Trypsin Thermo Fisher Scientific Cat#: 25200056 ACK Thermo Fisher Scientific Cat#: A1049201 DNase I Millipore Sigma SKU 11284932001 UltraPure BSA Thermo Fisher Scientific Cat#: AM2618 Anti-mouse CD45 Monoclonal Antibody, APC BioLegend Cat#: 103111; RRID: AB_312976 Anti-mouse CD31 Monoclonal Antibody, APC BioLegend Cat#102410; RRID: AB_312905 Anti-mouse CD11b Monoclonal Antibody, APC BioLegend Cat#: 101212; RRID: AB_312795 Anti-mouse F4/80 Monoclonal Antibody, APC BioLegend Cat#: 123116; RRID: AB_893481 Anti-mouse Ter119 Monoclonal Antibody, APC BioLegend Cat#: 116212; RRID: AB_313713 MULTI-seq lipid anchor and co-anchor McGinnis et al. 2019 76. McGinnis, C.S. ∙ Patterson, D.M. ∙ Winkler, J. ... MULTI-Seq: sample multiplexing for single-cell RNA sequencing using lipid-tagged indices Nat. Methods. 2019; 16 :619-626 Crossref Scopus (124) PubMed Google Scholar Generated by the Gartner lab Knockout DMEM Gibco Cat#10829-018 Fetal Bovine Serum Hyclone Cat#SV30014 GlutaMax Gibco Cat#35050-061 Non-essential amino acids Thermo Fisher Scientific Cat#11140050 2-mercaptoethanol Sigma Cat#M-7522 Recombinant Mouse LIF Protein Millipore Cat#ESG1107 Critical commercial assays SPRI Bead Beckman Coulter A63881 KAPA HiFi HotStart ReadyMix KAPA Biosystems KK2601 Chromium Single Cell 3’ Library & Gel Bead Kit v2 10x Genomics PN-120237 Chromium Single Cell A Chip Kit 10x Genomics PN-1000009 Chromium i7 Multiplex Kit 10x Genomics PN-120262 Qiagen Plasmid Giga kit Qiagen cat. no. 12191 Site-directed mutagenesis kit New England Biolabs E0554S Agilent Technologies High Sensitivity DNA Kit Fisher Scientific NC1738319 Super PiggyBac transposase System Biosciences PB210PA-1 Deposited data Raw data from KP-Tracer mice (scRNA-seq, MULTI-seq, target site, and Lenti-Cre-BC) This manuscript NCBI BioProject: PRJNA803321 Processed data for KP-Tracer tumors This manuscript https://doi.org/10.5281/zenodo.5847461 Interactive VISION and PhyloVision Reports This manuscript https://doi.org/10.5281/zenodo.5888895 Oligonucleotides oDYT011 sgNT oligo top tTAGCTCTtAAACCGCGGAGCCGAATACCTCGCCAACAag This manuscript N/A oDYT012 sgNT oligo bottom TTGGCGAGGTATTCGGCTCCGCGGTTTaAGAGC This manuscript N/A oDYT013 sgLkb1 oligo top tTAGCTCTtAAACTTGTGACTGCGGCCCACCACCAACAag This manuscript N/A oDYT014 sgLkb1 oligo bottom TTGGTGGTGGGCCGCAGTCACAAGTTTaAGAGC This manuscript N/A oDYT015 sgApc oligo top tTAGCTCTtAAACCGGAGTGAAACTACGCTCAAcCAACAag This manuscript N/A oDYT016 sgApc oligo bottom TTGgTTGAGCGTAGTTTCACTCCGGTTTaAGAGC This manuscript N/A oDYT019 gibson_3xsg_piggy FWD GACTGGATTCCTTTTTTAGGGCCCATTGGTctagaCGTGA CCGAGCTTGTC This manuscript N/A oDYT020 gibson_3xsg_piggy REV CGGGGAAAAAGCCATGTTTAAACGcggccgcctaatggatcct agtactcgaG This manuscript N/A oDYT021 gibson_TS1.1gB_ FWD catggacgagctgtacaagtaaTGAATTAATtaaGTCACGAATCC AGCTAGCTG This manuscript N/A oDYT022 gibson_TS1.1gB_ REV CCATTATAAGCTGCAATAAACAAGTTTCCTTAGCCGCTA ATAGGTGAGCAGTTAACACCTGCAGGAGCGATGG This manuscript N/A oDYT023-030 10x_target site amplification_primer_F AATGATACGGCGACCACCGAGATCTACACNNNNNNNN TCTTTCCCTACACGACGCTCTTCCGATCT This manuscript N/A oDYT031-038 10x_target site amplification_primer_R CAAGCAGAAGACGGCATACGAGANNNNNNNNTGTCTC GTGGGCTCGGAGATGTGTATAAGAGACAGAATCCAGC TAGCTGTGCAGC This manuscript N/A oDYT039 MULTIseq spike-in CCTTGGCACCCGAGAATTCC This manuscript N/A oDYT040 MULTIseq P5 AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTA CACGACGCTCTTCCGATCT This manuscript N/A oDYT041-48 MULTIseq P7 CAAGCAGAAGACGGCATACGAGATNNNNNNNNGTGACT GGAGTTCCTTGGCACCCGAGAATTCC This manuscript N/A oDYT049 P5 universal for Lenti-BC AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTA CACGACGCTCTTCCGATCT This manuscript N/A oDYT050-059 P7 for Lenti-BC CAAGCAGAAGACGGCATACGAGATNNNNNNNNAGTCTC GTGGGCTCGGAGATGTGTATAAGAGACAGGACCTCCCT AGCAAACTGGGGCACAAG This manuscript N/A Software and code 10X cellranger https://support.10xgenomics.com/single-cell-gene-expression/software/pipelines/latest/installation v2.1.1 deMULTIplex https://github.com/chris-mcginnis-ucsf/MULTI-seq v1.0.2 inferCNV https://github.com/broadinstitute/infercnv v1.11.1 Scanpy https://github.com/theislab/scanpy 1.7.0rc1 Jungle https://github.com/felixhorns/jungle N/A Hotspot DeTomaso & Yosef, 2021 24. DeTomaso, D. ∙ Yosef, N. Hotspot identifies informative gene modules across modalities of single-cell genomics Cell Syst. 2021; 12 :446-456.e9 Full Text Full Text (PDF) Scopus (4) PubMed Google Scholar v0.9.1 Evolutionary Coupling This study https://doi.org/10.5281/zenodo.6354596 Phylotime This study https://doi.org/10.5281/zenodo.6354596 EffectivePlasticity This study https://doi.org/10.5281/zenodo.6354596 Subclonal expansion detection This study https://doi.org/10.5281/zenodo.6354596 Cassiopeia tree reconstruction algorithms Jones et al, 2020 55. Jones, M.G. ∙ Khodaverdian, A. ∙ Quinn, J.J. ... Inference of single-cell phylogenies from lineage tracing data using Cassiopeia Genome Biol. 2020; 21 :92 Crossref Scopus (14) PubMed Google Scholar and this study https://doi.org/10.5281/zenodo.6354596 Open table in a new tab
Further information and requests for resources and reagents should be directed to and will be fulfilled by the Lead Contact Jonathan Weissman ( weissman@wi.mit.edu ).
Plasmids generated in this study are being submitted to Addgene. All unique/stable reagents generated in this study are available from the lead contact with a completed Materials Transfer Agreement.
All mouse experiments described in this study were approved by the Massachusetts Institute of Technology Institutional Animal Care and Use Committee (IACUC) (institutional animal welfare assurance no. A-3125-01). A male mouse embryonic stem cell (mESC) line harboring the conditional alleles Kras LSL-G12D/+ and Trp53 fl/fl (KP) was engineered with the lineage tracer cassettes. The engineered and selected mESC clones were injected into blastocysts from albino B6 or CD1 background for chimera making as previously described ( Zhou et al. 2010 147. Zhou, Y. ∙ Rideout, 3rd, W.M. ∙ Zi, T. ... Chimeric mouse tumor models reveal differences in pathway activation between ERBB family- and KRAS-dependent lung adenocarcinomas Nat. Biotechnol. 2010; 28 :71-78 Crossref Scopus (0) PubMed Google Scholar ). We chose to use the chimeric mice strategy because the multiple, random integration of lineage tracing target sites in the genome makes it challenging for breeding stable strains. Both male and female mice with more than 10% chimerism based on coat color were used in this study. Tumors were initiated by intratracheal infection of mice with lentiviral vectors expressing Cre recombinase ( DuPage, Dooley, and Jacks 2009 27. DuPage, M. ∙ Dooley, A.L. ∙ Jacks, T. Conditional mouse lung cancer models using adenoviral or lentiviral delivery of Cre recombinase Nat. Protoc. 2009; 4 :1064-1072 Crossref Scopus (508) PubMed Google Scholar ). Five total mESC clones were used in this study to avoid idiosyncrasy in clonal behavior and analyses were performed on all tumors combined. Lenti-Cre-BC vector was co-transfected with packaging vectors (delta8.2 and VSV-G) into HEK-293T cells using polyethylenimine (Polysciences). The supernatant was collected at 48h post-transfection, ultracentrifuged at 25,000 r.p.m. for 90 min at 4C, and resuspended in phosphate-buffered saline (PBS). 8-12-week-old chimeras were infected intratracheally with lentiviral vectors, including lenti-Cre-BC-sgNT (2x10 7 PFU) or lenti-Cre-BC-sgLkb1 (4x10 6 PFU) or lenti-Cre-BC-sgApc (1x10 7 PFU) to achieve similar aging time after tumor initiation.
The lenti_sgRNA_Cre_barcode vector was derived from a previously described Perturb-seq lentiviral vector ( Adamson et al., 2016 2. Adamson, B. ∙ Norman, T.M. ∙ Jost, M. ... A multiplexed single-cell CRISPR screening platform enables systematic dissection of the unfolded protein response Cell. 2016; 167 :1867-1882.e21 Full Text Full Text (PDF) Scopus (420) PubMed Google Scholar ), pBA439, with the following changes: the two loxP sites were removed by site-directed mutagenesis (SDM) using oDYT001 and oDYT002 followed by oDYT009 and oDYT010; the Puro-BFP was removed using restriction sites NheI and PacI and was replaced by Cre that was PCR amplified using oDYT003 and oDYT004 via Gibson assembly; a ubiquitous chromatin opening element (UCOE) that was PCR amplified using oDYT005 and oDYT006 was introduced using restriction sites NsiI and NotI via Gibson assembly. oDYT007 and oDYT008 (containing EcoRI and SbfI sites for subsequent barcode cloning) were then annealed and ligated using restriction sites BclI and PacI. Three different sgRNAs of interest were then cloned into the resulting vector using pairs of top and bottom strand sgRNA oligos: sgNT (non-targeting) (oDYT011 and oDYT012), sgLkb1 (oDYT013 and oDYT014), and sgApc (oDYT015 and oDYT016) were each annealed and ligated using restriction sites BlpI and BstXI to form pDYT003, pDYT004, and pDYT005 respectively. These sgRNAs have been used and validated previously ( Rogers et al. 2017 103. Rogers, Z.N. ∙ McFarland, C.D. ∙ Winters, I.P. ... A quantitative and multiplexed approach to uncover the fitness landscape of tumor suppression in vivo Nat. Methods. 2017; 14 :737-742 Crossref Scopus (53) PubMed Google Scholar , 2018 104. Rogers, Z.N. ∙ McFarland, C.D. ∙ Winters, I.P. ... Mapping the in vivo fitness landscape of lung adenocarcinoma tumor suppression in mice Nat. Genet. 2018; 50 :483-486 Crossref Scopus (53) PubMed Google Scholar ). Finally, a whitelist barcode oligo pool consisting of 249,959 unique 16-nucleotide barcodes where every barcode has a Levenshtein distance of >3 from every other barcode was designed. The whitelist barcode library was PCR amplified then introduced at the 3’UTR region of Cre in each of the three constructs using restriction sites EcoRI and SbfI.
The lineage tracer vectors pDYT001 and pDYT002 were derived from previously described target site plasmids, PCT 60-62 ( Chan et al. 2019 17. Chan, M.M. ∙ Smith, Z.D. ∙ Grosswendt, S. ... Molecular recording of mammalian embryogenesis Nature. 2019; 570 :77-82 Crossref Scopus (125) PubMed Google Scholar ; Quinn et al. 2021 98. Quinn, J.J. ∙ Jones, M.G. ∙ Okimoto, R.A. ... Single-cell lineages reveal the rates, routes, and drivers of metastasis in cancer xenografts Science. 2021; 371 :p.eabc1944 Crossref Scopus (45) Google Scholar ; Jones et al. 2020 55. Jones, M.G. ∙ Khodaverdian, A. ∙ Quinn, J.J. ... Inference of single-cell phylogenies from lineage tracing data using Cassiopeia Genome Biol. 2020; 21 :92 Crossref Scopus (14) PubMed Google Scholar ). A loxP site was first removed from both PCT61 and PCT62 using oDYT017 and oDYT018 via site-directed mutagenesis. The triple sgRNA cassettes driven by distinct U6 promoters in PCT61 and PCT62 were then PCR amplified using oDYT019 and oDYT020 and introduced into the PCT60 backbone using restriction sites XbaI and NotI via Gibson assembly. Finally, the target site barcode library was PCR amplified from a previously described gene fragment from PCT48 ( Jones et al. 2020 55. Jones, M.G. ∙ Khodaverdian, A. ∙ Quinn, J.J. ... Inference of single-cell phylogenies from lineage tracing data using Cassiopeia Genome Biol. 2020; 21 :92 Crossref Scopus (14) PubMed Google Scholar ), using oDYT021 and oDYT022 and introduced into the two resulting vectors above using restriction sites PacI and HpaI to form pDYT001 and pDYT002, which contain the triple guide cassette from PCT61 and PCT62 respectively. The target site library consists of a 14-bp random integration barcode and three target sites (ade2, bri1, whtB), which are complementary to the three sgRNAs.
KP ∗ 17 is an embryonic stem (ES) cell line derived from C57BL/6-129/Sv F1 background engineered with conditional alleles Kras LSL_G12D/+ ; p53 fl/fl . ES cells were maintained with JM8 media (500mL: 82.9% Knockout DMEM (Gibco Cat#10829-018), 15% FBS (Hyclone Cat#SV30014), 1% GlutaMax (Gibco Cat#35050-061), 1% Non-essential amino acids (Thermo Fisher Scientific Cat#11140050), 0.1% 2-mercaptoethanol (Sigma Cat#M-7522), 500,000U Recombinant Mouse LIF Protein (Millipore Cat#ESG1107)) with feeders. KP ∗ 17 was first targeted using CRISPR-assisted HDR to generate Rosa26 LSL-Cas9-P2A-mNeonGreen which was validated for correct targeting by PCR and southern blot and validated for Cas9 activity. The lineage tracing transposon vectors were then introduced together with transposase vector (SBI) by transfection. Three passages after transfection, mESCs were purified by FACS based on mCherry expression and expanded as individual clones.
Target site integration number was quantified as the following: We first used fluorescence-based readout to examine mCherry expression of each ES cell clone in 96 well format, which allowed us to narrow down the ES clone candidates with relatively high expression of mCherry (the reporter of lineage tracer library). Then we used quantitative genomic PCR to count the number of lineage tracer genome integration in each ES cell clone by amplifying the target site regions (oDYT062 and oDYT063) and normalized to a 2N locus, β-actin, in the genome (oDYT060 and oDYT061). Samples were run in triplicates and the reactions were performed on a QuantStudio 6 Flex Real-Time PCR System. In this study, we used the following ES clones in the tumor analysis due to a combination of high chimeric rate and good target site capture: 1D5, 2E1, 1C4, 2F4 and 2H9. Clones 1D5, 1C4 were engineered with pDYT001 and clones 2E1, 2F4 and 2H9 were engineered with pDYT002. All five clones were used independently for generating chimeric mice in this study and no major difference in their lineage tracing performance was observed.
Tumors were harvested and single-cell suspension was prepared as described in ( Chuang et al. 2017 20. Chuang, C.H. ∙ Greenside, P.G. ∙ Rogers, Z.N. ... Molecular definition of a metastatic lung cancer state reveals a targetable CD109–Janus kinase–Stat Axis Nat. Medicine. 2017; 23 :291-300 Crossref Scopus (0) PubMed Google Scholar ) and ( Denny et al. 2016 22. Denny, S.K. ∙ Yang, D. ∙ Chuang, C.-H. ... Nfib promotes metastasis through a widespread increase in chromatin accessibility Cell. 2016; 166 :328-342 Full Text Full Text (PDF) Scopus (194) PubMed Google Scholar ). Primary tumors and metastases were dissociated using a digestion buffer (DMEM/F12, 5mM HEPES, DNase, Collagenase IV, Dispase, Trypsin-EDTA) and incubated at 37 °C for 30 min. After dissociation, the samples were quenched with twice the volume of cold quench solution (L-15 medium, FBS, DNase). The cells were then filtered through a 40um cell strainer, spun down at 1000rpm for 5 min, resuspended in 2mL ACK Lysing Buffer, and incubated at room temperature for 1-2 min. Lysis was then stopped with the addition of 10mL DMEM/F12 followed by the spinning down and resuspending of the samples in 1mL FACS buffer. Cells within the pleural fluid were collected immediately after euthanasia by making a small incision in the ventral aspect of the diaphragm followed by introduction of 1 ml of PBS. Cells were stained with antibodies to CD45 (30-F11, Biolegend Cat#103112), CD31 (390, Biolegend Cat#102410), F4/80 (BM8, Biolegend Cat#123116), CD11b (Biolegend Cat#101212) and Ter119 (Biolegend Cat#116212) to exclude cells from the hematopoietic and endothelial lineages. DAPI was used to stain dead cells.
Cells were then labeled by MULTI-seq ( McGinnis et al. 2019 76. McGinnis, C.S. ∙ Patterson, D.M. ∙ Winkler, J. ... MULTI-Seq: sample multiplexing for single-cell RNA sequencing using lipid-tagged indices Nat. Methods. 2019; 16 :619-626 Crossref Scopus (124) PubMed Google Scholar ) in 100ul PBS buffer containing 5ul lipid anchor (50uM) and 2.5ul of barcode oligos (100uM) for 10 min on ice and then 6ul co-anchor (50uM) 10 min on ice. Cells were washed and resuspended with ice-cold FACS buffer to prevent aggregation. DAPI was used to exclude dead cells. FACS Aria sorters (BD Biosciences) were used for cell sorting. Live cancer cells were sorted based on positive expression of mCherry and mNeonGreen as well as negative expression of hematopoietic and endothelial lineage markers (mCherry+, mNeonGreen+, CD45-, CD31-, Ter119-, F4/80-, DAPI-). High purity of the resulting cancer cells has been confirmed in previous studies using similar fluorescent reporter systems ( Caswell et al. 2014 15. Caswell, D.R. ∙ Chuang, C.-H. ∙ Yang, D. ... Obligate progression precedes lung adenocarcinoma dissemination Cancer Discov. 2014; 4 :781-789 Crossref Scopus (34) PubMed Google Scholar ; Chuang et al. 2017 20. Chuang, C.H. ∙ Greenside, P.G. ∙ Rogers, Z.N. ... Molecular definition of a metastatic lung cancer state reveals a targetable CD109–Janus kinase–Stat Axis Nat. Medicine. 2017; 23 :291-300 Crossref Scopus (0) PubMed Google Scholar ; LaFave et al. 2020 62. LaFave, L.M. ∙ Kartha, V.K. ∙ Ma, S. ... Epigenomic State transitions characterize tumor progression in mouse lung adenocarcinoma Cancer Cell. 2020; 38 :212-228.e13 Full Text Full Text (PDF) Scopus (58) PubMed Google Scholar ). Live normal lung cells were sorted based on negative expression of mNeonGreen, and hematopoietic and endothelial lineage markers. Datasets were further filtered for normal cells analytically via gene expression analyses (see section below “Single-cell transcriptome processing for KP-Tracer NT data”) and by removing cells with low editing efficiencies (see section below “Single-cell lineage tracing preprocessing pipeline and quality control filtering”).
Single-cell RNA-seq libraries were prepared using 10x_3’_V2 kit according to the 10x user guide, except for the following modification. After cDNA amplification, the cDNA pool is split into two fractions. Half of the cDNA pool are used for scRNA-seq library construction and proceed as directed in the 10x user guide.
To prepare the Target Site libraries, the amplified cDNA libraries were further amplified with Target Site-specific primers containing Illumina-compatible adapters and sample indices (oDYT023-oDYT038, forward:5′CAAGCAGAAGACGGCATACGAGATNNNNNNNNGTCTCGTGGGCTCGGAGATGTGTATAAGAGACAGAATCCAGCTAGCTGTGCAGC;
reverse:5′-AATGATACGGCGACCACCGAGATCTACACNNNNNNNNTCTTTCCCTACACGACGCTCTTCCGATCT; “N” denotes sample indices) using Kapa HiFi ReadyMix (Roche), as described in ( Jones et al. 2020 55. Jones, M.G. ∙ Khodaverdian, A. ∙ Quinn, J.J. ... Inference of single-cell phylogenies from lineage tracing data using Cassiopeia Genome Biol. 2020; 21 :92 Crossref Scopus (14) PubMed Google Scholar ). Approximately 30 fmol of template cDNA was used per sample, divided between four identical reactions to avoid possible PCR induced library biases. PCR products were purified and size-selected using SPRI magnetic beads (Beckman) and quantified by BioAnalyzer (Agilent).
The MULTI-seq libraries were prepared as described in (McGinnis et al.), using a custom protocol based on the 10x Genomics Single Cell V2 and CITE-seq workflows. Briefly, the 10x workflow was followed up until complementary DNA amplification, where 1μl of 2.5μM MULTI-seq additive primer (oDYT039) was added to the cDNA amplification master mix. After amplification, MULTIseq barcode and endogenous cDNA fractions were separated using a 0.6X solid phase reversible immobilization (SPRI) size selection. To further purify the MULTI-seq barcode, we increased the final SPRI ratio in the barcode fraction to 3.2X reaction volumes and added 1.8X reaction volumes of 100% isopropanol (Sigma-Aldrich). Eluted barcode cDNA was then quantified using QuBit before library preparation PCR using primers oDYT040 and oDYT041-oDYT048 (95 °C, 5′; 98 °C, 15′; 60 °C, 30′; 72 °C, 30′; eight cycles; 72 °C, 1′; 4 °C hold). TruSeq RPIX:
5′-CAAGCAGAAGACGGCATACGAGATNNNNNNGTGACTGGAGTTCCTTGGCACCCGAGAATTCCA-3′
TruSeq P5 adaptor:
5′-AATGATACGGCGACCACCGAGATCTACACTCTTTCCCTACACGACGCTCTTCCGATCT-3′
Following library preparation PCR, the library was size-selected by a 1.6X SPRI clean-up prior to sequencing.
The Lenti_Cre_BC library amplification protocol was adapted from the Perturb-seq protocol ( Adamson et al., 2016 2. Adamson, B. ∙ Norman, T.M. ∙ Jost, M. ... A multiplexed single-cell CRISPR screening platform enables systematic dissection of the unfolded protein response Cell. 2016; 167 :1867-1882.e21 Full Text Full Text (PDF) Scopus (420) PubMed Google Scholar ). 4 parallel PCR reactions were constructed containing 30ng of final scRNA-seq library as template, oDYT049, and indexed oDYT050-oDYT059, and amplified using KapaHiFi ReadyMix according to the following PCR protocol: (1) 95C for 3 min, (2) 98C for 15 s, then 70C for 10 s (16-24 cycles, depending on final product amount). Reactions were re-pooled during 0.8X SPRI selection, and then fragments of length ∼390bp were quantified by bioanalyzer. Lenti_Cre_BC libraries were sequenced as spike-ins alongside the parent RNA-seq libraries.
Sequencing libraries from each sample were pooled to yield approximately equal coverage per cell per sample; scRNA gene expression libraries, Target Site amplicon libraries, MULTI-seq amplicon libraries and Lenti-Cre-BC amplicon libraries were pooled in an approximately 10:3:1:1 molar ratio for sequencing, aiming for at least 70,000 total reads per cell. The libraries were sequenced using a custom sequencing strategy on the NovaSeq platform (Illumina) in order to read the full-length Target Site amplicons. Sample identities were read as indices (I1: 8 cycles, R1: 26 cycles, R2: 290 cycles). Only the first 98 bases per read were used for analysis in the RNA expression libraries to mask the longer reads required to sequence the Target Sites.
Each cell was sequenced in four sequencing libraries: a MULTI-seq library (for identifying sample identity), a target site library (for reconstructing phylogenies), an RNA-seq library (for measuring transcriptional states), and a Lenti-Cre-BC library (for verifying clonal identity). First, the scRNA-seq was processed using the 10X CellRanger pipeline (version 2.1.1) with the mm10 genome build. Then, each cell barcode identified from the 10X pipeline was assigned to a sample using the MULTI-seq library, which was processed with the deMULTIplex R package (version 1.0.2; ( McGinnis et al. 2019 76. McGinnis, C.S. ∙ Patterson, D.M. ∙ Winkler, J. ... MULTI-Seq: sample multiplexing for single-cell RNA sequencing using lipid-tagged indices Nat. Methods. 2019; 16 :619-626 Crossref Scopus (124) PubMed Google Scholar )). Cells identified as doublets or without a discernible MULTI-seq label were filtered out from downstream analysis.
Next, we processed the Target Site library using the previously described Cassiopeia preprocessing pipeline ( Jones et al. 2020 55. Jones, M.G. ∙ Khodaverdian, A. ∙ Quinn, J.J. ... Inference of single-cell phylogenies from lineage tracing data using Cassiopeia Genome Biol. 2020; 21 :92 Crossref Scopus (14) PubMed Google Scholar ; Quinn et al. 2021 98. Quinn, J.J. ∙ Jones, M.G. ∙ Okimoto, R.A. ... Single-cell lineages reveal the rates, routes, and drivers of metastasis in cancer xenografts Science. 2021; 371 :p.eabc1944 Crossref Scopus (45) Google Scholar ). Briefly, reads with identical cellBC and UMI were collapsed into a single, error-corrected consensus sequence representing a single-expressed transcript. Consensus sequences were identified within a cell based on a maximum of 10 high-quality mismatches (PHRED score greater than 30) and an edit distance less than 2 (default pipeline parameters). UMIs within a cell reporting more than one consensus sequence were resolved by selecting the consensus sequence with more reads. Each consensus sequence was aligned to the wild-type reference Target Site sequence using a local alignment strategy, and the intBC and indel alleles were called from the alignment. Cells with fewer than 2 reads per UMI on average or fewer than 10 UMIs overall were filtered out. These data are summarized in a molecule table which records the cellBC, UMI, intBC, indel allele, read depth, and other relevant information. Cells that were assigned to Normal lung tissue via a MULTI-seq barcode or had more than 80% of their TargetSites uncut were assigned as “Normal” and not used for downstream lineage reconstruction tasks.
Lenti-Cre-BC libraries were processed using a custom pipeline combining Cassiopeia transcript collapsing, filtering, and quantification and a probabilistic assignment strategy based on the Perturb-seq gRNA calling pipeline ( Adamson et al. 2016 2. Adamson, B. ∙ Norman, T.M. ∙ Jost, M. ... A multiplexed single-cell CRISPR screening platform enables systematic dissection of the unfolded protein response Cell. 2016; 167 :1867-1882.e21 Full Text Full Text (PDF) Scopus (420) PubMed Google Scholar ). First, sequencing reads were collapsed based on a maximum sequence edit distance of 2 and 3 high-quality sequences mismatches and then cells with fewer than 2 average reads per UMI or 2 UMIs overall were filtered out. Then, Lenti-Cre-BC sequencing reads were compared to the reference sequence and barcode identities were extracted and error-corrected by comparing each extracted barcode to a whitelist of Lenti-Cre-BC sequences, allowing for an edit distance of 3. Then, the count distributions for each unique Lenti-Cre-BC were inspected to remove barcodes that represented background noise. Next, a Lenti-Cre-BC coverage matrix was formed, summarizing the ratio between reads and number of UMIs for each barcode in each cell. Cell coverages were normalized to sum to the median number of coverages across the matrix and log 2 -normalized. Finally, with this matrix we adapted the Perturb-seq gRNA calling pipeline to assign barcode identity to cells ( Adamson et al. 2016 2. Adamson, B. ∙ Norman, T.M. ∙ Jost, M. ... A multiplexed single-cell CRISPR screening platform enables systematic dissection of the unfolded protein response Cell. 2016; 167 :1867-1882.e21 Full Text Full Text (PDF) Scopus (420) PubMed Google Scholar ). To do so, we fit a Guassian kernel density function to the coverage distribution for each barcode and then determined a threshold separating “foreground” from “background” based on the relative extrema of the distribution (after removing the 99th percentile of the coverage distribution). Cells whose coverage values fell above the threshold were assigned that particular Lenti-Cre-BC. Cells that received more than one assignment or no assignment at all were marked as ambiguous.
After pre-processing each of these libraries, we called clonal populations, created character matrices, and reconstructed phylogenies for each clonal population (see sections below “Tree Reconstruction with Cassiopeia” and “Calling clonal populations and creating character matrices”). In this, we removed cells that contained few edited sites as this could indicate normal cell contamination (i.e. inactivity of Cas9) and identified consensus sets of intBCs per mES Clone (see section below “Creating a consensus intBC set for mESC clones”) that were used for tree reconstruction. After tree reconstruction, we used the Lenti-Cre-BC data to remove cells within each tumor that contained strong evidence of different clonal origin (see section below “Cell Filtering with Lenti-Cre-BC”). Finally, we computed important clone-level quality-control statistics used for identifying clones with sufficient information for phylodynamic analysis (see section below “Tree Quality Control for Fitness Inference”).
Across all three datasets (KP, KPL and KPA), this pipeline left us with 72,328 cells with high-quality Target Site information.
In this study, each clonal population corresponded to a primary tumor or metastatic family. Tumors were identified with two approaches: first, by deconvolution with MULTI-seq (and filtering with Lenti-Cre-BC information; see below in section “Cell Filtering with Lenti-Cre-BC”); and second, by separating cells based on differing intBC sets. In the second approach, we used Cassiopeia to identify non-overlapping intBC sets and classify cells using the “call-lineages” command-line tool. Once clonal populations were identified, consensus intBC sets were identified (see “Creating a consensus intBC set for mESC clones” below). All summarized molecular information for a given cell (cellBC, number of UMI, intBC, indel allele, read depth, etc) along with the assigned clonal identity were summarized in an allele table. Then, character matrices were formed for each clonal population, summarizing mutation information across the N cells in a population and their M cut-sites. Characters (i.e., cut-sites) with more than 80% missing information or containing a mutation that was reported in greater than 98% of cells were filtered out for downstream tree reconstruction.
Given that each mouse is generated from a specific mESC clone, we expected tumors from each mouse would maintain the same set of intBCs as the parental mESC clone. To identify this consensus set of intBCs, we stratified tumors based on which mESC clone they originated from, and within these groups computed the proportion of tumors that reported a given intBC in at least 10% of cells. We determined cutoffs separating reproducible intBCs from irreproducible intBCs for each mES clone separately. These consensus intBC sets were used for downstream reconstruction of phylogenies.
Trees for each clonal population (see “Calling clonal populations and creating character matrices” above) were reconstructed with Cassiopeia-Hybrid ( Jones et al. 2020 55. Jones, M.G. ∙ Khodaverdian, A. ∙ Quinn, J.J. ... Inference of single-cell phylogenies from lineage tracing data using Cassiopeia Genome Biol. 2020; 21 :92 Crossref Scopus (14) PubMed Google Scholar ). Briefly, Cassiopeia-Hybrid infers phylogenies by first splitting cells into clusters using a “greedy” criterion (Cassiopeia-Greedy) until a user-defined criteria is met at which point each cluster of cells is reconstructed using a near-optimal Steiner-Tree maximum-parsimony algorithm (Cassiopeia-ILP). We compared the parsimony of trees generated using two different greedy criterions - both criterions employed work by first identifying a mutation and subsequently splitting cells based on whether or not this mutation was observed in a cell. First, we used the original Cassiopeia-Greedy criterion, which identifies mutations to split cells on by using the frequency and probability of mutations. Second we applied a compatibility-based criterion which prioritizes mutations based on character-compatibility (see section “Compatibility-based greedy heuristic for tree reconstruction” below). We proceeded with the more parsimonious tree. In one specific case, (3515_Lkb1_T1), we observed that the lineage tracing alleles were not adequately captured with phylogenetic inference of the primary tumor alone. To handle this, we rebuilt the tree of the tumor-metastasis family and then subset the phylogeny to consist of only the cells from the primary tumor - resulting in a clonal phylogeny that appeared to be better supported by allelic information.
In most inferences, we used indel priors computed with Cassiopeia to select mutations with a Cassiopeia-Greedy algorithm as well as weight edges during the Steiner-Tree search with Cassiopeia-ILP. Generally, we used an LCA-based cutoff to transition between Cassiopeia-Greedy and Cassiopeia-ILP as previously described ( Quinn et al. 2021 98. Quinn, J.J. ∙ Jones, M.G. ∙ Okimoto, R.A. ... Single-cell lineages reveal the rates, routes, and drivers of metastasis in cancer xenografts Science. 2021; 371 :p.eabc1944 Crossref Scopus (45) Google Scholar ). Clone-specific parameters are reported in Table S1 .
A rare, but simple case for phylogenetic inference is that of perfect phylogeny in which every character (or cut-site) is binary (that is, can be cut or uncut) and mutates at most one time. In this regime, every pair of characters is “compatible” -- that is, given two binary characters i and j , the sets of cells that report a character i as mutated are non-overlapping with the set of cells that report character j as mutated, or one set of cells is completely contained within the other.
In this approach, we used a heuristic, called the compatibility index, to measure how far a pair of characters is from compatibility. To do so, we first “binarized” our character matrices by treating each unique (cut-site, mutation) pair as a binary character. (To note this binarization procedure is possible because of the irreversibility of Cas9 mutations and discussed in our previous work ( Jones et al. 2020 55. Jones, M.G. ∙ Khodaverdian, A. ∙ Quinn, J.J. ... Inference of single-cell phylogenies from lineage tracing data using Cassiopeia Genome Biol. 2020; 21 :92 Crossref Scopus (14) PubMed Google Scholar ).) Then, we found the character that had deviated the least from perfect phylogeny, that is violated compatibility the least. To find this character, we first built a directed “compatibility-graph”, where individual nodes represented characters and edges between nodes represented deviations from compatibility. Each edge from character i to j was weighted as follows: 𝑤 𝑖 , 𝑗 = − 𝑛 𝑗 ⁢ l o g ⁡ ( 𝑝 𝑗 ) where i and j are two incompatible characters, n j is the number of cells reporting character j , and p j is the prior probability of character j mutating. For the purposes of building this compatibility matrix, missing data was ignored (this is, no node in the graph corresponded to a missing state). A character c ’ to split cells with was identified by minimizing the sum of weights emitted from the node: 𝑐 ′ = 𝑎 ⁢ 𝑟 ⁢ 𝑔 ⁢ 𝑚 ⁢ 𝑖 ⁢ 𝑛 𝑐 ∈ 𝑋 ⁢ ∑ 𝑗 ∈ 𝑂 ⁢ 𝑢 ⁢ 𝑡 ⁡ ( 𝑐 ) 𝑤 𝑐 , 𝑗 where Out(c) denotes the set of edges with c as a source. This process was repeated until the tree was resolved completely, or a criterion was reached as in Cassiopeia-Hybrid.
After performing tree reconstruction for each clonal population, leaves were annotated with Lenti-Cre-BC information and evaluated manually for filtering. Specifically, in tumors with adequate Lenti-Cre-BC information, we identified subclades (defined here as clades that joined directly to the root) that clearly had divergent Lenti-Cre-BC information. This combined Lenti-Cre-BC and lineage analysis helped minimize the influence of lenti-Cre-BC dropout in single-cell experiments. These subclades were subsequently removed and cells were filtered out from the phylogenetic analysis. In one case (3513_NT_T4 and 3513_NT_T5), two tumor populations were split from a parental tumor (3513_NT_N2), reconstructed, and used in downstream analyses.
Chromosomal copy number variations (CNV) were inferred with the InferCNV R package (version 1.2.1), which predicts CNVs based on single-cell gene expression data. InferCNV was run in ‘subclusters’ analysis mode using ‘random_trees’ as the subclustering method. Genes with less than one cell were filtered with the ‘min_cells_per_gene’ option, and no clipping was performed on centered values (‘max_centered_threshold’ set to ‘NA’). The cutoff for the minimum average read count per gene among reference cells was set to 0.1, per software recommendation for 10x data. CNV prediction was performed with the ‘i6’ Hidden Markov Model, whose output CNV states were filtered with the included Bayesian mixture model with a threshold of 0.2 to find the most confident CNVs. All other options were set to their default values.
Each tumor sample was processed independently with normal lung cells (identified solely from the MULTI-seq deconvolution pipeline) as the reference cells. The number of CNVs for each cell was computed by counting the number of CNV regions predicted. We filtered cells with CNV counts greater than three standard deviations away from the mean of each tumor, in addition to cells with greater than or equal to 20 predicted CNVs. When comparing CNV counts of cells in expansions against those of cells in non-expansions, statistical significance was computed with a one-sided permutation test and the Mann-Whitney U-test, both of which yielded the same results.
We applied hierarchical clustering with a euclidean distance metric and the “ward” linkage to identify CNV clusters of cells within each tumor. For each clustering induced by cutting the hierarchical clustering dendrogram at different heights, we computed the probability that a cell and its nearest neighbor on the Cassiopeia tree were in the same hierarchical cluster (“nearest neighbor probability”). These clusters ranged from most coarse-grained (low cutoff height) to the most fine-grained (high cutoff height). When there were multiple nearest neighbors, pseudocounts were used by taking the fraction of nearest neighbors that were in the same cluster. We performed nonparametric Permutation Tests for each unique clustering by shuffling the cluster assignments of the cells and computing the nearest neighbor probability using these assignments.
Trees were subjected to quality control before identifying subclones under positive selection and single-cell fitness inference. We employed two quality control metrics: first, a measure of subclonal diversity known as “percent unique indel states”, defined as the proportion of cells that reported a unique set of character states (i.e., mutations). Second, we also filter lineage trees based on the level of “unexhausted target sites” defined as the proportion of characters (i.e., specific cut sites) that were not dominated by a single mutation (i.e, more than 98% of cells contained the same mutation). These metrics describe the diversity and depth of the lineage trees, and enable filtering out tumors with poor lineage tracing quality (i.e., lineage tracing capacity became saturated too early during tumor development). Using these two metrics, we filtered out tumors that had less than 10% unique indel states or less than 20% unexhausted target sites. Additionally, tumors with too few cells recovered (fewer than 100 cells) were ignored for this analysis because of a lack of power to confidently quantify subclonal behavior.
Subclones undergoing positive selection were identified by comparing the number of cells contained in the subclone to its direct “sisters” (i.e. branches emanating directly from the parent of a subclone of interest) and computing a probability of this observation with a coalescent model. Specifically, consider a node v in a particular tree with k children stored in the set C. Let n c denote the number of leaves below a particular node c (and observe that N = nv=c Cnc). Under the coalescent model, we can compute a probability indicating how likely a subclone c under v would have exactly n c leaves given v had N total leaves as follows: 𝑝 𝑁 , 𝑘 ⁡ ( 𝑛 𝑐 ) = ( 𝑁 − 𝑛 𝑐 − 1 𝑘 − 2 ) ( 𝑁 − 1 𝑘 − 1 )
Finally, we computed the probability that a subclone c under v would have at least n c leaves given v had N total leaves is: ̂ 𝑝 𝑁 , 𝑘 ⁡ ( 𝑛 𝑐 ) = ∑ 𝑁 − 𝑘 + 1 𝑛 = 𝑛 𝑐 𝑝 𝑁 , 𝑘 ⁡ ( 𝑛 )
Nodes with probabilities ̂ 𝑝 𝑁 , 𝑘 ⁡ ( 𝑛 𝑐 ) < 0 . 0 1 , at least a depth of 1 from the root, and containing subclades with at least 15% of the total tree population were annotated as undergoing an “expansion”. In the analysis presented in this study, we additionally filtered out nodes annotated as “expanding” if they contained another node in their subtree that was also expanding. Expansion proportions were calculated as the fraction of the tree consisting of cells residing in any subclade called as “expanding”.
To compute single-cell fitness, we used the “infer_fitness” function from the jungle package (publicly available at https://github.com/felixhorns/jungle ) which implements a previously described probabilistic method for inferring relative fitness coefficients between samples in a clonal population ( Neher et al. 2014 85. Neher, R.A. ∙ Russell, C.A. ∙ Shraiman, B.I. Predicting evolution from the shape of genealogical trees eLife. 2014; 3 :e03568 Crossref Scopus (90) Google Scholar ). Because some trees contained exhausted lineages (i.e., those in which all target sites were saturated with edits), after filtering out trees that did not pass quality control (see section “Tree quality control for fitness inference” above), we pre-processed branch lengths on each phylogeny such that branches had a length of 0 if no mutations separated nodes and 1 if not. In essence, this collapses uninformative edges in the fitness inference and helps control for lineage exhaustion. After this procedure, we were left with fitness estimates for each leaf in a phylogeny, normalized to other cells within the phylogeny.
Genes differentially expressed along the fitness continuum within each tumor were identified with a linear regression approach. Specifically, given a cell i , we can model the expression of some gene j according to the cell’s fitness score f i as follows: l o g ⁡ ( 1 + 𝑒 𝑖 , 𝑗 ) ∼ 𝑓 𝑖 + 𝑠 ⁢ 𝑖 ⁢ 𝑧 ⁢ 𝑒 _ 𝑓 ⁢ 𝑎 ⁢ 𝑐 ⁢ 𝑡 ⁢ 𝑜 ⁢ 𝑟 𝑖 Where e ij is the count-normalized expression of gene j in cell i (we used the median number of UMI counts across the dataset to normalize expression level) and size_factor i is the number of genes detected in the cell. Only genes appearing in more than 10 cells were retained for differential expression analysis. Linear models were fit using Julia’s GLM package (v1.3.7). Significances were computed using a Likelihood Ratio Test, comparing the model above to a model only using the size_factor as a predictor. P-values were FDR corrected using the Benjamini-Hochberg procedure ( Benjamini and Hochberg 1995 7. Benjamini, Y. ∙ Hochberg, Y. Controlling the false discovery rate: A practical and powerful approach to multiple testing Journal of the Royal Statistical Society: Series B (Methodological). 1995; 57 :289-300 Crossref Google Scholar ). Log 2 fold-changes were computed by comparing the average expression of a gene in the top vs bottom 10th percentile of fitness scores.
The transcriptional FitnessSignature was derived from the results of individual tumor fitness differential expressions with a majority-vote meta-analysis. This approach ranks genes based on the number of times that a gene is differentially expressed (FDR < 0.05 and |log 2 FC| > log 2 (1.5)) and the consistency of its direction. We used the MetaVolanoR R package (version 1.0.1) to perform this majority-vote analysis, which computed both of these values. We identified consistently differentially expressed genes for our transcriptional FitnessSignature if a gene appeared to show up at least 2 times in the same direction, and if the ratio between frequency and consistency was greater than 0.5.
We determined transcriptional fitness gene modules using the Hotspot package (version 0.9.0; ( DeTomaso and Yosef 2021 24. DeTomaso, D. ∙ Yosef, N. Hotspot identifies informative gene modules across modalities of single-cell genomics Cell Syst. 2021; 12 :446-456.e9 Full Text Full Text (PDF) Scopus (4) PubMed Google Scholar )). To do so, we first subset our processed single-cell expression matrix (see section below “Single-cell transcriptome analysis for KP-Tracer data”) to contain only the 1,183 genes in the FitnessSignature that were positively associated with fitness. Then, using Hotspot we identified fitness-related genes that were significantly autocorrelated with the scVI latent space using the “danb” observation model and 211 neighbors (the square-root of the number of cells in the expression matrix). After this procedure, genes with an FDR of less than 0.05 were retained for downstream clustering. We then computed pairwise local autocorrelations with Hotspot and clustered genes using these pairwise statistics with the “create_modules” function in Hotspot (minimum gene threshold of 100, FDR threshold of 0.05, core_only=False). This procedure identified three modules that were used for downstream analysis.
The scRNA-seq was processed using the 10X CellRanger pipeline (version 2.1.1) with the mm10 genome build. Cells were assigned to a sample using the MULTI-seq pipeline described above (see section “Single-cell preprocessing pipeline”). After quantification, informative genes were identified using the Fano filtering process implemented in VISION ( DeTomaso et al. 2019 23. DeTomaso, D. ∙ Jones, M.G. ∙ Subramaniam, M. ... Functional interpretation of single cell similarity maps Nat. Commun. 2019; 10 :4376 Crossref Scopus (45) PubMed Google Scholar ), and raw counts were batch-corrected (using the batch-harvest data, indicating when a batch of mice were sacrificed as the batch variable) and projected into a shared latent space of 10 dimensions with scVI ( Gayoso et al., 2022; Lopez et al., 2018 37. Gayoso, A. ∙ Lopez, R. ∙ Xing, G. ... A Python library for probabilistic analysis of single-cell omics data Nat. Biotechnol. 2022; 40 :163-166 Crossref Scopus (0) PubMed Google Scholar 69. Lopez, R. ∙ Regier, J. ∙ Cole, M.B. ... Deep generative modeling for single-cell transcriptomics Nat. Methods. 2018; 15 :1053-1058 Crossref Scopus (335) PubMed Google Scholar ). Cells were initially clustered with the Leiden algorithm as implemented in Scanpy ( Wolf et al. 2018 141. Wolf, F.A. ∙ Angerer, P.A. ∙ Theis, F.J. SCANPY: large-scale single-cell gene expression data analysis Genome Biol. 2018; 19 :15 Crossref Scopus (1050) PubMed Google Scholar ; Traag et al. 2019 127. Traag, V.A. ∙ Waltman, L. ∙ van Eck, N.J. From Louvain to Leiden: guaranteeing well-connected communities Sci. Rep. 2019; 9 :5233 Crossref Scopus (589) PubMed Google Scholar ), and two clusters dominated by cells annotated as normal and cells that could not be confidently mapped to a tumor via MULTI-seq or Lenti-Cre-BC analysis (see section “Single-cell preprocessing pipeline” and “Cell Filtering with Lenti-Cre-BC” above) were removed from downstream analysis. Clusters were then manually re-clustered to obtain segmentations that aligned with gene expression patterns. After this process, we were left with a total of high-quality 58,022 cells with single-cell transcriptomic profiles from KP mouse tumors. Single-cell counts were normalized by the median UMI count across cells and logged to obtain log-normalized data. Gene markers for each Leiden cluster were identified using the Wilcox rank-sums test on the log-normalized gene counts with the Scanpy package ( Wolf et al. 2018 141. Wolf, F.A. ∙ Angerer, P.A. ∙ Theis, F.J. SCANPY: large-scale single-cell gene expression data analysis Genome Biol. 2018; 19 :15 Crossref Scopus (1050) PubMed Google Scholar ).
scRNA-seq data of cells obtained from various tissues in sample L46 were quantified using the 10X CellRanger pipeline (version 2.1.1) with the mm10 genome build. Cells were assigned to a sample (one of 4 tissues) using the CellRanger multi procedure. After quantification and sample assignment, cells with fewer than 200 UMIs and genes appearing in fewer than 1% of cells were filtered out. This left us with 14,424 high-quality cells. A low-dimensional embedding was inferred using scVI on the dataset with the 4000 most highly-variable genes (using the “seurat_v3” flavor of Scanpy’s highly_variable_genes function). Transcriptional clusters were identified using the Leiden community detection algorithm. One cluster of 329 cells consisted of normal lung cells and expressed gene markers Nkx2-1 , Sftpc , and Scgb1a1 ; we isolated and annotated this cluster as normal lung epithelial cells (primarily AT2 and club cells).
This dataset of 329 normal lung epithelial cells (isolated from the L46 sample, as described above) was integrated into the scRNA-seq dataset of KP tumors (see section “Single-cell transcriptome processing for KP-Tracer NT data”) using scVI ( Gayoso et al., 2022; Lopez et al., 2018 37. Gayoso, A. ∙ Lopez, R. ∙ Xing, G. ... A Python library for probabilistic analysis of single-cell omics data Nat. Biotechnol. 2022; 40 :163-166 Crossref Scopus (0) PubMed Google Scholar 69. Lopez, R. ∙ Regier, J. ∙ Cole, M.B. ... Deep generative modeling for single-cell transcriptomics Nat. Methods. 2018; 15 :1053-1058 Crossref Scopus (335) PubMed Google Scholar ). Specifically, we used scVI to batch-correct these two datasets and project all cells into a common coordinate system. Then, we visualized this scVI batch-corrected embedding with UMAP.
TPM-normalized RNA-seq data were downloaded from GEO accession GSE84447 . Samples were split into early and late-stage tumor groups based on the author annotations: tumors annotated with “KPT-E” were assigned to the early stage group and tumors with “TnonMet” or “TMet” annotations were assigned to the late group. Then, we log-normalized the TPM counts and used the limma R package (version 3.36.3) to infer differentially expressed genes with the “eBayes” function. Genes passing an FDR threshold of 0.05 and log 2 -fold-change threshold of 1 (in either direction) were called differentially expressed and used for comparison with the FitnessSignature described in this study.
Raw expression count matrices were downloaded directly from GEO, accession number GSE152607 . Gene counts were normalized to transcript length, to account for read depth artifacts in the Smart-Seq2 protocol. VISION ( DeTomaso et al. 2019 23. DeTomaso, D. ∙ Jones, M.G. ∙ Subramaniam, M. ... Functional interpretation of single cell similarity maps Nat. Commun. 2019; 10 :4376 Crossref Scopus (45) PubMed Google Scholar ) was used to compute FitnessSignature scores (using the FitnessSignature gene set described in our study) for each cell in the dataset and scores were averaged within time points of KP mice.
The fitness signature genes including 1183 up-regulated genes and 1027 down-regulated genes from mice experiments were converted to corresponding genes from the H. sapiens genome (build hg19), resulting in 1126 up- and 970 down-regulated human genes, respectively. FitnessSignature with only up-related genes was denoted as FSU, FitnessSignature with only down-related genes was denoted as FSD. TCGA Lung adenocarcinoma cohort with RNAseq data (n=495) were stratified into FSU-High, FSU-Low, FSD-High, and FSD-Low according to median expression of sum of FitnessSignature genes, then, patients harboring genes with FSU-High and FSD-Low formed a group, patients containing FSU-Low and FSD-High gene expression formed another group. Subsequently, these two groups were used for survival analysis using the survival package in R (version 3.2.11). The survival analysis was invoked with the call “survfit(Surv(Time, Event) ∼ Group)” where “Group” is the FitnessSignature-based stratification. Kaplan–Meier curve is shown with a log-rank statistical test. For fitness gene module 1, 2, and 3 analyses, patients were divided into module gene expression of High and Low based on the median of the sum of gene expression, followed by survival analysis.
Each of the three fitness gene module scores (computed with VISION ) were normalized to the range [0, 1] across all NT cells. All NT cells in non-expansions were defined as the background cells, and the background module scores were calculated by averaging the normalized module scores of these cells. Additionally, the module scores of cells in each expansion were averaged to obtain the psuedo-bulk module score for each expansion. These module scores were divided by the background module scores, yielding the module enrichment score (i.e. fold-change versus background) per fitness module. These scores were plotted on a personality plot for visualization. Every expansion was assigned (non-exclusively) to the three fitness modules using a permutation test to test whether the cells in the expansion exhibited a significant increase in fitness module score compared to non-expanding background cells (p < 0.05).
EffectivePlasticity for each tumor was computed by first calculating a normalized parsimony score for the tumor tree, with respect to the Leiden cluster identities at the leaves, using the Fitch-Hartigan algorithm ( Fitch 1971 30. Fitch, W.M. Toward defining the course of evolution: minimum change for a specific tree topology Syst. Biol. 1971; 20 :406-416 Crossref Scopus (6104) Google Scholar ; Hartigan 1973 44. Hartigan, J.A. Minimum mutation fits to a given tree Biometrics. 1973; 29 :53-65 Crossref Google Scholar ). Briefly, this procedure begins by assigning cluster identities to the leaves of the tree, and then calculates the minimum number of times a transition between cluster identities must have happened ancestrally in order to account for the pattern observed at the leaves. To compare scores across trees, we normalize these parsimony scores by the number of edges in the tree, thus giving the EffectivePlasticity score. In all analyses, we filtered out cells that were part of Leiden clusters that were represented in less than 2.5% of the total size of the tree.
In order to generate single-cell EffectivePlasticity (“scEffectivePlasticity”), we computed the EffectivePlasticity for each subtree rooted at a node on the path from the root to a leaf and averaged these scores together. This score thus represents the average EffectivePlasticity of every subtree that contains a single cell.
To generate average EffectivePlasticity for each Leiden cluster, we first stratified cells in each tumor according to the Leiden cluster. Then, we averaged together scores within each tumor for each Leiden cluster, thus providing a distribution of EffectivePlasticity for each Leiden cluster.
The Allelic EffectivePlasticity score provided a “tree-agnostic” measurement of a cell’s effective plasticity. Qualitatively, the score measures the proportion of cells that are found in a different Leiden cluster than their closest relative (as determined by the modified edit distance between two cells’ character states; see section “Allelic Coupling” for the definition of this distance metric). Importantly, if a cell has more than one closest relative, each of their votes are normalized by the number of equally close relatives this cell has. More formally, the single-cell Allelic EffectivePlasticity was defined as: 𝑎 ⁡ ( 𝑖 ) = 1 | 𝐾 | ⁢ ∑ 𝑘 ∈ 𝐾 𝐼 ⁡ ( 𝑙 ⁢ 𝑒 ⁢ 𝑖 ⁢ 𝑑 ⁢ 𝑒 ⁢ 𝑛 ⁡ ( 𝑘 ) = = 𝑙 ⁢ 𝑒 ⁢ 𝑖 ⁢ 𝑑 ⁢ 𝑒 ⁢ 𝑛 ⁡ ( 𝑖 ) ) Where K indicates the set of a cell’s closest relatives, as measured by modified edit distance, leiden(i) indicates the Leiden cluster that cell i resides in, and I() is an indicator function that is 1 if the two Leiden clusters are the same and 0 otherwise. The Allelic EffectivePlasticity of a tumor is the average of these scores: 𝐴 ⁡ ( 𝑡 ⁢ 𝑢 ⁢ 𝑚 ⁢ 𝑜 ⁢ 𝑟 ) = 1 | 𝐿 | ⁢ ∑ 𝑙 ∈ 𝐿 𝑎 ⁡ ( 𝑙 )
The L2 EffectivePlasticity score served as an alternative tree-based score that accounted for random noise at the boundary between two Leiden clusters, as opposed to treating each Leiden Cluster as a point. As with the EffectivePlasticity score, we first found nearest-neighbors of each cell i using the phylogenies and considered neighbors found in a different Leiden cluster than i . Yet, in contrast to the EffectivePlasticity score, we distinctly used an L2-distance in the 10 dimensional scVI latent space to obtain a measure of how distinct the neighbor was. Mathematically, the single-cell L2 EffectivePlasticity score was defined as: 𝑙 2 ⁡ ( 𝑖 ) = 1 | 𝐾 | ⁢ ∑ 𝑘 ∈ 𝐾 | | 𝑥 𝑖 − 𝑥 𝑘 | | 2 Where K indicates the set of a cell’s closest relatives, as found with the phylogeny, and x i indicates the 10-dimensional embedding of cell i ’s single-cell expression profile in scVI space. The L2 EffectivePlasticity of a tumor was defined as the average across all leaves in the tumor.
Evolutionary Coupling is the normalized phylogenetic distance between any pair of variables on a tree. Mathematically, given two states M and K that can be used to label a subset of the leaves of the tree, we compute the average distance between these states: 𝐷 ⁡ ( 𝑀 , 𝐾 ) = 1 𝑛 𝑚 ⁢ 𝑛 𝑘 ⁢ ∑ 𝑚 ∈ { 𝑀 } , 𝑘 ∈ ( 𝐾 } 𝑑 𝑇 ⁡ ( 𝑚 , 𝑘 ) where n M is the number of leaves with state M, {M} denotes the set of cells in set M , and d T (i, j) denotes the phylogenetic distance between leaves. There are multiple ways to score d T (i, j) , and here we used the number of mutated edges for our analysis (i.e., the number of edges separating two leaves i and j that carried at least one mutation). To normalize these distances, we compare D(M, K) to a random background generated by shuffling the leaf assignments 2000 times. Then, to obtain background-normalized scores, we Z-normalize to the random distribution D R : 𝐷 ′ ⁡ ( 𝑀 , 𝐾 ) = 𝐷 ⁡ ( 𝑀 , 𝐾 ) − 𝐸 ⁡ [ 𝐷 𝑅 ⁡ ( 𝑀 , 𝐾 ) ] 𝑆 ⁢ 𝐷 ⁡ [ 𝐷 𝑅 ⁡ ( 𝑀 , 𝐾 ) ]
This score is obtained for all pairs of states in a tumor that pass a 2.5% proportion threshold (i.e., we filter out cells in states that fall below this threshold). Then, from the matrix of all background-normalized phylogenetic distances, P (such that P M,K is equal to D ’ (M,K) ), we compute the Evolutionary Couplings between two states M and K by Z-normalizing P : 𝐸 ⁡ ( 𝑀 , 𝐾 ) = 𝑃 𝑀 , 𝐾 − 𝐸 ⁡ [ 𝑃 ] 𝑆 ⁢ 𝐷 ⁡ [ 𝑃 ]
Evolutionary Couplings presented in Figures 5 B and 5D are normalized as: ̂ 𝐸 ⁡ ( 𝑀 , 𝐾 ) = e x p ⁡ ( − 𝐸 ⁡ ( 𝑀 , 𝐾 ) m a x ⁡ ( 𝑎 ⁢ 𝑏 ⁢ 𝑠 ⁡ ( 𝐸 ) ) ) Where E denotes all the Evolutionary Couplings between states in a given tumor.
We used modified edit distances between cells to compute an Allelic Coupling score that could be used to assess consistency of the Evolutionary Coupling results. Here, we used a modified edit distance, h ’ (a i , b i ) , that scored the distance between sample a and b at the i th character:

The allelic distance between two samples a and b is ∑ 𝑖 ∈ 𝑋 ℎ ′ ⁡ ( 𝑎 𝑖 , 𝑏 𝑖 ) . We used these distances instead of phylogenetic distances to compute the coupling statistic described in the section above entitled “Evolutionary Coupling” and called this new coupling statistic “Allelic Coupling”.
K-nearest-neighbor (KNN) coupling was computed by using d T as the distance to the k th neighbor in the Evolutionary Coupling statistic. We used the same phylogenetic distance described in the section entitled “Evolutionary Coupling” to compute the k th neighbor and used k=10 for the analysis.
To identify separate fates in the KP-Tracer dataset, we first computed Evolutionary Couplings in each tumor for all pairs of states. To remove noise intrinsic to the clustering, we filtered out clusters that accounted for less than 2.5% of the tumor. As a phylogenetic distance metric, we used the number of mutated edges (i.e., any edge that contained at least one mutation was given a weight of 1 and otherwise the edge was weighted as 0). Before computing Evolutionary Couplings, we preprocessed the lineages such that each leaves with the same Leiden cluster were grouped together (see section entitled “Preprocessing lineages with respect to states”).
After calculating the Evolutionary Coupling for all pairs of states within each tumor, we concatenated all vectors of Evolutionary Coupling together into a matrix. We additionally converted Evolutionary Couplings to similarities by exponentiating these values (i.e, E ’ (M, K) = exp(-E(M,K)) ). As additional features for this clustering, we also added Leiden cluster proportions to each tumor’s vector of couplings. Then we Z-normalized across features to compare tumors and clustered this transformed matrix using a hierarchical clustering approach in the python scipy package (version 1.6.1). We used a Euclidean metric and the “ward” linkage method. We identified three clusters from this hierarchical clustering, corresponding to our three Fate Clusters. These three Fate Clusters were visualized using Uniform Manifold Approximation and Projection (UMAP) on the Evolutionary Coupling and Leiden cluster proportion concatenated matrix. Important couplings were identified using Principal Component Analysis on the same Evolutionary Coupling concatenated matrix.
In some lineages, we observed that polytomies (or non-bifurcating) subclades were created at the very bottom of the tree due to the saturation of target site edits. Because this could artificially appear to make cellular states more closely related than they actually were, we took a conservative approach to making conclusions about cellular relationships between leaves in such polytomies. Specifically, we first assigned states from a state space Σ to each leaf in a tree according to some function 𝑠 ⁡ ( 𝑙 ) → 𝜎 ∈ Σ for all l leaves in the tree. Then, for all polytomies that contained at least unique states or more, we created extra splits in the tree for each unique state. More formally:

To create a consensus Evolutionary Coupling map across the tumors in a Fate Cluster, we first computed the average Evolutionary Coupling between all pairs of states in a tumor as described previously. Then, we computed an average Evolutionary Coupling for each pair of states, normalizing by the number of tumors that this pair appeared in above the requisite 2.5% threshold. Critically, we removed patterns that were driven by a small proportion of cells, we only considered states that appeared in at least 2.5% of the total number of cells across all tumors in a Fate Cluster.
Phylotime was defined as the distance to the first ancestor that could have been a particular state. To approximate the Phylotime in this study, we defined the initial AT2-like state (Leiden cluster 4) as the ground state, and inferred the sets of states for each ancestor with the Fitch-Hartigan bottom-up algorithm ( Fitch 1971 30. Fitch, W.M. Toward defining the course of evolution: minimum change for a specific tree topology Syst. Biol. 1971; 20 :406-416 Crossref Scopus (6104) Google Scholar ; Hartigan 1973 44. Hartigan, J.A. Minimum mutation fits to a given tree Biometrics. 1973; 29 :53-65 Crossref Google Scholar ). Then, in each tumor, we computed the phylogenetic distance separating each cell from its closest ancestor that could have been an AT2-like cell, as determined with the Fitch-Hartigan bottom-up algorithm. Phylogenetic distances were defined as the number of non-zero-length branches (though we compare the consistency of Phylotime to a distance metric that uses the number of mutations along each edge in Figures S5 J and S5K). In this way, Phylotime is proportional to the number of generations elapsed since the more recent ancestral node that, under a maximum-parsimony approach, could have been an AT2-like cell. Here, the tree structure is advantageous in modeling divergence times from the AT2-like state because it can account for homoplasy (i.e., the same mutation occurring independently) and convergent phenotypic evolution events (i.e., the same transcriptomic state being reached separately, as opposed to pseudotime statistics estimated from single-cell transcriptomes ( Trapnell et al., 2014 128. Trapnell, C. ∙ Cacchiarelli, D. ∙ Grimsby, J. ... The dynamics and regulators of cell Fate decisions are revealed by pseudotemporal ordering of single cells Nat. Biotechnol. 2014; 32 :381-386 Crossref Scopus (1984) PubMed Google Scholar ) events. Thus, it is preferable, in principle, to comparing the mutation states directly between a leaf and all AT2-like cells. Phylotime within each tumor was normalized to a 0-1 scale. Once every tumor was analyzed this way, Phylotime across tumors was merged by performing an average-based smoothing across the transcriptional space: specifically, for each cell, we found the 5 closest neighbors in transcriptional space (in the low-dimensional scVI latent space) and averaged Phylotimes within this neighborhood. After integrating together Phylotime in this manner, the final distribution across tumors was normalized once again to a 0-1 scale.
Genes associated with Phylotime in each Fate Cluster were identified using the Tradeseq package ( Van den Berge et al. 2020 105. Van den Berge, Koen ∙ Roux de Bézieux, H. ∙ Street, K. ... Trajectory-based differential expression analysis for single-cell sequencing data Nat. Commun. 2020; 11 :1-13 Crossref Scopus (62) PubMed Google Scholar ). Specifically, for each Fate Cluster, lowly-expressed genes were filtered if they were detected in fewer than 10% of cells and high-variance genes were identified with the Fano filtering procedure implemented in VISION ( DeTomaso et al. 2019 23. DeTomaso, D. ∙ Jones, M.G. ∙ Subramaniam, M. ... Functional interpretation of single cell similarity maps Nat. Commun. 2019; 10 :4376 Crossref Scopus (45) PubMed Google Scholar ). Then, in each cluster, expression models were fitted with the “fitGAM” function and genes associated with a specific segment of Phylotime were identified with the “associationTest” function. P-values were FDR corrected using the Benjamini-Hochberg procedure ( Benjamini and Hochberg 1995 7. Benjamini, Y. ∙ Hochberg, Y. Controlling the false discovery rate: A practical and powerful approach to multiple testing Journal of the Royal Statistical Society: Series B (Methodological). 1995; 57 :289-300 Crossref Google Scholar ), and significant genes were retained if they had an FDR below 0.05 and a mean log 2 -fold-change above 0.5. Smoothed expression profiles were predicted with the Tradeseq package using the models fit from the fitGAM procedure and genes were subsequently clustered into those expressed early and late. Gene set enrichment analysis was performed using the enrichR R package (version 3.0) after converting gene names from mm10 to GRCh38. We used the Biological Process gene ontology, ChEA, and MsigDB Hallmark gene sets. Informative genes were manually selected from the set of genes passing the significance and effect-size thresholds, and manually clustered for display in Figure 5 .
The scRNA-seq data was processed using the 10X CellRanger pipeline (version 2.1.1) with the mm10 genome build. Cells were assigned to a sample using the MULTI-seq pipeline as described above (see section “Single-cell preprocessing pipeline”) to form a raw count matrix consisting of cells from KP, KPL, or KPA mice. Cells with fewer than 200 genes detected, greater than 15% of mitochondrial reads, or greater than 7000 genes detected were filtered out. Cells were batch-corrected and projected into 20 latent dimensions using scVI ( Gayoso et al., 2022; Lopez et al., 2018 37. Gayoso, A. ∙ Lopez, R. ∙ Xing, G. ... A Python library for probabilistic analysis of single-cell omics data Nat. Biotechnol. 2022; 40 :163-166 Crossref Scopus (0) PubMed Google Scholar 69. Lopez, R. ∙ Regier, J. ∙ Cole, M.B. ... Deep generative modeling for single-cell transcriptomics Nat. Methods. 2018; 15 :1053-1058 Crossref Scopus (335) PubMed Google Scholar ) with 2 hidden layers and the library batch as a batch covariate on the top 4000 most variable genes, as detected with Scanpy’s “highly_variable_genes” function with the “seruat_v3” flavor ( Wolf, Angerer, and Theis 2018 141. Wolf, F.A. ∙ Angerer, P.A. ∙ Theis, F.J. SCANPY: large-scale single-cell gene expression data analysis Genome Biol. 2018; 19 :15 Crossref Scopus (1050) PubMed Google Scholar ). Clusters were identified with the Leiden algorithm ( Traag, Waltman, and van Eck 2019 127. Traag, V.A. ∙ Waltman, L. ∙ van Eck, N.J. From Louvain to Leiden: guaranteeing well-connected communities Sci. Rep. 2019; 9 :5233 Crossref Scopus (589) PubMed Google Scholar ) with manual parameter selection to obtain an acceptable resolution. All normal cells and seven additional clusters with high proportions of normally-annotated cells (as with MULTI-seq or via the lineage-tracing data) were filtered out for downstream analysis (a total of 2,209 cells in the entire dataset).
To perform label transfer from the KP-Tracer dataset, we first labeled all KP cells in the integrated dataset with previous annotations and labeled all new cells with “Unknown”. Then, we used scANVI ( Xu et al. 2021 142. Xu, C. ∙ Lopez, R. ∙ Mehlman, E. ... Probabilistic harmonization and annotation of single-cell transcriptomics data with deep generative models Mol. Syst. Biol. 2021; 17 :e9620 Crossref Scopus (24) PubMed Google Scholar ) to predict labels of cells from KPL and KPA mice using 40 latent dimensions, 2 hidden layers, and a dropout rate of 0.2. Upon inspecting predictions, we elected to keep predictions made by scANVI for the majority of cells, with the exception of 5 new Leiden clusters identified by clustering the scVI latent space. Additionally, we elected to merge one new Leiden cluster with the Pre-EMT state because key gene expression markers across these two states were consistent. After this process, we were left with a total of 104,197 high-quality cell transcriptomes.
The single-cell RNA count matrix was first count-normalized to the median number of UMI counts across cells and log-transformed. Then, cells assigned to the Pre-EMT state were separated into three non-overlapping sets according to their genotype (KP, KPL, or KPA). Differentially expressed genes in the KPL subset of cells in the Pre-EMT cluster were identified by comparing these cells to all other cells with Scanpy using a t-test on log-normalized count matrix with the top 5000 most variable genes. Highlighted genes were selected from the set genes passing an FDR cutoff of 0.05 and a log 2 FC cutoff of 1.
The evolutionary trajectories from KPL and KPA mice were analyzed identically to the KP tumors as described in the previous section entitled “Fate Clustering”. Briefly, each tumor was described as a vector of Leiden cluster proportions and exponentiated Evolutionary Couplings (i.e, E ’ (M, K) = exp(-E(M,K)) ). Vectors were concatenated together and Z-normalized across features. The resulting matrix was decomposed and analyzed using Principal Component Analysis (PCA) and informative features were identified by evaluating the features with highest principal component loadings.
Using the tumor-metastasis family tree for 3724_NT_T1 and associated metastases, we computed the Evolutionary Couplings between each microdissected piece of the primary tumor (T1-15) and each metastasis (the statistic is described in the section entitled “Evolutionary Coupling”). Normalized Evolutionary Couplings (E) were computed as described previously.
In each of the tumor-metastasis families (defined as a tumor containing both a primary tumor and a large enough metastatic population) analyzed in Figures 7 and S7 , we first reconstructed trees encompassing all cells in the primary and metastatic tumors (referred to as a “tumor-metastasis family” tree). Then, we stratified cells in the primary tumor by the expansions called with our expansion-calling statistic (see above, “Identifying subclonal selection”). If a cell was not part of an expansion, it was labeled as “non-expansion”. Then, for each cell in a metastatic tumor, we computed the average modified phylogenetic distance to all primary tumor cells in the tumor-metastasis family tree. The modified phylogenetic distance was computed as the sum of branch lengths, where each branch length was defined as the number of mutations separating each node from one another (as inferred using Camin-Sokal parsimony - i.e., irreversibility of mutations).
Tumor-metastasis family trees were inferred and stratified as described above (see “Phylogenetic distances on Tumor-Metastasis Family trees”) and Euclidean distance was used to measure transcriptomic differences between metastatic cells and primary tumor subpopulations.
All statistical tests comparing the distribution of continuous values are indicated in the appropriate figure legend. Mann-Whitney U tests were performed using the ranksums function in the scipy.stats python package with sidedness specified in the figure legend. All boxplots present the quartiles of the distribution and whiskers show the rest of the distribution. Outliers of boxplots are determined using as being 1.5x the inter-quantile range.

Section: Acknowledgments

We thank Marco Jost, Jeffrey Hussmann, Luke Koblan, Yocef Ouadah, Lindsay LaFave, Luke Gilbert, Julien Sage, Xin Ye, Brittany Adamson, Sebastian Prillo, and all members of the Weissman, Jacks, and Yosef labs for helpful discussions. We thank Liming Tao, Demi Sandel, Caterina Colon, Laura Liao, Kieren Marini, Alejandro Sweet-Cordero, Danielle Dionne, Toni Delorey, Jenna Pfiffner-Borges, Orit Rozenblatt-Rosen, and Aviv Regev for technical help. We thank Joan Kanter, Cristen Muresan, Karen Yee, and Judy Teixeira for administrative support. We thank the UCSF Center for Advanced Technology and the Chan Zuckerberg Biohub for assistance with high-throughput sequencing. We thank UCSF Flow Cytometry Facility, UCSF Cell and Genome Engineering Core, MIT Koch Institute Animal Facility, and MIT Swanson Biotechnology Center Flow Cytometry Facility.
Research reported in this publication was supported in part by the NCI Cancer Target Discovery And Development (CTD ∧ 2) and the NIH Centers of Excellence in Genomic Science (CEGS), the NCI Cancer Center Support (core) grant P30-CA14051, the Howard Hughes Medical Institute, and the Ludwig Center at MIT. D.Y. is supported by a Damon Runyon Cancer Research Foundation Postdoctoral Fellowship (DRG-2238-18). M.G.J. is supported by a UCSF Discovery Fellowship. S.N. is supported by a predoctoral training grant T32GM007287 and a Howard Hughes Medical Institute Gilliam Award. J.M.R. is supported by the NIH F31NS115380. J.J.Q. is supported by a NIH NIGMS F32GM125247. F.H. is supported by a Helen Hay Whitney Foundation Fellowship. C.S.M. is supported by the NIH-NCI F31CA257349. D.M.P. is supported by the NIH-NIGMS F32GM128366. M.M.C. is a Gordon and Betty Moore fellow of the Life Sciences Research Foundation. J.S.W. and T.J. were supported by the Howard Hughes Medical Institute and the Ludwig Center at MIT. T.J. is supported by the Break Through Cancer Foundation, Johnson & Johnson Lung Cancer Initiative, and The Lustgarten Foundation. T.G.B. received funding support from the National Institutes of Health (R01CA231300, U54CA224081, R01CA204302, R01CA211052, and R01CA169338).
D.Y., M.G.J., T.J., N.Y., and J.S.W. conceived of, designed, and led the analysis of the KP-Tracer project. D.Y. constructed lineage-tracing targeting vectors and engineered the mouse ES cells with the help from J.L.P. and W.F-P. W.M.R. III generated the KP-Tracer chimeric mice, and S.N. transduced the mice. D.Y. and S.N. harvested tumors. D.Y. generated the single-cell RNA-seq data with help from C.S.M., D.M.P., Z.J.G., and E.D.C.; W.W. and T.G.B analyzed the TCGA data. M.G.J. and N.Y. conceived of computational approaches, and M.G.J. implemented these approaches. M.G.J., K.H.(J.)M., and D.Y. analyzed the data with help from F.H., X.Q., J.J.Q., R.H., M.Z.C., and M.M.C.; D.Y., M.G.J., N.Y., T.J., and J.S.W. interpreted results. D.Y., M.G.J., T.J., N.Y., and J.S.W. wrote the manuscript with input from all authors. J.S.W., T.J., and N.Y. supervised the project.
J.S.W. declares outside interest in 5 AM Venture, Amgen, Chroma Medicine, KSQ Therapeutics, Maze Therapeutics, Tenaya Therapeutics, and Tessera Therapeutics. T.J. is a member of the Board of Directors of Amgen and Thermo Fisher Scientific, is a co-founder of Dragonfly Therapeutics and T2 Biosystems, and is the president of Break Through Cancer. T.J. serves on the Scientific Advisory Board of Dragonfly Therapeutics, SQZ Biotech, and Skyhawk Therapeutics. None of these affiliations represent a conflict of interest with respect to this study. T.G.B. is an advisor to Array BioPharma, Revolution Medicines, Novartis, AstraZeneca, Takeda, Springworks, Jazz Pharmaceuticals, Relay Therapeutics, Rain Therapeutics, and Engine Biosciences and receives research funding from Novartis, Strategia, Kinnate, and Revolution Medicines. J.M.R. consults for Maze Therapeutics and Waypoint Bio. Z.J.G. is an equity holder in Scribe Biosciences and Provenance bio and a member of the SAB of Serotiny Bio.
One or more of the authors of this paper self-identifies as an underrepresented ethnic minority in science. One or more of the authors of this paper self-identifies as a member of the LGBTQ+ community. One or more of the authors of this paper received support from a program designed to increase minority representation in science.

Section: Supplemental information (6)

Download all Spreadsheet (31.38 KB) Table S1. Tumor sample information, tree reconstruction parameters, and quality-control statistics, related to Figure 1 This table contains information about all tumor samples regarding their timing, ES clones, mice and genetic perturbations, the Cassiopeia parameters used to reconstruct trees, the parsimony scores, depths, and indel-phylogeny distance correlations. Spreadsheet (6.21 MB) Table S2. Differential expression gene lists of individual Leiden clusters, related to Figures 3 and 6 Reports the effect sizes and significances genes across various differential expression analyses performed throughout the study, including the differentially expressed genes of Leiden clusters in KP tumors, in tumors of all three genotypes combined (KP, KPL and KPA) and differentially expressed genes of the PreEMT transcriptional states in KPL versus the other tumors. Spreadsheet (522.04 KB) Table S3. Phylogenetic fitness majority vote gene association signatures and modules, related to Figures 3 and 6 This table reports the low- and high-fitness-associated-genes from the majority-vote meta-analysis of KP, KPL and KPA tumors individually. The gene set enrichment analysis for the fitness-associated genes in KP mice is included. We also include the gene lists for the three gene modules from the Hotspot analysis of high fitness-associated genes of the KP tumors. Spreadsheet (55.39 KB) Table S4. Evolutionary coupling and Leiden cluster proportions for individual tumors (including all KP, KPL, and KPA tumors) analyzed for Figures 5 and 6 Spreadsheet (127.10 KB) Table S5. Phylotime differential gene expression analysis, related to Figure 5 This table contains the differentially expressed genes following early to late Phylotime in tumors from Fate Cluster 1 and 2. Spreadsheet (13.53 KB) Table S6. Primers and plasmids used in this manuscript, related to STAR Methods
