Title: A single-embryo, single-cell time-resolved model for mouse gastrulation


Abstract: Summary

Mouse embryonic development is a canonical model system for studying mammalian cell fate acquisition. Recently, single-cell atlases comprehensively charted embryonic transcriptional landscapes, yet inference of the coordinated dynamics of cells over such atlases remains challenging. Here, we introduce a temporal model for mouse gastrulation, consisting of data from 153 individually sampled embryos spanning 36 h of molecular diversification. Using algorithms and precise timing, we infer differentiation flows and lineage specification dynamics over the embryonic transcriptional manifold. Rapid transcriptional bifurcations characterize the commitment of early specialized node and blood cells. However, for most lineages, we observe combinatorial multi-furcation dynamics rather than hierarchical transcriptional transitions. In the mesoderm, dozens of transcription factors combinatorially regulate multifurcations, as we exemplify using time-matched chimeric embryos of Foxc1/Foxc2 mutants. Our study rejects the notion of differentiation being governed by a series of binary choices, providing an alternative quantitative model for cell fate acquisition.

Section: Introduction

Early embryonic development in mammals proceeds through robust acquisition of specialized cellular properties by individual cells that specify the basic embryonic lineages, which, in turn, form the first organs. Decades of research using model organisms have provided tremendous insight into the activity of genes and pathways driving this process and ensuring its robustness ( Arnold and Robertson, 2009 4. Arnold, S.J. ∙ Robertson, E.J. Making a commitment: cell lineage allocation and axis patterning in the early mouse embryo Nat. Rev. Mol. Cell Biol. 2009; 10 :91-103 Crossref Scopus (586) PubMed Google Scholar ; Bedzhov et al., 2014 8. Bedzhov, I. ∙ Graham, S.J. ∙ Leung, C.Y. ... Developmental plasticity, cell fate specification and morphogenesis in the early mouse embryo Philos. Trans. R. Soc. Lond. B Biol. Sci. 2014; 369 :20130538 Crossref Scopus (95) PubMed Google Scholar ; Ebisuya and Briscoe, 2018 21. Ebisuya, M. ∙ Briscoe, J. What does time mean in development? Development. 2018; 145 :dev164368 Crossref Scopus (83) PubMed Google Scholar ; Tam and Ho, 2020 64. Tam, P.P.L. ∙ Ho, J.W.K. Cellular diversity and lineage trajectory: insights from mouse single cell transcriptomes Development. 2020; 147 :dev179788 Crossref Scopus (15) PubMed Google Scholar ). This had far-reaching implications for other fields such as cancer and regenerative medicine ( Ben-Porath et al., 2008 10. Ben-Porath, I. ∙ Thomson, M.W. ∙ Carey, V.J. ... An embryonic stem cell-like gene expression signature in poorly differentiated aggressive human tumors Nat. Genet. 2008; 40 :499-507 Crossref Scopus (2086) PubMed Google Scholar ; Spagnoli and Hemmati-Brivanlou, 2006 58. Spagnoli, F.M. ∙ Hemmati-Brivanlou, A. Guiding embryonic stem cells towards differentiation: lessons from molecular embryology Curr. Opin. Genet. Dev. 2006; 16 :469-475 Crossref Scopus (29) PubMed Google Scholar ). Advances in single-cell technologies recently enabled high-resolution charting of mouse embryonic development, mapping comprehensively the transcriptional states of developing embryos during gastrulation ( Argelaguet et al., 2019 2. Argelaguet, R. ∙ Clark, S.J. ∙ Mohammed, H. ... Multi-omics profiling of mouse gastrulation at single-cell resolution Nature. 2019; 576 :487-491 Crossref Scopus (242) PubMed Google Scholar ; Chan et al., 2019 15. Chan, M.M. ∙ Smith, Z.D. ∙ Grosswendt, S. ... Molecular recording of mammalian embryogenesis Nature. 2019; 570 :77-82 Crossref Scopus (204) PubMed Google Scholar ; Cheng et al., 2019 17. Cheng, S. ∙ Pei, Y. ∙ He, L. ... Single-Cell RNA-Seq Reveals Cellular Heterogeneity of Pluripotency Transition and X Chromosome Dynamics during Early Mouse Development Cell Rep. 2019; 26 :2593-2607.e3 Full Text Full Text (PDF) Scopus (74) PubMed Google Scholar ; Grosswendt et al., 2020 25. Grosswendt, S. ∙ Kretzmer, H. ∙ Smith, Z.D. ... Epigenetic regulator function through mouse gastrulation Nature. 2020; 584 :102-108 Crossref Scopus (70) PubMed Google Scholar ; Ibarra-Soria et al., 2018 31. Ibarra-Soria, X. ∙ Jawaid, W. ∙ Pijuan-Sala, B. ... Defining murine organogenesis at single-cell resolution reveals a role for the leukotriene pathway in regulating blood progenitor formation Nat. Cell Biol. 2018; 20 :127-134 Crossref Scopus (80) PubMed Google Scholar ; Lescroart et al., 2018 40. Lescroart, F. ∙ Wang, X. ∙ Lin, X. ... Defining the earliest step of cardiovascular lineage segregation by single-cell RNA-seq Science. 2018; 359 :1177-1181 Crossref Scopus (192) PubMed Google Scholar ; Mohammed et al., 2017 45. Mohammed, H. ∙ Hernando-Herraez, I. ∙ Savino, A. ... Single-Cell Landscape of Transcriptional Heterogeneity and Cell Fate Decisions during Mouse Early Gastrulation Cell Rep. 2017; 20 :1215-1228 Full Text Full Text (PDF) Scopus (198) PubMed Google Scholar ; Nowotschin et al., 2019 46. Nowotschin, S. ∙ Setty, M. ∙ Kuo, Y.Y. ... The emergent landscape of the mouse gut endoderm at single-cell resolution Nature. 2019; 569 :361-367 Crossref Scopus (213) PubMed Google Scholar ; Pijuan-Sala et al., 2019 51. Pijuan-Sala, B. ∙ Griffiths, J.A. ∙ Guibentif, C. ... A single-cell molecular map of mouse gastrulation and early organogenesis Nature. 2019; 566 :490-495 Crossref Scopus (483) PubMed Google Scholar ; Scialdone et al., 2016 56. Scialdone, A. ∙ Tanaka, Y. ∙ Jawaid, W. ... Resolving early mesoderm diversification through single-cell expression profiling Nature. 2016; 535 :289-293 Crossref Scopus (206) PubMed Google Scholar ) and organogenesis ( Cao et al., 2019 14. Cao, J. ∙ Spielmann, M. ∙ Qiu, X. ... The single-cell transcriptional landscape of mammalian organogenesis Nature. 2019; 566 :496-502 Crossref Scopus (1786) PubMed Google Scholar ; Chan et al., 2019 15. Chan, M.M. ∙ Smith, Z.D. ∙ Grosswendt, S. ... Molecular recording of mammalian embryogenesis Nature. 2019; 570 :77-82 Crossref Scopus (204) PubMed Google Scholar ; de Soysa et al., 2019 19. de Soysa, T.Y. ∙ Ranade, S.S. ∙ Okawa, S. ... Single-cell analysis of cardiogenesis reveals basis for organ-level developmental defects Nature. 2019; 572 :120-124 Crossref Scopus (153) PubMed Google Scholar ; Han et al., 2018 26. Han, X. ∙ Wang, R. ∙ Zhou, Y. ... Mapping the Mouse Cell Atlas by Microwell-Seq Cell. 2018; 172 :1091-1107.e17 Full Text Full Text (PDF) Scopus (901) PubMed Google Scholar ; Nowotschin et al., 2019 46. Nowotschin, S. ∙ Setty, M. ∙ Kuo, Y.Y. ... The emergent landscape of the mouse gut endoderm at single-cell resolution Nature. 2019; 569 :361-367 Crossref Scopus (213) PubMed Google Scholar ; Tam and Ho, 2020 64. Tam, P.P.L. ∙ Ho, J.W.K. Cellular diversity and lineage trajectory: insights from mouse single cell transcriptomes Development. 2020; 147 :dev179788 Crossref Scopus (15) PubMed Google Scholar ). Yet, moving from atlases toward the inference of quantitative dynamics during cell state transitions represents a major open challenge in the field. Pseudotemporal ordering defines the progression of cell trajectories based on computational inference of transcriptional similarities ( Tanay and Regev, 2017 65. Tanay, A. ∙ Regev, A. Scaling single-cell genomics from phenomenology to mechanism Nature. 2017; 541 :331-338 Crossref Scopus (489) PubMed Google Scholar ). However, the rapid nature of development, characterized by a continuous flux of intracellular molecular changes within a short time frame, poses unique challenges for this approach ( Tritschler et al., 2019 68. Tritschler, S. ∙ Büttner, M. ∙ Fischer, D.S. ... Concepts and limitations for learning developmental trajectories from single cell genomics Development. 2019; 146 :dev170506 Crossref Scopus (125) PubMed Google Scholar ) (e.g., when bifurcation points are fuzzy or when distinct differentiating populations converge by activating common gene modules in a non-hierarchical manner). Similarly, pseudo-temporal ordering is difficult when differentiation to a specific cell type occurs over a wide range of time during development. Alternative approaches that aim at merging single-cell analysis with lineage relationships are rapidly evolving, using the estimation of transcriptional derivatives (RNA velocity) ( La Manno et al., 2018 38. La Manno, G. ∙ Soldatov, R. ∙ Zeisel, A. ... RNA velocity of single cells Nature. 2018; 560 :494-498 Crossref Scopus (1950) PubMed Google Scholar ), time series experiments ( Fischer et al., 2019 24. Fischer, D.S. ∙ Fiedler, A.K. ∙ Kernfeld, E.M. ... Inferring population dynamics from single-cell RNA-sequencing time series data Nat. Biotechnol. 2019; 37 :461-468 Crossref Scopus (67) PubMed Google Scholar ; Schiebinger et al., 2019 55. Schiebinger, G. ∙ Shu, J. ∙ Tabaka, M. ... Optimal-Transport Analysis of Single-Cell Gene Expression Identifies Developmental Trajectories in Reprogramming Cell. 2019; 176 :928-943.e22 Full Text Full Text (PDF) Scopus (357) PubMed Google Scholar ), or by simultaneous direct recording of cell histories, with promising but still partial coverage ( Bowling et al., 2020 11. Bowling, S. ∙ Sritharan, D. ∙ Osorio, F.G. ... An Engineered CRISPR-Cas9 Mouse Line for Simultaneous Readout of Lineage Histories and Gene Expression Profiles in Single Cells Cell. 2020; 181 :1410-1422.e27 Full Text Full Text (PDF) Scopus (147) PubMed Google Scholar ; Chan et al., 2019 15. Chan, M.M. ∙ Smith, Z.D. ∙ Grosswendt, S. ... Molecular recording of mammalian embryogenesis Nature. 2019; 570 :77-82 Crossref Scopus (204) PubMed Google Scholar ; Kalhor et al., 2018 33. Kalhor, R. ∙ Kalhor, K. ∙ Mejia, L. ... Developmental barcoding of whole mouse via homing CRISPR Science. 2018; 361 :eaat9804 Crossref Scopus (219) PubMed Google Scholar ; Raj et al., 2018 52. Raj, B. ∙ Wagner, D.E. ∙ McKenna, A. ... Simultaneous single-cell profiling of lineages and cell types in the vertebrate brain Nat. Biotechnol. 2018; 36 :442-450 Crossref Scopus (377) PubMed Google Scholar ; Spanjaard et al., 2018 59. Spanjaard, B. ∙ Hu, B. ∙ Mitic, N. ... Simultaneous lineage tracing and cell-type identification using CRISPR-Cas9-induced genetic scars Nat. Biotechnol. 2018; 36 :469-473 Crossref Scopus (330) PubMed Google Scholar ). In principle, atlases can be constructed from samples that are staged using traditional methods ( Cao et al., 2019 14. Cao, J. ∙ Spielmann, M. ∙ Qiu, X. ... The single-cell transcriptional landscape of mammalian organogenesis Nature. 2019; 566 :496-502 Crossref Scopus (1786) PubMed Google Scholar ; Pijuan-Sala et al., 2019 51. Pijuan-Sala, B. ∙ Griffiths, J.A. ∙ Guibentif, C. ... A single-cell molecular map of mouse gastrulation and early organogenesis Nature. 2019; 566 :490-495 Crossref Scopus (483) PubMed Google Scholar ), thus facilitating coarse-grained temporal modeling of inferred transcriptional states. However, refining such classical staging and augmenting it with quantitative kinetic modeling of transcriptional regulation remains to be addressed.
Precise staging of developmental progression is critical in order to describe sequences of developmental events in a consistent and comparable fashion, in particular when studying multiple strains, genetic perturbations, and other interventions. In the mouse, timing of development using “days postcoitum” (dpc) provides only a nominal estimate of progression for each embryo. This is because litters are often highly heterogeneous, frequently constituting embryos from several morphologically distinct embryonic stages ( Figure 1 A) ( Downs and Davies, 1993 20. Downs, K.M. ∙ Davies, T. Staging of gastrulating mouse embryos by morphological landmarks in the dissecting microscope Development. 1993; 118 :1255-1266 Crossref PubMed Google Scholar ). Another unique challenge of studying viviparous development is that up to the point of extraction, the embryo is largely concealed. To address this, methods for staging embryos using morphological features, such as those proposed by Theiler (1989) 67. Theiler, K. The House Mouse, Atlas of Embryonic Development Springer Science+ Business Media, 1989 Crossref Google Scholar and later elaborated on by Downs and Davies (1993) 20. Downs, K.M. ∙ Davies, T. Staging of gastrulating mouse embryos by morphological landmarks in the dissecting microscope Development. 1993; 118 :1255-1266 Crossref PubMed Google Scholar , are still considered the gold-standard in the field. However, morphology-based approaches are limited by the resolution provided by the number of such distinguishable stages and the qualitative nature of such classification.
In the current study, we wished to move further toward an ideal representation of mammalian embryonic development as a continuous process. We reasoned that single-cell RNA sequencing (scRNA-seq) of individual embryos, in correlation with morphological measures obtained from microscopy, will allow placing the embryos on a continuum of transcriptional transformation. Assigning a singular developmental time to cells originating from the same embryo provided a timestamp to each cell in our dataset. This enabled the construction of a flow model ( Ahuja et al., 1993 1. Ahuja, R.K. ∙ Magnanti, T.L. ∙ Orlin, J.B. Network Flows: Theory, Algorithms and Applications Prentice Hall, 1993 Google Scholar ) for the transition of cells on the transcriptional manifold. Flow analysis distinguished early specialization of few embryonic cell types, identified their stepwise acquisition of transcriptional identity and linked it with the hierarchical activity of fate-specific transcription factors (TFs). However, for most of the cells in the embryo, the data suggest complex transcriptional dynamics in multipotent progenitor states and complex combinatorial activity of TFs that drive multi-furcation rather than the classical tree-like bifurcation. The temporal atlas and associated flow model form the foundations for elucidating intrinsic and extrinsic effects shaping cell fate decisions in vivo . This is illustrated by studying mesoderm gene regulation by Foxc1 and Foxc2, using single-cell chimera knockout experiments with tight single-embryo time control.

Section: Results

To generate a continuous fate map of mouse gastrulation up to somitogenesis, we performed scRNA-seq on dissociated cells from individual embryos representing early post-implantation up to pre-somitic stages, corresponding to embryonic day (E) ∼E6.5–E8.25 ( Figure 1 A; Table S1 ). Each embryo was handled and imaged separately for subsequent assessment of morphological features and size measurements. To focus on tissues that contribute to the embryo proper, the ectoplacental cone, parietal endoderm, and much of the extraembryonic ectoderm, were removed prior to dissociation. To allow sequencing of single cells separately from each embryo, we used MARS-seq ( Jaitin et al., 2014 32. Jaitin, D.A. ∙ Kenigsberg, E. ∙ Keren-Shaul, H. ... Massively parallel single-cell RNA-seq for marker-free decomposition of tissues into cell types Science. 2014; 343 :776-779 Crossref Scopus (1300) PubMed Google Scholar ), where single cells are index-sorted directly into multi-well plates using a flow cytometer, in which they are barcoded prior to pooling. In this manner, 33,700 cells from 153 embryos were sequenced at a median coverage of 4,100 unique molecular identifiers (UMIs) per cell ( Figure S1 A). A sufficient representation of the various developmental stages was ensured by morphological assessment. Due to the inherent sparsity of scRNA-seq data, metacell analysis ( Baran et al., 2019 6. Baran, Y. ∙ Bercovich, A. ∙ Sebe-Pedros, A. ... MetaCell: analysis of single-cell RNA-seq data using K-nn graph partitions Genome Biol. 2019; 20 :206 Crossref Scopus (167) PubMed Google Scholar ) was employed on the entire dataset, by which transcriptionally similar single cells are aggregated to form more cohesive and distinct transcriptional states termed metacells (MCs). In this manner, we robustly mapped all transcriptional states and generated their similarity graph.
To place the embryos on a sequential time axis, we first ranked them using morphology alone ( Figure S1 B). We then developed a strategy for ranking embryos by K-nn similarities among single-cell profiles ( Figure 1 B). This resulted in remarkably high comparability between the two independent ranking schemes (ρ = 0.97) ( Figures 1 C and S1 C). For external validation, we projected cells from each embryo onto a recently published mouse single-cell gastrulation atlas ( Pijuan-Sala et al., 2019 51. Pijuan-Sala, B. ∙ Griffiths, J.A. ∙ Guibentif, C. ... A single-cell molecular map of mouse gastrulation and early organogenesis Nature. 2019; 566 :490-495 Crossref Scopus (483) PubMed Google Scholar ) and re-timed our single cells using this reference atlas consisting of pooled embryos from 6-h time intervals. We averaged the external cell timing for each embryo, deriving again a high degree of concordance with our internal ranking strategy (ρ = 0.98) ( Figure 1 D). Finally, comparison of embryo ranking to the estimation of embryos’ physical growth rate (approximated by the physical area under the microscope) provided alignment of our ranks to an absolute size scale (ρ = 0.91) ( Figure 1 E). Single-embryo sampling also facilitated controlled analysis of male and female embryos (genotyped based on Y chromosome RNA) ( Figure S1 D), demonstrating comparable size and transcriptional distributions between the sexes at these stages ( Figures 1 C–1E, red versus blue dots). For older embryos, we observed more precise ordering, consistent with the less accurate assignment of morphology and size at early stages, and with acceleration in transcriptional diversification from mid/late streak stage onward. To synthesize all observations, each embryo was assigned a calculated timestamp based on size and transcription (hereinafter designated as E t ). To reduce possible sampling noise and facilitate downstream statistical analysis, we formed thirteen temporal groups labeled E t 6.5–E t 8.1 corresponding to the mean approximated developmental time of embryos within them (3–36 embryos and 884–6,442 cells for each group) ( Figures S1 A and S1E).
For initial visualization of differentiation dynamics, we separated the dataset using canonical markers into three transcriptional manifolds describing development from the epiblast toward the three germ layers (ectoderm, mesoderm, and endoderm) ( Figure 1 F). Projection of the thirteen groups of timed embryos on these manifolds showed clear directional transition from the epiblast ground state and subsequent differentiation and diversification, supporting the notion that pseudotime can approximate embryonic development over the manifold. Because each MC is made up of cells from different embryos corresponding to the same transcriptional state, we could estimate a pseudotime for each MC using the calculated ages of the embryos contributing to them ( Figure 1 G). In a pseudotime representation of a highly synchronous process, MCs are expected to consist of cells from a narrow range of embryonic times. However, the variation in embryonic times for each MC was generally high (SD 1.1–12 h) ( Figure 1 G, left panel). Conversely, individual embryos consisted of cells belonging to MCs with varied pseudotimes (SD 1.4–6.5 h) ( Figure 1 H). This demonstrates that dynamics of transcriptional states are far from coherent and synchronous and accentuates the need for models that represent embryonic development as concurrent and unsynchronized collections of single cells that transition through the transcriptional manifold.
To infer developmental dynamics from the series of acquired single-embryo maps, we made two assumptions: (1) embryos that are similarly timed will include cells that are similarly distributed over the transcriptional manifold, such that progression in time will involve a gradual change in states over manifold links; and (2) progression in time involves rapid cell proliferation, with rates that may change depending on cell type or position on the manifold. To derive quantitative models supporting the first assumption, we represented the transcriptional space of embryonic development using 461 MC states. These states are linked using a logistic metric function to form a manifold structure ( Figure 2 A). In this manner, the likelihood of cells to exhibit transcriptional changes between any two states over time is estimated by a probabilistic (i.e., Markovian) manifold distance over the MC graph ( STAR Methods ). Because MC linkage is not (in practice, cannot be) fully captured by the 2D model representation, we explicitly visualize neighboring MCs using edges on top of the standard 2D embedding of the model (i.e., links on Figure 2 A), even if these edges are not well accommodated by the 2D embedding.
To provide quantitative support to the second assumption regarding proliferation rates, we first estimated the average embryonic growth rate, using image analysis to count nuclei in DAPI-stained embryos that were timed by morphology ( Figure 2 B). This analysis confirmed the remarkably rapid exponential growth from 900–1,300 cells at E7.0 to 10,000–13,000 cells at E8.0 (average calculated doubling time ∼7 h), consistent with previously reported histology and dissociated cell-based counting ( Palis et al., 1999 47. Palis, J. ∙ Robertson, S. ∙ Kennedy, M. ... Development of erythroid and myeloid progenitors in the yolk sac and embryo proper of the mouse Development. 1999; 126 :5073-5084 Crossref PubMed Google Scholar ; Snow, 1977 57. Snow, M. Gastrulation in the mouse: Growth and regionalization of the epiblast J. Embryol. Exp. Morphol. 1977; 42 :293-303 Google Scholar ). This is also in alignment with studies demonstrating that apoptosis levels in early post-implantation embryos are low and randomly distributed among the embryonic germ layers ( Tam and Behringer, 1997 63. Tam, P.P. ∙ Behringer, R.R. Mouse gastrulation: the formation of a mammalian body plan Mech. Dev. 1997; 68 :3-25 Crossref Scopus (453) PubMed Google Scholar ). To estimate proliferation rate biases over the manifold, we noted that a distinct and small 10% sub-population of the single cells showed low expression of both M- and S-phase-related genes ( Figure S1 F), whereas the remaining 90% of the single-cell population showed a distinctive smooth transition between M- and S-stereotypic expression. Initial annotation of MCs using known markers showed that states linked with the embryonic endoderm, node/notochord, visceral endoderm (VE), and extraembryonic endoderm (ExEn) transcriptional programs were enriched for the low proliferation population, in agreement with previous reports ( Bellomo et al., 1996 9. Bellomo, D. ∙ Lander, A. ∙ Harragan, I. ... Cell proliferation in mammalian gastrulation: the ventral node and notochord are relatively quiescent Dev. Dyn. 1996; 205 :471-485 Crossref Scopus (107) PubMed Google Scholar ; Snow, 1977 57. Snow, M. Gastrulation in the mouse: Growth and regionalization of the epiblast J. Embryol. Exp. Morphol. 1977; 42 :293-303 Google Scholar ) ( Figures 2 C, S1 G, and S1H). Tracking of cell-type frequencies over inferred embryonic time allowed estimation of the relative (lower) growth for these populations compared with the rest of the embryo (r = 0.88, 0.83 for embryonic endoderm, VE/ExEn, respectively) ( Figure S1 I). In summary, the inferred manifold model and estimated cell-type-specific growth rates together set the stage for a model accommodating the two forces that shape embryo cell-state composition over time: the transition between transcriptional states (i.e., differentiation) and the massive growth and proliferation enabling it.
To progress toward a fully resolved model of embryonic differentiation dynamics, we developed a network flow model connecting the manifold distributions of the 13 groups of timed embryos, based on our model for differentiation and growth dynamics ( Figure 2 D). In this representation, MCs are depicted as nodes distributed horizontally over time, and edges denote their predicted transition to the next time point. The flow model uses an approximated mass-conservation strategy (or optimal transport) ( Schiebinger et al., 2019 55. Schiebinger, G. ∙ Shu, J. ∙ Tabaka, M. ... Optimal-Transport Analysis of Single-Cell Gene Expression Identifies Developmental Trajectories in Reprogramming Cell. 2019; 176 :928-943.e22 Full Text Full Text (PDF) Scopus (357) PubMed Google Scholar ) to track cellular differentiation along the manifold links in time. This is implemented via a mincost-maxflow algorithm with convex costs that accommodates uncertainty in sampling cell types at each time point, while considering the variation in cell-type growth rates over time ( Figures S2 A and S2B; see also STAR Methods , sensitivity and bootstrap analysis). We next used the flow model to refine marker-based cell-type annotation over the transcriptional manifold using the computationally inferred cell fate of MCs representing early differentiating states ( Figures 2 E and S3 ; Table S2 ). This resulted in the annotation of embryonic MCs into 29 cell types (extending annotations in Pijuan-Sala et al. [2019 51. Pijuan-Sala, B. ∙ Griffiths, J.A. ∙ Guibentif, C. ... A single-cell molecular map of mouse gastrulation and early organogenesis Nature. 2019; 566 :490-495 Crossref Scopus (483) PubMed Google Scholar ]). We note that annotation assisted by the flow model effectively refines and resolves weakly differentiated and transcriptionally ambiguous groups. For example, we distinguish between two phases of noncommitted nascent mesoderm (early and late) that display differences in differentiation potential and define the first ectodermal cells arising from the epiblast as definitive ectoderm due to their potential to contribute to both surface ectoderm and neural plate fates ( Figure 2 D) ( Harvey et al., 2010 27. Harvey, N.T. ∙ Hughes, J.N. ∙ Lonic, A. ... Response to BMP4 signalling during ES cell differentiation defines intermediates of the ectoderm lineage J. Cell Sci. 2010; 123 :1796-1804 Crossref Scopus (27) PubMed Google Scholar ).
Network flows provide a framework for understanding how strongly committed cell states emerge over time. The flow model defines different possible timed trajectories leading to any strongly specified transcriptional state, which can be depicted as paths over the network diagram ( Figure 3 , top panels). The kinetics of genes participating in a differentiation program can be estimated as the mean expression per absolute time ( Figure 3 , heatmaps) and can also be decomposed into the main temporal regimes composing it ( Figure 3 , line graphs). These tools provide a quantitative view into the differentiation of blood, node, and cardiomyocyte cells, the first highly specialized cell types in the early embryo. Early blood progenitors are among the first functional cells to be specified. Consistent with previous studies that identified the origins of the extra-embryonic mesoderm, including primitive hematopoiesis, to the proximal primitive streak ( Huber et al., 2004 30. Huber, T.L. ∙ Kouskoff, V. ∙ Fehling, H.J. ... Haemangioblast commitment is initiated in the primitive streak of the mouse embryo Nature. 2004; 432 :625-630 Crossref Scopus (563) PubMed Google Scholar ; Lawson and Pedersen, 1992 39. Lawson, K.A. ∙ Pedersen, R.A. Clonal analysis of cell fate during gastrulation and early neurulation in the mouse Ciba Found. Symp. 1992; 165 :3-21, discussion 21–26 PubMed Google Scholar ), our model predicts that primitive erythroid cells originate from primitive streak (PS) cells at the earliest time point ( Figure 3 A). In fact, according to our model, PS cells from E t 6.7 onward are unlikely to contribute to the blood lineage ( Figure 3 A). These cells, passing through a transient nascent mesoderm (NM) state (characterized by genes such as T, Mixl1, and Mesp1), rapidly lose the epiblast gene signature and begin expressing sequential waves of key regulatory genes. Notably, Tal1, Kdr, and Etv2 are observed to be expressed at appreciable levels by E t 6.9, closely followed by a combination of factors restricting the cells to the hematopoietic fate, such as Runx1 and Lmo2 ( Figure 3 A).
The node is a distinct structure that arises from the anterior PS at the distal tip of the late streak embryo ( Figure 3 B). The node constitutes a major signaling center and is critical for correct patterning of the embryo and determination of the left-right axis. This is achieved by directional flow of extracellular fluid driven by clockwise rotation of specialized cilia ( Hirokawa et al., 2006 29. Hirokawa, N. ∙ Tanaka, Y. ∙ Okada, Y. ... Nodal flow and the generation of left-right asymmetry Cell. 2006; 125 :33-45 Full Text Full Text (PDF) Scopus (459) PubMed Google Scholar ). The ciliated node cells observed in our manifold are identified as cells expressing high levels of Foxj1, a TF known to be critical for ciliary development ( Chen et al., 1998 16. Chen, J. ∙ Knowles, H.J. ∙ Hebert, J.L. ... Mutation of the mouse hepatocyte nuclear factor/forkhead homologue 4 gene results in an absence of cilia and random left-right asymmetry J. Clin. Invest. 1998; 102 :1077-1082 Crossref Scopus (341) PubMed Google Scholar ), and numerous genes directly relating to cilia structure and function such as Tppp3, Fam183b, and Nek1 ( Figure 3 B). A small number of Foxj1 + cells can be identified as early as E t 6.9 and begin expressing cilia genes closely thereafter. These cells are predicted to arise from anterior PS progenitors, consistent with previous reports ( Balmer et al., 2016 5. Balmer, S. ∙ Nowotschin, S. ∙ Hadjantonakis, A.K. Notochord morphogenesis in mice: Current understanding & open questions Dev. Dyn. 2016; 245 :547-557 Crossref Scopus (39) PubMed Google Scholar ; Tam and Beddington, 1987 62. Tam, P.P. ∙ Beddington, R.S. The formation of mesodermal tissues in the mouse embryo during gastrulation and early organogenesis Development. 1987; 99 :109-126 Crossref PubMed Google Scholar ). Foxj1 expression correlates to the expression of additional TFs critical for node morphogenesis such as Noto ( Beckers et al., 2007 7. Beckers, A. ∙ Alten, L. ∙ Viebahn, C. ... The mouse homeobox gene Noto regulates node morphogenesis, notochordal ciliogenesis, and left right patterning Proc. Natl. Acad. Sci. USA. 2007; 104 :15765-15770 Crossref Scopus (81) PubMed Google Scholar ), Rfx3, and T. These are preceded by the expression of TFs characteristic of the anterior PS, Gsc, Mixl1, Eomes, and Foxa2 and anti-correlated with the canonical epiblast gene signature ( Figure 3 B). Similar analysis illustrates transcriptional kinetics in early progenitors of the embryonic heart ( Figure 3 C). In summary, the model allows reconstituting the rapid and precise establishment of specialized transcriptional programs toward the blood, node, and heart. Such specialized cells, however, comprise only a small fraction (∼10%) of the embryo by E t 8.1, whereas for the majority of embryonic cell states, differentiation appears more complex, involving more gradual commitment and specialization.
After validating the flow model via analysis of differentiation toward highly specialized fates, we focused our analysis on complex fate decision dynamics, which may involve selection between two fates or more (bifurcation and multi-furcation, respectively). One early example of such process is the segregation of the epiblast to the mesoderm and endoderm lineages through the PS and the restriction of this potential by the formation of definitive ectoderm. This process is shown in our model to span a prolonged period of time between E t 6.5–E t 7.6. To represent the continuous dynamics of transitions, we introduce the “vein plot” ( Figure 4 A). This plot displays the relative abundance of transcriptional states over time and the differentiation flux between them, as indicated by the relative width of the diagonal connections that span the time points. In this manner, it is clear that epiblast differentiation is dynamic and largely biphasic: 88% of the flow toward the PS fate occurs by E t 7.1, whereas 89% of the ectoderm restriction takes place at E t 7.3 or later ( Figures 4 A and 4B). Throughout this extended period, epiblast cells maintain robust expression of the core pluripotency factors Utf1, Pou3f1, Dnmt3b, and Pim2 ( Figures 4 C, left, and S4 A). Interestingly, we discovered major expression changes occur over time even within the seemingly homogeneous epiblast because it continuously supplies cells to the PS and definitive ectoderm ( Figure 4 C, right). Most notably, downregulation of Nodal signaling genes (Nodal and Tdgf1) happens in parallel to PS differentiation and precedes the induction of definitive ectoderm markers Sox9, Irx3, and Irx5 ( Figures 4 D and S4 A). Interestingly, distinct rostral and caudal signatures are evident in the definitive ectoderm already in E t 7.5 ( Figure S4 B). Activation of the definitive ectoderm program is largely considered to be achieved by secreted antagonists emanating from the distal and anterior VE, protecting the overlying epiblast from differentiation to PS, and further patterned by signals from the endoderm and axial mesoderm ( Arkell and Tam, 2012 3. Arkell, R.M. ∙ Tam, P.P. Initiating head development in mouse embryos: integrating signalling and transcriptional activity Open Biol. 2012; 2 :120030 Crossref Scopus (50) PubMed Google Scholar ; Balmer et al., 2016 5. Balmer, S. ∙ Nowotschin, S. ∙ Hadjantonakis, A.K. Notochord morphogenesis in mice: Current understanding & open questions Dev. Dyn. 2016; 245 :547-557 Crossref Scopus (39) PubMed Google Scholar ; Hemmati-Brivanlou and Melton, 1997 28. Hemmati-Brivanlou, A. ∙ Melton, D. Vertebrate embryonic cells will become nerve cells unless told otherwise Cell. 1997; 88 :13-17 Full Text Full Text (PDF) Scopus (289) PubMed Google Scholar ), such as bone morphogenetic protein (BMP) and Nodal agonist-antagonist gradients ( Li et al., 2013 41. Li, L. ∙ Liu, C. ∙ Biechele, S. ... Location of transient ectodermal progenitor potential in mouse development Development. 2013; 140 :4533-4543 Crossref Scopus (48) PubMed Google Scholar ; Liu et al., 2018 42. Liu, C. ∙ Wang, R. ∙ He, Z. ... Suppressing Nodal Signaling Activity Predisposes Ectodermal Differentiation of Epiblast Stem Cells Stem Cell Reports. 2018; 11 :43-57 Full Text Full Text (PDF) Scopus (14) PubMed Google Scholar ; McMahon et al., 1998 43. McMahon, J.A. ∙ Takada, S. ∙ Zimmerman, L.B. ... Noggin-mediated antagonism of BMP signaling is required for growth and patterning of the neural tube and somite Genes Dev. 1998; 12 :1438-1452 Crossref Scopus (692) PubMed Google Scholar ). Using the flow model absolute timescale, we show that, concomitant with nodal signaling repression in the anterior epiblast, transforming growth factor β (TGF-β) superfamily modulators Cer1 and Lefty1 are expressed in the VE, while interestingly, Lefty2 is transiently induced in the nascent and early rostral mesoderm ( Figure 4 E).
Biphasic differentiation over a prolonged period of massive proliferation as shown for the epiblast is in marked contrast to the developmental dynamics of the PS ( Figures 4 F). Flows demonstrate the continuous replenishment of the PS by the epiblast to compensate for the massive egress toward the NM and anterior PS. This process is accompanied by the activation of early endoderm and mesoderm markers such as Eomes, Foxa2, Mixl1, and T ( Figure S4 C), representing the potential of the PS to differentiate to both lineages ( Figure S4 D). However, calculating a commitment score for each MC identified only a few MCs with such potential ( Figure S4 E). Furthermore, unlike epiblast and NM, cells quickly transition through the PS without stabilizing their state thus forming a sharp bifurcation ( Figures 4 F and S4 F). This lack of PS stability implies that the mesoderm/endoderm bifurcation occurs very rapidly on exit from the pluripotent state, such that no stable self-renewing mesendodermal progenitor cell state can be defined.
Differentiation from the NM defines a third type of prototypic developmental dynamics that differs from both the epiblast and the PS. NM differentiation occurs gradually and continuously through E t 6.7–E t 8.0, during which the intrinsic uncommitted state is continuously produced ( Figure S4 F). Using the flow model, we depict NM multi-furcation into 10 mesodermal programs by computing the relative NM fraction contributing to each of these fates over time ( Figure 4 G). Up to E t 6.9, NM cells are heavily biased toward the hematoendothelial and extraembryonic mesoderm lineages. Cardiac progenitors and rostral mesoderm then emerge, trailed by an increased dominance for caudal mesoderm fates, starting at E t 7.4. During this period (E t 6.7–E t 7.8), NM cells are continuously marked by high levels of Mesp1, T, Mixl1, Lefty2, and Snai1 ( Figures 4 H and S4 G). Concomitantly, temporal activation of key mesodermal factors such as Tal1, Etv2 (hematoendothelial fate), Hand1/2 (extraembryonic mesoderm and cardiac fates), and Foxc1 and Dll3 (rostral and caudal mesoderm, respectively) marks initial commitment toward more specified mesodermal programs ( Figures 4 H, 4I, and S4 G). In conclusion, these data support an extended notion of developmental fate acquisition that can go through phased fate determination (as in the epiblast), rapid transitional bifurcation (as in the PS), or complex and time-dependent multi-furcation (as observed for the NM).
The classical stepwise differentiation model for development describes a series of specific gene expression signatures, each defining a direct transition between a progenitor state and a more specialized progeny state. We searched for such specific steps by identifying genes whose activation was unique to only one of the major fate transitions predicted by the flow model ( Figure 5 A). Interestingly, this analysis demonstrated that transitions toward the node, cardiomyocytes, and the hematoendothelial lineages are characterized by highly specific gene programs, in line with their early specification and specialized molecular functions. However, most transitions involved gene expression dominated by combinatorial signatures and lacking unique regulator genes or other specific makers. This was most evident in the complex repertoire of mesodermal fates, which, as shown above, represent temporally dynamic multi-furcation from the NM toward extraembryonic, rostral, and caudal programs. To model the regulation of this complex process, we focused on the combinatorial expression of 63 TFs with variable expression within the mesoderm ( Figure 5 B). TFs dominate the mesodermal transcriptional programs (59 out of the 256 most variable genes in the mesoderm are TFs), however, only some are likely to drive initial NM differentiation. Distinguishing between driver TFs and “responder” TFs can be achieved by analysis of their temporal kinetics ( Figure 5 C) and absolute expression level ( Figure S5 A).
TFs expression reflected the overall high-level organization of the mesoderm into 4 main regimes: progenitor states (marked by Eomes, Mixl1, and Mesp1), extraembryonic fates (Msx1/2, Hand1), and a spectrum of rostral (Foxc1/2, Twist1) and caudal (Cdx1, Hoxb1, Hoxa1) programs ( Figure 5 C). However, none of these TFs define a precise bifurcation pattern. For example, characteristic high expression of Hand1 in extraembryonic mesoderm is also observed in some rostral mesoderm MCs. Similarly, although Foxc1/2 are not expressed in most of the extraembryonic mesoderm lineages, they otherwise show only quantitative preferences to some (e.g., rostral, paraxial) mesodermal fates. The complex combinatorics of the mesoderm TFs is likely to have a major regulatory impact on target genes. To start and quantify this effect, for each mesoderm gene we compared the attainable fit by a regression model using one or two input TFs ( Figures 5 D and S5 B). For a few genes, we observe very tight linkage with the expression of a single TF (e.g., Tdgf1 and Eomes). However, for most genes, we gain significant (compared to shuffled controls) predictive power when using two TFs as regulatory inputs (e.g., Pdch19, Bmp2, Dll3, and Vim) ( Figures 5 E, 5F, and S5 C). The data suggest that although a cascade of master regulators expression can drive bifurcation and differentiation of specialized cell types, multifurcation in the mesoderm depends on complex combinations of many TFs rather than hierarchical TF expression. The correlation-based analysis presented here can use temporally resolved data to derive an initial understanding of such combinatorial schemes. Yet, such analysis is limited in its specificity as models become more complex and must therefore be combined with perturbations of candidate TFs.
Forkhead box C1 and C2 genes (Foxc1 and Foxc2) exhibit broad and largely overlapping expression patterns in non-axial mesoderm. Mice harboring deletions of both genes die at mid-gestation with notable phenotypes in somites, intermediate mesoderm derivatives, blood vessels, heart, and neural crest ( Fatima et al., 2016 23. Fatima, A. ∙ Wang, Y. ∙ Uchida, Y. ... Foxc1 and Foxc2 deletion causes abnormal lymphangiogenesis and correlates with ERK hyperactivation J. Clin. Invest. 2016; 126 :2437-2451 Crossref Scopus (67) PubMed Google Scholar ; Kume, 2009 36. Kume, T. The cooperative roles of Foxc1 and Foxc2 in cardiovascular development Adv. Exp. Med. Biol. 2009; 665 :63-77 Crossref Scopus (52) PubMed Google Scholar ; Winnier et al., 1997 69. Winnier, G.E. ∙ Hargett, L. ∙ Hogan, B.L. The winged helix transcription factor MFH1 is required for proliferation and patterning of paraxial mesoderm in the mouse embryo Genes Dev. 1997; 11 :926-940 Crossref Scopus (183) PubMed Google Scholar ). In our data, Foxc1/Foxc2 are expressed in rostral and caudal mesoderm, as well as weakly in subpopulations of hematoendothelial progenitors and the foregut ( Figures 5 B and S6 A). Furthermore, Foxc1 expression peaks in early paraxial mesoderm, suggesting that it may play an instructive role in its specification. To this end, we adapted the chimeric embryo approach for use with precise single-embryo quantification ( Figure 6 A). We generated isogenic pairs of fluorescently tagged Foxc1/2 double knockout (DKO) and control mouse embryonic stem cells (mESCs), which were subsequently injected into host blastocysts followed by index sorting of single-embryo cells and MARS-seq ( Figures 6 B and S6 B). In this manner, we could separately project injected and host cells from the same embryo onto the wild-type model. Generating seven such paired single-cell profiles, together with four isogenic control injected chimeras, provided a robust internally controlled platform to assess cell-autonomous effects of Foxc1/2 DKO over time. We then tested the impact of Foxc1/2 loss on the temporal dynamics within the embryo. We further performed in silico analysis to control for loss of imprinting and chromosomal abnormalities that are frequently associated with mESC cultures ( Figure S6 C). Overall, host and DKO cells consistently match in terms of embryonic time (as quantified by analysis of K-nn similarities between knockout or host cells and the reference temporal model) ( Figures 6 C and S7 A). However, in 4 of 7 chimeras, DKO cells matched embryonic mesoderm of significantly younger reference embryos relative to the host cells. This phenotype, indicating retarded differentiation, is specific to the embryonic mesoderm, as timing based on ectoderm/endoderm cells was similar to the host (D = 0.21, p = 3.8e−11; D = 0.06, p = 0.17, Kolmogorov-Smirnov D statistic and p value for the mesoderm and combined endoderm/ectoderm, respectively) ( Figures 6 C and S7 A). Specificity was further substantiated by directly comparing DKO cells to their isogenic controls ( Figure S7 B).
We next asked whether the observed delay in mesoderm differentiation is driven by specific cell types as a function of time. Time-matched comparison of cell type frequencies indeed showed a reduction in paraxial mesoderm cells in the DKO, together with increased abundance of extraembryonic mesoderm cells ( Figure 6 D). To search for the most promising direct regulatory targets of Foxc1/2 in the embryonic mesoderm, we performed differential expression analysis comparing pooled expression on timed single cells classified as host or knockout embryonic mesoderm. This showed consistently that the expression of key paraxial and rostral mesoderm TFs (e.g., Tcf15, Prrx2, and Twist1) and regulators (e.g., Ppp1r1a and Cer1), was markedly reduced in knockout cells ( Figures 6 E and 6F). Differential expression between isogenic unmanipulated cells and their corresponding host cells provided strong validation for the specificity of these genes as potential targets of Foxc1/2 ( Figure S7 C). Yet, this analysis also stressed the necessity of including isogenic control cells because a noticeable reduction in Pkdcc in the control cells suggested that, for this gene, perturbations may originate already in the parental mESCs ( Figure S7 C).
To further control for non-cell-autonomous effects, we utilized a tetraploid complementation assay. We injected Foxc1/2 DKO, or isogenic control cells into 4N host blastocysts and dissected the resulting embryos at E8 (dpc). In this manner, the embryonic compartment was solely contributed by the injected cells, allowing evaluating the non-cell-autonomous effects on gastrulation ( Figure S6 B). Interestingly, knockout embryos generated by 4N complementation assay were significantly younger compared to their isogenic control counterparts, dissected at the same time ( Figures S6 B and S7 D). Yet, unlike in the case of the 2N chimeric embryos, both mesoderm and non-mesoderm lineages were significantly delayed in these embryos ( Figure S7 E). Surprisingly, however, directly comparing 4N individual knockout or control embryos to time-matched embryos identified only minor changes in gene expression ( Figure S7 F). Together, these results suggest that the global delay in 4N knockout embryos is due to a failure to correctly execute mesoderm differentiation programs in the absence of Foxc1/2. This may affect key signaling required for the synchronous maturation of mesoderm and non-mesoderm lineages (e.g., Lefty2) ( Figure S7 F). This effect is compensated in 2N chimeric embryos, most likely due to the ability of host cells to correctly activate mesoderm programs. Taken together, the data highlight Foxc1 and Foxc2 as key early mesodermal regulators and strongly implicates them in the regulation of multiple secondary TFs that lead toward the paraxial mesoderm fate.

Section: Discussion

Fertilization triggers the course of development, whereby individual embryos progress in time toward maturation. To achieve rapid diversification after implantation, gastrulating embryos undergo massive cell proliferation that involves a continuous flux of parallel intracellular molecular changes that break transcriptional and structural symmetry ( Bedzhov et al., 2014 8. Bedzhov, I. ∙ Graham, S.J. ∙ Leung, C.Y. ... Developmental plasticity, cell fate specification and morphogenesis in the early mouse embryo Philos. Trans. R. Soc. Lond. B Biol. Sci. 2014; 369 :20130538 Crossref Scopus (95) PubMed Google Scholar ; Rossant and Tam, 2009 54. Rossant, J. ∙ Tam, P.P. Blastocyst lineage formation, early embryonic asymmetries and axis patterning in the mouse Development. 2009; 136 :701-713 Crossref Scopus (481) PubMed Google Scholar ). The complexity of modeling this process is best manifested when aiming to assign time to embryos and cells. Unlike individual embryos that can be assigned with absolute time, cells comprising an embryo may represent transcriptional states that exist at multiple time points in development. Therefore, faithfully charting cell state transitions during embryonic development requires unified models that synthesize quantitative transcriptional kinetics of individual cells and embryos.
To address this challenge, we conducted a phenomenological characterization of mouse gastrulation at the resolution of single embryos and the single cells comprising them. Ordering embryos on a transcriptional continuum allowed us to assign a unique time-stamp to each embryo that is based on the transcriptional profile of its comprising cells (denoted E t ). Comparing transcription time with classical morphology-based staging showed an overall high correlation between the two approaches. However, morphology was able to capture only part of the variation in the transcriptional landscape between embryos ( Figure 7 A). In part, this is due to the limited number of distinguishable morphological changes and the qualitative nature of such classification. In many cases, molecular specification precedes the appearance of an appreciated morphological structure as evident, for example, in the cases of the allantois, cardiomyocytes, and early blood specification ( Figure 7 B). Our data provide a synthesis between transcription and morphology, thus significantly refining classical embryo staging approaches.
To infer differentiation flows and lineage specification dynamics over the embryonic transcriptional manifold, we developed algorithms that integrate single-embryo time, transcriptional identity of single cells, and estimation of the growth rates for key embryonic lineages. The ability to chart simultaneous programs in the embryo at high temporal resolution provides a holistic view across cell types, thus allowing suggesting co-dependence between them. A notable example of such an interaction is the significant reduction in Nodal signaling genes in the otherwise largely homogeneous epiblast, situated juxtaposed to the source of high levels of the Nodal inhibitors Lefty1 and Cer1 from the VE ( Costello et al., 2015 18. Costello, I. ∙ Nowotschin, S. ∙ Sun, X. ... Lhx1 functions together with Otx2, Foxa2, and Ldb1 to govern anterior mesendoderm, node, and midline development Genes Dev. 2015; 29 :2108-2122 Crossref Scopus (67) PubMed Google Scholar ; Perea-Gomez et al., 2002 50. Perea-Gomez, A. ∙ Vella, F.D. ∙ Shawlot, W. ... Nodal antagonists in the anterior visceral endoderm prevent the formation of multiple primitive streaks Dev. Cell. 2002; 3 :745-756 Full Text Full Text (PDF) Scopus (307) PubMed Google Scholar ) and temporally correlated with the onset of Lefty2 expression by the emerging mesoderm. This transcriptional switch coincides with a shift in the differentiation potential of the epiblast: from early predominant contribution to mesoderm and endoderm fates through the PS, to en masse commitment to definitive ectoderm commencing E t 7.0. Interestingly, the watershed-like switch in epiblast commitment correlates with the previously described sharp reduction in the efficiency to isolate epiblast stem cells from late streak embryos ( Brons et al., 2007 12. Brons, I.G. ∙ Smithers, L.E. ∙ Trotter, M.W. ... Derivation of pluripotent epiblast stem cells from mammalian embryos Nature. 2007; 448 :191-195 Crossref Scopus (1640) PubMed Google Scholar ; Kojima et al., 2014 35. Kojima, Y. ∙ Kaufman-Francis, K. ∙ Studdert, J.B. ... The transcriptional and functional properties of mouse epiblast stem cells resemble the anterior primitive streak Cell Stem Cell. 2014; 14 :107-120 Full Text Full Text (PDF) Scopus (225) PubMed Google Scholar ; Tesar et al., 2007 66. Tesar, P.J. ∙ Chenoweth, J.G. ∙ Brook, F.A. ... New cell lines from mouse epiblast share defining features with human embryonic stem cells Nature. 2007; 448 :196-199 Crossref Scopus (1765) PubMed Google Scholar ).
Consistent with previous findings in Xenopus ( Hemmati-Brivanlou and Melton, 1997 28. Hemmati-Brivanlou, A. ∙ Melton, D. Vertebrate embryonic cells will become nerve cells unless told otherwise Cell. 1997; 88 :13-17 Full Text Full Text (PDF) Scopus (289) PubMed Google Scholar ), our model predicts that epiblast commitment to ectoderm initiates through a common progenitor cell population termed definitive ectoderm. These cells are predicted by the flows to differentiate to either neural plate or surface ectoderm (epidermis) fates. Indeed, such cells have been previously identified in the mouse ( Cajal et al., 2012 13. Cajal, M. ∙ Lawson, K.A. ∙ Hill, B. ... Clonal and molecular analysis of the prospective anterior neural boundary in the mouse embryo Development. 2012; 139 :423-436 Crossref Scopus (50) PubMed Google Scholar ) and further isolated in vitro ( Harvey et al., 2010 27. Harvey, N.T. ∙ Hughes, J.N. ∙ Lonic, A. ... Response to BMP4 signalling during ES cell differentiation defines intermediates of the ectoderm lineage J. Cell Sci. 2010; 123 :1796-1804 Crossref Scopus (27) PubMed Google Scholar ; Li et al., 2013 41. Li, L. ∙ Liu, C. ∙ Biechele, S. ... Location of transient ectodermal progenitor potential in mouse development Development. 2013; 140 :4533-4543 Crossref Scopus (48) PubMed Google Scholar ; Liu et al., 2018 42. Liu, C. ∙ Wang, R. ∙ He, Z. ... Suppressing Nodal Signaling Activity Predisposes Ectodermal Differentiation of Epiblast Stem Cells Stem Cell Reports. 2018; 11 :43-57 Full Text Full Text (PDF) Scopus (14) PubMed Google Scholar ). Yet, the transient nature of definitive ectoderm (retention time 4.8 ± 0.8 h) ( Figure S4 F), the lack of distinctive markers, and difficulty in tracing their fate in vivo make elucidating the potential of these cells a challenging task. Our data suggest that early distinct spatial expression within this population may predict anterior/posterior patterning ( Figure S4 B). This potentially extends recent findings demonstrating regionalization of the spinal cord prior to neural differentiation ( Metzis et al., 2018 44. Metzis, V. ∙ Steinhauser, S. ∙ Pakanavicius, E. ... Nervous System Regionalization Entails Axial Allocation before Neural Differentiation Cell. 2018; 175 :1105-1118.e17 Full Text Full Text (PDF) Scopus (99) PubMed Google Scholar ), in contrast to the long-standing initiation transformation model (for review, see Stern et al., 2006 61. Stern, C.D. ∙ Charite, J. ∙ Deschamps, J. ... Head-tail patterning of the vertebrate embryo: One, two or many unresolved problems? Int J Dev Biol. 2006; 50 :3-15 Crossref Scopus (104) PubMed Google Scholar ).
The flow model clearly uncovered prototypic rapidly bifurcating cell state transitions associated with the first specialized cells of the embryo: blood, node/notochord, and cardiomyocytes. Nevertheless, gastrulation appeared to be dominated by enduring progenitor populations that gradually multifurcate to give rise to distinct cell fates. Regulation of such regimes seems combinatorial and nuanced with no single major TF or clear hierarchical stepwise program driving transitions. We propose an approach that focuses on the multi-faceted regulation within such states, combining temporal and kinetic modeling with experimental systems that integrate reporters, perturbations, and single-cell readout for in-depth analysis in vivo . We show that single chimeric embryos, harboring gene-specific mutations, allow separation of the effect of key regulators on developmental timing from their effect on direct target genes. Specifically, in the case of Foxc1/Foxc2 mutants, we could reproduce the previously described loss of paraxial mesoderm, but in the same experiment also trace back this phenotype to gene expression changes in its progenitors. Our data show that knockout cells that were destined toward rostral and paraxial fates are developmentally delayed and may later compensate by elevating alternative programs (e.g., those involving extra-embryonic mesoderm fates). Multi-furcation in the mesoderm, therefore, emerges as a process involving a delicate balance between differentiation programs within a multipotent mesodermal progenitor state.
Continuous commitment over time represents a key limitation of pseudotime methods that inherently forces a rigid tree-like structure on inferred cell state transitions. Similarly, convergence of distinct states into the same program is not easily modeled using pseudotemporal ordering. One such example is the contribution of the VE to the embryonic endoderm recently demonstrated during early mouse gastrulation ( Kwon et al., 2008 37. Kwon, G.S. ∙ Viotti, M. ∙ Hadjantonakis, A.K. The endoderm of the mouse embryo arises by dynamic widespread intercalation of embryonic and extraembryonic lineages Dev. Cell. 2008; 15 :509-520 Full Text Full Text (PDF) Scopus (318) PubMed Google Scholar ; Nowotschin et al., 2019 46. Nowotschin, S. ∙ Setty, M. ∙ Kuo, Y.Y. ... The emergent landscape of the mouse gut endoderm at single-cell resolution Nature. 2019; 569 :361-367 Crossref Scopus (213) PubMed Google Scholar ; Peng et al., 2019 49. Peng, G. ∙ Suo, S. ∙ Cui, G. ... Molecular architecture of lineage allocation and tissue organization in early mouse embryo Nature. 2019; 572 :528-532 Crossref Scopus (145) PubMed Google Scholar ). Our work provides a unified model of mouse gastrulation that considers continuous, parallel, and converged differentiation toward multiple lineages ( Figure 7 C). In such a “basin-like” representation of development, rapid bifurcations into highly functional cells are depicted as “canyons,” whereas progenitor states that gradually multifurcate over several time points are depicted as basins ( Figure 7 C). Collectively, our work introduces a quantitative temporal model of embryonic development, holding great promise for elucidating the roles of multiple regulatory layers in shaping and memorizing functional programs. Nevertheless, moving forward toward a complete realization of these processes will require integrating spatial information into the model, creating spatiotemporal models that represent development as a concurrent, and interacting collection of intra-cellular processes with progressively specialized and robust transcriptional and spatial identities.
Limitations of our study are related first to our model resolution and accuracy. Model accuracy is defined by the number of embryos sampled and the uniformity of their absolute ( a priori unknown) temporal distribution. Resolution in our model is directly affected by cellular diversity. Indeed, current sampling depth allows more precise tracking for embryonic times showing extensive cellular diversity (at E t 6.9 and thereafter) but provides lower resolution for the earlier, inherently less-diverse, time bins. In addition, dissection of extra-embryonic tissues may have variable efficiency and can affect inference of flows for these lineages. These issues can be improved on by sequencing additional embryos up to the noise limits of sampling and scRNA-seq. More fundamental limitations relate to the use and interpretation of the model. The flow model makes assumptions on proliferation rates of different cell types over time, which were extrapolated from bulk measurements and cell-cycle-related gene expression. Measurements involving specific cell type isolation or monitoring lineage dynamics using time-lapse microscopy will allow a more precise evaluation of cell proliferation rates. Finally, the precision of the estimated breakdown of embryonic cells into types per time point is based on thresholding a continuous space of differentiation, and when visualizing the flow model, we must use it as is (e.g., for color-coding).

Section: STAR★Methods

REAGENT or RESOURCE SOURCE IDENTIFIER Deposited data scRNA-seq embryonic profiles This paper GEO: GSE169210 Gastrulation scRNA-seq atlas Pijuan-Sala et al., 2019 51. Pijuan-Sala, B. ∙ Griffiths, J.A. ∙ Guibentif, C. ... A single-cell molecular map of mouse gastrulation and early organogenesis Nature. 2019; 566 :490-495 Crossref Scopus (483) PubMed Google Scholar PMID: https://pubmed.ncbi.nlm.nih.gov/30787436/ Experimental models: Cell lines Mouse: V6.5 mouse embryonic stem cells Jaenisch lab, MIT RRID:CVCL_C865 Mouse: Foxc1/2 dKO mESCs This paper N/A Mouse: isogenic control mESCs This paper N/A Experimental models: Organisms/strains Mouse: C57BL/6JRccHsd Envigo RRID: MGI: 6151402 Mouse: Hsd:ICR(CD-1) Envigo RRID: MGI: 5649797 Mouse: B6D2F1 Envigo RRID: MGI: 5651959 Oligonucleotides FoxC1 5′ gRNA: gTTGATCCGAACGTTCCTCCG This paper N/A FoxC1 3′ gRNA: gAGTCTCTGTACCGCACGTCG This paper N/A FoxC2 5′ gRNA: GGCGCTCGGGTTCAGCCGAC This paper N/A FoxC2 3′ gRNA: gAGGGACGGCGTAGCTCGATA This paper N/A Recombinant DNA Cas9 targeting plasmid: px330 Wu et al., 2013 70. Wu, Y. ∙ Liang, D. ∙ Wang, Y. ... Correction of a genetic disease in mouse via use of CRISPR-Cas9 Cell Stem Cell. 2013; 13 :659-662 Full Text Full Text (PDF) Scopus (494) PubMed Google Scholar Addgene plasmid: #98750 HTNC expression plasmid: pTriEx-HTNC Peitz et al., 2002 48. Peitz, M. ∙ Pfannkuche, K. ∙ Rajewsky, K. ... Ability of the hydrophobic FGF and basic TAT peptides to promote cellular uptake of recombinant Cre recombinase: a tool for efficient genetic engineering of mammalian genomes Proc. Natl. Acad. Sci. USA. 2002; 99 :4489-4494 Crossref Scopus (282) PubMed Google Scholar Addgene plasmid: #13763 Software and algorithms Metacell Baran et al., 2019 6. Baran, Y. ∙ Bercovich, A. ∙ Sebe-Pedros, A. ... MetaCell: analysis of single-cell RNA-seq data using K-nn graph partitions Genome Biol. 2019; 20 :206 Crossref Scopus (167) PubMed Google Scholar PMID: https://pubmed.ncbi.nlm.nih.gov/31604482/ Network flow inference algorithm This paper https://github.com/tanaylab/embflow https://doi.org/10.5281/zenodo.4646177 MARS-seq pipe mapping/UMI pipeline Keren-Shaul et al., 2019 34. Keren-Shaul, H. ∙ Kenigsberg, E. ∙ Jaitin, D.A. ... MARS-seq2.0: an experimental and analytical pipeline for indexed sorting combined with single-cell RNA sequencing Nat. Protoc. 2019; 14 :1841-1862 Crossref Scopus (161) PubMed Google Scholar PMID: https://pubmed.ncbi.nlm.nih.gov/31101904/ Open table in a new tab
Further information and requests for resources and reagents should be directed to and will be fulfilled by the Lead Contact, Yonatan Stelzer ( Yonatan.stelzer@weizmann.ac.il ).
Plasmids and cell lines generated in this study will be made available by the Lead Contact upon request.
The accession number for the raw and processed data reported in this paper is GEO: GSE169210 .
Code has been deposited at https://github.com/tanaylab/embflow , https://doi.org/10.5281/zenodo.4646177 .
Interactive independent analysis can be performed at https://tanaylab.weizmann.ac.il/embflow .
Mouse embryonic stem cells (mESCs, v6.5) were cultured under standard conditions on a feeder layer of X-ray irradiated mouse embryonic fibroblasts (MEF, DR4). Standard mESC medium: DMEM (High glucose, GIBCO), 20% FBS (US certified, Biological Industries), 20mg/lit recombinant leukemia inhibitory factor (LIF), 0.1mM 2-mercaptoethanol (GIBCO), Penicillin/streptomycin (Biological Industries), 1mM L-glutamine (Biological Industries), 1% non-essential amino acids (Biological Industries). For chimera assays medium was supplemented with 1mM PD0325901 (Sigma, 1 mM), and 3mM CHIR99021 (Sigma), 48hrs prior to blastocyst injection.
All animal procedures were approved by the Institutional Animal Care and Use Committee and were performed in strict adherence to Weizmann Institute guidelines. Mice were monitored for health and activity and were given ad libitum access to water and standard mouse chow with 12-hr light/dark cycles. Embryos were collected from timed pregnant immune competent C57BL/6JRccHsd or Hsd:ICR(CD-1) females (obtained from Envigo and mated in house with males of the same strain), between E6.5-8.25 (see Figure S1 F). Pregnant mice were not involved in previous studies. Embryos were removed from their implantation sites using fine forceps, in PBS, and Reichert’s membrane and ectoplacental cone removed. Embryos were then washed in fresh PBS and transferred to chilled DMEM (Phenol-red free, GIBCO) supplemented with 10% FBS (Biological Industries) for imaging prior to dissociation. Phase contrast images were taken with an Eclipse Ti2 inverted microscope (Nikon) and Zyla sCMOS camera (Andor). Size measurement of the embryonic component of each embryo was performed as previously described ( Downs and Davies, 1993 20. Downs, K.M. ∙ Davies, T. Staging of gastrulating mouse embryos by morphological landmarks in the dissecting microscope Development. 1993; 118 :1255-1266 Crossref PubMed Google Scholar ). Embryo staging was performed according to ( Downs and Davies, 1993 20. Downs, K.M. ∙ Davies, T. Staging of gastrulating mouse embryos by morphological landmarks in the dissecting microscope Development. 1993; 118 :1255-1266 Crossref PubMed Google Scholar ) and EMAP (eMouse Atlas Project; http://www.emouseatlas.org/emap/home.html ) ( Richardson et al., 2014 53. Richardson, L. ∙ Venkataraman, S. ∙ Stevenson, P. ... EMAGE mouse embryo spatial gene expression database: 2014 update Nucleic Acids Res. 2014; 42 :D835-D844 Crossref Scopus (106) PubMed Google Scholar ).
The same single investigator performed both staging and measurements for consistency.
mESCs expressing constitutive GFP were generated by integration of a Lox-DsRed-Lox-GFP cassette (based on Addgene plasmid #32702) into acceptor attP sites integrated in the H11 locus (using Addgene plasmid #52544), followed by Cre recombination using recombinant His-TAT-NLS-Cre (HTNC) protein (Addgene plasmid #13763), as previously described ( Peitz et al., 2002 48. Peitz, M. ∙ Pfannkuche, K. ∙ Rajewsky, K. ... Ability of the hydrophobic FGF and basic TAT peptides to promote cellular uptake of recombinant Cre recombinase: a tool for efficient genetic engineering of mammalian genomes Proc. Natl. Acad. Sci. USA. 2002; 99 :4489-4494 Crossref Scopus (282) PubMed Google Scholar ). Cells were then co-transfected using TransIT-X2 (Mirus, according to manufacturers protocol) with four SpCas9 vectors (px330, Addgene plasmid #98750) ( Wu et al., 2013 70. Wu, Y. ∙ Liang, D. ∙ Wang, Y. ... Correction of a genetic disease in mouse via use of CRISPR-Cas9 Cell Stem Cell. 2013; 13 :659-662 Full Text Full Text (PDF) Scopus (494) PubMed Google Scholar ), each expressing a single gRNA designed to remove the entire protein coding sequence of either Foxc1 or Foxc2. gRNAs were selected for minimal off targets using CCTop - CRISPR/Cas9 target online predictor ( https://cctop.cos.uni-heidelberg.de:8043/ ) ( Stemmer et al., 2015 60. Stemmer, M. ∙ Thumberger, T. ∙ Del Sol Keyer, M. ... CCTop: An Intuitive, Flexible and Reliable CRISPR/Cas9 Target Prediction Tool PLoS ONE. 2015; 10 :e0124633 Crossref Scopus (686) PubMed Google Scholar ). For genotyping, individual clones were grown for two passages on gelatin-coated plates to eliminate residual MEF, and genomic DNA extracted with PCR compatible lysis buffer (10mM Tris, PH = 8, 0.45% Triton X-100, 0.45% tween-20, 0.2mg/ml Proteinase-K). Validation by genomic PCR used a set of primers flanking the expected deletions, and internal primers, as well as by Sanger sequencing.
Prior to dissociation, to focus on tissues that contribute to the embryo proper, the ectoplacental cone, parietal endoderm, and much of the extraembryonic ectoderm, were removed using fine forceps. For isolation of single cells for scRNA-seq, embryos were dissociated with 0.25% Trypsin-A, 0.02% EDTA (Biological Industries) solution for 5′ at 37°C, and resuspended in DMEM w/o phenol red (GIBCO) supplemented with 10% FBS (Biological Industries). Samples were run on a FACSAria-III flow cytometer (BD Biosciences) using the ‘index sort’ option to retain the spectral properties of each individual sorted cell.
Single-cell cDNA libraries were prepared using the MARS-Seq method, as described ( Jaitin et al., 2014 32. Jaitin, D.A. ∙ Kenigsberg, E. ∙ Keren-Shaul, H. ... Massively parallel single-cell RNA-seq for marker-free decomposition of tissues into cell types Science. 2014; 343 :776-779 Crossref Scopus (1300) PubMed Google Scholar ; Keren-Shaul et al., 2019 34. Keren-Shaul, H. ∙ Kenigsberg, E. ∙ Jaitin, D.A. ... MARS-seq2.0: an experimental and analytical pipeline for indexed sorting combined with single-cell RNA sequencing Nat. Protoc. 2019; 14 :1841-1862 Crossref Scopus (161) PubMed Google Scholar ), with the following modifications: The final concentration of the RT1 primers was 2nM, and pooling was done via centrifugation to VBLOCK200 reservoir (Clickbio). Klenow reaction was not followed by heat inactivation. The volume of the first RT and Exonuclease I reactions mix were scaled down to 1 and 0.5 ul, respectively, and dispensed by MANTIS liquid handler (FORMULATRIX). In brief, single cells were sorted using flow cytometer directly lysis solution containing well identifying poly-T barcodes. mRNA from cell capture plates was then converted into cDNA and pooled. Pooled samples were amplified by T7 in vitro transcription, and the resulting RNA was fragmented and converted into a sequencing-ready library by tagging the samples with pool barcodes and Illumina sequences during ligation, reverse transcription, and PCR.
To estimate total cell counts in embryos of different developmental stages, we harvested 19 embryos from E6.25 to E8.0 and fixed them overnight using 4% PFA. The embryos were subsequently washed with PBS-0.1% tween (PBST), nuclear-stained using DAPI (Sigma-Aldrich D9564) diluted to 1.0 μg/mL in PBS and incubated overnight in 70% glycerol-PBS on a tilting platform to clarify the tissue. The embryos were mounted on a Cellvis 35mm glass-bottom dish and imaged using a Zeiss LSM-880 confocal with automatically optimized Z-interval. The raw images were next processed using Bitplane Imaris software. E6.25-E7.0 embryos were processed along the entire span of the confocal stack, while embryos from later stages were cropped to half of the span along the lateral-to-medial extent, discarding dimmer Z sections distal to the lens. We used the Imaris “surface” feature to manually segment the image stack into embryonic and extra-embryonic domains. We next used the “spots” feature with optimized parameters to assess the distribution of cell nuclei in each domain separately. For embryos older than E7.0, the nuclei counts were multiplied by a factor of two to account for the entire left-right axis of each embryo.
Blastocyst injections were performed using (C57BL/6xDBA) B6D2F1 (Envigo) host embryos. In brief, 3-4-week old B6D2F1 females were hormone primed by an intraperitoneal (i.p.) injection of pregnant mare serum gonadotropin (PMSG, Vetmarket) followed 46 hr later by an injection of human chorionic gonadotropin (hCG, Sigma). Embryos were harvested at the zygote stage, and cultured in a CO2 incubator until blastocyst stage. On the day of the injection, groups of embryos were placed in drops of M2 medium using a 16-um diameter injection pipet (Biomedical Instruments). Approximately ten cells were injected into the blastocoel of each embryo using a Piezo micromanipulator (Prime Tech). For tetraploid complementation, 2-cell embryos were fused to one cell using a CF150/F instrument (BLS), by 2 DC square pulses of 30V 40ms and 1-2V AC, in 0.3M Manitol solution with BSA. An average of 15 cells were injected to the blastocoel of such embryos. Approximately 20 blastocysts were transferred to each recipient female (CD1 female mice, Envigo); the day of injection was considered as 2.5dpc. Mice were handled in accordance with institutional guidelines and approved by the Institutional Animal Care and Use Committee (IACUC).
MARS-seq reads were processed using the MARS-seq2.0 pipeline ( Keren-Shaul et al., 2019 34. Keren-Shaul, H. ∙ Kenigsberg, E. ∙ Jaitin, D.A. ... MARS-seq2.0: an experimental and analytical pipeline for indexed sorting combined with single-cell RNA sequencing Nat. Protoc. 2019; 14 :1841-1862 Crossref Scopus (161) PubMed Google Scholar ). In Brief, After removing plate barcodes (4 base pairs) from Read 1, reads were mapped to the mm9 genome using bowtie2. Demultiplexing of the reads and construction of the single-cell UMI matrix was based on the well barcodes (7 base pairs) and UMI barcodes (8 base pairs) from Read 2.To demultiplex single-cell datasets into individual embryos, we recorded embryo identity per well during sorting and mapped well barcodes to embryo IDs as part of the MARS-seq post-processing stage. We removed mitochondrial transcripts from all cells in the UMI matrix. Overall we processed 40868 wells, out of which we retained 33,900 well-covered cells for further analysis. In particular, cells with the less than 1000 UMIs were filtered out. To analyze chimeric embryos, we used FACS index sorting to record GFP fluorescence per cell in addition to embryo identity per well. We then distinguished knockout and host single cells using thresholding of the green channel bimodal distribution. To allow comparison of our temporal atlas to the published gastrulation atlas we used 116,312 QC positive cells and mapped 10x gene names to MARS-seq gene names using naive matching of gene symbols.
Replication in this study is based on collecting individual embryos. All analyses were validated to be robust to subsets of the embryos acquired. Data collection involved sampling embryos at different estimated times, in several iterations given temporal analysis to insure complete coverage (See Table S1 ). For scaling embryos in time bins we corroborated scRNA-seq data with estimation of embryo size, thereby preventing bias or skewing of the timescale. We used blinding for staging embryos using two independent methods (scRNA-seq and morphology-based). The study did not involve a-priori determination of required sample size since the robustness of single-embryo sampling was not known in advance. However we did determine temporal bin size (based on the total number of cells from embryos in the bin, aiming at a minimum of 1000). There were no formal inclusion/exclusion criteria in this study.
To select feature genes for MC analysis we followed standard practice and identified 804 high variance genes in the UMI matrix downloaded to 1,653 UMIs ( Baran et al., 2019 6. Baran, Y. ∙ Bercovich, A. ∙ Sebe-Pedros, A. ... MetaCell: analysis of single-cell RNA-seq data using K-nn graph partitions Genome Biol. 2019; 20 :206 Crossref Scopus (167) PubMed Google Scholar ). We then filtered cell-cycle and stress-related genes using manual annotation of 80 gene clusters. This resulted in a set of 665 feature genes. MCs were derived as described ( Baran et al., 2019 6. Baran, Y. ∙ Bercovich, A. ∙ Sebe-Pedros, A. ... MetaCell: analysis of single-cell RNA-seq data using K-nn graph partitions Genome Biol. 2019; 20 :206 Crossref Scopus (167) PubMed Google Scholar ) using K = 100 and standard bootstrapping, MC splitting and outlier filtering. To avoid potential bias due to sometimes incomplete removal of extraembryonic tissues, residual MCs corresponding to extraembryonic ectoderm and parietal endoderm were removed prior to further analysis. The derived reference model included 461 MCs on 33,700 cells, leaving 200 outlier cells.
For a representation of temporal trends in Figure 1 , we split the MC partition into separate endoderm, mesoderm and ectoderm graphs using known germ layer marker. This classification was not used in subsequent modeling and annotation, which are all based on flows described in Figure 2 .
Intrinsic temporal ordering of embryos is inferred using analysis of the cell-cell similarities and optimization of the linear ordering of embryos minimizing the temporal distance between similar cells. This analysis is done after excluding cells from the extraembryonic endoderm (defined by marker expression of Ttr and Apoe, Figure S1 G) and the hematopoietic lineage (defined by expression of Cited4, Figure S3 ), since sampling of these tissues is variable between embryos. Given the filtered UMI matrix, we construct the adjacency matrix 𝐸 𝑢 ⁢ 𝑣 encoding the balanced K-nn graph as defined by the MC pipeline for 𝐾 = 5 0 . We marginalize over embryos to compute raw embryo similarity: 𝑁 𝑖 ⁢ 𝑗 = ∑ 𝑢 ∈ 𝐶 𝑖 , 𝑣 ∈ 𝐶 𝑗 𝐸 𝑢 ⁢ 𝑣 , where 𝐶 𝑖 represent the cells of embryo i. We then normalize raw similarities in two steps. First, we normalize columns given the number of cells in each embryo 𝑆 𝑝 ⁢ 𝑟 ⁢ 𝑒 𝑖 ⁢ 𝑗 = ( | 𝐶 𝑗 | ) − 1 ⁢ 𝑁 𝑖 ⁢ 𝑗 . We next normalize rows while also considering embryo sampling batch effect. To do this, assume the sampling batch of each embryo is 𝑏 ⁡ ( 𝑖 ) and assume some initial embryo ordering 𝑜 ⁢ 𝑟 ⁢ 𝑑 ⁡ ( 𝑖 ) (e.g., based on morphology alone). We compute the embryo batch effect by estimating the increase in similarity only among embryos that are within the same approximated time range (to avoid computing large batch effects due to differences in scheduled embryo harvesting) 𝛽 𝑖 = ∑ | 𝑜 ⁢ 𝑟 ⁢ 𝑑 ⁡ ( 𝑖 ) − 𝑜 ⁢ 𝑟 ⁢ 𝑑 ⁡ ( 𝑗 ) ] ≤ 1 0 , 𝑏 ⁡ ( 𝑖 ) = 𝑏 ⁡ ( 𝑗 ) 𝑆 𝑝 ⁢ 𝑟 ⁢ 𝑒 𝑖 ⁢ 𝑗 / ⁢ ∑ | 𝑜 ⁢ 𝑟 ⁢ 𝑑 ⁡ ( 𝑖 ) − 𝑜 ⁢ 𝑟 ⁢ 𝑑 ⁡ ( 𝑗 ) ] ≤ 1 0 , 𝑏 ⁡ ( 𝑖 ) ≠ 𝑏 ⁡ ( 𝑗 ) 𝑆 𝑝 ⁢ 𝑟 ⁢ 𝑒 𝑖 ⁢ 𝑗 . We correct similarities between embryos within the same batch and | 𝑜 ⁢ 𝑟 ⁢ 𝑑 ⁡ ( 𝑖 ) − 𝑜 ⁢ 𝑟 ⁢ 𝑑 ⁡ ( 𝑗 ) | ≤ 1 0 by setting 𝑆 𝑝 ⁢ 𝑟 ⁢ 𝑒 , 𝑏 𝑖 ⁢ 𝑗 = ( 𝛽 𝑖 ) − 1 ⁢ 𝑆 𝑝 ⁢ 𝑟 ⁢ 𝑒 𝑖 ⁢ 𝑗 (keeping all other 𝑆 𝑝 ⁢ 𝑟 ⁢ 𝑒 values unchanged), and then define: 𝑆 𝑖 ⁢ 𝑗 = 𝑆 𝑝 ⁢ 𝑟 ⁢ 𝑒 , 𝑏 𝑖 ⁢ 𝑗 / ∑ 𝑘 𝑆 𝑝 ⁢ 𝑟 ⁢ 𝑒 , 𝑏 𝑖 ⁢ 𝑘 We can now define the ordering optimization problem 𝜏 = 𝑎 ⁢ 𝑟 ⁢ 𝑔 ⁢ 𝑚 ⁢ 𝑖 ⁢ 𝑛 τ ⁡ ( ⋅ ) ⁢ ∑ 𝑖 ⁢ 𝑗 𝑆 𝑖 ⁢ 𝑗 ⁢ | τ ⁡ ( 𝑖 ) − τ ⁡ ( 𝑗 ) | among all possible orderings τ ⁡ ( ⋅ ) of the embryos. We solve the problem using a sorting heuristic. We initialize embryo ordering by their annotated Theiler stage (randomly ordering within each stage). Embryos for which Theiler staging was not possible (9 embryos), were assigned to the most abundant Theiler stage of their litter. We then run a bubble-sort-like algorithm by iteratively switching the position of neighboring embryos if this lowers the goal function until a local minimum is reached. We found that this simple heuristic is sufficiently powerful given that the initial Theiler ordering already defines the correct coarse-grained solution.
To transform embryo ordering into physical developmental times (in units of hours) we had to consider non-uniform embryo sampling and correct it using some independent physical measurement. We used area measurement 𝐴 𝑖 for a subset of the embryos (using only C57BL/6 data to minimize strain-effects). Given the embryos exponential growth dynamics, we fit 𝑙 ⁢ 𝑜 ⁢ 𝑔 ⁡ ( 𝐴 𝑖 ) as a function of the intrinsic rank of each embryo 𝑖 using a smoothing spline interpolation (R function smooth.spline with parameter 𝑠 ⁢ 𝑝 ⁢ 𝑎 ⁢ 𝑟 = 0 . 9 , Figure 1 E). To extend the boundaries, the interpolation function was linearly extrapolated. To derive absolute time, the log area scale 𝑙 ⁢ 𝑜 ⁢ 𝑔 ⁡ ( 𝐴 ) was transformed into a developmental timescale 𝐸 𝑡 by assuming a linear relationship 𝑡 ∼ 𝑙 ⁢ 𝑜 ⁢ 𝑔 ⁡ ( 𝐴 ) and setting the median time of the first age group to 6.5 and the median time of the last age group to 8.1.
We constructed a reference MC object for the mouse gastrulation atlas published in Pijuan-Sala et al. (2019) 51. Pijuan-Sala, B. ∙ Griffiths, J.A. ∙ Guibentif, C. ... A single-cell molecular map of mouse gastrulation and early organogenesis Nature. 2019; 566 :490-495 Crossref Scopus (483) PubMed Google Scholar . Most atlas cells are labeled by collection time 𝑡 𝑐 into 6h intervals between e6.5 and e8.5. Using these labels, we computed the mean atlas age for each reference MC. We then computed for each of our embryos a projected mean age as follow: i) we matched MARS-seq and 10X gene symbols and used only feature genes as defined by the MC pipeline ii) for each embryo cell, we identified the atlas MC with maximal correlation (using log scaled single-cell UMI counts correlation to log scale gene frequency in MCs). iii) we computed the mean reference MC time matching all cells within each embryo. This is then defined as the projected atlas time of the embryo. Comparisons of these times to the intrinsic embryo ordering is shown in Figure 1 .
Given a MC solution over all embryos’ cells, we define first the gene expression distribution within each MC using the fraction of UMI’s per gene g in MC i, denoted 𝑒 𝑔 ⁢ 𝑖 (computed by the MC package). Each MC consists of cells from different time groups, represented by vectors 𝑛 𝑡 𝑖 specifying the number of cells from time group t and MC i. We assume analysis is done using a set of feature genes 𝐹 including genes that involve significant transcriptional variance and are filtered so as not to include batch-affected genes or genes linked with the cell cycle.
To compute manifold distances between MCs we perform the following steps: i) define parametric pairwise distances : we use a logistic function on the regularized 𝑒 𝑔 ⁢ 𝑖 values over the set of features genes 𝐹 : 𝑑 𝑖 ⁢ 𝑗 = ∑ 𝑔 ∈ 𝐹 𝑝 ⁢ 𝑙 ⁢ 𝑜 ⁢ 𝑔 ⁢ 𝑖 ⁢ 𝑠 ⁢ ( 𝑙 ⁢ 𝑜 ⁢ 𝑔 ⁢ 2 ⁢ ( 𝜀 + 𝑒 𝑔 ⁢ 𝑖 ) − 𝑙 ⁢ 𝑜 ⁢ 𝑔 ⁢ 2 ⁢ ( 𝜀 + 𝑒 𝑔 ⁢ 𝑗 ) ; 𝑙 ⁢ 𝑜 ⁢ 𝑐 , 𝑠 ⁢ 𝑐 ⁢ 𝑎 ⁢ 𝑙 ⁢ 𝑒 ) where loc (default 1) and scale (default 0.2) are parameters for a standard logistic function and 𝜀 (default 5e-4) is a regularization parameter. ii) defined manifold neighborhoods. We only trust the above parametric pairwise distances over highly related transcriptional states (e.g., for 𝑒 𝑔 ⁢ 𝑖 vectors that are generally similar). We therefore identify pairs of MCs 𝐸 𝑝 ⁢ 𝑟 ⁢ 𝑒 such that ( 𝑖 , 𝑗 ) ∈ 𝐸 𝑝 ⁢ 𝑟 ⁢ 𝑒 𝑖 ⁢ 𝑓 𝑑 𝑖 ⁢ 𝑗 < α ∗ m i n ( 𝑇 𝑖 , 𝑇 𝑗 ) , where 𝑇 𝑖 is the distance between MC I and its second most similar neighbor, and 𝛼 is a tolerance parameter (default 3). We further filter 𝐸 𝑝 ⁢ 𝑟 ⁢ 𝑒 such that each MC include at most 5 neighbors (those with the smallest distances), and construct a manifold graph M = (I, E) over MCs, with edge weights that equal the original 𝑑 𝑖 ⁢ 𝑗 values for the retained edges. This graph is visualized in Figure 2 A. iii) We next define a rate matrix 𝑄 = ( 𝑟 𝑖 ⁢ 𝑗 ) where 𝑟 𝑖 ⁢ 𝑗 = ( 𝐷 / 𝑑 𝑖 ⁢ 𝑗 ) for ( 𝑖 , 𝑗 ) ∈ 𝐸 and 0 otherwise, setting the diagonal as 𝑟 𝑖 ⁢ 𝑖 = − ∑ { 𝑖 ≠ 𝑗 } 𝑟 𝑖 ⁢ 𝑗 and using 𝐷 = 𝑚 ⁢ 𝑒 ⁢ 𝑑 ⁢ 𝑖 ⁢ 𝑎 ⁢ 𝑛 𝑖 ⁡ ( m a x j ⁡ 𝑑 𝑖 ⁢ 𝑗 ) for scaling distances. The manifold transition probabilities are now computed as:
𝑝 𝑖 ⁢ 𝑗 = 𝑒 − 𝑡 ⁢ 𝑄 , i.e., assuming a Markov process over the manifold with the rate matrix Q and timescale t (we use t = 1 to derive the flow models as discussed below). The manifold costs are derived from the probabilities by scaling each row and taking the inverse: 𝑐 𝑖 ⁢ 𝑗 = m a x 𝑗 ⁡ ( 𝑝 𝑖 ⁢ 𝑗 ) / 𝑝 𝑖 ⁢ 𝑗
For each cell, we computed a mitosis and synthesis phase score by counting the number of UMIs from mitosis (M) and replication (S) genes and normalizing this count by the total number of UMIs per cell. The group of M-phase genes includes Mki67, Cenpf, Top2a, Smc4;SMC4, Ube2c, Ccnb1, Cdk1, Arl6ip1, Ankrd11, Hmmr;IHABP, Cenpa;Cenp-a, Tpx2, Aurka, Kif4, Kif2c, Bub1b, Ccna2, Kif23, Kif20a, Sgol2, Smc2, Kif11, Cdca2, Incenp, Cenpe. The group of S-phase genes includes Pcna, Rrm2, Mcm5, Mcm6, Mcm4, Ung, Mcm7, Mcm2, Uhrf1, Orc6, Tipin. We detected reduced S phase and M phase scores for cells from extraembryonic and embryonic endoderm ( Figure 2 C). We also observed exponential decay of the fraction of cells per embryo as a function of inferred embryo time, fitting in log space a global trend of decrease in their relative frequency with coefficients of 0.83 and 0.88 for extraembryonic and embryonic endoderm respectively ( Figure S1 I). We did not observe significant evidence for differential growth rates in other cell types. We therefore assume a growth loss constant of 𝜆 𝑡 𝑒 ⁢ 𝑥 ⁢ 𝑒 ⁢ 𝑒 ⁢ 𝑛 ⁢ 𝑑 ⁢ 𝑜 = 1 − 0 . 8 3 = 0.17 for extraembryonic endoderm at all time groups, and of 𝜆 𝑡 𝑒 ⁢ 𝑚 ⁢ 𝑏 ⁢ 𝑒 ⁢ 𝑛 ⁢ 𝑑 ⁢ 𝑜 = 1 − 0 . 8 8 = 0 . 1 2 . for all embryonic endoderm types. We set the loss constant to 0 for all other cell types. We note that these estimations are only approximating a much more complex and dynamically changing process, but within the time window studied here, these estimations provide sufficient compensation with minimal additional parameter fitting.
Recall each MC consists of cells from different time groups, represented by vectors 𝑛 𝑡 𝑖 . We normalize these count vectors and generate a probability distribution per time point 𝑝 𝑖 ⁢ 𝑡 = 𝑛 𝑡 𝑖 / ∑ 𝑖 𝑛 𝑡 𝑖 . We define a flow model over this time resolved MC model using a flow matrix 𝑓 𝑡 𝑖 ⁢ 𝑗 for every time point t < T (T being the last time point), describing the fraction of cells from time t at MC i transitioning to MC j at time t+1.
The ideal “mass conservation” constraint in the model ensures the total flow in and out of each MC at each time point equals the observed frequency of single cells within it – specifically: ∑ 𝑗 𝑓 𝑡 𝑖 ⁢ 𝑗 = 𝑝 𝑡 𝑖 ⁡ ( 𝑓 ⁢ 𝑜 ⁢ 𝑟 ⁢ 𝑤 ⁢ 𝑎 ⁢ 𝑟 ⁢ 𝑑 ) , ∑ 𝑗 𝑓 𝑡 − 1 𝑗 ⁢ 𝑖 = 𝑝 𝑡 𝑖 ⁡ ( 𝑏 ⁢ 𝑎 ⁢ 𝑐 ⁢ 𝑘 ⁢ 𝑤 ⁢ 𝑎 ⁢ 𝑟 ⁢ 𝑑 ) where the boundary constraints (forward at the t = T, backward at t = 1), are ignored.
In practice however, we must relax these constraints given two considerations – First, we must consider differential growth rates between MCs. Second, uncertainty on our estimations of 𝑝 𝑡 𝑖 (which are a result of a single cell sampling process with considerable variance) must be considered.
To account for differential growth rates we use the growth loss constants 𝜆 𝑡 𝑖 (as described in the previous section). We assume that at each time step, MCs with 𝜆 𝑡 𝑖 > 0 emit “dilution” flow proportionally to their frequency - 𝜆 𝑡 𝑖 ⁢ 𝑝 𝑡 𝑖 . The total lost flow at time t, 𝜆 𝑡 = ∑ 𝑖 𝜆 𝑡 𝑖 ⁢ 𝑝 𝑡 𝑖 is being redistributed proportionally among all MCs toward time t+1, adding 𝛾 𝑡 𝑖 = 𝑝 𝑡 + 1 𝑖 ⁢ 𝜆 𝑡 to the flows going into each MC at time t+1. To define the resulted generalized conservation of mass, we introduce the flow constraints for each MC and time point: 𝐶 ⁢ 𝑁 ⁢ 𝑆 ⁢ 𝑇 ⁢ 𝑅 𝑓 ⁢ 𝑙 ⁢ 𝑜 ⁢ 𝑤 ≡ ∑ 𝑗 𝑓 𝑡 𝑖 ⁢ 𝑗 + 𝑝 𝑡 𝑖 ⁢ 𝜆 𝑡 𝑖 = ∑ 𝑗 𝑓 𝑡 − 1 𝑗 ⁢ 𝑖 + 𝑝 𝑡 𝑖 ⁢ 𝜆 𝑡 − 1 = 𝑓 𝑡 𝑖 We can now consider the uncertainty on the estimation of 𝑝 𝑡 𝑖 by computing relative total flow error per MC and time point 𝑑 𝑡 𝑖 = ( 𝑓 𝑡 𝑖 − 𝑝 𝑡 𝑖 ) / 𝑝 𝑡 𝑖 and using a cost function to penalize flows with large d magnitude – 𝑐 ⁢ 𝑜 ⁢ 𝑠 ⁢ 𝑡 𝑐 ⁢ 𝑎 ⁢ 𝑝 = ∑ 𝑖 , 𝑡 𝑓 ⁢ 𝑙 ⁢ 𝑜 ⁢ 𝑤 _ 𝑒 ⁢ 𝑟 ⁡ 𝑟 ⁡ 𝑜 ⁢ 𝑟 ⁡ ( 𝑑 𝑡 𝑖 ) where the flow error is a piecewise linear convex function with a minimum at 0 (shown in the right panels in Figure S2 A).
Given the relaxed formulation of the mass conservation and growth constraints, we can next write down a general optimization goal function for flows, which consider also the transcriptional manifold and the MC-MC distances defined by it – in simple terms: 𝑐 ⁢ 𝑜 ⁢ 𝑠 ⁢ 𝑡 𝑚 ⁢ 𝑎 ⁢ 𝑛 ⁢ 𝑖 ⁢ 𝑓 = ∑ 𝑖 , 𝑗 , 𝑡 𝑐 𝑖 ⁢ 𝑗 ⁢ 𝑓 𝑡 𝑖 ⁢ 𝑗 The resulted combined optimization problem: m i n ⁡ ( 𝑐 ⁢ 𝑜 ⁢ 𝑠 ⁢ 𝑡 𝑚 ⁢ 𝑎 ⁢ 𝑛 ⁢ 𝑖 ⁢ 𝑓 ⁡ ( 𝐹 ) + 𝑐 ⁢ 𝑜 ⁢ 𝑠 ⁢ 𝑡 𝑐 ⁢ 𝑎 ⁢ 𝑝 ⁡ ( 𝐹 ) ) Subject to the constraint 𝐶 ⁢ 𝑁 ⁢ 𝑆 ⁢ 𝑇 ⁢ 𝑅 𝑓 ⁢ 𝑙 ⁢ 𝑜 ⁢ 𝑤 and the global flow constraints ∑ 𝑖 𝑓 1 𝑖 = 1 . In fact, these constraints and cost function define a classical network min-cost max-flow problem with convex costs. This problem is polynomial, and we derive an optimal solution the highly efficient simplex algorithm ( Ahuja et al., 1993 1. Ahuja, R.K. ∙ Magnanti, T.L. ∙ Orlin, J.B. Network Flows: Theory, Algorithms and Applications Prentice Hall, 1993 Google Scholar ).
To annotate MCs, we added to the analysis of marker gene expression in each MC an examination of the inferred flow from (and to) them. MCs. In some cases, these supported identification of progenitor states that are already primed toward specific fates despite having only mild marker expression specificity. Let 𝐹 𝑖 ⁢ 𝑗 = ∑ 1 2 𝑡 = 1 𝑓 𝑡 𝑖 ⁢ 𝑗 be the average MC MC flow, 𝐹 3 = 𝐹 ⋅ 𝐹 ⋅ 𝐹 (matrix multiplication) and let 𝐺 be the concatenation of 𝐹 3 and the transpose ( 𝐹 3 ) 𝑇 containing the third-order ingoing and outgoing MC flows for each MC (rows). For 𝐺 we compute the first-order correlation matrix 𝐶 1 𝑖 ⁢ 𝑗 = 𝑐 ⁢ 𝑜 ⁢ 𝑟 𝑘 ⁡ ( 𝐺 𝑖 ⁢ 𝑘 , 𝐺 𝑗 ⁢ 𝑘 ) with the diagonal set to zero and the second-order correlation matrix 𝐶 2 𝑖 ⁢ 𝑗 = 𝑐 ⁢ 𝑜 ⁢ 𝑟 𝑘 ⁡ ( 𝐶 1 𝑖 ⁢ 𝑘 , 𝐶 1 𝑗 ⁢ 𝑘 ) . The diagonal of 𝐶 2 𝑖 ⁢ 𝑗 is again set to zero. MCs are then clustered into 65 groups using hierarchical clustering (Ward.D method) of Euclidean distances between columns of 𝐶 2 𝑖 ⁢ 𝑗 . The second-order correlation matrix is shown in Figure S3 A. Clusters were manually annotated based on selected markers shown in Figure S3 B. In cases where intra-cluster gene expression was not sufficiently homogeneous, single MCs were reannotated accordingly.
For the analysis in Figure S2 A, we used a fixed MC solution and recomputed flows while changing only one parameter at a time. To generate Figure S2 B, 153 replica single-cell UMI matrices where generated leaving out the cells of one of the 153 embryos each time. MC partitions, manifold distances and flows were recomputed for each replica using the same parameters as in the original analysis. MCs were annotated with cell types by projecting each replica MC to the best correlated original MC using log transformed mean gene UMI fractions on feature genes. Intrinsic ranks of embryos as well as the age group partitioning was kept unchanged.
Using the flow matrices 𝑓 𝑡 𝑖 ⁢ 𝑗 that are the solutions of the mincost flow problem, we define forward and backward probability transition matrices between MCs via 𝑃 𝑡 , 𝑓 ⁢ 𝑤 𝑖 ⁢ 𝑗 = 𝑓 𝑡 𝑖 ⁢ 𝑗 ∑ 𝑘 𝑓 𝑡 𝑖 ⁢ 𝑘 𝑃 𝑡 , 𝑏 ⁢ 𝑤 𝑖 ⁢ 𝑗 = 𝑓 𝑡 𝑖 ⁢ 𝑗 ∑ 𝑘 𝑓 𝑡 𝑘 ⁢ 𝑗 . Given a distribution 𝑝 𝑡 𝑖 over MCs at time 𝑡 , we can iteratively forward and backward propagate it through 𝑝 𝑡 + 1 = ( 𝑃 𝑡 , 𝑓 ⁢ 𝑤 ) 𝑇 ⁢ 𝑝 𝑡 𝑝 𝑡 − 1 = 𝑃 𝑡 − 1 , 𝑏 ⁢ 𝑤 𝑝 𝑡 .
To summarize flows as shown in the “vein plots” of Figures 4 and 7 , we group cells based on their annotated cell type and time-bin. We then summarize flows between cell types at each time point (where total flows between subsequent time points is 1). We are smoothing total frequency of each cell type per time using local polynomial regression and create “veins” with changing width that is proportional to cell type frequency. Flows between cell types are simplified by eliminating low magnitude flows between cell types (using a threshold of 0.005), and we visualize each edge with a width that is proportional to flow magnitude.
To generate Figure 5 A, we selected for each cell type the ancestral cell type mostly contributing to it according to the flows. For each pair of cell type transitions 𝑇 1 → 𝑇 2 we calculated gene expression profiles 𝑒 1 𝑔 = ∑ 𝑖 ∈ 𝑇 1 , 𝑗 ∈ 𝑇 2 𝑒 𝑔 ⁢ 𝑖 ⁢ 𝐹 𝑖 ⁢ 𝑗 ∑ 𝑖 ∈ 𝑇 1 , 𝑗 ∈ 𝑇 2 𝐹 𝑖 ⁢ 𝑗 , 𝑒 2 𝑔 = ∑ 𝑖 ∈ 𝑇 1 , 𝑗 ∈ 𝑇 2 𝑒 𝑔 ⁢ 𝑗 ⁢ 𝐹 𝑖 ⁢ 𝑗 ∑ 𝑖 ∈ 𝑇 1 , 𝑗 ∈ 𝑇 2 𝐹 𝑖 ⁢ 𝑗 corresponding to bulk expression of cells before and after the transition 𝑇 1 → 𝑇 2 . Denote by 𝑙 ⁢ 𝑓 ⁡ ( 𝑔 ; 𝑇 1 → 𝑇 2 ) = l o g 2 ⁡ ( 𝜀 + 𝑒 2 𝑔 ) − l o g 2 ⁡ ( 𝜀 + 𝑒 1 𝑔 ) the fold change corresponding to that transition ( ε = 1 0 − 5 ) . We then selected genes that are differentially expressed along a transition, i.e., that satisfy ∣ l o g 2 ⁡ ( 𝜀 + 𝑒 2 𝑔 ) − l o g 2 ⁡ ( 𝜀 + 𝑒 1 𝑔 ) ∣ > 1 , l o g 2 ⁡ ( 1 0 − 5 + m a x ⁡ ( 𝑒 1 𝑔 , 𝑒 2 𝑔 ) ) ≻ − 1 5 for at least one transition 𝑇 1 → 𝑇 2 . Among these genes, we filtered genes, that are uniquely differentially expressed along one transition, i.e., that (i) have a gap 𝑚 ⁢ 𝑎 ⁢ 𝑥 ( 𝑇 1 → 𝑇 2 ) ⁢ 𝑙 ⁢ 𝑓 ⁡ ( 𝑔 ; 𝑇 1 → 𝑇 2 ) > 0 . 5 + 𝑙 ⁢ 𝑓 ⁡ ( 𝑔 ; 𝑇 1 → 𝑇 2 ) for all transition pairs ( 𝑇 1 → 𝑇 2 ) not equal to the maximizing pair and (ii) for which the second largest fold change along a transition ( 𝑇 1 → 𝑇 2 ) is smaller than 1. Figure 5 A shows 𝑙 ⁢ 𝑓 ⁡ ( 𝑔 ; 𝑇 1 → 𝑇 2 ) for all included genes and included pairs 𝑇 1 , 𝑇 2 .
We filtered 63 mesodermal transcription factors that display high absolute expression as well as high variance within the mesoderm, i.e., ( ε = 3 ⋅ 1 0 − 5 ) 𝑙 ⁢ 𝑜 ⁢ 𝑔 2 ⁢ ( ε + 𝑚 ⁢ 𝑎 ⁢ 𝑥 𝑖 ∈ 𝑚 ⁢ 𝑒 ⁢ 𝑠 ⁢ 𝑜 ⁢ 𝑒 𝑔 ⁢ 𝑖 ) ≻ 1 2 , Δ 𝑚 ⁢ 𝑎 ⁢ 𝑥 ⁢ ( 𝑔 ) > 2 . with Δ 𝑚 ⁢ 𝑎 ⁢ 𝑥 ⁢ ( 𝑔 ) = 𝑙 ⁢ 𝑜 ⁢ 𝑔 2 ⁢ ( ε + 𝑚 ⁢ 𝑎 ⁢ 𝑥 𝑖 ∈ 𝑚 ⁢ 𝑒 ⁢ 𝑠 ⁢ 𝑜 ⁢ 𝑒 𝑔 ⁢ 𝑖 ) − 𝑙 ⁢ 𝑜 ⁢ 𝑔 2 ⁢ ( ε + 𝑚 ⁢ 𝑖 ⁢ 𝑛 𝑖 ∈ 𝑚 ⁢ 𝑒 ⁢ 𝑠 ⁢ 𝑜 ⁢ 𝑒 𝑔 ⁢ 𝑖 ) . These factors were visualized on a heatmap over all mesoderm MCs.
To estimate the kinetics of a TF g over time, we selected the mesodermal MCs, where it is highly expressed, ( 𝑙 ⁢ 𝑜 ⁢ 𝑔 2 ⁢ ( ε + 𝑒 𝑔 ⁢ 𝑖 ) − 𝑙 ⁢ 𝑜 ⁢ 𝑔 2 ⁢ ( ε + 𝑚 ⁢ 𝑖 ⁢ 𝑛 𝑖 ∈ 𝑚 ⁢ 𝑒 ⁢ 𝑠 ⁢ 𝑜 ⁢ 𝑒 𝑔 ⁢ 𝑖 ) ) > 0 . 8 ⋅ Δ 𝑚 ⁢ 𝑎 ⁢ 𝑥 ⁢ ( 𝑔 ) . Flows were then propagated through these MCs. The kinetics of selected transcription factors along their propagated flows is shown in Figure 5 C.
We identified genes that have at least an 8-fold difference between minimal and maximal gene expression within the mesoderm. Gene expression levels of highly variable genes (that are not transcription factors) were predicted in terms of transcription factor levels using standard linear regression. For each variable gene, the most predictive single transcription factor and the most predictive pair of transcription factors was reported ( Figure 5 D). Because 𝑅 ˆ 2 values of linear regressions always increase when increasing the number of explanatory variables, we performed a permutation test for comparing gene expression predictions from two transcription factors with predictions from one transcription factor. To this end, we first shuffled the TF expression matrix. We then used the best fitting single TF in the original data as a fixed anchor and estimated the improvement in Rˆ2 derived when adding to this anchor the best fitting shuffled TF vector. A comparison of the gain in Rˆ2 in the unshuffled matrix and shuffled matrix provided control for the over-fitting we perform when extending the model.
We constructed a common balanced K-nn graph consisting of 33.889 cells from the wild-type atlas and 4284 cells from seven Foxc1/2 KO chimera embryos. Using the common K-nn graph, we associate to each cell 𝑖 a probability vector 𝑝 𝑖 counting the fraction of cells from each cell type among its 50 nearest neighbor cells, i.e. 𝑝 𝑖 ⁡ ( 𝑐 ⁢ 𝑒 ⁢ 𝑙 ⁢ 𝑙 𝑡 ⁢ 𝑦 ⁢ 𝑝 ⁡ 𝑒 𝐴 ) = # 𝑤 ⁢ 𝑖 ⁢ 𝑙 ⁢ 𝑑 ⁢ 𝑡 ⁢ 𝑦 ⁢ 𝑝 ⁡ 𝑒 𝑛 ⁢ 𝑒 ⁢ 𝑖 ⁢ 𝑔 ⁢ ℎ ⁢ 𝑏 ⁢ 𝑜 ⁢ 𝑟 𝑐 ⁢ 𝑒 ⁢ 𝑙 ⁢ 𝑙 ⁢ 𝑠 𝑓 ⁢ 𝑟 ⁢ 𝑜 ⁢ 𝑚 𝑐 ⁢ 𝑒 ⁢ 𝑙 ⁢ 𝑙 𝑡 ⁢ 𝑦 ⁢ 𝑝 ⁡ 𝑒 𝐴 # 𝑤 ⁢ 𝑖 ⁢ 𝑙 ⁢ 𝑑 ⁢ 𝑡 ⁢ 𝑦 ⁢ 𝑝 ⁡ 𝑒 𝑛 ⁢ 𝑒 ⁢ 𝑖 ⁢ 𝑔 ⁢ ℎ ⁢ 𝑏 ⁢ 𝑜 ⁢ 𝑟 𝑐 ⁢ 𝑒 ⁢ 𝑙 ⁢ 𝑙 ⁢ 𝑠 . Note that we can calculate 𝑝 𝑖 for both wild-type and chimera cells, while only wild-type cells come with a cell type tag. Using 𝑝 𝑖 , we then assigned each chimera cell to a cell type by projecting it on that wild-type cell 𝑗 , whose 𝑝 𝑗 is most correlated with 𝑝 𝑖 . A MC 2d projection of the combined single-cell graph is shown in Figure S6 C. Chimera cells are colored according to their inferred cell type, wild-type cells are plotted in gray.
We used the balanced K-nn graph of the combined chimera and wildetype embryo dataset to time host and KO cells from each chimera embryo separately. More precisely, for each cell 𝑖 let 𝑁 ⁡ 𝑁 ⁡ ( 𝑖 ) be the nearest neighbor wild-type cell that is not from the same embryo as cell 𝑖 . We then attach to each cell 𝑖 the intrinsic rank (between 1 and 153) of the embryo of its nearest neighbor cell 𝑁 ⁡ 𝑁 ⁡ ( 𝑖 ) , 𝑡 𝑖 = 𝑅 𝑁 ⁡ 𝑁 ⁡ ( 𝑖 ) . We noted that simply computing the mean embryo time of NN cells as the representation of chimera cell population timing would introduce biases at the boundaries of the analyzed time interval (e.g., very early embryos cannot have neighbors in embryos even more early). We therefore refined the analysis of NN times per knockout and host cells as follows. For a selection 𝑆 of cell types, for instance, embryonic mesoderm or ectoderm, we define for each chimera embryo 𝐸 the cumulative distributions 𝑞 𝑆 , 𝐾 ⁢ 𝑂 𝐸 ⁡ ( 𝑡 ) and 𝑞 𝑆 , ℎ ⁢ 𝑜 ⁢ 𝑠 ⁢ 𝑡 𝐸 ⁡ ( 𝑡 ) of nearest neighbor time stamps 𝑡 𝑖 for all KO/host cells 𝑖 from the chimera embryo 𝐸 and selected cell types 𝑆 . For each wild-type embryo 𝐸 we can compute an analogous nearest neighbor cumulative distribution 𝑝 𝑆 𝐸 ⁡ ( 𝑡 ) . By finding for each 𝑞 𝑆 , 𝐾 ⁢ 𝑂 𝐸 ⁡ ( 𝑡 ) or 𝑞 𝑆 , ℎ ⁢ 𝑜 ⁢ 𝑠 ⁢ 𝑡 𝐸 ⁡ ( 𝑡 ) the best correlated wild-type 𝑝 𝑆 , 𝐸 ⁡ ( 𝑡 ) , we can match each chimera embryo 𝐸 with a wild-type embryo 𝐸 ′ , separately for KO and host cells. This procedure is used to independently time KO and host cells from ecto-/endoderm, embryonic mesoderm and extraembryonic mesoderm. The group of ecto-/endoderm contains foregut, definitive endoderm, primitive node, definitive ectoderm, surface ectoderm, rostral neural plate, caudal neural plate and caudal epiblast. Embryonic mesoderm contains early nascent, late nascent, caudal, lateral & intermediate, paraxial, and rostral mesoderm as well as cardiac crescent and cardiomyocyte cells. Extraembryonic mesoderm consists of allantois, amnion/chorion, and extraembryonic mesoderm cells.
We calculated bulk expression profiles 𝑒 𝐾 ⁢ 𝑂 𝑔 , + and 𝑒 𝑊 ⁢ 𝑇 𝑔 , + for all KO chimera and WT cells from cell types with high Foxc1/2 expression (rostral, paraxial and caudal mesoderm) and defined the log fold change δ + 𝑔 = l o g 2 ⁡ ( 𝑒 𝐾 ⁢ 𝑂 𝑔 , + + ε ) − l o g 2 ⁡ ( 𝑒 𝑊 ⁢ 𝑇 𝑔 , + + ε ) for ε = 5 ⋅ 1 0 − 5 . As a negative control, we averaged bulk expression profiles 𝑒 𝐾 ⁢ 𝑂 𝑔 , 𝑖 and 𝑒 𝑊 ⁢ 𝑇 𝑔 , 𝑖 per cell type 𝑖 and gene 𝑔 over all cell types not expressing Foxc1/2 (Amnion/Chorion, Allantois, Caudal epiblast, Caudal neural plate, Definitive ectoderm, Definitive endoderm, Epiblast, ExE mesoderm, Node/Notochord, PS, Rostral neural plate and Surface ectoderm) and calculated the log fold change δ − between the two: δ − 𝑔 = l o g 2 ⁡ ( 𝑚 ⁢ 𝑒 ⁢ 𝑎 ⁢ 𝑛 𝑖 ⁡ ( 𝑒 𝐾 ⁢ 𝑂 𝑔 , 𝑖 ) + ε ) − l o g 2 ⁡ ( 𝑚 ⁢ 𝑒 ⁢ 𝑎 ⁢ 𝑛 𝑖 ⁡ ( 𝑒 𝑊 ⁢ 𝑇 𝑔 , 𝑖 ) + ε ) . To identify candidate differentially expressed gene, we filtered genes satisfying ∣ δ + 𝑔 ∣ > 0 . 7 ∣ δ + 𝑔 − δ − 𝑔 ∣ > 0 . 5 , i.e., genes with sufficiently high differential expression among Foxc1/2 expressing cell types that was absent among the non-Foxc1/2 expressing cells. From the remaining list of 27 genes we further removed Igf2 and H19 whose opposite differential expression was attributed to loss of parental imprinting.
To make the data accessible to all users, we have developed an online interactive data exploration interface (https:// tanaylab.weizmann.ac.il/embflow ).

Section: Acknowledgments

We thank the Tanay and Stelzer group members for discussion and critical reading of the manuscript, and Hernan Rubinstein for graphic work. Y.S. is the incumbent of the Louis and Ida Rich Career Development Chair and is supported by Moross Integrated Cancer Center, the Israel Cancer Research Fund (ICRF), Helen and Martin Kimmel Stem Cell Institute, Hadar Impact Fund, Lord Sieff of Brimpton Memorial Fund, Janet and Steven Anixter, JoAnne Silva and Lester and Edward Anixter Family, Yeda-Sela Center, Barry and Janet Lang, European Research Council (ERC_StG 852865), ISF (1610/18), the Minerva Foundation, and Human Frontier Science Program (CDA00023/2019-C). S.C. was supported by the EMBO long term fellowship (ALTF 268-2018). M.M. was a postdoctoral fellow of the Minerva Stiftung and is supported by the Walter Benjamin program of the German Research Foundation (DFG). A.T. is supported by the European Research Council (ERC CoG scAssembly), the EU BRAINTIME project, the Israel Science Foundation, and the Chen-Zuckerberg Foundation. This research was further supported Israeli Council for Higher Education (CHE) Data Science program and by a grant from Madame Olga Klein-Astrachan.
M.M., Y.M., A.T., and Y.S. conceived and designed the experiment and performed data analysis and its interpretation. M.M. developed the flow algorithms with help from A.T. M.M., Y.M., R.B.-Y., A.T., and Y.S. annotated cell types with the help of A.U. Embryology and single-cell processing were performed by Y.M., S.C., R.B.-Y., and R.H. with input from Z.M. and the help of N.R., L.L., A.L., and E.C. Y.M. generated the Foxc DKO cell line with the help of Y.R. and S.C. A.-H.O. performed chimera injections and supervised animal handling. The interactive web interface was generated by A.L. with help from M.M. and A.T. Y.M., M.M., A.T., and Y.S. wrote the manuscript with input from all the authors.
The authors declare no competing interests.

Section: Supplemental information (2)

Download all Spreadsheet (21.13 KB) Table S1. Summary characteristics of the 153 embryos making up the transcriptional manifold, related to Figure 1 Spreadsheet (29.95 MB) Table S2. Processed metacell relative gene expression data, related to Figure 2
