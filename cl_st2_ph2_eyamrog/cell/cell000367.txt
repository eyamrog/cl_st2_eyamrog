Title: Wave-like dopamine dynamics as a mechanism for spatiotemporal credit assignment


Abstract: Summary

Significant evidence supports the view that dopamine shapes learning by encoding reward prediction errors. However, it is unknown whether striatal targets receive tailored dopamine dynamics based on regional functional specialization. Here, we report wave-like spatiotemporal activity patterns in dopamine axons and release across the dorsal striatum. These waves switch between activational motifs and organize dopamine transients into localized clusters within functionally related striatal subregions. Notably, wave trajectories were tailored to task demands, propagating from dorsomedial to dorsolateral striatum when rewards are contingent on animal behavior and in the opponent direction when rewards are independent of behavioral responses. We propose a computational architecture in which striatal dopamine waves are sculpted by inference about agency and provide a mechanism to direct credit assignment to specialized striatal subregions. Supporting model predictions, dorsomedial dopamine activity during reward-pursuit signaled the extent of instrumental control and interacted with reward waves to predict future behavioral adjustments.

Section: Introduction

Dopamine (DA) supports reward learning and motivated behaviors, but precisely what information it encodes and how it arrives at postsynaptic targets remain unclear ( Berke, 2018 10. Berke, J.D. What does dopamine mean? Nat. Neurosci. 2018; 21 :787-793 Crossref Scopus (204) PubMed Google Scholar ; Berridge, 2007 11. Berridge, K.C. The debate over dopamine’s role in reward: the case for incentive salience Psychopharmacology (Berl.). 2007; 191 :391-431 Crossref Scopus (1489) PubMed Google Scholar ; Collins and Frank, 2014 21. Collins, A.G.E. ∙ Frank, M.J. Opponent actor learning (OpAL): modeling interactive effects of striatal dopamine on reinforcement learning and choice incentive Psychol. Rev. 2014; 121 :337-366 Crossref Scopus (48) PubMed Google Scholar ; Schultz, 2016 103. Schultz, W. Dopamine reward prediction-error signalling: a two-component response Nat. Rev. Neurosci. 2016; 17 :183-195 Crossref Scopus (323) PubMed Google Scholar ). According to the reward prediction error (RPE) hypothesis, transients in DA signaling reflect deviations from reward expectation that drive reinforcement learning (RL) ( Montague et al., 1996 83. Montague, P.R. ∙ Dayan, P. ∙ Sejnowski, T.J. A framework for mesencephalic dopamine systems based on predictive Hebbian learning J. Neurosci. 1996; 16 :1936-1947 Crossref PubMed Google Scholar ; Schultz et al., 1997 104. Schultz, W. ∙ Dayan, P. ∙ Montague, P.R. A neural substrate of prediction and reward Science. 1997; 275 :1593-1599 Crossref Scopus (5366) PubMed Google Scholar ). This formulation generally treats DA as a “global” (spatiotemporally uniform) signal, a view based on two key findings. First, DA axon projections to the forebrain are extensively divergent ( Matsuda et al., 2009 78. Matsuda, W. ∙ Furuta, T. ∙ Nakamura, K.C. ... Single nigrostriatal dopaminergic neurons form widely spread and highly dense axonal arborizations in the neostriatum J. Neurosci. 2009; 29 :444-453 Crossref Scopus (438) PubMed Google Scholar ; Prensa and Parent, 2001 97. Prensa, L. ∙ Parent, A. The nigrostriatal pathway in the rat: A single-axon study of the relationship between dorsal and ventral tier nigral neurons and the striosome/matrix striatal compartments J. Neurosci. 2001; 21 :7247-7260 Crossref PubMed Google Scholar ), providing an architecture for broadcast-like communication. Second, midbrain DA neuron spikes are highly synchronized ( Hyland et al., 2002 53. Hyland, B.I. ∙ Reynolds, J.N.J. ∙ Hay, J. ... Firing modes of midbrain dopamine cells in the freely moving rat Neuroscience. 2002; 114 :475-492 Crossref Scopus (369) PubMed Google Scholar ; Li et al., 2011 66. Li, W. ∙ Doyon, W.M. ∙ Dani, J.A. Acute in vivo nicotine administration enhances synchrony among dopamine neurons Biochem. Pharmacol. 2011; 82 :977-983 Crossref Scopus (30) PubMed Google Scholar ), putatively implementing a code for RPEs ( Eshel et al., 2016 30. Eshel, N. ∙ Tian, J. ∙ Bukwich, M. ... Dopamine neurons share common response function for reward prediction error Nat. Neurosci. 2016; 19 :479-486 Crossref PubMed Google Scholar ; Joshua et al., 2009 55. Joshua, M. ∙ Adler, A. ∙ Prut, Y. ... Synchronization of midbrain dopaminergic neurons is enhanced by rewarding events Neuron. 2009; 62 :695-704 Full Text Full Text (PDF) Scopus (0) PubMed Google Scholar ; Kim et al., 2012 58. Kim, Y. ∙ Wood, J. ∙ Moghaddam, B. Coordinated activity of ventral tegmental neurons adapts to appetitive and aversive learning PLoS ONE. 2012; 7 :e29766 Crossref Scopus (0) PubMed Google Scholar ; Mohebi et al., 2019 82. Mohebi, A. ∙ Pettibone, J.R. ∙ Hamid, A.A. ... Dissociable dopamine dynamics for learning and motivation Nature. 2019; 570 :65-70 Crossref Scopus (122) PubMed Google Scholar ). These observations form the basis for an influential view ( Glimcher, 2011 38. Glimcher, P.W. Understanding dopamine and reinforcement learning: the dopamine reward prediction error hypothesis Proc. Natl. Acad. Sci. USA. 2011; 108 :15647-15654 Crossref Scopus (412) PubMed Google Scholar ; Kim et al., 2020 59. Kim, H.R. ∙ Malik, A.N. ∙ Mikhael, J.G. ... A Unified Framework for Dopamine Signals across Timescales Cell. 2020; 183 :1600-1616.e25 Full Text Full Text (PDF) Scopus (10) PubMed Google Scholar ; Schultz, 1998 102. Schultz, W. Predictive reward signal of dopamine neurons J. Neurophysiol. 1998; 80 :1-27 Crossref Scopus (3009) PubMed Google Scholar ) of what DA communicates and how it is delivered: scalar RPEs that are uniformly broadcast to all recipient subregions.
It remains debated, however, whether DA signals convey such scalar, uniform decision variables. In the midbrain, DA neurons are reported to encode multiple behavior- and stimulus-specific features ( Engelhard et al., 2019 29. Engelhard, B. ∙ Finkelstein, J. ∙ Cox, J. ... Specialized coding of sensory, motor and cognitive variables in VTA dopamine neurons Nature. 2019; 570 :509-513 Crossref Scopus (86) PubMed Google Scholar ; Sharpe et al., 2018 105. Sharpe, M.J. ∙ Chang, C.Y. ∙ Liu, M.A. ... Author Correction: Dopamine transients are sufficient and necessary for acquisition of model-based associations Nat. Neurosci. 2018; 21 :1493 Crossref Scopus (0) PubMed Google Scholar ), or distributions of reward outcomes in an RPE framework ( Dabney et al., 2020 24. Dabney, W. ∙ Kurth-Nelson, Z. ∙ Uchida, N. ... A distributional code for value in dopamine-based reinforcement learning Nature. 2020; 577 :671-675 Crossref Scopus (69) PubMed Google Scholar ). Moreover, the major subregions of the striatum receive vastly different patterns of DA following unpredicted reward delivery ( Brown et al., 2011 15. Brown, H.D. ∙ McCutcheon, J.E. ∙ Cone, J.J. ... Primary food reward and reward-predictive stimuli evoke different patterns of phasic dopamine signaling throughout the striatum Eur. J. Neurosci. 2011; 34 :1997-2006 Crossref Scopus (106) PubMed Google Scholar ), during motivated pursuit ( Hamid et al., 2016 44. Hamid, A.A. ∙ Pettibone, J.R. ∙ Mabrouk, O.S. ... Mesolimbic dopamine signals the value of work Nat. Neurosci. 2016; 19 :117-126 Crossref Scopus (308) PubMed Google Scholar ; Shnitko and Robinson, 2015 108. Shnitko, T.A. ∙ Robinson, D.L. Regional variation in phasic dopamine release during alcohol and sucrose self-administration in rats ACS Chem. Neurosci. 2015; 6 :147-154 Crossref PubMed Google Scholar ), and to conditioned stimuli ( Menegas et al., 2017 80. Menegas, W. ∙ Babayan, B.M. ∙ Uchida, N. ... Opposite initialization to novel cues in dopamine signaling in ventral and posterior striatum in mice eLife. 2017; 6 :e21886 Crossref Scopus (90) PubMed Google Scholar ). If regional heterogeneity is an adaptive feature of striatal DA dynamics, what are the organizational rules for large-scale DA transmission, and how do they facilitate computational/circuit operations in the service of behavioral flexibility?
An important clue is the functional architecture of hierarchical corticostriatal loops ( Graybiel, 2008 39. Graybiel, A.M. Habits, rituals, and the evaluative brain Annu. Rev. Neurosci. 2008; 31 :359-387 Crossref Scopus (1004) PubMed Google Scholar ; Haber, 2003 43. Haber, S.N. The primate basal ganglia: parallel and integrative networks J. Chem. Neuroanat. 2003; 26 :317-330 Crossref Scopus (1029) PubMed Google Scholar ), wherein multiple striatal “actors” (or subregions) gate the selection of cortical actions at various functional levels of abstraction ( Balleine et al., 2015 7. Balleine, B.W. ∙ Dezfouli, A. ∙ Ito, M. ... Hierarchical control of goal-directed action in the cortical–basal ganglia network Curr. Opin. Behav. Sci. 2015; 5 :1-7 Crossref Scopus (22) Google Scholar ; Frank, 2011 31. Frank, M.J. Computational models of motivated action selection in corticostriatal circuits Curr. Opin. Neurobiol. 2011; 21 :381-386 Crossref Scopus (122) PubMed Google Scholar ). A global DA RPE would equally reinforce all of these circuits, leading to inefficient learning when only a subset of them are responsible for rewards. Indeed, in theoretical models, robust learning in complex tasks requires RPEs that are preferentially directed to “credit” striatal actors/subregions in proportion to the extent of their participation in action selection ( Frank and Badre, 2012 32. Frank, M.J. ∙ Badre, D. Mechanisms of hierarchical reinforcement learning in corticostriatal circuits 1: computational analysis Cereb. Cortex. 2012; 22 :509-526 Crossref Scopus (164) PubMed Google Scholar ; O’Reilly and Frank, 2006 89. O’Reilly, R.C. ∙ Frank, M.J. Making working memory work: a computational model of learning in the prefrontal cortex and basal ganglia Neural Comput. 2006; 18 :283-328 Crossref Scopus (597) PubMed Google Scholar ). While such regional, actor-specific striatal RPEs are reported in human fMRI studies ( Badre and Frank, 2012 4. Badre, D. ∙ Frank, M.J. Mechanisms of hierarchical reinforcement learning in cortico-striatal circuits 2: evidence from fMRI Cereb. Cortex. 2012; 22 :527-536 Crossref Scopus (115) PubMed Google Scholar ; Gershman et al., 2009 36. Gershman, S.J. ∙ Pesaran, B. ∙ Daw, N.D. Human reinforcement learning subdivides structured action spaces by learning effector-specific values J. Neurosci. 2009; 29 :13524-13531 Crossref Scopus (83) PubMed Google Scholar ), we currently lack an empirical demonstration of whether DA signals are tailored to subregions according to their functional/computational specialty. Here, we used widefield imaging to assay DA dynamics over large territories of the dorsal striatum. We report spatiotemporally heterogeneous DA responses characterized by wave-like patterns that are regionally tailored to striatal targets as a function of task demands and predict animal’s behavioral adjustments.

Section: Results

We set out to study the large-scale organization of DA responses across the dorsal striatum (DS). Standard methods for DA assay have restricted spatial scale (10–100 s of micrometers); we overcame these limitations by injecting a cre -dependent fluorescent calcium indicator GCaMP6f into the midbrain of mice expressing cre recombinase selectively in DA cells (DAT-cre mice) and captured DA-axon dynamics through an ~7 mm 2 chronic imaging window over the DS ( Figure 1 A). This approach provided optical access to 60%–80% of the dorsal surface of the mouse striatum, with a view of dorsomedial (DMS), dorsolateral (DLS), and partial access to the posterior-tail (TS) region of the striatum ( Figure 1 B). A separate group of mice received striatal injection of the fluorescent DA sensor dLight followed by window surgery. We combined DA activity indicators with the expression of tdTomato to simultaneously capture inert red frames under dual-color, head-fixed preparations at multiple levels of resolution with one- or two-photon microscopy.
We first focused on spontaneous DA signals in a dark chamber without external stimuli. To test whether DA responses are globally synchronized, we compared fluorescence signals in DS regions of interest (ROIs) ( Figure 1 B). While ROIs were sometimes globally synchronized, we observed evidence of decorrelated activity across striatal subregions that temporally evolved ( Figures 1 C and 1D). This regional variability was observed both in DA concentration and axonal calcium signals (dLight and GCaMP6f fluorescence) and was also apparent on the micrometer scale of DA terminals ( Figure S1 A). Moreover, DA activity showed strong local correlations that gradually decreased with anatomical distance ( Figures 1 E and S1 B), comparable with the organization of striatal spiny-neuron activity ( Klaus et al., 2017 60. Klaus, A. ∙ Martins, G.J. ∙ Paixao, V.B. ... The Spatiotemporal Organization of the Striatum Encodes Action Space Neuron. 2017; 96 :949 Full Text Full Text (PDF) Scopus (13) PubMed Google Scholar ; Parker et al., 2018 92. Parker, J.G. ∙ Marshall, J.D. ∙ Ahanonu, B. ... Diametric neural ensemble dynamics in parkinsonian and dyskinetic states Nature. 2018; 557 :177-182 Crossref Scopus (89) PubMed Google Scholar ; Shin et al., 2020 106. Shin, J.H. ∙ Song, M. ∙ Paik, S.-B. ... Spatial organization of functional clusters representing reward and movement information in the striatal direct and indirect pathways Proc. Natl. Acad. Sci. USA. 2020; 117 :27004-27015 Crossref Scopus (0) PubMed Google Scholar ). Strikingly, this distance-dependent falloff had a strong bias toward the mediolateral (ML) axis ( Figure 1 F; two-way ANOVA with significant main effect of direction, F(1,7) = 82.3, p = 4.0 × 10 −5 for 8 GCaMP6f mice and F(1,5) = 71.7, p = 3.7 × 10 −4 for 6 dLight mice) that was not observed in simultaneously captured tdTomato frames (p > 0.4). Together, these results demonstrate that DA inputs can become recruited asynchronously ( Howe and Dombeck, 2016 50. Howe, M.W. ∙ Dombeck, D.A. Rapid signalling in distinct dopaminergic axons during locomotion and reward Nature. 2016; 535 :505-510 Crossref Scopus (214) PubMed Google Scholar ), hinting that the global DA hypothesis may need to be refined.
To further examine the topographical organization of DS DA, we used standard clustering analyses ( Figure 1 G). In every dataset (n = 76 sessions from 8 GCaMP6f mice and 6 dLight mice), the highest cluster threshold identified two contiguous territories in the field of view ( Figures 1 H–1J), outlining well-established DS subregions: DMS and DLS striatum ( Balleine et al., 2007 6. Balleine, B.W. ∙ Delgado, M.R. ∙ Hikosaka, O. The role of the dorsal striatum in reward and decision-making J. Neurosci. 2007; 27 :8161-8165 Crossref Scopus (808) PubMed Google Scholar ; Graybiel, 2008 39. Graybiel, A.M. Habits, rituals, and the evaluative brain Annu. Rev. Neurosci. 2008; 31 :359-387 Crossref Scopus (1004) PubMed Google Scholar ; Yin and Knowlton, 2006 119. Yin, H.H. ∙ Knowlton, B.J. The role of the basal ganglia in habit formation Nat. Rev. Neurosci. 2006; 7 :464-476 Crossref Scopus (1412) PubMed Google Scholar ). Increasing cluster limits progressively revealed smaller areas of DS ( Figures 1 H and S1 F and S1G), resembling striatal subdomains previously identified based on glutamatergic input patterns and behavioral specialty ( Hintiryan et al., 2016 46. Hintiryan, H. ∙ Foster, N.N. ∙ Bowman, I. ... The mouse cortico-striatal projectome Nat. Neurosci. 2016; 19 :1100-1114 Crossref Scopus (240) PubMed Google Scholar ; Hooks et al., 2018 49. Hooks, B.M. ∙ Papale, A.E. ∙ Paletzki, R.F. ... Topographic precision in sensory and motor corticostriatal projections varies across cell type and cortical area Nat. Commun. 2018; 9 :3549 Crossref Scopus (37) PubMed Google Scholar ; Hunnicutt et al., 2016 52. Hunnicutt, B.J. ∙ Jongbloets, B.C. ∙ Birdsong, W.T. ... A comprehensive excitatory input map of the striatum reveals novel functional organization eLife. 2016; 5 :e19103 Crossref Scopus (162) PubMed Google Scholar ; Matamales et al., 2020 77. Matamales, M. ∙ McGovern, A.E. ∙ Mi, J.D. ... Local D2- to D1-neuron transmodulation updates goal-directed learning in the striatum Science. 2020; 367 :549-555 Crossref Scopus (14) PubMed Google Scholar ). We did not observe these territories when clustering control tdTomato frames, and shuffling the pixel-wise spatial (or temporal) order of GCaMP6f and dLight signals produced random clusters. Together, these results provide evidence for regional coordination of DA transmission and served as an initial basis for evaluating whether DA inputs are modulated by the underlying subregion’s computational specialty.
We next noted that the distance dependence of correlated DA activity patterns reflected an underlying organization of spatiotemporally continuous trajectories. In particular, both GCaMP6f and dLight fluorescence initiated in localized striatal zones and migrated across DS as DA axons become sequentially recruited to affect DA release in spatially contiguous regions ( Figures 2 A and S2 ; Video S1 ). These trajectories, which we quantify below, resembled those described as traveling waves in cortical and subcortical brain regions ( Grinvald et al., 1994 40. Grinvald, A. ∙ Lieke, E.E. ∙ Frostig, R.D. ... Cortical point-spread function and long-range lateral interactions revealed by real-time optical imaging of macaque monkey primary visual cortex J. Neurosci. 1994; 14 :2545-2568 Crossref PubMed Google Scholar ; Lubenov and Siapas, 2009 71. Lubenov, E.V. ∙ Siapas, A.G. Hippocampal theta oscillations are travelling waves Nature. 2009; 459 :534-539 Crossref Scopus (246) PubMed Google Scholar ; Mohajerani et al., 2013 81. Mohajerani, M.H. ∙ Chan, A.W. ∙ Mohsenvand, M. ... Spontaneous cortical activity alternates between motifs defined by regional axonal projections Nat. Neurosci. 2013; 16 :1426-1435 Crossref Scopus (193) PubMed Google Scholar ; Muller et al., 2014 87. Muller, L. ∙ Reynaud, A. ∙ Chavane, F. ... The stimulus-evoked population response in visual cortex of awake monkey is a propagating wave Nat. Commun. 2014; 5 :3675 Crossref Scopus (78) PubMed Google Scholar , 2018 88. Muller, L. ∙ Chavane, F. ∙ Reynolds, J. ... Cortical travelling waves: mechanisms and computational principles Nat. Rev. Neurosci. 2018; 19 :255-268 Crossref Scopus (123) PubMed Google Scholar ). From here on, we use the “DA wave” terminology as a shorthand to describe the spatiotemporally continuous, flow-like patterns of dopaminergic activity across DS.
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiIwZGZmOGJiZWJiZWMxMWU0ODgyNmQ5NDRjOWY0MTA5MyIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjExNjMwfQ.HIOQPBUwaFfVJiTkB4uy4p5xjZEVPSCq6Xi_101D5UHFpfb7dCWc6uELDIZDdACz6kpQj5ytee0jqAT6NVPOlTDCaCyopyJd9ZagRKFZxX_p9--OMUW7G783Jq6H7df-uY6fJmcIOVbiRGwlZBteRoDfAiPoe8CbEycisHr1ns0HMQDVVrwX4aWlUkCPH6eUnGUlia1v0Eh61iOcwy-zJuZh7jxearjyA2N1FViyNdryJuojIo4VLD5HVOCFKdD5wZ15eISSNH71yzetX6H2-DzianoQ-4wkgqs4i0X7Yy12t5O6L4UHMJsAEY5e4KBPZdKhD7ABrzZJ54Ou1VRySg Video (4.77 MB) Video S1. Example recording session demonstrating the activity pattern of DA axons in the dorsal striatum, related to Figure 2 Each frame is labeled with elapsed time and which fluorescent sensor is being plotted. The early black-and-white frames show data from two separate animals, whereas the color frames show simultaneous imaging in the same mouse as described in Figure S3A. Video playback is 0.5× real speed.
To quantitatively characterize these DA trajectories, we leveraged optic flow algorithms that extract frame-by-frame flow fields ( Afrashteh et al., 2017 2. Afrashteh, N. ∙ Inayat, S. ∙ Mohsenvand, M. ... Optical-flow analysis toolbox for characterization of spatiotemporal dynamics in mesoscale optical imaging of brain activity Neuroimage. 2017; 153 :58-74 Crossref Scopus (18) PubMed Google Scholar ; Townsend and Gong, 2018 116. Townsend, R.G. ∙ Gong, P. Detection and analysis of spatiotemporal patterns in brain activity PLoS Comput. Biol. 2018; 14 :e1006643 Crossref Scopus (16) PubMed Google Scholar ; see STAR Methods for details). The transient activation in DA axons (and release) originated from spatially clustered “source” regions defined by divergent vectors that signify outward flow ( Figures 2 B and S2 A). Once initiated, fluorescence migrated to neighboring striatal regions before terminating as a result of flow toward “sink” locations ( Figure 2 B). DA waves entered the DS with exponentially decaying inter-wave intervals ( Figures 2 D and 2E) and propagated with a range of velocities ( Figures 2 F and 2G). Moreover, the overall direction of flow was bimodally distributed ( Figures 2 H and 2I; Omnibus test for angular uniformity; GCaMP6f sessions p < 10 −4 , dLight sessions p < 10 −3 ), significantly biased to a ML propagation axis that was not present in simultaneously acquired tdTomato frames ( Figure 2 I; p > 0.4).
The flow-like property exhibited similar statistics for DA axon activation and release ( Figures 2 E–2G), indicating that axonal excitation and release may be coupled. To concretely test this possibility, we made dual-color widefield recordings in 4 DAT-cre mice with cre-dependent, red-shifted calcium indicator jRGECO1a injected into the midbrain and dLight broadly expressed in the DS ( Figure S3 A). Indeed, we found strong coupling between the simultaneously acquired dLight and jRGECO1a spatiotemporal flow patterns ( Figures 2 J, 2K, and S3 B–S3D), with highly correlated temporal dynamics in the major striatal subdivisions that was not affected by the locomotor state of the mice ( Figures S3 E and S3F).
We also examined whether the complex DA trajectories resulted from various imaging artifacts and/or damage to cortex and glutamatergic afferents during surgery for cannula implantation. We first ruled out the contribution of imaging artifacts related to locomotion and blood flow by imaging multiple DA activity sensors with spectrally separated inert fluorophores that did not display fast, spatially heterogeneous fluctuations ( Figures 2 I and S3 G–S3J). Second, we confirmed similar flow-like, sequential DA signals in absence of cortical resection in a separate group of animals that received small-diameter optic fibers arranged into a grid ( Figures S3 K–S3S, Video S2 ) to minimize cortical damage. These findings lead us to conclude that wave-like activation patterns reflect a striatal DA circuit specialization for spatiotemporally coordinated dynamics.
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiI3NWZmMjA5YWFkYTk4Y2M5YTVmMjcxN2ExMjZmZTQ3MCIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjExNjMwfQ.BPeEFFNnSCnLYksKNFxwfIibA4ZW0ZudjU5sgYBMU6JRUdPNXX8gT6lqLs57aO8x_jEU35_RG1YVRAUXhmb1NkmAVy5TgXVpJ60290mOysGzWlAzTj3aSUjLInr2eR1JSlbWK-09KJm0Akvp0Myab7ffO1m_CA71CMBEajlteBn_FdwMNtwxg7wEnBm7kg9_2Qty88XGUR8DszwU0TAyU77SJxdb4VMGN9rlvW0FakTfDzx7qUKMkhB2hJcftsitHc6RgYHTidstP_cN2aVbMLFBpedo7-GKXlEmjbnLmikF1abRP8YtqsWKGeKQzyOLfbpUg4N_g4L4Y_vFKhrBgQ Video (996.59 KB) Video S2. GCaMP6f activity profile during spontaneous activity using optic fiber grid described in Figure S3K, related to Figures 2 and S3 Video playback is 1× real speed.
The propagation of wave-like dynamics could produce temporal delays in the arrival of DA transients across the striatum that, in turn, may regulate regional DA-dependent plasticity mechanisms ( Iino et al., 2020 54. Iino, Y. ∙ Sawada, T. ∙ Yamaguchi, K. ... Dopamine D2 receptors in discrimination learning and spine enlargement Nature. 2020; 579 :555-560 Crossref Scopus (27) PubMed Google Scholar ; Shindou et al., 2019 107. Shindou, T. ∙ Shindou, M. ∙ Watanabe, S. ... A silent eligibility trace enables dopamine-dependent synaptic plasticity for reinforcement learning in the mouse striatum Eur. J. Neurosci. 2019; 49 :726-736 Crossref Scopus (9) PubMed Google Scholar ; Yagishita et al., 2014 118. Yagishita, S. ∙ Hayashi-Takagi, A. ∙ Ellis-Davies, G.C.R. ... A critical time window for dopamine actions on the structural plasticity of dendritic spines Science. 2014; 345 :1616-1620 Crossref Scopus (254) PubMed Google Scholar ). We asked whether elementary propagation trajectories could realize assorted temporal lead/lags in DA activation across DS. Using multiple convergent methods for the analysis of spatiotemporal sequences ( Mackevicius et al., 2019 73. Mackevicius, E.L. ∙ Bahle, A.H. ∙ Williams, A.H. ... Unsupervised discovery of temporal sequences in high-dimensional datasets, with applications to neuroscience eLife. 2019; 8 :e38471 Crossref Scopus (21) PubMed Google Scholar ; Townsend and Gong, 2018 116. Townsend, R.G. ∙ Gong, P. Detection and analysis of spatiotemporal patterns in brain activity PLoS Comput. Biol. 2018; 14 :e1006643 Crossref Scopus (16) PubMed Google Scholar ), we identified rudimentary motif patterns that affect DA dynamics across the DS ( Figures S2 F–S2H; Video S3 ). We focused our analyses on three motif waves that produced 93% ± 3% of the DA transients ( Figure S2 H). First, center-out (CO) waves initiate at the juncture of DMS and DLS and rapidly spread bilaterally outward to produce DA signals that arrive at different striatal regions with little delay ( Figure 2 L). Second, lateromedial (LM) waves start from the lateral striatum and predominantly propagate medially to deliver delayed DA transients to the DMS relative to DLS ( Figure 2 M). Third, ML waves are sourced in the DMS and propagate laterally, activating DA axons in the medial striatum first and progressively recruited DA in lateral regions ( Figure 2 N). These findings demonstrate that motif waves specify how DA responses initiate and propagate across DS, codifying the relative timing of regional DA that may shape striatal plasticity.
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiI2ZGIyZTM5Yjk1ZDUzMzM3YTEyMjM4MTY2YWRmZDY0YSIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjExNjMwfQ.PUwLJO-Ppx4_kSCt2mLAkHqYRk7xsXcS_XadIGIVrAre85r4dA1FRGc9cRVjZ9Nzy4u7yquppkbHniF85BrhQ76HH7s5sHGlINXI-RoTdJ-262PwZKHNozccGs8zDVLM0iVNsAC4JrFRcgDAWq1p_hE3dlzyGN-rHpfz1QTGpxV8-1ky1E01Q34Pw-7aEEbQB44gZGuIYT5Q1X19bvRF7V0GYf_R-BMdEfBbjfRCWwXwoTYw-tJ-X0-OAjTD00VRp-7nQmLYlOiZjXDMlmiXZBKwQE6HEwJUbPzGhErm-T7mL79Ow2IsmepHpjLBd2R_YbSuC0N8SDj0f91G3rIO6g Video (748.66 KB) Video S3. Identification of motif waves using low dimensional embedding of spatial principal components (PCs), related to Figures 2 and S3 Each dot represents different fluorescent events of the same wave category to demonstrate a shared trajectory. The frames depicted at the left are one of the waves.
What is the functional role of DA waves in adaptive behavior? We set out to determine the computational significance of DA trajectories in the context of the well-studied role of DS in instrumental behavior. The DS exhibits graded behavioral specialty, with the DMS implicated in agentic, goal-directed behaviors involving action-outcome learning and DLS implicated in stimulus-response behaviors ( Yin and Knowlton, 2006 119. Yin, H.H. ∙ Knowlton, B.J. The role of the basal ganglia in habit formation Nat. Rev. Neurosci. 2006; 7 :464-476 Crossref Scopus (1412) PubMed Google Scholar ; Balleine et al., 2007 6. Balleine, B.W. ∙ Delgado, M.R. ∙ Hikosaka, O. The role of the dorsal striatum in reward and decision-making J. Neurosci. 2007; 27 :8161-8165 Crossref Scopus (808) PubMed Google Scholar ; Corbit and Janak, 2010 22. Corbit, L.H. ∙ Janak, P.H. Posterior dorsomedial striatum is critical for both selective instrumental and Pavlovian reward learning Eur. J. Neurosci. 2010; 31 :1312-1321 Crossref Scopus (91) PubMed Google Scholar ; Thorn et al., 2010 114. Thorn, C.A. ∙ Atallah, H. ∙ Howe, M. ... Differential dynamics of activity changes in dorsolateral and dorsomedial striatal loops during learning Neuron. 2010; 66 :781-795 Full Text Full Text (PDF) Scopus (223) PubMed Google Scholar ). Inactivation or manipulation of DA in DMS degrades goal-directed planning and action due to an inability to learn whether rewards are under instrumental control ( Balleine and O’Doherty, 2010 5. Balleine, B.W. ∙ O’Doherty, J.P. Human and rodent homologies in action control: corticostriatal determinants of goal-directed and habitual action Neuropsychopharmacology. 2010; 35 :48-69 Crossref Scopus (1022) PubMed Google Scholar ; Wunderlich et al., 2012 117. Wunderlich, K. ∙ Smittenaar, P. ∙ Dolan, R.J. Dopamine enhances model-based over model-free choice behavior Neuron. 2012; 75 :418-424 Full Text Full Text (PDF) Scopus (156) PubMed Google Scholar ).
To study whether DS DA is tailored to the target region’s computational specialty, we designed two operant tasks that manipulated action-outcome contingency and asked whether DA dynamics carry information about instrumental controllability (i.e., agency). Auditory tones that escalated in frequency indicated progress to rewards in both tasks ( Figures 3 A–3D). In the “instrumental” task, this reward progress was contingent on, and tied to, the mouse running on a wheel to traverse a linearized distance. The distance to reward was randomly selected from a uniform distribution on each trial (50–150 cm; Figure 3 C). Thus, while the mouse was in control of tone transitions, the specific contingencies varied across trials. In a second “Pavlovian” task, mice were free to run, but the tone transitions occurred independent of running, and the time to reward was drawn from a uniform distribution (4–8 s; Figure 3 C). Thus, the two tasks differed in instrumental controllability, but were structurally identical: tones provided information about progress to reward, which could not be inferred from elapsed time alone. Trained mice exhibited anticipatory lick trajectories that increased with ascending tone frequency in both tasks ( Figures 3 E and 3F), indicating that mice used escalating tones to update their online judgment of progress to reward. Moreover, analysis of run bouts across the two tasks revealed that mice invested goal-directed effort to receive rewards selectively in the instrumental task ( Figure S4 ).
As in the spontaneous conditions reported above, DA waves were ubiquitous during task performance and were especially prevalent at reward. Notably, reward delivery immediately resynchronized DA responses into propagating waves that had opponent directions depending on task conditions. Specifically, rewards after an instrumental trial triggered medially sourced, laterally propagating (ML) waves ( Figures 3 G–3J; Video S4 ), whereas rewards in the Pavlovian task promoted laterally initiated, medially propagating (LM) waves ( Figures 3 H–3J; Video S4 ). These divergent responses in the two task conditions affected the temporal order of DA recruitment on the ML axis: DMS achieved peak reward-induced DA significantly sooner than lateral regions in the instrumental condition ( Figure 3 K; p = 0.031, Wilcoxon signed-rank test; n = 6 mice), whereas DMS had delayed DA peaks in the Pavlovian task ( Figure 3 L; p = 0.0078, Wilcoxon signed-rank test; n = 8 mice). Moreover, these wave trajectories evolved with task experience, with reward-induced waves exhibiting irregular trajectories in naive animals but becoming more consistent and directional across several training days ( Figures 3 M and 3N; Video S5 ).
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiI5Y2FkMDc5NjdhODZlNzNlMzg3YzBmZTNmZmQwZTk3YSIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjExNjMwfQ.MXV0eJAv9W74OWPAjAGzDUUpC243S3WWr_WeDoCcofmtEik7XF8uOjJI4jhvPoT0s74WRxK7i2c3OzDw8-G28MvpJx1J5WgBl8TL97GS3qIoDpTdHJQ3dn657ajsAWqVSpa20iJ10brHL20y4CsCpGMIVVlAh63vDuKqmHEKtOeMA9e6N1OaeaIWKUtpOklUWN6XAZYul0gam9NLeZVijexeUvKlDnc5ZPcUF_JUCUBG0K8p9LEztU1TymWByE69hbaDBrbIKfQdo2pyFkO3BiUk35rS93z_QdDB2jWfSAq_9d_gM29kyj-2IB7hMvOLivMbbIjFBQmNzmYJptV1fQ Video (485.09 KB) Video S4. Reward response in instrumental and Pavlovian tasks, related to Figure 3 Instrumental task (left panel) and Pavlovian task (right panel). The clock at the top left displays time relative to reward. Video playback is 1× real speed.
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiIxMWIyMTVmZTNmMGM4MTBiMTk5YmYxMjQxMzRhYzY1YiIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjExNjMwfQ.V53vavAf7XQJMcLn2QZeljsI3caM1VXiMMm6eucgaJJQg16sEWL6QvI_wAek6LAINMvS5MUL_QM4oUoad2Dd7YWByLG71du91TTFcMvq-sreGjOhgx07q0MnNGtuUQzyisFt5dYmqt55pOdzuvgddgREEq4lTTPMAbQbUIEgh6Sq6EKHJBf2Xz_wZkHF8ZmjE_yuxyLTO-dCWqpy4Kf-9jotUKvvEBz3Xw5GbxmLTAzBHq9vzmobxlreLt4JZ4a4LUKb0-Ts5vdYvf9pt7HhUXJ_KDiU6-QKY_B1I2H357btx-aEg3RERou0MPg0TDOg_-eO6F2Jpr_OTdPajTMDnA Video (4.29 MB) Video S5. Top row of videos shows reward response dynamics in naive animals presented with unpredicted reward delivery, related to Figure 3 Notice the highly variable spatiotemporal dynamics. The bottom row of frames shows the same animal with smooth and regular DA reward responses after extensive exposure to the operant chamber and reward in the behavioral tasks. See Figure 3N for accompanying quantification of these trajectories.
The dynamic sculpting of these trajectories by training and task demands suggested that DA waves may be important for behavioral flexibility. In particular, the continuous propagation of DA across the striatum in space and time motivated a revision of standard “temporal difference (TD)” RL models wherein a single reward value influences learning about reward-predictive events. We reasoned that these views could be expanded to include “spatiotemporal differences” in which waves carry additional, graded information about structural sub-circuits that are most likely to be responsible for rewards. To formally explore this account, we simulated the consequence of spatially delayed rewards in the tone tasks within a TD framework. The simulation contained a bank of parallel agents representing striatal subregions ( Frank and Badre, 2012 32. Frank, M.J. ∙ Badre, D. Mechanisms of hierarchical reinforcement learning in corticostriatal circuits 1: computational analysis Cereb. Cortex. 2012; 22 :509-526 Crossref Scopus (164) PubMed Google Scholar ; Figure S5 ), and tone/state transitions formulated as sequential semi-Markov states ( Daw et al., 2006 26. Daw, N.D. ∙ Courville, A.C. ∙ Touretzky, D.S. Representation and timing in theories of the dopamine system Neural Comput. 2006; 18 :1637-1677 Crossref Scopus (110) PubMed Google Scholar ). To explore the consequence of ML propagating waves, the reward response for the most “medial” agent was delivered immediately at the end of the trial and progressively delayed for more “lateral” agents. The model also included eligibility traces ( Singh and Sutton, 1996 109. Singh, S.P. ∙ Sutton, R.S. Reinforcement Learning with Replacing Eligibility Traces Mach. Learn. 1996; 22 :123-158 Crossref Scopus (345) Google Scholar ; Sutton and Barto, 2018 112. Sutton, R.S. ∙ Barto, A.G. Reinforcement Learning MIT Press, 2018 Google Scholar ) so that any delays in rewards could still be attributed to earlier states that were no longer active, in proportion to their decaying eligibility. This choice was motivated by both computational principles and the documented impact of such delays in DA signaling on synaptic plasticity in mouse striatum ( Shindou et al., 2019 107. Shindou, T. ∙ Shindou, M. ∙ Watanabe, S. ... A silent eligibility trace enables dopamine-dependent synaptic plasticity for reinforcement learning in the mouse striatum Eur. J. Neurosci. 2019; 49 :726-736 Crossref Scopus (9) PubMed Google Scholar ; Yagishita et al., 2014 118. Yagishita, S. ∙ Hayashi-Takagi, A. ∙ Ellis-Davies, G.C.R. ... A critical time window for dopamine actions on the structural plasticity of dendritic spines Science. 2014; 345 :1616-1620 Crossref Scopus (254) PubMed Google Scholar ).
As learning progressed across trials, the RPE response in the most medial agent back-propagated to the earliest predictor of reward ( Montague et al., 1996 83. Montague, P.R. ∙ Dayan, P. ∙ Sejnowski, T.J. A framework for mesencephalic dopamine systems based on predictive Hebbian learning J. Neurosci. 1996; 16 :1936-1947 Crossref PubMed Google Scholar ; Figure S5 ; Video S7 ). However, in more lateral agents, delays in reward response led to progressively reduced credit assignment to the earlier states. Indeed, these effects translated to produce steeper value functions in the most medial agents as the agent progressed to reward, and lateral agents shallower ramps ( Figure S5 ). Given that the value function reflects the reward value of the agent’s predictions, which can be used to guide action selection, these simulations provide an initial algorithmic demonstration that reward-induced waves can give rise to asymmetric structural credit assignment. Moreover, as rewards produced opponent DA wave dynamics across the two tasks, this mechanism would preferentially reinforce the medial DS agents for instrumental tasks. We next test this prediction in mouse behavior before examining how instrumental controllability may be computed in these tasks to affect wave dynamics.
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiI5MTllYmJkYzBhZTMxYzQ1ZDk3MjU0N2Q3Y2Y2OWI1NSIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjExNjMwfQ.IWwYZLbgvPKs9eAEw3T--0jGruMM08h1KaYYwDEo5RB8ea4lszfu2nDAYiUFw29-YyInB-6v_YTif0VKcERNvAbkuBavvLwY7g-kmvMggollsNW47iTb7X9YOIxVUsfzHQO4c0013xHrBo1vVxRUMRRaNF92bq6Mjg7HHNWkHbQoLz6_a8Jx9VHb6zq0E9y0B8Jn6e-O5Mzp7MzW7e-uHd0hKhuIrNo_4JRG8dEcGMritDL_PkDpjJyaqW8qmVt1Z8IWnDnBAF22ik2X9IS5azn52KT6nHdJDrardchrSqtyP9TlkVgT9HwvkYB4gqG4mp7YCLK-m5ElZVHOVS5iTw Video (1.19 MB) Video S6. Example instrumental and Pavlovian trial performance showing respective instrumental contingency and mouse displacement through the virtual corridor, related to Figure 4
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiI0Yzc2NGNjYjc5NzM3NjI0ZGQ2MGM2MmY1ZDNkMDU4MSIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjExNjMwfQ.XouTwZO4wC27BO3iefQkI54TwRWzbg_es1tfWoBwMc_cEehIQCU_gV7Z2TE4Tgj-qk2EgEBUYkxGKY9Pmy9Ua04bRHcoOuqzy2odsUwXk0kLL6v9a0nSB3JRSi-zh4FM9Gk3q3Ddkp2jiQf3m90sCfyv-d5dDqplULAzROdR3_tuD7RdeTi6bpH2fcLfynf6fYqQhQfHD4Z5tRi0E-k34AK09zm1BUuB8oichRZz0i0QBQjvAgRm8PutNH0KeyJJyba-7eW5vdu1jW-BVOdLjTq81uHFquSC8dEViFzhWDbJLY1vXBowMwOgsHp1Igyoqnp30ze51SiikjbJs0BXag Video (1.34 MB) Video S7. Value and RPE dynamics for a bank of RL agents simulated to receive progressively delayed outcome responses, related to Figure 3 Each frame shows ramping state value (left) and back-propagation of RPE (right) as a function of training trial-number. See Figure S5 for quantification.
For our behavioral tasks, we posited that opponent DA waves would facilitate reward-credit dissemination to specialized striatal regions depending on the animal’s instrumental agency in advancing progress to reward. This hypothesis is inspired by expert-like organization of DS anatomy ( Aoki et al., 2019 3. Aoki, S. ∙ Smith, J.B. ∙ Li, H. ... An open cortico-basal ganglia loop allows limbic control over motor output via the nigrothalamic pathway eLife. 2019; 8 :e49995 Crossref Scopus (17) PubMed Google Scholar ; Hintiryan et al., 2016 46. Hintiryan, H. ∙ Foster, N.N. ∙ Bowman, I. ... The mouse cortico-striatal projectome Nat. Neurosci. 2016; 19 :1100-1114 Crossref Scopus (240) PubMed Google Scholar ; Hunnicutt et al., 2016 52. Hunnicutt, B.J. ∙ Jongbloets, B.C. ∙ Birdsong, W.T. ... A comprehensive excitatory input map of the striatum reveals novel functional organization eLife. 2016; 5 :e19103 Crossref Scopus (162) PubMed Google Scholar ; Matamales et al., 2020 77. Matamales, M. ∙ McGovern, A.E. ∙ Mi, J.D. ... Local D2- to D1-neuron transmodulation updates goal-directed learning in the striatum Science. 2020; 367 :549-555 Crossref Scopus (14) PubMed Google Scholar ), activity ( Barbera et al., 2016 8. Barbera, G. ∙ Liang, B. ∙ Zhang, L. ... Spatially Compact Neural Clusters in the Dorsal Striatum Encode Locomotion Relevant Information Neuron. 2016; 92 :202-213 Full Text Full Text (PDF) Scopus (121) PubMed Google Scholar ; Kasanetz et al., 2008 56. Kasanetz, F. ∙ Riquelme, L.A. ∙ Della-Maggiore, V. ... Functional integration across a gradient of corticostriatal channels controls UP state transitions in the dorsal striatum Proc. Natl. Acad. Sci. USA. 2008; 105 :8124-8129 Crossref Scopus (0) PubMed Google Scholar ; Klaus et al., 2017 60. Klaus, A. ∙ Martins, G.J. ∙ Paixao, V.B. ... The Spatiotemporal Organization of the Striatum Encodes Action Space Neuron. 2017; 96 :949 Full Text Full Text (PDF) Scopus (13) PubMed Google Scholar ; Parker et al., 2018 92. Parker, J.G. ∙ Marshall, J.D. ∙ Ahanonu, B. ... Diametric neural ensemble dynamics in parkinsonian and dyskinetic states Nature. 2018; 557 :177-182 Crossref Scopus (89) PubMed Google Scholar ; Piray et al., 2017 95. Piray, P. ∙ den Ouden, H.E.M. ∙ van der Schaaf, M.E. ... Dopaminergic Modulation of the Functional Ventrodorsal Architecture of the Human Striatum Cereb. Cortex. 2017; 27 :485-495 PubMed Google Scholar ; Shin et al., 2020 106. Shin, J.H. ∙ Song, M. ∙ Paik, S.-B. ... Spatial organization of functional clusters representing reward and movement information in the striatal direct and indirect pathways Proc. Natl. Acad. Sci. USA. 2020; 117 :27004-27015 Crossref Scopus (0) PubMed Google Scholar ), and graded specialization for action-outcome learning on the ML axis ( Balleine and O’Doherty, 2010 5. Balleine, B.W. ∙ O’Doherty, J.P. Human and rodent homologies in action control: corticostriatal determinants of goal-directed and habitual action Neuropsychopharmacology. 2010; 35 :48-69 Crossref Scopus (1022) PubMed Google Scholar ; Graybiel, 2008 39. Graybiel, A.M. Habits, rituals, and the evaluative brain Annu. Rev. Neurosci. 2008; 31 :359-387 Crossref Scopus (1004) PubMed Google Scholar ; Kim and Hikosaka, 2015 57. Kim, H.F. ∙ Hikosaka, O. Parallel basal ganglia circuits for voluntary and automatic behaviour to reach rewards Brain. 2015; 138 :1776-1800 Crossref PubMed Google Scholar ; Parent and Hazrati, 1995 91. Parent, A. ∙ Hazrati, L.N. Functional anatomy of the basal ganglia. I. The cortico-basal ganglia-thalamo-cortical loop Brain Res. Brain Res. Rev. 1995; 20 :91-127 Crossref Scopus (1701) PubMed Google Scholar ; Thorn et al., 2010 114. Thorn, C.A. ∙ Atallah, H. ∙ Howe, M. ... Differential dynamics of activity changes in dorsolateral and dorsomedial striatal loops during learning Neuron. 2010; 66 :781-795 Full Text Full Text (PDF) Scopus (223) PubMed Google Scholar ; Yin and Knowlton, 2006 119. Yin, H.H. ∙ Knowlton, B.J. The role of the basal ganglia in habit formation Nat. Rev. Neurosci. 2006; 7 :464-476 Crossref Scopus (1412) PubMed Google Scholar ). Testing this possibility required task conditions wherein agency is dynamically manipulated in the same session. We thus trained a separate cohort of mice in a serial reversal task with changing reward contingencies across “instrumental” and “Pavlovian” blocks lasting 25–35 trials each ( Figure 4 A). Mice experienced multiple unsignaled reversals in the same session, requiring continuous learning about agency. We predicted that reward-epoch DA trajectories should (1) reverse directions after block transitions; and (2) predict the animal’s future behavioral adjustments, with ML waves signaling agency and increase future running.
Trained mice completed an average of 6.4 ± 0.3 reversals across 210 ± 10 trials per session and dynamically adjusted their performance according to task contingencies. Specifically, mice completed instrumental blocks with a significantly higher run velocity and ramped down their velocity after they entered Pavlovian blocks ( Figures 4 B and 4C). Replicating our previous findings in a different cohort of mice, we observed robust DA waves following instrumental and Pavlovian trials at reward delivery ( Figures 4 D), with ML waves in instrumental trials and LM waves following Pavlovian trials ( Figures 4 E–4G). The wave reversals persisted across multiple block transitions ( Figure 4 H) for both axonal activation and DA release but were not observed in tdTomato frames ( Figure 4 I). The wave dynamics were not simply related to differences in motoric output or velocity: opponent wave directions were observed even when velocities were matched across tasks ( Figure 4 J). Moreover, in Pavlovian trials with elevated running velocity, wave directions were influenced by the locomotion-sensory congruence, defined as the correlation of wheel displacement and distance to reward in 250 ms bins. In particular, we found that spurious correlations between sensory evidence and (non-contingent) advance to reward in high-velocity Pavlovian trials promoted ML waves ( Figure 4 K), indicating that wave directions are shaped by spurious evidence for instrumental control. These results support our prediction that DS wave trajectories are sensitive to task demands across the two conditions.
While these results confirm that wave trajectories dynamically shift across task contingencies, they do not establish whether they are involved in future behavioral adjustments. We thus tested whether DA wave directions at reward predict future-trial running in a history-dependent manner. We found that past wave angles were related to next-trial running speed ( Figure 4 L) and significantly correlated with run velocity in successive trials ( Figure 4 M). Moreover, the effect of past wave directions on next-trial velocity had a history dependence, with more recent-trial DA wave directions demonstrating the largest velocity regression coefficients ( Figure 4 N), a pattern not observed in tdTomato frames. These results are reminiscent of the impact of reward history in canonical RL models and data ( Bayer and Glimcher, 2005 9. Bayer, H.M. ∙ Glimcher, P.W. Midbrain dopamine neurons encode a quantitative reward prediction error signal Neuron. 2005; 47 :129-141 Full Text Full Text (PDF) Scopus (769) PubMed Google Scholar ; Lau and Glimcher, 2005 63. Lau, B. ∙ Glimcher, P.W. Dynamic response-by-response models of matching behavior in rhesus monkeys J. Exp. Anal. Behav. 2005; 84 :555-579 Crossref Scopus (267) PubMed Google Scholar ; Sutton and Barto, 2018 112. Sutton, R.S. ∙ Barto, A.G. Reinforcement Learning MIT Press, 2018 Google Scholar ) and support our second prediction. Together, our observations support the conclusion that DA wave trajectories are sensitive to evidence for agency and deliver opponent DA responses that predict the animal’s behavioral adjustments according to task demands, manifested as adaptive running speed.
The above-mentioned data support general predictions about the role of opponent DA trajectories in instrumental learning by directing reward credit to (and away from) DMS regions specialized for agency. However, these findings do not reveal how the mouse and the DA system infer controllability. In our tasks, the animal must make the critical inference of whether it controls reward-predictive tone transitions and which specific contingency (i.e., distance to run to advance tones) applies in the current trial. Thus, for mice to learn about agency and dynamically adjust their behaviors, the trial-by-trial evidence for instrumental control should determine whether reward-evoked DA will strengthen action-outcome learning (i.e., favor the DMS). In other words, online evidence for agency prescribes wave direction that, in turn, promotes (or suppresses) instrumental performance in subsequent trials. To formalize this notion, we constructed a hierarchical multi-agent mixture of experts (MoE) model, building on earlier models of corticostriatal interactions in learning and action ( Doya et al., 2002 27. Doya, K. ∙ Samejima, K. ∙ Katagiri, K. ... Multiple model-based reinforcement learning Neural Comput. 2002; 14 :1347-1369 Crossref Scopus (279) PubMed Google Scholar ; Frank and Badre, 2012 32. Frank, M.J. ∙ Badre, D. Mechanisms of hierarchical reinforcement learning in corticostriatal circuits 1: computational analysis Cereb. Cortex. 2012; 22 :509-526 Crossref Scopus (164) PubMed Google Scholar ; Figures 5 A and S6 ). We first summarize the model’s components (see STAR Methods for details) before outlining and testing precise predictions related to DA dynamics and behavior.
At the highest layer (level 1) is an “expert,” putatively corresponding to DMS, that computes evidence that the agent is in control of outcomes (i.e., that its actions cause tone transitions and rewards). To do so, this expert must consider multiple potential action-outcome relationships, given the distribution of time/distance contingencies experienced in the task ( Figure 5 A). As such, the expert has access to multiple sub-experts within its domain (level 2), each specialized to represent different contingencies (e.g., the distance needed to run is short, medium, or long trials). The expert can recruit the sub-expert that best predicts the state transitions in the current trial (i.e., the one with the smallest RPEs, minimizing the Bellman error). Moreover, auditory tone transitions that occur earlier or later than predicted give rise to sub-expert RPEs (sRPEs; level 3). For example, during a short distance trial, the “short-distance” sub-expert experiences reduced sRPEs, whereas a “long-distance” sub-expert experiences large sRPEs at tone transitions that occur earlier than expected. At the end of a trial, reward credit is delivered to experts that are most predictive of state transitions, which will guide future model “running.” Finally, the agent will increase its speed only when the accumulated evidence is larger for agentic “distance” experts than non-agentic “time” experts.
This formulation allows an agent to learn and flexibly adapt behavior based on task contingencies ( Figure S6 ; Doya et al., 2002 27. Doya, K. ∙ Samejima, K. ∙ Katagiri, K. ... Multiple model-based reinforcement learning Neural Comput. 2002; 14 :1347-1369 Crossref Scopus (279) PubMed Google Scholar ; Frank and Badre, 2012 32. Frank, M.J. ∙ Badre, D. Mechanisms of hierarchical reinforcement learning in corticostriatal circuits 1: computational analysis Cereb. Cortex. 2012; 22 :509-526 Crossref Scopus (164) PubMed Google Scholar ) and expands the RL account of striatal DA such that it is informed by the inferred causal contributions of recipient subregions ( Chang et al., 2004 18. Chang, Y.-H. ∙ Ho, T. ∙ Kaelbling, L.P. All learning is Local: Multi-agent Learning in Global Reward Games Thrun, S. ∙ Saul, L.K. ∙ Schölkopf, B. (Editors) Advances in Neural Information Processing Systems 16 MIT Press, 2004; 807-814 Google Scholar ; Gershman et al., 2015 37. Gershman, S.J. ∙ Norman, K.A. ∙ Niv, Y. Discovering latent causes in reinforcement learning Curr. Opin. Behav. Sci. 2015; 5 :43-50 Crossref Scopus (54) Google Scholar ; O’Reilly and Frank, 2006 89. O’Reilly, R.C. ∙ Frank, M.J. Making working memory work: a computational model of learning in the prefrontal cortex and basal ganglia Neural Comput. 2006; 18 :283-328 Crossref Scopus (597) PubMed Google Scholar ; Russell and Zimdars, 2003 100. Russell, S.J. ∙ Zimdars, A. Q-decomposition for reinforcement learning agents Fawcett, T. ∙ Mishra, N. (Editors) Proceedings of the 20th International Conference on Machine Learning (ICML-03) 2003; 656-663 Google Scholar ). Thus, in contrast to previous global scalar DA accounts, our model provides a formal framework for adaptive DA signals that are spatiotemporally tailored to striatal subregions. Moreover, this architecture makes multi-level predictions about DA dynamics during the reward pursuit and outcome epochs ( Figures 5 B–5D and S6 ), potentially tying together the role of DA in performance and learning. We systematically test three key predictions from the model below.
If DA waves at reward guide spatiotemporal credit assignment, what determines which subregion should receive the credit? As noted above, the model contains a DMS-like “distance expert” that accumulates online evidence for agency in the form of ramping signals that are proportional to the accuracy of underlying subregions’ predictions ( Figure 5 B). Ramping DA signals during reward pursuit in the midbrain and ventral striatum has been described as scalar decision variables corresponding to RPEs ( Gershman, 2014 35. Gershman, S.J. Dopamine ramps are a consequence of reward prediction errors Neural Comput. 2014; 26 :467-471 Crossref Scopus (22) PubMed Google Scholar ; Lloyd and Dayan, 2015 69. Lloyd, K. ∙ Dayan, P. Tamping Ramping: Algorithmic, Implementational, and Computational Explanations of Phasic Dopamine Signals in the Accumbens PLoS Comput. Biol. 2015; 11 :e1004622 Crossref Scopus (21) PubMed Google Scholar ; Morita and Kato, 2014 84. Morita, K. ∙ Kato, A. Striatal dopamine ramping may indicate flexible reinforcement learning with forgetting in the cortico-basal ganglia circuits Front. Neural Circuits. 2014; 8 :36 PubMed Google Scholar ), value functions ( Hamid et al., 2016 44. Hamid, A.A. ∙ Pettibone, J.R. ∙ Mabrouk, O.S. ... Mesolimbic dopamine signals the value of work Nat. Neurosci. 2016; 19 :117-126 Crossref Scopus (308) PubMed Google Scholar ), or progress within a cognitive map ( Guru et al., 2020 42. Guru, A. ∙ Seo, C. ∙ Post, R.J. ... Ramping activity in midbrain dopamine neurons signifies the use of a cognitive map bioRxiv. 2020; Google Scholar ). Instead, we posit here that anticipatory DA ramps in a given DS subregion reflect the accuracy or usefulness of the underlying regions’ predictions about task contingency, thus providing a tag for how much reward-credit it should receive at outcome. Thus, our model predicts that anticipatory epoch DA dynamics also diverge across striatal subregions and task demands.
We tested this prediction by examining DA activity during anticipation as mice drew closer to reward. In the instrumental task, we observed a buildup of activity in the DMS ( Figures 6 A–6D), ramping in proportion to the progress to reward ( Hamid et al., 2016 44. Hamid, A.A. ∙ Pettibone, J.R. ∙ Mabrouk, O.S. ... Mesolimbic dopamine signals the value of work Nat. Neurosci. 2016; 19 :117-126 Crossref Scopus (308) PubMed Google Scholar ; Howe et al., 2013 51. Howe, M.W. ∙ Tierney, P.L. ∙ Sandberg, S.G. ... Prolonged dopamine signalling in striatum signals proximity and value of distant rewards Nature. 2013; 500 :575-579 Crossref Scopus (256) PubMed Google Scholar ). Strikingly, the opposite profile was observed in the Pavlovian condition with negative ramps even as mice drew closer to rewards ( Figures 6 B–6D). The opponent DMS ramp slopes were also observed in blockwise reversal sessions, with dLight and GCaMP6f ramps dynamically reversing after block change ( Figures 6 E–6G), but not in tdTomato frames ( Figure 6 G).
The opposite profile of anticipatory DA signals across the two task conditions is not explained by extant models of midbrain or accumbens DA ramps. Instead, we interpret DS DA ramp dynamics as reflecting the value of the underlying subregion’s agentic predictions, providing a marker for this region’s reward responsibility. In addition, because reward credit should be proportional to the accuracy of these agentic predictions, our interpretation ties together opponent anticipatory dynamics with the opponent reward waves. We specifically posited that if DA ramps relay the subregion’s reward-predictive accuracy, they would impact the subsequent timing of DA increases at reward, with regions assigned the most credit receiving the earliest DA bursts at reward. As such, trials with steepest ramp slopes (highest responsibility) should receive reward responses soonest (largest credit; Figure 6 H). Consistent with this interpretation, we observed that DMS ramp slopes were inversely correlated with the latency-to-peak fluorescence following reward for both task conditions ( Figures 6 I–6K). The negative relationship between DMS ramp slope and latency to reward peak was also observed in DA dynamics of contingency reversal sessions ( Figures 6 J and 6K; p < 10 −4 for both GCaMP6f and dLight sessions), but not in simultaneously captured tdTomato frames ( Figure 6 K). These findings indicate that anticipatory DA dynamics in DMS are modulated by instrumental contingency and predict regional reward responses, demonstrating a relationship between eligibility and reward credit.
Thus far, we have focused on the coarsest division of labor related to the highest level in our model (controllability, level 1), but the agent’s ability to infer control depends on underlying sub-experts that learn distinct action-outcome contingencies (level 2). Such a hierarchical scheme implies that within the DMS, smaller subregions should differentially express DA ramps for different distance contingencies. Indeed, we observed that DA ramp slopes were expressed across the ML axis of the striatum to different extents ( Figures 6 L and 6M). We next tested whether territories of the DS exhibit specialized ramp profiles for different distance conditions and found that contiguous striatal regions expressed steepest DA ramps for a preferred set of trials with related distance requirements ( Figures 6 N–6P and S7 A). We did not observe this regional contingency preference in simultaneously acquired tdTomato frames ( Figure 6 P). These results are consistent with previous studies on progressive instrumental specialization of DS on the ML axis ( Matamales et al., 2020 77. Matamales, M. ∙ McGovern, A.E. ∙ Mi, J.D. ... Local D2- to D1-neuron transmodulation updates goal-directed learning in the striatum Science. 2020; 367 :549-555 Crossref Scopus (14) PubMed Google Scholar ; Thorn et al., 2010 114. Thorn, C.A. ∙ Atallah, H. ∙ Howe, M. ... Differential dynamics of activity changes in dorsolateral and dorsomedial striatal loops during learning Neuron. 2010; 66 :781-795 Full Text Full Text (PDF) Scopus (223) PubMed Google Scholar ) and support our MoE interpretations that DMS consists of smaller subregions that learn and express predictions for a variety of potential instrumental contingencies.
At the smallest scale (level 3), the “evidence” for each sub-expert is accrued based on the degree to which they experience RPEs (sRPEs) at state transitions ( Figure 5 D). In the model, each auditory tone is represented as a unique state within a sub-expert’s semi-Markov process, and sRPEs arise at tone transitions that occur earlier (or later) than expected. Thus, evidence for a given sub-expert is signaled by the relative lack of sRPEs compared with other sub-experts. This account predicts that tone transitions would give rise to rapid DA deflections reflecting sRPEs and that these signals would be modulated by trial length and position of tone within a trial. Specifically, the model predicts that (1) sRPEs would be larger in shorter trials (because tone transitions are indicative of future reward arriving earlier than expected); and (2) within a given task contingency, tones arriving later in the trial would drive larger deflections than early-trial tones due to temporal discounting ( Figures 7 A and S7 ).
Supporting these predictions, we observed abrupt DA responses at tone changes in both widefield, one-photon ( Figure 7 B), and two-photon ( Figure 7 D) preparations. Specifically, individual pixels during widefield DA imaging responded to multiple tone changes and consistently accompanied the sensory indicators of progress to reward ( Figure 7 C). In contrast to these multi-tone responses in individual pixels of the widefield data ( Figures S7 B–S7E), we noted that DA axon segments in the two-photon condition reliably responded to single tone transitions ( Figure 7 E), and different portions of the imaged axon lattice tiled the full sequence of escalating tones ( Figures 7 I and S7 F). Next, we assessed whether these DA signals exhibited properties of sRPEs outlined above (i.e., trial length and position of tone in trial and not just sensory events or elapsed time; Figure 7 A). Indeed, tone-responsive GCaMP6f and dLight pixels in the widefield were significantly modulated by trial length, with larger responses in short-distance conditions ( Figures 7 F–7H). Moreover, these transients scale according to the position of the tone transitions within a trial, a result not observed in the control frames ( Figure 7 H). The DA axon responses in the two-photon condition were also modulated by trial distance contingency and tone position in trial ( Figures 7 J and 7K). Together, these observations indicate that sRPEs are represented in rapid DA responses at state transitions during anticipatory epoch, consistent with our model predictions.

Section: Discussion

Our observations provide evidence for a spatiotemporal organizing principle of striatal DA signals and their behavioral relevance. Wave-like DA activation patterns were expressed as directional motifs that regulated the relative timing of regional DA changes and served to correlate DA in functionally related striatal territories. We reasoned that the computational significance of these waves in RL might be to assign spatiotemporal credit to striatal subregions differentially. Indeed, temporal delays on a similar timescale to those induced by DA waves are reported to constrain corticostriatal plasticity in vitro ( Yagishita et al., 2014 118. Yagishita, S. ∙ Hayashi-Takagi, A. ∙ Ellis-Davies, G.C.R. ... A critical time window for dopamine actions on the structural plasticity of dendritic spines Science. 2014; 345 :1616-1620 Crossref Scopus (254) PubMed Google Scholar ). Our TD simulations show that such temporal lags in reinforcement signals can drive spatially asymmetric reward learning and credit assignment. Thus, as hierarchically recruited striatal subregions exhibit graded functional specialization ( Hooks et al., 2018 49. Hooks, B.M. ∙ Papale, A.E. ∙ Paletzki, R.F. ... Topographic precision in sensory and motor corticostriatal projections varies across cell type and cortical area Nat. Commun. 2018; 9 :3549 Crossref Scopus (37) PubMed Google Scholar ; Kasanetz et al., 2008 56. Kasanetz, F. ∙ Riquelme, L.A. ∙ Della-Maggiore, V. ... Functional integration across a gradient of corticostriatal channels controls UP state transitions in the dorsal striatum Proc. Natl. Acad. Sci. USA. 2008; 105 :8124-8129 Crossref Scopus (0) PubMed Google Scholar ; Klaus et al., 2017 60. Klaus, A. ∙ Martins, G.J. ∙ Paixao, V.B. ... The Spatiotemporal Organization of the Striatum Encodes Action Space Neuron. 2017; 96 :949 Full Text Full Text (PDF) Scopus (13) PubMed Google Scholar ; Piray et al., 2017 95. Piray, P. ∙ den Ouden, H.E.M. ∙ van der Schaaf, M.E. ... Dopaminergic Modulation of the Functional Ventrodorsal Architecture of the Human Striatum Cereb. Cortex. 2017; 27 :485-495 PubMed Google Scholar ; Thorn et al., 2010 114. Thorn, C.A. ∙ Atallah, H. ∙ Howe, M. ... Differential dynamics of activity changes in dorsolateral and dorsomedial striatal loops during learning Neuron. 2010; 66 :781-795 Full Text Full Text (PDF) Scopus (223) PubMed Google Scholar ), DA waves may serve to regulate plasticity in postsynaptic domains with diverse functional specialization.
We tested this hypothesis according to the documented specialty of DMS in action-outcome learning and goal-directed behaviors. Our tasks manipulated reward controllability, requiring mice to dynamically learn about agency. Consistent with our hypothesis that DMS DA dynamics would be tailored to task demands, we found that reward delivery triggered DA waves in opponent directions based on task contingency. ML waves that produce rapid DMS DA peaks were enriched in instrumental trials, whereas LM waves were prevalent following non-contingent Pavlovian trials. Notably, these wave directions reversed within a few trials after task reversal and predicted future-trial behavioral adjustments with history-dependent effects in line with reinforcement learning. Together, our studies provide evidence for the role of spatiotemporal propagation of DA in agency learning by codifying the relative timing of a corticostriatal plasticity modulator.
The MoE model served to formalize our empirical observations, building on hierarchical neural network models of corticostriatal interactions ( Collins and Frank, 2013 20. Collins, A.G.E. ∙ Frank, M.J. Cognitive control over learning: creating, clustering, and generalizing task-set structure Psychol. Rev. 2013; 120 :190-229 Crossref Scopus (162) PubMed Google Scholar ; Frank and Badre, 2012 32. Frank, M.J. ∙ Badre, D. Mechanisms of hierarchical reinforcement learning in corticostriatal circuits 1: computational analysis Cereb. Cortex. 2012; 22 :509-526 Crossref Scopus (164) PubMed Google Scholar ; O’Reilly and Frank, 2006 89. O’Reilly, R.C. ∙ Frank, M.J. Making working memory work: a computational model of learning in the prefrontal cortex and basal ganglia Neural Comput. 2006; 18 :283-328 Crossref Scopus (597) PubMed Google Scholar ). The model captures regional reward credit assignment in functionally specialized cortico-basal ganglia (BG) loops, inspired by previous anatomical and functional reports ( Aoki et al., 2019 3. Aoki, S. ∙ Smith, J.B. ∙ Li, H. ... An open cortico-basal ganglia loop allows limbic control over motor output via the nigrothalamic pathway eLife. 2019; 8 :e49995 Crossref Scopus (17) PubMed Google Scholar ; Barbera et al., 2016 8. Barbera, G. ∙ Liang, B. ∙ Zhang, L. ... Spatially Compact Neural Clusters in the Dorsal Striatum Encode Locomotion Relevant Information Neuron. 2016; 92 :202-213 Full Text Full Text (PDF) Scopus (121) PubMed Google Scholar ; Haber, 2003 43. Haber, S.N. The primate basal ganglia: parallel and integrative networks J. Chem. Neuroanat. 2003; 26 :317-330 Crossref Scopus (1029) PubMed Google Scholar ; Hintiryan et al., 2016 46. Hintiryan, H. ∙ Foster, N.N. ∙ Bowman, I. ... The mouse cortico-striatal projectome Nat. Neurosci. 2016; 19 :1100-1114 Crossref Scopus (240) PubMed Google Scholar ; Hunnicutt et al., 2016 52. Hunnicutt, B.J. ∙ Jongbloets, B.C. ∙ Birdsong, W.T. ... A comprehensive excitatory input map of the striatum reveals novel functional organization eLife. 2016; 5 :e19103 Crossref Scopus (162) PubMed Google Scholar ; Klaus et al., 2017 60. Klaus, A. ∙ Martins, G.J. ∙ Paixao, V.B. ... The Spatiotemporal Organization of the Striatum Encodes Action Space Neuron. 2017; 96 :949 Full Text Full Text (PDF) Scopus (13) PubMed Google Scholar ; Lee et al., 2020 64. Lee, J. ∙ Wang, W. ∙ Sabatini, B.L. Anatomically segregated basal ganglia pathways allow parallel behavioral modulation Nat. Neurosci. 2020; 23 :1388-1398 Crossref Scopus (0) PubMed Google Scholar ; Mandelbaum et al., 2019 74. Mandelbaum, G. ∙ Taranda, J. ∙ Haynes, T.M. ... Distinct Cortical-Thalamic-Striatal Circuits through the Parafascicular Nucleus Neuron. 2019; 102 :636-652.e7 Full Text Full Text (PDF) Scopus (35) PubMed Google Scholar ; Marquand et al., 2017 75. Marquand, A.F. ∙ Haak, K.V. ∙ Beckmann, C.F. Functional corticostriatal connection topographies predict goal directed behaviour in humans Nat. Hum. Behav. 2017; 1 :0146 Crossref Scopus (53) PubMed Google Scholar ; Märtin et al., 2019 76. Märtin, A. ∙ Calvigioni, D. ∙ Tzortzi, O. ... A Spatiomolecular Map of the Striatum Cell Rep. 2019; 29 :4320-4333.e5 Full Text Full Text (PDF) Scopus (22) PubMed Google Scholar ; Matamales et al., 2020 77. Matamales, M. ∙ McGovern, A.E. ∙ Mi, J.D. ... Local D2- to D1-neuron transmodulation updates goal-directed learning in the striatum Science. 2020; 367 :549-555 Crossref Scopus (14) PubMed Google Scholar ; Parker et al., 2018 92. Parker, J.G. ∙ Marshall, J.D. ∙ Ahanonu, B. ... Diametric neural ensemble dynamics in parkinsonian and dyskinetic states Nature. 2018; 557 :177-182 Crossref Scopus (89) PubMed Google Scholar ; Shin et al., 2020 106. Shin, J.H. ∙ Song, M. ∙ Paik, S.-B. ... Spatial organization of functional clusters representing reward and movement information in the striatal direct and indirect pathways Proc. Natl. Acad. Sci. USA. 2020; 117 :27004-27015 Crossref Scopus (0) PubMed Google Scholar ; Stanley et al., 2020 111. Stanley, G. ∙ Gokce, O. ∙ Malenka, R.C. ... Continuous and Discrete Neuron Types of the Adult Murine Striatum Neuron. 2020; 105 :688-699.e8 Full Text Full Text (PDF) Scopus (19) PubMed Google Scholar ; Tanaka et al., 2004 113. Tanaka, S.C. ∙ Doya, K. ∙ Okada, G. ... Prediction of immediate and future rewards differentially recruits cortico-basal ganglia loops Nat. Neurosci. 2004; 7 :887-893 Crossref Scopus (574) PubMed Google Scholar ; Thorn et al., 2010 114. Thorn, C.A. ∙ Atallah, H. ∙ Howe, M. ... Differential dynamics of activity changes in dorsolateral and dorsomedial striatal loops during learning Neuron. 2010; 66 :781-795 Full Text Full Text (PDF) Scopus (223) PubMed Google Scholar ). In the MoE, evidence for instrumental controllability was accrued in the form of ramps to the DMS expert. In particular, as a trial progressed, sub-experts experienced prediction errors (sRPEs) when sensory events did not align as expected based on their specialization. Conversely, congruence between actions and predicted outcomes for a given sub-expert led to progressive ramps signaling their prediction accuracy and responsibility for impending rewards. In turn, these anticipatory ramps in the model will bias reward credit to “distance” experts to increase the agent’s motoric output during the instrumental task but reduced running in the Pavlovian task.
Consistent with the MoE account, we reported anticipatory epoch DA ramping dynamics within large DMS regions that reversed directions between task conditions. Additional specialization was observed for distinct contingencies within smaller striatal subregions in the two tasks, consistent with sub-experts. We reasoned that these dynamics may serve a dual purpose. First, they could promote online behavioral vigor flexibility according to the inferred task contingencies in the current trial. Second, these ramps could also signal which subregions were best predictive of reward outcomes, providing a tag for their responsibility (akin to an eligibility trace in RL; Singh and Sutton, 1996 109. Singh, S.P. ∙ Sutton, R.S. Reinforcement Learning with Replacing Eligibility Traces Mach. Learn. 1996; 22 :123-158 Crossref Scopus (345) Google Scholar ). Such a tag would allow RPEs to preferentially credit the appropriate subregion and the eligible MSNs within it. While the two functions are not mutually exclusive, our data provide strong support for the second interpretation: On a trial-by-trial basis, the degree of ramping in a given subregion was predictive of the latency to reward peak elicited by the wave. Moreover, the ramp slope and wave direction were predictive of subsequent-trial behavioral adjustments in line with the credit assignment implemented in the MoE. These findings accord with views that DA signals can have different functions during reward pursuit and outcome that can be gated by local microcircuit elements that regulate plasticity windows ( Berke, 2018 10. Berke, J.D. What does dopamine mean? Nat. Neurosci. 2018; 21 :787-793 Crossref Scopus (204) PubMed Google Scholar ; Bradfield et al., 2013 12. Bradfield, L.A. ∙ Bertran-Gonzalez, J. ∙ Chieng, B. ... The thalamostriatal pathway and cholinergic control of goal-directed action: interlacing new with existing learning in the striatum Neuron. 2013; 79 :153-166 Full Text Full Text (PDF) Scopus (156) PubMed Google Scholar ; Franklin and Frank, 2015 33. Franklin, N.T. ∙ Frank, M.J. A cholinergic feedback circuit to regulate striatal population uncertainty and optimize reinforcement learning eLife. 2015; 4 :e12029 Crossref Scopus (0) PubMed Google Scholar ; Morris et al., 2004 85. Morris, G. ∙ Arkadir, D. ∙ Nevet, A. ... Coincident but distinct messages of midbrain dopamine and striatal tonically active neurons Neuron. 2004; 43 :133-143 Full Text Full Text (PDF) Scopus (388) PubMed Google Scholar ; Threlfell et al., 2012 115. Threlfell, S. ∙ Lalic, T. ∙ Platt, N.J. ... Striatal dopamine release is triggered by synchronized activity in cholinergic interneurons Neuron. 2012; 75 :58-64 Full Text Full Text (PDF) Scopus (434) PubMed Google Scholar ).
Further supporting the MoE organization, we also reported localized, transient RPEs that signaled changes in sensory events. These local transients exhibited key properties consistent with sRPEs according to our TD RL simulations: they were increasingly larger as trials progressed, and when task contingencies required shorter rather than longer distance running. We interpret these sRPEs as a mechanism by which sub-experts can report when they fail to predict the current task state. By comparing these errors across multiple actors, the system can accrue evidence for the most accurate expert (in the form of ramps). Notably, this interpretation hints at a different role for sRPEs (facilitating inference about responsible actors) compared with the large RPEs following reward itself (facilitating reinforcement learning): a dual operation that can also be gated ( Franklin and Frank, 2015 33. Franklin, N.T. ∙ Frank, M.J. A cholinergic feedback circuit to regulate striatal population uncertainty and optimize reinforcement learning eLife. 2015; 4 :e12029 Crossref Scopus (0) PubMed Google Scholar ; Gershman et al., 2015 37. Gershman, S.J. ∙ Norman, K.A. ∙ Niv, Y. Discovering latent causes in reinforcement learning Curr. Opin. Behav. Sci. 2015; 5 :43-50 Crossref Scopus (54) Google Scholar ; Redish et al., 2007 98. Redish, A.D. ∙ Jensen, S. ∙ Johnson, A. ... Reconciling reinforcement learning models with behavioral extinction and renewal: implications for addiction, relapse, and problem gambling Psychol. Rev. 2007; 114 :784-805 Crossref Scopus (197) PubMed Google Scholar ; Schoenbaum et al., 2013 101. Schoenbaum, G. ∙ Stalnaker, T.A. ∙ Niv, Y. How did the chicken cross the road? With her striatal cholinergic interneurons, of course Neuron. 2013; 79 :3-6 Full Text Full Text (PDF) Scopus (0) PubMed Google Scholar ). Put together, the synthesis of our data and computational simulations imply that DA signals are spatiotemporally vectorized during both epochs, tailored to the underlying region’s computational specialty.
Circuit mechanisms that facilitate the spatiotemporal coordination of striatal DA activity remain critical gaps in our understanding DA signaling. One hypothesis motivated by the excitation-release coupling principle in neurobiology would suggest that DA waves may be inherited from the sequential firing of topographically projecting midbrain DA cells ( Lerner et al., 2015 65. Lerner, T.N. ∙ Shilyansky, C. ∙ Davidson, T.J. ... Intact-Brain Analyses Reveal Distinct Information Carried by SNc Dopamine Subcircuits Cell. 2015; 162 :635-647 Full Text Full Text (PDF) Scopus (299) PubMed Google Scholar ). Previous reports of spiking in DA cell pairs report highly synchronized responses that inspired prevailing views for global DA release in recipient regions ( Eshel et al., 2016 30. Eshel, N. ∙ Tian, J. ∙ Bukwich, M. ... Dopamine neurons share common response function for reward prediction error Nat. Neurosci. 2016; 19 :479-486 Crossref PubMed Google Scholar ; Glimcher, 2011 38. Glimcher, P.W. Understanding dopamine and reinforcement learning: the dopamine reward prediction error hypothesis Proc. Natl. Acad. Sci. USA. 2011; 108 :15647-15654 Crossref Scopus (412) PubMed Google Scholar ; Kim et al., 2020 59. Kim, H.R. ∙ Malik, A.N. ∙ Mikhael, J.G. ... A Unified Framework for Dopamine Signals across Timescales Cell. 2020; 183 :1600-1616.e25 Full Text Full Text (PDF) Scopus (10) PubMed Google Scholar ; Schultz, 1998 102. Schultz, W. Predictive reward signal of dopamine neurons J. Neurophysiol. 1998; 80 :1-27 Crossref Scopus (3009) PubMed Google Scholar ). Indeed, we did observe such synchronized DA events across DS, so our findings do not directly refute these hypotheses, but expand our understanding of DA signaling to additional, spatiotemporally complex activation trajectories with functional consequences. Nonetheless, population-level synchrony in midbrain DA cells and their relationship to DA waves remain open questions as limited studies have assessed the simultaneous firing of large populations (many hundreds/thousands) of projection-defined DA neurons ( Engelhard et al., 2019 29. Engelhard, B. ∙ Finkelstein, J. ∙ Cox, J. ... Specialized coding of sensory, motor and cognitive variables in VTA dopamine neurons Nature. 2019; 570 :509-513 Crossref Scopus (86) PubMed Google Scholar ; da Silva et al., 2018 23. da Silva, J.A. ∙ Tecuapetla, F. ∙ Paixão, V. ... Dopamine neuron activity before action initiation gates and invigorates future movements Nature. 2018; 554 :244-248 Crossref Scopus (154) PubMed Google Scholar ). Moreover, the extent to which midbrain-initiated action potentials can fully propagate through an entire DA axon arbor in the face of energetic costs ( Pissadaki and Bolam, 2013 96. Pissadaki, E.K. ∙ Bolam, J.P. The energy cost of action potential propagation in dopamine neurons: clues to susceptibility in Parkinson’s disease Front. Comput. Neurosci. 2013; 7 :13 Crossref Scopus (150) PubMed Google Scholar ) and GABA shunt currents ( Brodnik et al., 2019 13. Brodnik, Z.D. ∙ Batra, A. ∙ Oleson, E.B. ... Local GABA A Receptor-Mediated Suppression of Dopamine Release within the Nucleus Accumbens ACS Chem. Neurosci. 2019; 10 :1978-1985 Crossref Scopus (8) PubMed Google Scholar ; Kramer et al., 2020 62. Kramer, P.F. ∙ Twedell, E.L. ∙ Shin, J.H. ... Axonal mechanisms mediating γ-aminobutyric acid receptor type A (GABA-A) inhibition of striatal dopamine release eLife. 2020; 9 :e55729 Crossref PubMed Google Scholar ; Lopes et al., 2019 70. Lopes, E.F. ∙ Roberts, B.M. ∙ Siddorn, R.E. ... Inhibition of Nigrostriatal Dopamine Release by Striatal GABA A and GABA B Receptors J. Neurosci. 2019; 39 :1058-1065 Crossref Scopus (16) PubMed Google Scholar ) remains unknown. Future studies into details of the functional anatomy and spike propagation principles in DA cells may uncover previously unappreciated axonal specializations or patterns of sequential recruitment in the midbrain cell bodies.
Another likely mechanism for DA waves may involve local modulation of DA axons and release in the striatum. Notably, striatal DA release can be evoked by cholinergic interneurons ( Cachope et al., 2012 17. Cachope, R. ∙ Mateo, Y. ∙ Mathur, B.N. ... Selective activation of cholinergic interneurons enhances accumbal phasic dopamine release: setting the tone for reward processing Cell Rep. 2012; 2 :33-41 Full Text Full Text (PDF) Scopus (271) PubMed Google Scholar ; Liu et al., 2018 68. Liu, C. ∙ Kershberg, L. ∙ Wang, J. ... Dopamine Secretion Is Mediated by Sparse Active Zone-like Release Sites Cell. 2018; 172 :706-718.e15 Full Text Full Text (PDF) Scopus (69) PubMed Google Scholar ; Threlfell et al., 2012 115. Threlfell, S. ∙ Lalic, T. ∙ Platt, N.J. ... Striatal dopamine release is triggered by synchronized activity in cholinergic interneurons Neuron. 2012; 75 :58-64 Full Text Full Text (PDF) Scopus (434) PubMed Google Scholar ) that can relay cortical or thalamic glutaminergic drive ( Adrover et al., 2020 1. Adrover, M.F. ∙ Shin, J.H. ∙ Quiroz, C. ... Prefrontal cortex driven dopamine signals in the striatum show unique spatial and pharmacological properties J. Neurosci. 2020; 40 :7510-7522 Crossref Scopus (2) PubMed Google Scholar ; Kosillo et al., 2016 61. Kosillo, P. ∙ Zhang, Y.-F. ∙ Threlfell, S. ... Cortical Control of Striatal Dopamine Transmission via Striatal Cholinergic Interneurons Cereb. Cortex. 2016; 26 :4160-4169 Crossref Scopus (71) PubMed Google Scholar ; Mandelbaum et al., 2019 74. Mandelbaum, G. ∙ Taranda, J. ∙ Haynes, T.M. ... Distinct Cortical-Thalamic-Striatal Circuits through the Parafascicular Nucleus Neuron. 2019; 102 :636-652.e7 Full Text Full Text (PDF) Scopus (35) PubMed Google Scholar ). Wave-like, spatiotemporal activation patterns have been reported in the neocortex ( Kasanetz et al., 2008 56. Kasanetz, F. ∙ Riquelme, L.A. ∙ Della-Maggiore, V. ... Functional integration across a gradient of corticostriatal channels controls UP state transitions in the dorsal striatum Proc. Natl. Acad. Sci. USA. 2008; 105 :8124-8129 Crossref Scopus (0) PubMed Google Scholar ; Mohajerani et al., 2013 81. Mohajerani, M.H. ∙ Chan, A.W. ∙ Mohsenvand, M. ... Spontaneous cortical activity alternates between motifs defined by regional axonal projections Nat. Neurosci. 2013; 16 :1426-1435 Crossref Scopus (193) PubMed Google Scholar ) and striatal cholinergic interneurons ( Rehani et al., 2019 99. Rehani, R. ∙ Atamna, Y. ∙ Tiroshi, L. ... Activity Patterns in the Neuropil of Striatal Cholinergic Interneurons in Freely Moving Mice Represent Their Collective Spiking Dynamics eNeuro. 2019; 6 ENEURO.0351-18.2018 Crossref Scopus (7) PubMed Google Scholar ). Thus, local striatal microcircuitry (including GABAergic interactions; Holly et al., 2020 48. Holly, E.N. ∙ Felicia Davatolhagh, M. ∙ España, R.A. ... Striatal low-threshold spiking interneurons locally gate dopamine during learning BioRxiv. 2020; Crossref Scopus (0) Google Scholar ; Kramer et al., 2020 62. Kramer, P.F. ∙ Twedell, E.L. ∙ Shin, J.H. ... Axonal mechanisms mediating γ-aminobutyric acid receptor type A (GABA-A) inhibition of striatal dopamine release eLife. 2020; 9 :e55729 Crossref PubMed Google Scholar ) may regulate regional DA dynamics. Moreover, DA waves at reward outcome may also be a consequence of the interaction between primed excitability of DA axons during the anticipatory epoch and midbrain-sourced synchronous reward bursts. Combining these spatiotemporal profiles may produce sequential DA activation at reward that propagates across the striatum in proportion to the ramps during anticipation. Therefore, how the spatiotemporal dynamics of glutamatergic and cholinergic activity interact with DA axons ( Adrover et al., 2020 1. Adrover, M.F. ∙ Shin, J.H. ∙ Quiroz, C. ... Prefrontal cortex driven dopamine signals in the striatum show unique spatial and pharmacological properties J. Neurosci. 2020; 40 :7510-7522 Crossref Scopus (2) PubMed Google Scholar ) to regulate regional DA during various behavioral epochs are intriguing lines of inquiry for future investigations.
Although DMS DA in our report supports the computations of the “distance” expert in the MoE, a limitation of our study is that we did not identify or assess the DA dynamics with properties of the “time” expert in the DS. Many studies investigating RPEs involve classical conditioning in which temporal representations are evident in the midbrain ( Pan et al., 2005 90. Pan, W.-X. ∙ Schmidt, R. ∙ Wickens, J.R. ... Dopamine cells respond to predicted events during classical conditioning: evidence for eligibility traces in the reward-learning network J. Neurosci. 2005; 25 :6235-6242 Crossref Scopus (313) PubMed Google Scholar ; Hollerman and Schultz, 1998 47. Hollerman, J.R. ∙ Schultz, W. Dopamine neurons report an error in the temporal prediction of reward during learning Nat. Neurosci. 1998; 1 :304-309 Crossref PubMed Google Scholar ; Soares et al., 2016 110. Soares, S. ∙ Atallah, B.V. ∙ Paton, J.J. Midbrain dopamine neurons control judgment of time Science. 2016; 354 :1273-1277 Crossref Scopus (116) PubMed Google Scholar ), and ramping signals related to timing may be present in other regions upstream of the DA system ( Brown et al., 1999 14. Brown, J. ∙ Bullock, D. ∙ Grossberg, S. How the basal ganglia use parallel excitatory and inhibitory learning pathways to selectively respond to unexpected rewarding cues J. Neurosci. 1999; 19 :10502-10511 Crossref PubMed Google Scholar ; Hazy et al., 2010 45. Hazy, T.E. ∙ Frank, M.J. ∙ O’Reilly, R.C. Neural mechanisms of acquired phasic dopamine responses in learning Neurosci. Biobehav. Rev. 2010; 34 :701-720 Crossref Scopus (70) PubMed Google Scholar ; Mello et al., 2015 79. Mello, G.B.M. ∙ Soares, S. ∙ Paton, J.J. A scalable population code for time in the striatum Curr. Biol. 2015; 25 :1113-1122 Full Text Full Text (PDF) Scopus (158) PubMed Google Scholar ). Nonetheless, even without a time expert per se, our MoE would behave similarly with a single DMS expert that simply evaluates the evidence for agency relative to some prior expectation about control. Moreover, while we make the case for how spatiotemporally coordinated DA responses may be involved in reward learning, an additional limitation of our study is that we did not deduce the mechanistic origin of DA waves. We have discussed multiple candidate mechanisms above.

Section: STAR★Methods

REAGENT or RESOURCE SOURCE IDENTIFIER Bacterial and virus strains AAV-syn-Flex-GCaMP6f Chen et al., 2013 19. Chen, T.-W. ∙ Wardill, T.J. ∙ Sun, Y. ... Ultrasensitive fluorescent proteins for imaging neuronal activity Nature. 2013; 499 :295-300 Crossref Scopus (2871) PubMed Google Scholar Addgene Cat# 100833 AAV-syn-Flex-jRGECO1a Dana et al., 2016 25. Dana, H. ∙ Mohar, B. ∙ Sun, Y. ... Sensitive red protein calcium indicators for imaging neural activity eLife. 2016; 5 :e12727 Crossref Scopus (384) PubMed Google Scholar Addgene Cat# 100853 AAV-syn-Flex- tdTomato Ed Boyden Addgene Cat# 62723 AAV-syn-DIO-EGFP Bryan Roth Addgene Cat# 50457 AAV-hsyn-dLight1.2 Patriarchi et al., 2018 93. Patriarchi, T. ∙ Cho, J.R. ∙ Merten, K. ... Ultrafast neuronal imaging of dopamine dynamics with designed genetically encoded sensors Science. 2018; 360 :360 Crossref Scopus (210) PubMed Google Scholar Addgene Cat# 111068 Experimental models: organisms/strains Mouse: Slc6a3 tm1(cre)Xz /J The Jackson Laboratory Jax # 020080; RRID:IMSR_JAX:020080 Software and algorithms LABVIEW 2016 National Instruments https://www.ni.com/en-us.html MATLAB (2017b) Mathworks https://www.mathworks.com/ Open table in a new tab
Requests for further information or reagents should be directed to and will be fulfilled by the lead contact, Arif A. Hamid ( arifhamid.DA@gmail.com ).
This study did not generate new unique reagents.
All data and code is available from corresponding author(s) upon reasonable request.
We used 29 adult DAT-cre mice (Slc6a3 tm1(cre)Xz ;13 females, 16 males; 020080, Jackson Laboratories, RRID:IMSR_JAX:020080) that were group or single housed on a reversed 12hr cycle and all behavioral training and testing was performed during the dark phase. All mice were task naive before training according to procedures described below. All procedures were conducted in accordance with the guidelines of the NIH and approved by Brown University Institutional Animal Care and Use Committee.
To achieve selective expression of cre-dependent GCaMP6f (or jRGECO1a) in DA cells, we followed standard surgical procedures for stereotaxic injection of cre-dependent virus. Briefly, mice were anesthetized with isoflurane (2% induction and maintained at 0.75%–1.25% in 1 l/min oxygen). To attain widespread infection of DA cells throughout the midbrain, we drilled two burr holes above the midbrain (−3.2mm AP, 0.4mm and 1.0mm ML relative to bregma) and injected 0.1-0.2 μL of AAV-syn-Flex-GCaMP6f ( Chen et al., 2013 19. Chen, T.-W. ∙ Wardill, T.J. ∙ Sun, Y. ... Ultrasensitive fluorescent proteins for imaging neuronal activity Nature. 2013; 499 :295-300 Crossref Scopus (2871) PubMed Google Scholar ) (Addgene Cat#100833) or AAV-syn-Flex-jRGECO1a ( Dana et al., 2016 25. Dana, H. ∙ Mohar, B. ∙ Sun, Y. ... Sensitive red protein calcium indicators for imaging neural activity eLife. 2016; 5 :e12727 Crossref Scopus (384) PubMed Google Scholar ) (Addgene Cat#100853) at two depths per burr hole (3.8 and 4.2 mm relative to brain surface). A subset of mice also received inert fluorophores used as control frames injected into the midbrain using the same specifications (AAV-syn-Flex- tdTomato Addgene Cat#62723, or AAV-syn-DIO-EGFP Addgene Cat#50457). For intrastriatal injections of dLight1.2 sensor, we drilled three burr holes (0.5ML, 1.0 AP; 1.4ML, −1.0AP; and 2.3ML, 0AP) and injected 0.1-0.2 μL of AAV-hsyn-dLight1.2 ( Patriarchi et al., 2018 93. Patriarchi, T. ∙ Cho, J.R. ∙ Merten, K. ... Ultrafast neuronal imaging of dopamine dynamics with designed genetically encoded sensors Science. 2018; 360 :360 Crossref Scopus (210) PubMed Google Scholar ) (Addgene Cat#111068) per burr hole.
We next secured a metal head-post to the skull and implanted an imaging cannula over the ipsilateral dorsal striatum. The cannula is a custom fabricated stainless-steel cylinder (Microgroup; 3mm diameter and 2.5-3mm height) with a 3mm coverslip (CS-3R, Warner Instruments) glued at the bottom with optical adhesive (Norad Optical #71). To insert the cannula into the brain, a 3mm diameter craniotomy was first drilled over the striatum (at bregma, centered on 2.0mm ML), and then dura was gently removed followed by slow aspiration of the overlying cortex until white, colossal fibers were visible (~0.8-1.2mm from brain surface). These fibers were also gently aspirated layer by layer until the underlying dorsal striatal tissue was uniformly exposed. A sterile imaging cannula was progressively lowered until the coverslip contacted striatal tissue uniformly. Dental cement was applied to secure the implant to the skull, and mice were allowed to recover for 1-2 weeks with post-operative care.
For optic fiber grid experiments ( Figure S3 K), the implants were constructed in-house using 3mm long 0.2NA, 100um multi-mode optical fibers, after removal of coating and cladding (AFM100H, ThorLabs). Nine to sixteen fibers were arranged into a grid spanning the 3mm diameter area of the imaging cannula described above. This arrangement facilitated regularly-spaced sampling of the same striatal regions captured using the cannula. During surgical implantation, the fibers were slowly lowered into the brain (at a rate of 0.1 mm/min) without aspiration of the cortex and cemented at 1.3mm from the brain surface, terminating in the dorsal striatal subregion. DAT-cre mice received flex.GCaMP6f injection as described above during the same surgery and were also allowed to recover from surgery for 1-2 weeks before imaging commenced. Two additional mice received a drivable optic-fiber grid that was constructed in the same fashion (but with 5mm long fibers; Figure S3 R). During surgery, the fiber grid was inserted only 1mm ventral to the brain surface. Several days later, after imaging started, this fiber bundle was progressively lowered 50-100um/day to assess DA axon dynamics deep in the striatum.
Following full recovery from surgery, mice underwent 2-3 days of habituation in operant chambers outfitted with a 3D printed wheel (15 cm diameter), audio speakers, and a solenoid-gated liquid reward dispenser. After 1-3 days of acclimation, mice were water-restricted, receiving 1mL/day in addition to water earned during task performance. We used custom LabVIEW scripts to control operant boxes during training and testing in behavioral tasks. In the first stage of training, mice received non-contingent rewards delivered randomly (3-15 s apart, uniform distribution) for five consecutive days or until they reliably licked for the reward. DA dynamics during these epochs are reported in Figures 3 M and 3N and Video S4 . Next, training in the “Pavlovian” task began, wherein rewards were delivered after a variable delay from trial-start. The start of each trial is signaled by the onset of a 4.3kHz tone that continues to escalate in frequency in proportion to the fraction of trial completed ( Figure 3 B). We used nine different frequencies that were selected to minimize harmonic overlap; 4.3kHz, 6.2kHz, 8.3kHz, 10kHz, 12.4kHz, 14.1kHz, 16kHz,8.4kHz, 20kHz. Across trials, the duration to wait for reward is randomly drawn from a uniform distribution (4-8 s). At the end of a trial, the auditory sound is turned off, and the solenoid delivers 3 μL of water reward to a spout in front of the mouse. Licking behavior was detected using capacitive touch sensors (AT42QT1010, Sparkfun). In some catch trials, the initial 4.3kHz tone turned off after 0.5 s, and the mouse did not have continuous information of progress to reward. For clarity, we only focused on escalating-tone trials. The next trial started after a variable inter-trial-interval of 3-8 s. A few weeks later, the same animals were then further trained on a distance-variant of the same task, where reward delivery is contingent on mice running on the wheel (“instrumental” task). Mice were exposed to the instrumental task requiring them to run on the wheel to traverse linearized distances, which are also randomly selected from a uniform distribution (50-150cm). Progress to reward was indicated by the same tone frequencies, and the angular position of the wheel was recorded using a miniature rotary encoder (MA3A10250N, US Digital). For task-related DA signals reported in Figures 3 , 4 , 5 , 6 , and 7 , we imaged expert mice after 2-3 weeks of instrumental or Pavlovian task experience in a chamber equipped with a widefield and 2-photon imaging system.
A different cohort of mice was exposed to the within-session reversal of instrumental and Pavlovian task conditions (data presented in Figures 4 and 6 ). As in the previous group, naive mice were first acclimated to the chamber and received unpredicted rewards as described above before exposure to the reversal task. The training and testing chambers of reversal tasks were identical to the chamber described above, except for the presence of a 5.9 inch, 1080p monitor projecting a virtual corridor controlled via the same LABVIEW behavioral software ( Figure 4 A). The animals were, thus, provided with richer sensory feedback about trial progress that could be leveraged to infer agency: In addition to the tone transitions, an LCD screen projected the virtual corridor that advanced in proportion to percent-trial-completed in both trial-types (see Video S6 ). The virtual corridor contains visual landmarks that include striped walls and a back wall with circles indicating the reward location. The Pavlovian and instrumental trials in these sessions were administered identical (i.e., trial statistics and contingencies) to those described above in instrumental-only or Pavlovian-only sessions. Blocks of instrumental and Pavlovian trials switched every 25-35 trials. All behavioral data is digitized and stored to disc at 50Hz.
Imaging was performed using a multi-photon microscope with modular laser-scanning and light-microscopy designed by Bruker/Prairie Technologies. Two-photon microscopy was performed using a 20X air objective (Olympus) on the same imaging platform with a femtosecond pulsed TiSapphire laser source (MaiTai DeepSee, 980nm power measured at objective was 20-50mW) that was scanned across the sample using a resonant (x axis) and non-resonant (y axis) galvanometer scanning mirrors. Returning photons were collected through an imaging path onto multi-alkali PMTs (R3896, Hamamatsu), and recorded frames were online-averaged to achieve a sampling rate of 10-15Hz. Some of the widefield imaging experiments were performed using a full-spectrum LED illumination with FITC filter cassette for illumination at 470nm and detection centered at 530nm. Images were acquired using a CoolSnap ES2 CCD camera (global shutter, Photometrics) and synchronized with behavioral events through TTL triggers. These frames were acquired with a 4X objective (Olympus), 100ms exposure (10Hz), and 8X on-camera binning to achieve a sample resolution of 40 μm/pixel (unless indicated otherwise). Dual-color imaging was performed on a custom-assembled rig (see Figure S3 A). Briefly, red and green fluorophores were respectively excited using 20Hz interleaved pulse-trains of 530nm or 470nm LEDs (MINTF4 and M470F3, respectively, ThorLabs). The 530nm excitation beam was first filtered (MF565-24, ThorLabs) and directed to a Nikon 50mm f/1.2 objective using a 405/488/560 dichroic (Di01-R405/488/561/635/800-t1-25x36, Semrock), while the 470 excitation beam was filtered (FF01-470/22-25, Semrock), and combined using a 490nm long pass dichroic (DMLP490R, ThorLabs). The returning emission light was dual bandpass filtered at 520nm and 610nm (FF01-523/610-25, Semrock). Images were captured using the Andor Zyla camera with an external trigger and 24ms exposure for a net frame rate of 40Hz. This yielded an effective 20Hz single-channel acquisition of red- and green-channel frames, which were synchronized with behavioral events.
All images were processed with custom routines in MATLAB. Each session is preprocessed for image registration and alignment to behavioral events based on event triggers. Movement artifacts and image drift in the XY plane were corrected using rigid-body registration using a DFT-based method ( Guizar-Sicairos et al., 2008 41. Guizar-Sicairos, M. ∙ Thurman, S.T. ∙ Fienup, J.R. Efficient subpixel image registration algorithms Opt. Lett. 2008; 33 :156-158 Crossref Scopus (1085) PubMed Google Scholar ). To cluster the activity of DA axons, we used the K-means algorithm in MATLAB. To compute the robustness of clustering results, we used the adjusted rand-Index measure, which computes the similarity of two clusters based on the probability of member overlap (corrected for chance; 0 = random clusters, 1 = exact same membership). We characterized flow patterns in DA waves by adapting standard optical flow algorithms in machine vision that are validated for imaging of fluorescence signals ( Afrashteh et al., 2017 2. Afrashteh, N. ∙ Inayat, S. ∙ Mohsenvand, M. ... Optical-flow analysis toolbox for characterization of spatiotemporal dynamics in mesoscale optical imaging of brain activity Neuroimage. 2017; 153 :58-74 Crossref Scopus (18) PubMed Google Scholar ; Mohajerani et al., 2013 81. Mohajerani, M.H. ∙ Chan, A.W. ∙ Mohsenvand, M. ... Spontaneous cortical activity alternates between motifs defined by regional axonal projections Nat. Neurosci. 2013; 16 :1426-1435 Crossref Scopus (193) PubMed Google Scholar ; Townsend and Gong, 2018 116. Townsend, R.G. ∙ Gong, P. Detection and analysis of spatiotemporal patterns in brain activity PLoS Comput. Biol. 2018; 14 :e1006643 Crossref Scopus (16) PubMed Google Scholar ). Briefly, flow trajectories were computed for any two successive frames as a displacement of intensity across the pixels in time. This method allowed us to evaluate a pixel-by-pixel velocity vector field that summarizes the direction and strength of flow at each pixel. While there are multiple methods to achieve this calculation, we adapted a combined Global-Local (CGL) algorithm ( Bruhn et al., 2002 16. Bruhn, A. ∙ Weickert, J. ∙ Schnörr, C. Combining the Advantages of Local and Global Optic Flow Methods Van Gool, L. (Editor) Pattern Recognition Springer, 2002; 454-462 Crossref Scopus (43) Google Scholar ; Liu, 2009 67. Liu, C. Beyond pixels: exploring new representations and applications for motion analysis Massachusetts Institute of Technology, 2009 PhD thesis Google Scholar ) that combines the Lucas-Kanade and Horn-Schunck methods. The frame-by-frame vector fields calculated using the CGL method were further processed to extract sink and source locations and also flow trajectories across multiple frames ( Figure 2 B). Specifically, the frame-by-frame flow magnitude for each frame (or flow-velocity, with units of mm/second) is computed by averaging the length of vectors at each pixel. The locations of sinks or sources were estimated based on local vector orientations: i.e., sinks are points of inward flow, whereas sources are points of outward flow. We estimated the pixel-wise likelihood of sinks and sources by simply computing the divergence of the vector field in each frame (“ divergence” function in MATLAB). The flow trajectory across frames was calculated from vector fields using the “ stream3 ” function in MATLAB from seeded pixels (e.g., Figures 2 C and 3 M). To quantify how reward-wave trajectories changed with task exposure ( Figures 3 M and 3N), we evaluated the flow trajectory for each trial, initiated from manually defined source pixels (white dots in Figure 3 M), and computed the average Fréchet trajectory similarity measure ( Eiter and Mannila, 1994 28. Eiter, T. ∙ Mannila, H. Computing discrete Fréchet distance Citeseer, 1994 Google Scholar ) across sessions.
To determine if elementary propagation sequences structure DA dynamics, we used two complementary methods, as shown in Figures S2 F and S2G. In the first method, the frame-time-series was processed for extraction of spatial principal components using standard methods (e.g., ( Mukamel et al., 2009 86. Mukamel, E.A. ∙ Nimmerjahn, A. ∙ Schnitzer, M.J. Automated analysis of cellular signals from large-scale calcium imaging data Neuron. 2009; 63 :747-760 Full Text Full Text (PDF) Scopus (355) PubMed Google Scholar )), and the resulting spatial PCs were embedded into a two-dimensional tSNE projection using the MATLAB “ tSNE ” function. The various DA wave trajectories of interest were observed to consistently traverse portions of the low-dimensional manifold ( Video S4 ). To find the different DA waves, we clustered the low dimensional paths/trajectories ( Figure S2 F, far right) that were correlated with the motif waves described in Figures 2 L–2N. The second method for identifying motif waves followed procedures described in Mackevicius et al., 2019 ( Mackevicius et al., 2019 73. Mackevicius, E.L. ∙ Bahle, A.H. ∙ Williams, A.H. ... Unsupervised discovery of temporal sequences in high-dimensional datasets, with applications to neuroscience eLife. 2019; 8 :e38471 Crossref Scopus (21) PubMed Google Scholar ; Peter et al., 2017 94. Peter, S. ∙ Kirschbaum, E. ∙ Both, M. ... Sparse convolutional coding for neuronal assembly detection Guyon, I. ∙ Luxburg, U.V. ∙ Bengio, S. ... (Editors) Advances in Neural Information Processing Systems Curran Associates, 2017; 3675-3685 Google Scholar ) (seqNMF toolbox in MATLAB) for unsupervised discovery of temporal sequences using convolutional non-negative matrix factorization. Briefly, frame time-series were reshaped into pixel time-series and factored into a tensor of smaller N matrices, with specified L duration across all pixels P (P x L x N). The seqNMF methods reduced motif matrix (P x L) redundancy by including a spatiotemporal penalty. We used various parameter combinations and selected ƛ = 0.005, N = 6, L = 0.6 s as initial parameters to identify motif waves for GCaMP6f, dLight and jRGECO1a frames.
DA waves at reward were quantified in a one-second epoch after reward delivery unless explicitly stated. While most figures show the angular orientation of wave directions relative to the imaging field of view (i.e., keeping AP/ML consistent, e.g., Figures 2 H, 3 G, 3H, and 4 G), we also utilized a linearization of wave directions to specifically quantify the extent of medial or lateral directionality of DA reward waves. To achieve this, the frame vector angle is remeasured relative to the medially oriented vector (u = −1, v = 0) without regard to clockwise/counterclockwise directionality (e.g., Figures 3 I inset and 4 E insets). This yielded relative wave-angles that were small if oriented in the medial direction (i.e., LM waves) and larger relative-angles for laterally oriented wave direction (i.e., ML waves), as shown in Figure 4 E.
We quantified the online sensory evidence for reward controllability the animal gets as a ‘congruence’ measure, quantifying the relationship between locomotion and changes in the audiovisual experience of the mice. We computed congruence as the fraction of a trial with > 0.75 correlation coefficient between locomotion (wheel position) and fraction of trial completed, in nonoverlapping 250ms time intervals. This allowed us to identify trials that may produce an “illusion of control” in the Pavlovian condition with high velocities when congruence is high, despite the absence of instrumental contingency in the trial.
We performed a multiple linear regression to assess how strongly previous-trial wave directions relate to current-trial running ( Figure 4 N). We first z-scored session-wide past wave-angle and velocity regressors and performed multiple regression to predict current trial velocity. For fluorescence time series alignments, DMS and DLS masks were defined using one of three methods: i) manual drawing, ii) boundaries using cluster results (as in Figure 1 I), or iii) uniformly spaced ROIs on the mediolateral axis (as in Figure 6 L inset). We evaluated the correlation between ramp slope and latency-to-peak by first peak-normalizing the reward response in a 2 s window and finding the time point (after reward) for which the fluorescence signal reached peak levels. TIFF stacks of 2-photon images of DA axon segments were also pre-processed for registration and alignment with behavioral data. To draw ROIs of these segments for assessing organization of responses ( Figure S1 ), we followed Howe and Dombeck ( Howe and Dombeck, 2016 50. Howe, M.W. ∙ Dombeck, D.A. Rapid signalling in distinct dopaminergic axons during locomotion and reward Nature. 2016; 535 :505-510 Crossref Scopus (214) PubMed Google Scholar ).
We modeled mouse behavior using a mixture of experts / multi-agent RL architecture ( Frank and Badre, 2012 32. Frank, M.J. ∙ Badre, D. Mechanisms of hierarchical reinforcement learning in corticostriatal circuits 1: computational analysis Cereb. Cortex. 2012; 22 :509-526 Crossref Scopus (164) PubMed Google Scholar ), extended here to accommodate the sequential tone structure with semi-markov dynamics ( Daw et al., 2006 26. Daw, N.D. ∙ Courville, A.C. ∙ Touretzky, D.S. Representation and timing in theories of the dopamine system Neural Comput. 2006; 18 :1637-1677 Crossref Scopus (110) PubMed Google Scholar ). We modeled the two task structures as separate “experts” that learned a value function V as a function of either elapsed time as in classical temporal difference learning applied to the Pavlovian condition, or as a function of distance traveled. Because mice were trained on both time and distance tasks, multiple sub-experts (representing clusters in mediolateral coordinates of striatum) were pre-trained for 2000 trials to span a range of contingencies (e.g., 400ms, 600ms, or 800ms per tone transition; or 5, 10 or 15cm). For simplicity, we modeled the task with discrete sub-experts that specialized on (had been preferentially exposed to) particular times/distances. However, one can easily generalize the framework to the continuous case (e.g., using basis functions ( Ludvig et al., 2008 72. Ludvig, E.A. ∙ Sutton, R.S. ∙ Kehoe, E.J. Stimulus representation and the timing of reward-prediction errors in models of the dopamine system Neural Comput. 2008; 20 :3034-3054 Crossref Scopus (104) PubMed Google Scholar )) and the discrete space can be modeled with arbitrary resolution by simply increasing the number of sub-experts. Moreover, various models have shown that prediction errors can be used to segregate learning of different latent task states ( Collins and Frank, 2013 20. Collins, A.G.E. ∙ Frank, M.J. Cognitive control over learning: creating, clustering, and generalizing task-set structure Psychol. Rev. 2013; 120 :190-229 Crossref Scopus (162) PubMed Google Scholar ; Gershman et al., 2015 37. Gershman, S.J. ∙ Norman, K.A. ∙ Niv, Y. Discovering latent causes in reinforcement learning Curr. Opin. Behav. Sci. 2015; 5 :43-50 Crossref Scopus (54) Google Scholar ).
The value function for each time sub-expert s estimates the discounted future reward V s ( X i,t ) = r(t) + 𝛾 V s ( X i,t +1 ) and was trained via temporal differences ( Sutton and Barto, 2018 112. Sutton, R.S. ∙ Barto, A.G. Reinforcement Learning MIT Press, 2018 Google Scholar ) based on reward prediction errors δ(X i,t ) = r(t) + 𝛾 V(X i,t +1 ) - V(X i,t ) . Each auditory tone was modeled as a distinct state X i,t or X i,d with semi-markov dynamics. That is, the onset of each tone i would advance the state vector to the corresponding position even if the tone occurred earlier or later in absolute time/distance. Thus the value function learned for each sub-expert was tied to the current state (tone) and the (discretized) dwell time ( t) or distance ( d) since it has been entered, and not to the absolute time or distance that passed from the onset of the first state. This semi-markov process was based on the assumption that the tone stimuli induce a neural state representation upon which TD is computed ( Daw et al., 2006 26. Daw, N.D. ∙ Courville, A.C. ∙ Touretzky, D.S. Representation and timing in theories of the dopamine system Neural Comput. 2006; 18 :1637-1677 Crossref Scopus (110) PubMed Google Scholar ; Ludvig et al., 2008 72. Ludvig, E.A. ∙ Sutton, R.S. ∙ Kehoe, E.J. Stimulus representation and the timing of reward-prediction errors in models of the dopamine system Neural Comput. 2008; 20 :3034-3054 Crossref Scopus (104) PubMed Google Scholar ) and evidence that rodents are endowed with such a rich state representation ( Gardner et al., 2018 34. Gardner, M.P.H. ∙ Schoenbaum, G. ∙ Gershman, S.J. Rethinking dopamine as generalized prediction error Proc. Biol. Sci. 2018; 285 :20181645 Crossref Scopus (0) PubMed Google Scholar ). The value function was learned by adjusting weights in response to the X state vector, with V(X i,t ) = wt X i,t and wt ← wt + 𝛼 δ(t), where 𝛼 is a learning rate. The distance experts were trained analogously, but with the X vector advancing with each (discretized) distance step rather than passive time. Thus if the agent stopped moving, the X i,d vector remained constant until it moved again, and if it moved faster than usual, the X i,d vector would advance to later states accordingly. We fixed 𝛼 = 0.25 and 𝛾 = 0.95 for all experts but verified that the patterns were robust to other settings.
After learning, the on-line evidence (responsibilities, Figures 5 and S6 , modeling the ramps) for each sub-expert was computed as an approximation to the likelihood of the trial-wise tone transitions for that sub-expert. We adopted a hybrid Bayesian-RL formulation ( Frank and Badre, 2012 32. Frank, M.J. ∙ Badre, D. Mechanisms of hierarchical reinforcement learning in corticostriatal circuits 1: computational analysis Cereb. Cortex. 2012; 22 :509-526 Crossref Scopus (164) PubMed Google Scholar ). From a Bayesian perspective, the attentional weights for each expert can be evaluated by computing the posterior probability that each expert encompasses the best account of the observed data x: P(s|x) = P(x|s) P(s) / 𝛴 P(x|s i ) P(s i ). Thus the evidence for each expert is computed by considering its prior evidence P(s) and the likelihood that the observed tone transitions or rewards would have been observed under the expert’s model P(x|s) , relative to all other experts. For example, if there was a low probability for a tone transition at a particular moment under a given expert, then the likelihood of that observation given the expert’s model is low. Once the posterior evidence for each expert is computed, one can then apply Bayesian model averaging to allocate attentional weights to each expert in proportion to their log evidence.
Rather than a fully Bayesian realization, we instead implemented an RL approximation that may more directly relate to corticostriatal DA mechanisms ( Frank and Badre, 2012 32. Frank, M.J. ∙ Badre, D. Mechanisms of hierarchical reinforcement learning in corticostriatal circuits 1: computational analysis Cereb. Cortex. 2012; 22 :509-526 Crossref Scopus (164) PubMed Google Scholar ). Instead of computing the likelihood directly, expert responsibility weights were assigned such that experts with the smallest Bellman errors δ s accumulated the most weight. In particular, the responsibility weight for each sub-expert 𝜔 ` s was decremented when the corresponding sub-expert experienced a reward prediction error: 𝜔 ` s ← 𝜔 ` s − δ s , where δ s is the positive reward prediction error according to the corresponding sub-expert’s value function given state vector X. (Similar results hold if using | δ s | instead of only positive RPEs to decrement expert weights). Intuitively, experts with more prediction errors are less likely to have been responsible for the outcome (tone transition or reward). These responsibility weights were then normalized relative to all sub-experts as an approximation to the log evidence for a given sub-expert: 𝜔 si = 𝑒 ⁢ 𝑥 ⁢ 𝑝 ⁡ ( 𝛽 ⁢ 𝜔 ` 𝑠 ⁢ 𝑖 ) / 𝛴 ⁢ 𝑗 ⁢ 𝑒 ⁢ 𝑥 ⁢ 𝑝 ⁡ ( 𝛽 ⁢ 𝜔 ` 𝑠 ⁢ 𝑗 ) , where 𝛽 is an inverse temperature parameter. Thus, in contrast to standard RL in which RPEs reinforce actions that yield rewards, during inference, more frequent Bellman errors for a given sub-expert are indicative that it is less responsible for observations compared to sub-experts that have minimal error. Such a scheme is compatible with extant models that use reward prediction errors for state creation and inference separate from reinforcement per se ( Collins and Frank, 2013 20. Collins, A.G.E. ∙ Frank, M.J. Cognitive control over learning: creating, clustering, and generalizing task-set structure Psychol. Rev. 2013; 120 :190-229 Crossref Scopus (162) PubMed Google Scholar ; Frank and Badre, 2012 32. Frank, M.J. ∙ Badre, D. Mechanisms of hierarchical reinforcement learning in corticostriatal circuits 1: computational analysis Cereb. Cortex. 2012; 22 :509-526 Crossref Scopus (164) PubMed Google Scholar ; Gershman et al., 2015 37. Gershman, S.J. ∙ Norman, K.A. ∙ Niv, Y. Discovering latent causes in reinforcement learning Curr. Opin. Behav. Sci. 2015; 5 :43-50 Crossref Scopus (54) Google Scholar ; Redish et al., 2007 98. Redish, A.D. ∙ Jensen, S. ∙ Johnson, A. ... Reconciling reinforcement learning models with behavioral extinction and renewal: implications for addiction, relapse, and problem gambling Psychol. Rev. 2007; 114 :784-805 Crossref Scopus (197) PubMed Google Scholar ). We posited that these RPEs correspond to the phasic events observed at tone transitions in the two-photon imaging data. The accumulation of these responsibility weights were posited to relate to the widefield imaging data in discrete subregions of DMS.
Finally, a second-level task selection process was implemented to arbitrate responsibility between the overall distance expert and overall time expert (each of which constituted a weighted combination of their subordinate experts). This inference process was identical to that for the sub-experts, with responsibility updated based on their experienced prediction errors: 𝜔 ` D ← 𝜔 ` D − δ D , where 𝜔 ` D is the accumulated responsibility of the distance expert based on its reward prediction errors, δ D = r(t) + 𝛾 V D (t+1) - V D (t) . The value function for the distance and time experts V D and V T are in turn weighted averages according to the inferred responsibilities of the subordinate experts within each structure: V D (t) = 𝛴 ⁢ 𝜔 sD V SD (t) and V T = 𝛴 ⁢ 𝜔 sT V ST (t). Similarly, the value function of the agent as a whole is the weighted average value function across the two experts V(t) = 𝜔 D V D (t)+ 𝜔 T V T (t). These responsibility weights for each task structure were again normalized across tasks, 𝜔 D = e βw`D / e β w`D + e βw`T .
For each distance or time, 100 test trials were run with 10 tones each and an inter trial interval was randomly drawn from 5-15 s. The agent as a whole selects actions in terms of speeds to run for a period of time at each tone transition or after it has completed it’s previous running. Speeds were selected in proportion to the inferred responsibility of the DMS expert, together with some stochasticity: speed(t) = five ∗ ( 𝜔 D (t)-0.5)) + 𝜀 , where 𝜀 was drawn from a uniform distribution with a mean of 3. Stochasticity facilitates the agent’s ability to disambiguate distance from time tasks within a trial (a constant speed would equate the prediction errors for the two tasks given appropriate sub-experts). Increasing speed with inferred DMS expert responsibility 𝜔 D allows the model to capture the increased running with instrumental task structure ( Figure S6 ). More detailed investigation of how speeds may be optimized according to reward/effort/delay tradeoffs will be examined in future work.

Section: Acknowledgments

We thank Matthew Nassar, Joshua Berke, Peter Dayan, and Theresa Desrochers for valuable discussion of the project and feedback on an earlier version of the manuscript and members of the Frank and Moore laboratories for feedback at various stages of the project. We also thank Ines Belghiti and Aneri Soni for help with adapting the MoE model implementation to the tone task. GCaMP6f and jRGECO1a were developed and made available by the HHMI Janelia GENIE Project. dLight was developed and made available by Lin Tian. This work was supported by HHMI Hanna Gray Fellowship to A.A.H.; NIH R01MH080066 and NSF grant 1460604 to M.J.F.; and awards from Carney Institute for Brain Sciences and Dean’s office at Brown University to C.I.M.
A.A.H. designed and performed all experiments, analyzed the data, applied the computational model, wrote and revised the paper. M.J.F. designed and supervised the study, developed and simulated the computational model, and wrote and revised the paper. C.I.M. supervised the study and contributed to revising the paper.
The authors declare no competing interests.
