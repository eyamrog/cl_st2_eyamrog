Title: Cerebellar Neurodynamics Predict Decision Timing and Outcome on the Single-Trial Level


Abstract: Summary

Goal-directed behavior requires the interaction of multiple brain regions. How these regions and their interactions with brain-wide activity drive action selection is less understood. We have investigated this question by combining whole-brain volumetric calcium imaging using light-field microscopy and an operant-conditioning task in larval zebrafish. We find global, recurring dynamics of brain states to exhibit pre-motor bifurcations toward mutually exclusive decision outcomes. These dynamics arise from a distributed network displaying trial-by-trial functional connectivity changes, especially between cerebellum and habenula, which correlate with decision outcome. Within this network the cerebellum shows particularly strong and predictive pre-motor activity (>10 s before movement initiation), mainly within the granule cells. Turn directions are determined by the difference neuroactivity between the ipsilateral and contralateral hemispheres, while the rate of bi-hemispheric population ramping quantitatively predicts decision time on the trial-by-trial level. Our results highlight a cognitive role of the cerebellum and its importance in motor planning.

Section: Introduction

Animals interact with their environment in a goal-directed manner and through complex behaviors that are optimized over time. Such goal-directed behaviors require motor planning that precedes actions. The neuronal signatures of such preparatory activity have been reported in the motor ( Churchland et al., 2010 16. Churchland, M.M. ∙ Cunningham, J.P. ∙ Kaufman, M.T. ... Cortical preparatory activity: representation of movement or first cog in a dynamical machine? Neuron. 2010; 68 :387-400 Full Text Full Text (PDF) Scopus (180) PubMed Google Scholar ), pre-motor ( Li et al., 2016 60. Li, N. ∙ Daie, K. ∙ Svoboda, K. ... Robust neuronal dynamics in premotor cortex during motor planning Nature. 2016; 532 :459-464 Crossref Scopus (107) PubMed Google Scholar ), and parietal cortices ( Maimon and Assad, 2006 64. Maimon, G. ∙ Assad, J.A. A cognitive signal for the proactive timing of action in macaque LIP Nat. Neurosci. 2006; 9 :948-955 Crossref Scopus (112) PubMed Google Scholar ) and display a few common features ( Gold and Shadlen, 2007; Murakami and Mainen, 2015; Shenoy et al., 2013; Svoboda and Li, 2018 33. Gold, J.I. ∙ Shadlen, M.N. The neural basis of decision making Annu. Rev. Neurosci. 2007; 30 :535-574 Crossref Scopus (1756) PubMed Google Scholar 72. Murakami, M. ∙ Mainen, Z.F. Preparing and selecting actions with neural populations: toward cortical circuit mechanisms Curr. Opin. Neurobiol. 2015; 33 :40-46 Crossref Scopus (5) PubMed Google Scholar 88. Shenoy, K.V. ∙ Sahani, M. ∙ Churchland, M.M. Cortical control of arm movements: a dynamical systems perspective Annu. Rev. Neurosci. 2013; 36 :337-359 Crossref Scopus (247) PubMed Google Scholar 93. Svoboda, K. ∙ Li, N. Neural mechanisms of movement planning: motor cortex and beyond Curr. Opin. Neurobiol. 2018; 49 :33-41 Crossref Scopus (39) PubMed Google Scholar ). First, preparatory activity can occur long before movement initiation. Examples include humans engaged in self-initiated binary decision tasks ( Soon et al., 2008 90. Soon, C.S. ∙ Brass, M. ∙ Heinze, H.J. ... Unconscious determinants of free decisions in the human brain Nat. Neurosci. 2008; 11 :543-545 Crossref Scopus (774) PubMed Google Scholar ), mice during an instructed-delay task ( Li et al., 2015 59. Li, N. ∙ Chen, T.W. ∙ Guo, Z.V. ... A motor cortex circuit for motor planning and movement Nature. 2015; 519 :51-56 Crossref PubMed Google Scholar ), or primates involved in a visuomotor task ( Maimon and Assad, 2006 64. Maimon, G. ∙ Assad, J.A. A cognitive signal for the proactive timing of action in macaque LIP Nat. Neurosci. 2006; 9 :948-955 Crossref Scopus (112) PubMed Google Scholar ), for which preparatory activity encoding for decision outcomes several seconds preceding movement can be found in various cortical areas. Second, preparatory neuroactivity has been shown to manifest itself as a ramping or sequential activity to a threshold ( Harvey et al., 2012 39. Harvey, C.D. ∙ Coen, P. ∙ Tank, D.W. Choice-specific sequences in parietal cortex during a virtual-navigation decision task Nature. 2012; 484 :62-68 Crossref Scopus (390) PubMed Google Scholar ), the rate of which has been shown to be correlated with decision timing ( Gold and Shadlen, 2007; Maimon and Assad, 2006; Mazurek et al., 2003; Murakami and Mainen, 2015; Murakami et al., 2014; Wang, 2008, 2012 33. Gold, J.I. ∙ Shadlen, M.N. The neural basis of decision making Annu. Rev. Neurosci. 2007; 30 :535-574 Crossref Scopus (1756) PubMed Google Scholar 64. Maimon, G. ∙ Assad, J.A. A cognitive signal for the proactive timing of action in macaque LIP Nat. Neurosci. 2006; 9 :948-955 Crossref Scopus (112) PubMed Google Scholar 68. Mazurek, M.E. ∙ Roitman, J.D. ∙ Ditterich, J. ... A role for neural integrators in perceptual decision making Cereb. Cortex. 2003; 13 :1257-1269 Crossref Scopus (406) PubMed Google Scholar 72. Murakami, M. ∙ Mainen, Z.F. Preparing and selecting actions with neural populations: toward cortical circuit mechanisms Curr. Opin. Neurobiol. 2015; 33 :40-46 Crossref Scopus (5) PubMed Google Scholar 73. Murakami, M. ∙ Vicente, M.I. ∙ Costa, G.M. ... Neural antecedents of self-initiated actions in secondary motor cortex Nat. Neurosci. 2014; 17 :1574-1582 Crossref Scopus (98) PubMed Google Scholar 101. Wang, X.-J. Decision making in recurrent neuronal circuits Neuron. 2008; 60 :215-234 Full Text Full Text (PDF) Scopus (326) PubMed Google Scholar 102. Wang, X.-J. Neural dynamics and circuit mechanisms of decision-making Curr. Opin. Neurobiol. 2012; 22 :1039-1046 Crossref Scopus (64) PubMed Google Scholar ). Finally, the neuroactivity of individual neurons during the pre-motor period can take more complex forms than merely a sub-threshold version of movement-related activity ( Churchland and Shenoy, 2007 15. Churchland, M.M. ∙ Shenoy, K.V. Temporal complexity and heterogeneity of single-neuron activity in premotor and motor cortex J. Neurophysiol. 2007; 97 :4235-4257 Crossref Scopus (133) PubMed Google Scholar ) and exhibit different tuning properties during different task epochs ( Churchland et al., 2010 16. Churchland, M.M. ∙ Cunningham, J.P. ∙ Kaufman, M.T. ... Cortical preparatory activity: representation of movement or first cog in a dynamical machine? Neuron. 2010; 68 :387-400 Full Text Full Text (PDF) Scopus (180) PubMed Google Scholar ). The common observation of variability in behavior ( Gordus et al., 2015; Osborne et al., 2005 34. Gordus, A. ∙ Pokala, N. ∙ Levy, S. ... Feedback from network states generates variability in a probabilistic olfactory circuit Cell. 2015; 161 :215-227 Full Text Full Text (PDF) Scopus (86) PubMed Google Scholar 76. Osborne, L.C. ∙ Lisberger, S.G. ∙ Bialek, W. A sensory source for motor variation Nature. 2005; 437 :412-416 Crossref Scopus (170) PubMed Google Scholar ) points toward dynamic trial-by-trial changes in the neurodynamics and thus cannot be captured by static and trial-averaged tuning frameworks for representation of motor responses ( Afshar et al., 2011; Briggman et al., 2005; Churchland and Kiani, 2016; Wei et al., 2019 2. Afshar, A. ∙ Santhanam, G. ∙ Yu, B.M. ... Single-trial neural correlates of arm movement preparation Neuron. 2011; 71 :555-564 Full Text Full Text (PDF) Scopus (107) PubMed Google Scholar 10. Briggman, K.L. ∙ Abarbanel, H.D.I. ∙ Kristan, Jr., W.B. Optical imaging of neuronal populations during decision-making Science. 2005; 307 :896-901 Crossref Scopus (213) PubMed Google Scholar 14. Churchland, A.K. ∙ Kiani, R. Three challenges for connecting model to mechanism in decision-making Curr. Opin. Behav. Sci. 2016; 11 :74-80 Crossref PubMed Google Scholar 104. Wei, Z. ∙ Inagaki, H. ∙ Li, N. ... An orderly single-trial organization of population dynamics in premotor cortex predicts behavioral variability Nat. Commun. 2019; 10 :216 Crossref Scopus (1) PubMed Google Scholar ).
While these findings in the cortex have provided insight, they also highlight the need for capturing neuronal population activity on a trial-by-trial basis and, as other studies have shown, for taking a brain-wide approach to decision making ( Cisek and Kalaska, 2010; Gao et al., 2018; Guo et al., 2017; Horwitz and Newsome, 1999; Kunimatsu et al., 2018; Liu et al., 2013 18. Cisek, P. ∙ Kalaska, J.F. Neural mechanisms for interacting with a world full of action choices Annu. Rev. Neurosci. 2010; 33 :269-298 Crossref Scopus (657) PubMed Google Scholar 29. Gao, Z. ∙ Davis, C. ∙ Thomas, A.M. ... A cortico-cerebellar loop for motor planning Nature. 2018; 563 :113-116 Crossref Scopus (38) PubMed Google Scholar 36. Guo, Z.V. ∙ Inagaki, H.K. ∙ Daie, K. ... Maintenance of persistent activity in a frontal thalamocortical loop Nature. 2017; 545 :181-186 Crossref Scopus (91) PubMed Google Scholar 42. Horwitz, G.D. ∙ Newsome, W.T. Separate signals for target selection and movement specification in the superior colliculus Science. 1999; 284 :1158-1161 Crossref Scopus (223) PubMed Google Scholar 54. Kunimatsu, J. ∙ Suzuki, T.W. ∙ Ohmae, S. ... Different contributions of preparatory activity in the basal ganglia and cerebellum for self-timing eLife. 2018; 7 :743 Crossref Scopus (9) Google Scholar 61. Liu, S. ∙ Gu, Y. ∙ DeAngelis, G.C. ... Choice-related activity and correlated noise in subcortical vestibular neurons Nat. Neurosci. 2013; 16 :89-97 Crossref Scopus (42) PubMed Google Scholar ). Support for this notion comes from the fact that decision making requires access to or can be modulated by brain functions such as short-term memory, internal states, and reward expectation that have a sub-cortical representation ( Abbott et al., 2017; Allen et al., 2017 1. Abbott, L.F. ∙ Angelaki, D.E. ∙ Carandini, M. ..., International Brain Laboratory. Electronic address: churchland@cshl.edu, International Brain Laboratory An International Laboratory for Systems and Computational Neuroscience Neuron. 2017; 96 :1213-1218 Full Text Full Text (PDF) Scopus (2) PubMed Google Scholar 6. Allen, W.E. ∙ Kauvar, I.V. ∙ Chen, M.Z. ... Global Representations of Goal-Directed Behavior in Distinct Cell Types of Mouse Neocortex Neuron. 2017; 94 :891-907 Full Text Full Text (PDF) PubMed Google Scholar ). However, obtaining high spatiotemporal resolution access to whole-brain neuroactivity is currently not possible in mammalian brains, while studying complex goal-directed behaviors, motor planning, and decision making in non-vertebrates is challenging, and results may not be directly transferrable to vertebrates. The larval zebrafish represents an attractive model to investigate these questions due to its high level of physiological and genetic homology to the mammalian brain, conformity to basic vertebrate brain organization ( Friedrich et al., 2010; Kalueff et al., 2014 28. Friedrich, R.W. ∙ Jacobson, G.A. ∙ Zhu, P. Circuit neuroscience in zebrafish Curr. Biol. 2010; 20 :R371-R381 Full Text Full Text (PDF) Scopus (106) PubMed Google Scholar 49. Kalueff, A.V. ∙ Stewart, A.M. ∙ Gerlai, R. Zebrafish as an emerging model for studying complex brain disorders Trends Pharmacol. Sci. 2014; 35 :63-75 Full Text Full Text (PDF) PubMed Google Scholar ), and its transparent brain that allows for whole-brain in vivo optical recording of neuroactivity at high speed and cellular resolution utilizing recent techniques in two-photon ( Ahrens et al., 2012; Portugues et al., 2014; Renninger and Orger, 2013 3. Ahrens, M.B. ∙ Li, J.M. ∙ Orger, M.B. ... Brain-wide neuronal dynamics during motor adaptation in zebrafish Nature. 2012; 485 :471-477 Crossref Scopus (310) PubMed Google Scholar 79. Portugues, R. ∙ Feierstein, C.E. ∙ Engert, F. ... Whole-brain activity maps reveal stereotyped, distributed networks for visuomotor behavior Neuron. 2014; 81 :1328-1343 Full Text Full Text (PDF) Scopus (125) PubMed Google Scholar 83. Renninger, S.L. ∙ Orger, M.B. Two-photon imaging of neural population activity in zebrafish Methods. 2013; 62 :255-267 Crossref Scopus (31) PubMed Google Scholar ), light-field ( Andalman et al., 2019; Cong et al., 2017; Nöbauer et al., 2017; Prevedel et al., 2014 7. Andalman, A.S. ∙ Burns, V.M. ∙ Lovett-Barron, M. ... Neuronal Dynamics Regulating Brain and Behavioral State Transitions Cell. 2019; 177 :970-985 Full Text Full Text (PDF) Scopus (8) PubMed Google Scholar 20. Cong, L. ∙ Wang, Z. ∙ Chai, Y. ... Rapid whole brain imaging of neural activity in freely behaving larval zebrafish ( Danio rerio ) eLife. 2017; 6 :60 Crossref Scopus (38) Google Scholar 75. Nöbauer, T. ∙ Skocek, O. ∙ Pernía-Andrade, A.J. ... Video rate volumetric Ca 2+ imaging across cortex using seeded iterative demixing (SID) microscopy Nat. Methods. 2017; 14 :811-818 Crossref Scopus (31) PubMed Google Scholar 80. Prevedel, R. ∙ Yoon, Y.G. ∙ Hoffmann, M. ... Simultaneous whole-animal 3D imaging of neuronal activity using light-field microscopy Nat. Methods. 2014; 11 :727-730 Crossref Scopus (297) PubMed Google Scholar ), light-sheet ( Ahrens et al., 2013; Favre-Bulle et al., 2018; Migault et al., 2018; Wan et al., 2019 4. Ahrens, M.B. ∙ Orger, M.B. ∙ Robson, D.N. ... Whole-brain functional imaging at cellular resolution using light-sheet microscopy Nat. Methods. 2013; 10 :413-420 Crossref Scopus (583) PubMed Google Scholar 25. Favre-Bulle, I.A. ∙ Vanwalleghem, G. ∙ Taylor, M.A. ... Cellular-Resolution Imaging of Vestibular Processing across the Larval Zebrafish Brain Curr. Biol. 2018; 28 :3711-3722 Full Text Full Text (PDF) PubMed Google Scholar 69. Migault, G. ∙ van der Plas, T.L. ∙ Trentesaux, H. ... Whole-Brain Calcium Imaging during Physiological Vestibular Stimulation in Larval Zebrafish Curr. Biol. 2018; 28 :3723-3735 Full Text Full Text (PDF) Scopus (6) PubMed Google Scholar 100. Wan, Y. ∙ Wei, Z. ∙ Looger, L.L. ... Single-Cell Reconstruction of Emerging Population Activity in an Entire Developing Circuit Cell. 2019; 179 :355-372 Full Text Full Text (PDF) Scopus (2) PubMed Google Scholar ), and other forms of microscopy ( Huisken et al., 2004; Wolf et al., 2015; Wu et al., 2011 44. Huisken, J. ∙ Swoger, J. ∙ Del Bene, F. ... Optical sectioning deep inside live embryos by selective plane illumination microscopy Science. 2004; 305 :1007-1009 Crossref Scopus (1281) PubMed Google Scholar 105. Wolf, S. ∙ Supatto, W. ∙ Debrégeas, G. ... Whole-brain functional imaging with two-photon light-sheet microscopy Nat. Methods. 2015; 12 :379-380 Crossref PubMed Google Scholar 107. Wu, Y. ∙ Ghitani, A. ∙ Christensen, R. ... Inverted selective plane illumination microscopy (iSPIM) enables coupled cell identity lineaging and neurodevelopmental imaging in Caenorhabditis elegans Proc. Natl. Acad. Sci. USA. 2011; 108 :17708-17713 Crossref Scopus (158) PubMed Google Scholar ). However, establishing a robust behavioral paradigm in the larval zebrafish that involves learning, memory, and integration of information across brain regions, and within which the neuronal basis of goal-directed motor planning and decision making could be studied, has proved challenging.
In the present study, we have combined high-speed volumetric calcium imaging based on light-field microscopy (LFM) ( Nöbauer et al., 2017; Prevedel et al., 2014 75. Nöbauer, T. ∙ Skocek, O. ∙ Pernía-Andrade, A.J. ... Video rate volumetric Ca 2+ imaging across cortex using seeded iterative demixing (SID) microscopy Nat. Methods. 2017; 14 :811-818 Crossref Scopus (31) PubMed Google Scholar 80. Prevedel, R. ∙ Yoon, Y.G. ∙ Hoffmann, M. ... Simultaneous whole-animal 3D imaging of neuronal activity using light-field microscopy Nat. Methods. 2014; 11 :727-730 Crossref Scopus (297) PubMed Google Scholar )—a technique that uniquely enables simultaneous capturing of neuronal network activity on the scale of the whole-brain at single-cell resolution—with a new operant conditioning paradigm in larval zebrafish, relief of aversive stimulus by turn (ROAST, Li, 2013 57. Li, J.M. Identification of an operant learning circuit by whole brain functional imaging in larval zebrafish. Doctoral dissertation Harvard University, 2013 Google Scholar ), to investigate the neuronal basis of goal-directed action selection. We found the dynamics of brain states to display decision-related bifurcation enabling prediction of both decision time (DT) and outcome at the trial-by-trial level. We found multiple brain areas whose inter- and intra-dynamics exhibited performance-dependent trial-by-trial changes of correlated pre-motor neuroactivity, representing functional connectivity changes that cannot be explained by slower learning-based changes of the network. The cerebellum also exhibited a surprisingly strong level of preparatory neuroactivity, which we found to mainly originate from the granule cell population, and which allowed us to predict both turn direction and the time point of turn initiation ~10 s before movement for individual trials. Our observations are explained by a model in which turn direction is determined by cerebellar ipsicontralateral competition, while the time point of turn initiation is quantitatively predicted by the joint ipsicontralateral population ramping rate.
Thus, our work extends the traditional view of the cerebellum in motor control and provides support for its more cognitive functions, while expanding the existing frameworks of “ramping-to-threshold” for decision making ( Gold and Shadlen, 2007; Wang, 2012 33. Gold, J.I. ∙ Shadlen, M.N. The neural basis of decision making Annu. Rev. Neurosci. 2007; 30 :535-574 Crossref Scopus (1756) PubMed Google Scholar 102. Wang, X.-J. Neural dynamics and circuit mechanisms of decision-making Curr. Opin. Neurobiol. 2012; 22 :1039-1046 Crossref Scopus (64) PubMed Google Scholar ) to the level of individual trials that has not been possible due to technical limitations ( Shadlen et al., 2016 87. Shadlen, M.N. ∙ Kiani, R. ∙ Newsome, W.T. ... Comment on “Single-trial spike trains in parietal cortex reveal discrete steps during decision-making” Science. 2016; 351 :1406 Crossref Scopus (11) PubMed Google Scholar ). The presence of cerebellar preparatory activity, representing internal variables that cannot be directly explained by instantaneous behavior or sensory input, points toward the critical role that it could play in motor planning more generally and, as zebrafish lack a cortex, prior to the emergence of cortical regions and functions ( Hodos, 2009 41. Hodos, W. Evolution of cerebellum Binder, M.D. ∙ Hirokawa, N. ∙ Windhorst, U. (Editors) Encyclopedia of Neuroscience Springer Berlin Heidelberg, 2009; 1240-1243 Crossref Google Scholar ).

Section: Results

In ROAST, fish learn to perform a directed tail movement to the right or left in order to receive relief from an aversive heat stimulus ( Figure 1 A). While ROAST was initially developed to study learning ( Li, 2013 57. Li, J.M. Identification of an operant learning circuit by whole brain functional imaging in larval zebrafish. Doctoral dissertation Harvard University, 2013 Google Scholar ), it also provides an ideal opportunity to investigate the neuronal basis of action selection and underlying pre-motor activity. The binary nature of the decision as well as the extended DT, between the onset of heat stimulus and the initiation of the first movement, allows studying the neuronal dynamics that underlie the choice for turn direction as well as the timing of movement initiation (see STAR Methods ). Data from an example learner are shown in Figure 1 B. The learners’ performance typically became stable after the first 15 trials in both blocks, with an asymptotic final performance of ~80% correct ( Figure 1 C, see STAR Methods ). At the level of single trials, we found that the latency to heat offset decreased as a function of trials in learner fish ( Figure S1 A), while the mean DT remained stable ( Figure S1 B). We performed simultaneous whole-brain calcium imaging using a home-built LFM ( Nöbauer et al., 2017; Prevedel et al., 2014 75. Nöbauer, T. ∙ Skocek, O. ∙ Pernía-Andrade, A.J. ... Video rate volumetric Ca 2+ imaging across cortex using seeded iterative demixing (SID) microscopy Nat. Methods. 2017; 14 :811-818 Crossref Scopus (31) PubMed Google Scholar 80. Prevedel, R. ∙ Yoon, Y.G. ∙ Hoffmann, M. ... Simultaneous whole-animal 3D imaging of neuronal activity using light-field microscopy Nat. Methods. 2014; 11 :727-730 Crossref Scopus (297) PubMed Google Scholar ) and a transgenic fish line Tg(elavl3:H2B-GCaMP6s) ( Vladimirov et al., 2014 97. Vladimirov, N. ∙ Mu, Y. ∙ Kawashima, T. ... Light-sheet functional imaging in fictively behaving zebrafish Nat. Methods. 2014; 11 :883-884 Crossref Scopus (111) PubMed Google Scholar ), while animals were engaged in ROAST. Using LFM allowed us to capture cellular neuroactivity at the whole-brain level within a volume of 700 × 700 × 200 μm, with all voxels acquired truly simultaneously at a volume rate of 10 Hz.
Volumetric reconstruction of the LFM data (see Video S1 ), followed by neuronal signal extraction ( Prevedel et al., 2014 80. Prevedel, R. ∙ Yoon, Y.G. ∙ Hoffmann, M. ... Simultaneous whole-animal 3D imaging of neuronal activity using light-field microscopy Nat. Methods. 2014; 11 :727-730 Crossref Scopus (297) PubMed Google Scholar ), allowed us to obtain activity traces from ~5,000 of the most active neurons across the brain ( Figure 1 D, example learner in block 2, right training). When these activities were co-registered with the time period of heat stimulus and the time points of left or right tail movements, a significant level of correlation was observed ( Figure 1 D, i). Mapping these neuronal activities spatially onto the brain revealed active neurons across the entire forebrain, midbrain, and anterior hindbrain ( Figure 1 D, ii), which were consistent in number and distribution across specimens ( Figures S1 D and S1E) with distinct neuronal dynamics in different brain regions correlated with specific epochs of our task ( Figure S1 C). To identify how the dynamics of brain states—i.e., the state of activity of all neurons at a given time—are associated with the different task epochs, we began by performing linear dimensionality reduction based on principal-component analysis (PCA). However, PCA on brain states failed to effectively reduce dimensionality in a fashion that would capture key differences during different task epochs ( Figures S1 F and S1G). To overcome this issue, we applied a nonlinear dimensionality reduction technique, t-distributed stochastic neighbor embedding (t-SNE; see STAR Methods ), to the time series of brain states ( Maaten and Hinton, 2008 62. Maaten, L.V.D. ∙ Hinton, G. Visualizing Data using t-SNE J. Mach. Learn. Res. 2008; 9 :2579-2605 Google Scholar ).
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiJkNWNiZDJjN2FkNTdiNzA1ZjhjOTgxNjcwMzkxNzhmYSIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjA3MDg1fQ.XWlA03wFYCg0j29bvqJV2a1loOrRkKOSwszqB1R598jsXW4CWokGbcBhmtqSFWyyBUnZEuUM8Tj0zcrQzB0LcEssyjpcjtTpSgxCzjPoORIA9bgpPdbDRnv-amGsKCi31AWt4uATEMRQULDL7KsBeFq91KQi1Blbwz0MT3Qfzs6IIbbZsA2qXzhMMnsLHIVvMBji7xps84_ki0lEVvQSoMmxgbxJL5lL5FmWLXs3dTJgljHZTQWa2NRdJGK9wfe9wUnw_CqsGI0xieOi_1C0iiqT_9M5RjUEAwHP-XP99XDMxOPad9qAbGDzqZy23UXoOTCO9zwavfyHZvIHM0TnWA Video (2.90 MB) Video S1. Projected Volumetric Reconstruction of Whole-Brain LFM Calcium Imaging Data, Related to Figure 1 Maximum intensity projections along three orthogonal directions of reconstructed LFM recording of GECI activity in an example zebrafish with pan-neuronal expression of GCaMP6s. Scale bar, 50 μm. Recording frame rate: 10 fps. Playback: 30 × real time.
We found two major clusters that were associated with the presence and absence of the heat stimulus, respectively ( Figure S2 A), showing that changes of the heat stimulus drive temporally sharp transitions between brain states resulting in a higher similarity of intra-cluster brain states than inter-cluster brain states ( Figure S2 B). Investigating the brain state representation of decision-related behavior, we found that brain states corresponding to correct and incorrect turns each densely and distinctively occupied separate sub-regions of the “Heat ON” and “Heat OFF” clusters ( Figure 2 A) with an increased level of similarity of brain states before turn events, in particular, for correct trials ( Figures S2 C and S2D). These observations show stereotypical, reoccurring global brain states across trials with increased coordination before movement, particularly in correct trials.
We connected temporally consecutive brain states in the t-SNE map on the trial-by-trial level and found the brain state dynamics to form a cyclic manifold, with the correct and incorrect trials forming distinct loops ( ∗∗∗ p < 0.0001, Wilcoxon rank-sum test, Figure 2 B). This shows that, during correct trials, highly similar brain states occur across trials, despite the different duration of the stimulus in each trial and the different timing of the decisions. Projecting the brain states into a 3D space spanned by reference brain states for correct trials, incorrect trials, and the heat-encoding component (see STAR Methods ) revealed a clear pre-turn bifurcation ( Figure 2 C) toward the correct and incorrect decision state. Strikingly, the bifurcation toward different decision outcomes could be observed well before turn initiations at the single-trial level ( Figure 2 C, ii; Video S2 ), despite different DTs.
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiI5ZDQzMTA3OTdlNGM2MjEzNmRhMjRiYTAyOWE0ODcwYyIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjA3MDg1fQ.OzLq-7GkR0U26x_9wBNnuSy89gQfDPPCOLqkiPsfAJLHGFJH1UKSkVegK-aIhIjDISvubdeV6QdQFy73Dn3LNhXaFqnI-wwY58Q8Rnyw1j0B5Hcorr_LxWn4NT71WUFeuis7aY-M-gBKXF26RFEWwe79GQs9YuhNPqeyyShDMDIFfZFyx6LUwQSnEquNh4T_DvmDD9ngXmQL68TTeltNCYKTXdzFeFK2XoNTerOZP7smxh9xJzxJgDVhxq5h5otHT3kbYTcIV6xAVg8cr45e_ZuvqqKYiqo9CfuBKPeQDqABdBxRp4I_erU5oLouDrO03cftcL0Cw8E-hdCIZteZrQ Video (1.29 MB) Video S2. Single-Trial Bifurcation Process during the Pre-motor Period, Related to Figure 2C Animation of the evolution of individual correct and incorrect trials during the pre-motor period (i.e., from heat onset to movement initiations), expressed as correlation with the averaged, final brain states at movement initiation. Black diamonds indicate heat onset, green and magenta dots indicate movement initiations for correct and incorrect turns, respectively. Color scale encodes temporal progress from heat onset to movement initiation. Note that these individual trials are with different decision times. Playback at 3 × real time.
Given our observations at the level of brain states, we set out to investigate the brain regions that drive the bifurcation toward different decision outcomes. We applied t-SNE to each neuron’s activity patterns in order to partition them into functional neuronal clusters. Applying t-SNE to the time series of all neurons and that of four behavior and stimulus regressors ( Figure S2 E; see STAR Methods ) allowed us to identify the individual functional neurons and their clustering around our regressors, which we emphasized further by partitioning the t-SNE map using hierarchical clustering (see STAR Methods ). Using this approach, six neuronal clusters with four regressors embedded within them were found ( Figure 2 D). We found that the t-SNE clusters coincided well with distinct anatomical regions ( Figure 2 E). A distinct group of bilateral neurons (cluster 1) in the telencephalon (Te) responded to the onset of the heat stimulus, “Heat ON.” Another group (cluster 6), overlapping largely with the thalamus, but also with neurons sparsely distributed in the Te, encoded for “Heat OFF.” “Turn L” was represented by contralaterally located neurons in the hindbrain and the left adjacent anterior rhombencephalic turning region (ARTR, cluster 2) ( Dunn et al., 2016; Wolf et al., 2017 24. Dunn, T.W. ∙ Mu, Y. ∙ Narayan, S. ... Brain-wide mapping of neural activity controlling zebrafish exploratory locomotion eLife. 2016; 5 :e12741 Crossref PubMed Google Scholar 106. Wolf, S. ∙ Dubreuil, A.M. ∙ Bertoni, T. ... Sensorimotor computation underlying phototaxis in zebrafish Nat. Commun. 2017; 8 :651 Crossref Scopus (23) PubMed Google Scholar ), while “Turn R” was encoded by neurons in the ipsilateral right hindbrain that highly overlapped with the cerebellum and ARTR and fell into a single cluster (cluster 4). Cluster 3 overlapped with habenula (Hb) and raphe, while cluster 5 coincided with the left cerebellum.
We hypothesized that decision making underlying goal-directed behavior relies on the coordination and integration of distributed information across different brain regions. While this notion has been theoretically proposed ( Abbott et al., 2017; Svoboda and Li, 2018 1. Abbott, L.F. ∙ Angelaki, D.E. ∙ Carandini, M. ..., International Brain Laboratory. Electronic address: churchland@cshl.edu, International Brain Laboratory An International Laboratory for Systems and Computational Neuroscience Neuron. 2017; 96 :1213-1218 Full Text Full Text (PDF) Scopus (2) PubMed Google Scholar 93. Svoboda, K. ∙ Li, N. Neural mechanisms of movement planning: motor cortex and beyond Curr. Opin. Neurobiol. 2018; 49 :33-41 Crossref Scopus (39) PubMed Google Scholar ), to our knowledge, it has not been directly demonstrated experimentally. To investigate this, we used correlation ( Cohen and Kohn, 2011; Kohn et al., 2016 19. Cohen, M.R. ∙ Kohn, A. Measuring and interpreting neuronal correlations Nat. Neurosci. 2011; 14 :811-819 Crossref Scopus (450) PubMed Google Scholar 52. Kohn, A. ∙ Coen-Cagli, R. ∙ Kanitscheider, I. ... Correlations and Neuronal Population Information Annu. Rev. Neurosci. 2016; 39 :237-256 Crossref Scopus (86) PubMed Google Scholar ) and evaluated it at the single-trial level for the relevant functional neuronal clusters for correct versus incorrect trials ( Figures 2 F and S2 F). We found that the absolute correlation of pre-motor activity within the ipsilateral cerebellum (ipsi Cb), as well as between the ipsi Cb and other brain regions such as the Hb and the contralateral cerebellum (contra Cb), increases on a trial-by-trial level, with correct trials exhibiting a higher degree of correlation than incorrect trials ( Figure S2 F). In particular, we found the average difference in correlation of pre-motor neuroactivity between the ipsi Cb and Hb for correct versus incorrect trials to be highly significant ( Figure 2 F). Moreover, we show that these trial-by-trial changes of correlation, which represent changes of functional connectivity, cannot be explained by the direct training-related changes of the network as the ipsi Cb and Hb did not show a significant change in their correlated activity as function of training ( Figure S2 F). In order to establish that the observed coordination and integration of brain-wide signals are necessary for correct decision outcomes, we performed pre-training lesions in Te and Hb. We found that both lesions impair the fish’s ability to learn and make correct decisions ( Figure 2 G). These observations strongly support the notion of a necessary integration and coordination of information across and within brain regions to generate motor planning for correct decision outcomes.
We next searched for the neuroactivity within each cluster that contributed to the observed pre-motor bifurcation of brain states and thus would be predictive of the motor response. However, since neurons can in principle have a mixed response, i.e., also decision-independent components such as those associated with the stimulus, it was necessary to parse out the decision-dependent versus decision-independent components from each cluster. To do so, we used demixed principal-component analysis (dPCA; Kobak et al., 2016 51. Kobak, D. ∙ Brendel, W. ∙ Constantinidis, C. ... Demixed principal component analysis of neural population data eLife. 2016; 5 :e10989 Crossref PubMed Google Scholar ; see STAR Methods ; Figures S3 A and S3B). We found the dPC1 of all clusters to account for at least ~50% of the observed variance in the corresponding cluster and to exhibit a decision-independent response ( Figure 3 A). Consistent with our observation of the t-SNE map where the “Heat ON” regressor is embedded in cluster 1 (Te), we found the dPC1 of cluster 1 to show increased activity only after heat onset. dPC1 of cluster 2 (contra ARTR) showed increased activity only after turn initiation, suggesting it is encoding for movements, while dPC1 of clusters 3 (Hb) and 4 (ipsi Cb and ARTR) displayed a linear increase in activity upon heat onset followed by a secondary peak after turn initiation, suggesting their potential involvement in sensorimotor transformation. dPC1 of clusters 5 (contra Cb) and 6 (thalamus) showed an overall decreased activity upon heat onset—in contrast to the neuroactivity in clusters 4 and 1, respectively—followed by an increase of activity after turn initiation. dPC2 explained ~25% of observed variance in each cluster. Importantly, we found that it exhibited in all clusters a decision-dependent behavior with a clear separation of correct versus incorrect decisions, in some clusters prior to and in some clusters after initiation of motor behavior ( Figure 3 A; see STAR Methods ). Among these clusters, cluster 4, the ipsi Cb and ARTR, allowed for a reliable decoding of the turn direction well before turn initiation. Overall, even though the pre-motor signal is available across multiple brain areas, the cerebellum and ARTR contain the strongest predictive signal for decision direction.
Given our above observations on the pre-motor decision-dependent dPCs of the cerebellum and ARTR, we hypothesized that they may represent preparatory neuroactivity for motor planning, similar to what has been reported in the cortex ( Churchland et al., 2012; Gao et al., 2018; Li et al., 2016 17. Churchland, M.M. ∙ Cunningham, J.P. ∙ Kaufman, M.T. ... Neural population dynamics during reaching Nature. 2012; 487 :51-56 Crossref Scopus (477) PubMed Google Scholar 29. Gao, Z. ∙ Davis, C. ∙ Thomas, A.M. ... A cortico-cerebellar loop for motor planning Nature. 2018; 563 :113-116 Crossref Scopus (38) PubMed Google Scholar 60. Li, N. ∙ Daie, K. ∙ Svoboda, K. ... Robust neuronal dynamics in premotor cortex during motor planning Nature. 2016; 532 :459-464 Crossref Scopus (107) PubMed Google Scholar ). We first looked at the trial-averaged activity of individual neurons in cluster 4, the ipsi Cb, and ARTR. For correct trials, we observed a gradual increase of ipsi neuroactivity after heat onset, which continued until movement initiation, followed by a strong peak after the execution of the turn ( Figure 3 B, i). In contrast, for incorrect trials, neuroactivity was reduced in general. In particular, the above gradual increase of pre-motor neuroactivity was absent, although the post-turn peak remained present ( Figure 3 B, ii). Sorting neurons both within correct and incorrect trials according to their activity onset time in the correct trials, we found that the identity of neurons that displayed strong activity after turns was different in correct versus incorrect trials ( Figure 3 B, i and ii). Moreover, neurons that displayed strong post-turn activity in incorrect trials were the same ones that also showed early onset of strong pre-motor activity in correct trials ( Figure 3 B, i and ii). This indicates that individual neurons displayed different “tunings” during pre-motor and post-motor epochs of the task and that pre-motor neuroactivity was not merely a subthreshold version of motor response ( Churchland et al., 2010 16. Churchland, M.M. ∙ Cunningham, J.P. ∙ Kaufman, M.T. ... Cortical preparatory activity: representation of movement or first cog in a dynamical machine? Neuron. 2010; 68 :387-400 Full Text Full Text (PDF) Scopus (180) PubMed Google Scholar ). We then mapped the order by which neurons became active to their anatomical locations in the brain. Following an anterior to posterior gradient, we found that neurons with an earlier onset time of pre-motor activity were located in the cerebellum, while neurons with a later onset of activity were mainly located in the ARTR ( Figure 3 B, iii). To exclude the possibility that the observed pre-motor activity represents an innate feature of the cerebellum, we investigated its changes as a function of trials. We found that the observed pre-motor activity uniquely emerges through learning in the ipsilateral side ( Figure 3 B, iv) for correct trials. This observation also highlights the fact that a more complex behavioral task is indeed necessary to observe the cerebellar ramping activity. Compared to the ipsilateral side, the contralateral side displayed very little pre-motor ramping. In correct trials, the responses of the first few active neurons were similar to those of the ipsilateral side; however, significantly fewer neurons participated in the pre-motor ramping activity, while a similarly strong post-turn response persisted for the correct trials ( Figure 3 C, i). In incorrect trials, neurons that displayed strong post-turn activity had an early onset time of pre-motor activity ( Figure 3 C, ii) and mostly overlapped with the contra ARTR ( Figure 3 C, iii). Consistent with our above observation of weak ramping activity in the contra Cb, we found no significant changes in contralateral ramping activity as a function of trial in our learning task ( Figure 3 C, iv).
The ARTR in each hemisphere has been shown to project inhibitory connections to the contralateral hemisphere ( Dunn et al., 2016 24. Dunn, T.W. ∙ Mu, Y. ∙ Narayan, S. ... Brain-wide mapping of neural activity controlling zebrafish exploratory locomotion eLife. 2016; 5 :e12741 Crossref PubMed Google Scholar ). Moreover, the parallel fibers of the cerebellar granular neurons, which feed into the Purkinje cells, span across both hemispheres of the cerebellum densely ( Knogler et al., 2017 50. Knogler, L.D. ∙ Markov, D.A. ∙ Dragomir, E.I. ... Sensorimotor Representations in Cerebellar Granule Cells in Larval Zebrafish Are Dense, Spatially Organized, and Non-temporally Patterned Curr. Biol. 2017; 27 :1288-1302 Full Text Full Text (PDF) Scopus (31) PubMed Google Scholar ). These observations provide evidence that the contra ARTR and Cb are an integral part of the learning, motor planning, and action selection circuit and that the activity of the ipsi and contra ARTR and cerebellum should be analyzed collectively. Thus, we investigated the joint dynamics of clusters 2, 4, and 5 during different task epochs, decomposed their joint activity into decision-independent and decision-dependent activity by applying dPCA and focused on the top 4 dPCs, which explain >80% of the variance. Within the decision-independent components, dPC1 displayed ramping and dPC3 a plateau, while for the decision-dependent components, dPC2 exhibited post-motor separation and dPC4 pre-motor separation ( Figures 4 A and S4 A). The observed ramping mode of dPC1 is consistent with activity that would represent a non-direction-specific but rather temporal aspect of a decision (i.e., the DT), while the plateau region in dPC3 is consistent with heat-and-motor-evoked signals, as the rise and fall of dPC3 coincides with heat onset and movement initiation. dPC2 represents the decision outcome after the turn—which can serve as a feedback signal for learning—while dPC4 represents the feedforward pre-motor signal that encodes future turn direction. In both non-learners ( Figure S4 B) and fish performing spontaneous turns in the absence of a heat stimulus ( Figure S4 C), the post-motor feedback signals were present, but pre-motor cerebellar signals were not predictive of turn direction.
Next, given our observations on the pre-motor decision-dependent dPCs in learners, we set out to quantify how well these predicted the outcome of the turn before movement initiation at the trial-by-trial level. Our prediction accuracy analyzed across fish (see STAR Methods , n = 8 training blocks) reached ~80% before turn initiation ( Figure 4 B, i). Figure 4 B, ii shows the prediction time in our example learner dataset, for which we found a value of 11.1 s (see STAR Methods and Figures S3 C and S3D). This result was reproducible across multiple learners (n = 5) for which we found an average prediction time of 10.4 s ( Figure 4 B, ii). The above timescales are different from the millisecond timescale that has been traditionally associated with the role of the cerebellum in motor control ( Johansson et al., 2016 48. Johansson, F. ∙ Hesslow, G. ∙ Medina, J.F. Mechanisms for motor timing in the cerebellar cortex Curr. Opin. Behav. Sci. 2016; 8 :53-59 Crossref Scopus (15) PubMed Google Scholar ) but well within the range of working memory ( Buhusi and Meck, 2005; Tetzlaff et al., 2012 12. Buhusi, C.V. ∙ Meck, W.H. What makes us tick? Functional and neural mechanisms of interval timing Nat. Rev. Neurosci. 2005; 6 :755-765 Crossref Scopus (1149) PubMed Google Scholar 95. Tetzlaff, C. ∙ Kolodziejski, C. ∙ Markelic, I. ... Time scales of memory, learning, and plasticity Biol. Cybern. 2012; 106 :715-726 Crossref Scopus (42) PubMed Google Scholar ).
We speculated that the decision for turn direction might arise from an ipsicontra interaction between the neuroactivity in the cerebellum, with the “winning” side determining the decision outcome. We tested this idea by comparing the difference in the decision-dependent neuroactivity of the Cb and ARTR between the two hemispheres during the pre-motor period at the single-trial level (see STAR Methods ). Compared to the original neuronal time series, this reconstructed time series only contained pre-motor decision-dependent information but had the same dimension (i.e., neurons × time, Figure S4 D). Thereby, we could preserve the information on the location of each neuron and obtain the ipsicontra difference activity. An example of the ipsicontra difference of reconstructed neuroactivity as a function of time is shown in the Figure 4 C, where it is positive during correct trials and negative during incorrect trials.
For an individual learner, we found a significantly higher level of preparatory activity on the ipsilateral side than the contralateral side in correct trials but a significantly lower level of activity in the incorrect trials ( Figure 4 D). These observations were consistent across fish and when all trials were pooled ( Figure 4 E) but not present in non-learners ( Figures S4 E and S4F). This mirroring relationship between the ipsilateral and contralateral side was seen in dPC4 across animals, but none of the other three top dPCs. Post-training ipsi Cb lesions led to a significant decrease of the correct rate, whereas contra Cb lesions resulted in a slight increase of the correct rate ( Figure 4 F). In fish performing spontaneous turns without stimuli, cerebellar lesions did not affect turning preference ( Figure 4 G), consistent with our previous observations that pre-motor cerebellar is only present in fish that learned ( Figures S4 A–S4C). These observations support our idea that cross-hemisphere difference neuroactivity in the cerebellum during motor planning forms the basis of the decision for turn direction, with the more active side determining the decision outcome on the trial-by-trial level.
A number of previous studies have shown that, in various decision-making tasks, the DT is linked to the velocity of the increase of cortical preparatory activity ( Afshar et al., 2011; Hanes and Schall, 1996; Murakami et al., 2014; Shenoy et al., 2013; Wang, 2012 2. Afshar, A. ∙ Santhanam, G. ∙ Yu, B.M. ... Single-trial neural correlates of arm movement preparation Neuron. 2011; 71 :555-564 Full Text Full Text (PDF) Scopus (107) PubMed Google Scholar 38. Hanes, D.P. ∙ Schall, J.D. Neural control of voluntary movement initiation Science. 1996; 274 :427-430 Crossref Scopus (787) PubMed Google Scholar 73. Murakami, M. ∙ Vicente, M.I. ∙ Costa, G.M. ... Neural antecedents of self-initiated actions in secondary motor cortex Nat. Neurosci. 2014; 17 :1574-1582 Crossref Scopus (98) PubMed Google Scholar 88. Shenoy, K.V. ∙ Sahani, M. ∙ Churchland, M.M. Cortical control of arm movements: a dynamical systems perspective Annu. Rev. Neurosci. 2013; 36 :337-359 Crossref Scopus (247) PubMed Google Scholar 102. Wang, X.-J. Neural dynamics and circuit mechanisms of decision-making Curr. Opin. Neurobiol. 2012; 22 :1039-1046 Crossref Scopus (64) PubMed Google Scholar ). Given our observation of ramping in the decision-independent pre-motor component of the cerebellar neuroactivity ( Figure 4 A, dPC1), we asked whether the rate of this ramping would be correlated with DT at the trial-by-trial level. We found trials with a shorter DT to exhibit a higher ramping rate and those with a longer DT a lower ramping rate ( Figure 5 A). We then calculated the ramping rate by a linear fit of the population activity ( Z score of dPC1) from heat onset to one second before the turn ( Figure S5 A) and found the ramping rate to be linearly correlated with the logarithm of the DT at the single-trial level ( Figure 5 B). We further confirmed that such an inverse correlation exists across animals at the single-trial level, despite systematic differences in the average DT of each fish ( Figure 5 C).
Next, we asked whether the population ramping rate is predictive of the time of turn initiations on the single-trial level. We obtained the fit parameters for a linear ramping and used this linear model to make a prediction about the expected turn initiation time at any given time point t after the heat onset ( Figure S5 B; see STAR Methods ). As expected, we found the predicted turn initiation time to become more accurate as t approached the turn initiation time point and to be highly predictive for actual turning time within a 20 s window before the turn (22.3 s ± 2.5 s when t = 20 s, mean ± SEM), at the single-trial level ( Figure 5 D; Video S3 ). To provide further causal support for our proposed mechanism, we performed both unilateral and bi-lateral post-training cerebellar lesion experiments. We found that, consistent with our model, both types of lesions, performed independently or together, led to a general increase of the DT ( Figure 5 E) as they reduced the pool of neurons contributing to the bi-hemispheric ramping signal.
eyJraWQiOiI4ZjUxYWNhY2IzYjhiNjNlNzFlYmIzYWFmYTU5NmZmYyIsImFsZyI6IlJTMjU2In0.eyJzdWIiOiI4ZWJhOTI0NGQ4NmRlNWE3OWIwYzgxNDVkOTNjNzEwOSIsImtpZCI6IjhmNTFhY2FjYjNiOGI2M2U3MWViYjNhYWZhNTk2ZmZjIiwiZXhwIjoxNzQ5NjA3MDg1fQ.U0Km3Ymyw-0LxnhzkExiYOnm_L0xJcmsNbUa8bv0XR3Rkln5_CLE6_qCF9is0qzTN5__qA1PS4LYtWmAyro03kB_ueDXlz2g_DZdm8I8RoPjXDg1mcgUTiY17q5jn_t618WBh9w5guqmGsPvH9K8tmmq6JopOJbNnCLGWp_LAFstoiCVNDtVdg0Mo4Gf-N2hYZX6IDErArU6G0ixpP14n8CRpImq0PMfePbczWuJHjsk866tw0xaTmvhZPST69OkEvm2XCc2NjQaNB3-Bk7ole0cmKYaT-YmTj3vecpYf-F5B5UQpWfJgi5ilnJNbNSu83NaWYd4Kj_I7V8BPUId_A Video (8.07 MB) Video S3. Predicting Turn Direction and Turn Time from Neuroactivity at the Single-Trial Level, Related to Figures 4 and 5 Movie of calcium imaging data during a ROAST trial, together with evolution of prediction for both, turn direction and turn time. Prediction is obtained from the neuroactivity at the single trial level. The example is a correct trial, with the training toward the right direction. Video starts 5 s before heat onset and ends 5 s after movement initiation. The prediction is evaluated starting at heat onset and updated until movement initiation. Top panels: Maximum intensity projections of neuron centroids, superimposed on an anatomical reference, Tg(elavl3:H2B-RFP) from the Z-Brain Atlas (Randlett et al., 2015). Filled red square indicates Heat ON, hollow red square indicates Heat OFF. Scale bar, 50 μm. Middle panel: Outcome of a binary prediction for turn direction. Hollow triangles indicate the possible outcomes (left versus right), and filled triangles indicate predicted outcome, color coded green for the right (correct) side and magenta for the left (incorrect) side. Bottom left panel: Evolution of error in predicted turn time, i.e., the difference between the prediction and the actual turn time. Red dashed line indicates heat onset; white dashed line indicates turn initiation. Bottom right panel: Plot of tracked tail segments (n = 9 segments). Each rendered frame is the maximum-projection of 16 consecutive recorded frames, to match behavioral recording frame rate (160 fps) to brain imaging frame rate (10 Hz). Playback is in real time (10 fps).
In principle, such ramping could be facilitated by a gradual increase of activity in individual neurons, which seemed unlikely due to their various complex forms at single-trial level ( Figure S5 C), or from more neurons joining the population of active neurons over time and participating in the generation of ramping activity on a population level. We found a high level of similarity between the ramping activity (dPC1) and the degree of neuronal participation (r = 0.799, ∗∗∗ p < 0.0001, see STAR Methods ), while the observed correlation of single-neuron activities with the population ramping activity was lower and ~82% of all neurons showed a lower degree of correlation with the population ramping activity compared to the degree of neuronal participation ( Figure S5 D). This suggests that an increase in the number of active neurons is more likely to be the source of observed ramping activity than a gradual increase of activity in individual neurons. The remaining 18% of neurons overlapped with the ipsilateral ARTR ( Figure S5 E).
We next aimed to determine which of the main cerebellar cell types, namely, the Purkinje, granule, and eurydendroid cells, were the primary contributors to cerebellar ramping activity. We used Tg(gSA2AzGFF152B; UAS:GCaMP6s) ( Filosa et al., 2016; Knogler et al., 2017; Takeuchi et al., 2015 26. Filosa, A. ∙ Barker, A.J. ∙ Dal Maschio, M. ... Feeding State Modulates Behavioral Choice and Processing of Prey Stimuli in the Zebrafish Tectum Neuron. 2016; 90 :596-608 Full Text Full Text (PDF) PubMed Google Scholar 50. Knogler, L.D. ∙ Markov, D.A. ∙ Dragomir, E.I. ... Sensorimotor Representations in Cerebellar Granule Cells in Larval Zebrafish Are Dense, Spatially Organized, and Non-temporally Patterned Curr. Biol. 2017; 27 :1288-1302 Full Text Full Text (PDF) Scopus (31) PubMed Google Scholar 94. Takeuchi, M. ∙ Matsuda, K. ∙ Yamaguchi, S. ... Establishment of Gal4 transgenic zebrafish lines for analysis of development of cerebellar neural circuitry Dev. Biol. 2015; 397 :1-17 Crossref Scopus (28) PubMed Google Scholar ), which specifically labels the granule cells with GCaMP and allowed us to separate the contribution of granule cells and the cerebellar output neurons. We found the granule cells to display strong pre-motor activity ( Figure 6 A, i). To differentiate between the activity of the Purkinje and eurydendroid cells, which are intermingled in the zebrafish cerebellum ( Bae et al., 2009; Takeuchi et al., 2015 9. Bae, Y.K. ∙ Kani, S. ∙ Shimizu, T. ... Anatomy of zebrafish cerebellum and screen for mutations affecting its development Dev. Biol. 2009; 330 :406-426 Crossref Scopus (143) PubMed Google Scholar 94. Takeuchi, M. ∙ Matsuda, K. ∙ Yamaguchi, S. ... Establishment of Gal4 transgenic zebrafish lines for analysis of development of cerebellar neural circuitry Dev. Biol. 2015; 397 :1-17 Crossref Scopus (28) PubMed Google Scholar ), we utilized Tg(Huc:H2B-GCaMP6s; GAD1b:RFP) ( Freeman et al., 2014; Satou et al., 2013 27. Freeman, J. ∙ Vladimirov, N. ∙ Kawashima, T. ... Mapping brain activity at scale with cluster computing Nat. Methods. 2014; 11 :941-950 Crossref Scopus (129) PubMed Google Scholar 84. Satou, C. ∙ Kimura, Y. ∙ Hirata, H. ... Transgenic tools to characterize neuronal properties of discrete populations of zebrafish neurons Development. 2013; 140 :3927-3931 Crossref Scopus (73) PubMed Google Scholar ) in which the Purkinje cells are most strongly labeled in GAD1b:RFP ( Bae et al., 2009 9. Bae, Y.K. ∙ Kani, S. ∙ Shimizu, T. ... Anatomy of zebrafish cerebellum and screen for mutations affecting its development Dev. Biol. 2009; 330 :406-426 Crossref Scopus (143) PubMed Google Scholar ). We took advantage of the anatomy and the fact that the Purkinje cells in fish are predominately located in dorsal layer of the cerebellum ( Bae et al., 2009; Takeuchi et al., 2015 9. Bae, Y.K. ∙ Kani, S. ∙ Shimizu, T. ... Anatomy of zebrafish cerebellum and screen for mutations affecting its development Dev. Biol. 2009; 330 :406-426 Crossref Scopus (143) PubMed Google Scholar 94. Takeuchi, M. ∙ Matsuda, K. ∙ Yamaguchi, S. ... Establishment of Gal4 transgenic zebrafish lines for analysis of development of cerebellar neural circuitry Dev. Biol. 2015; 397 :1-17 Crossref Scopus (28) PubMed Google Scholar ). We found pre-motor activity, although at different levels, for all three cell types ( Figure 6 A, i–iii). Individual neurons exhibited a response that was either positively or negatively tuned to the decision outcome. We found that more than 70% of recorded neurons of these three cell types displayed significant differences in pre-motor activity in correct compared to the incorrect trials. This could be also clearly observed for the Purkinje cell population, despite of its overall lower level of premotor activity ( Figure 6 A, ii), suggesting that our observed pre-motor turn direction prediction is driven by the neuroactivity of a large, diverse cerebellar population. Given that the eurydendroid cells are known to integrate input from both the granule and Purkinje cells ( Figure 6 A, iv), our data suggest that the main source of the observed pre-motor ramping activity predictive of the DT is stemming mainly from the granule cells rather than the Purkinje neurons. However, we observe a significant increase in post-turn activity in the Purkinje cells (p < 0.05) in incorrect trials that may represent feedback via the climbing fibers. This observation is also consistent with recent mammalian studies showing that the granule cells represent learning and reward-related signals ( Giovannucci et al., 2017; Wagner et al., 2019, 2017 30. Giovannucci, A. ∙ Badura, A. ∙ Deverett, B. ... Cerebellar granule cells acquire a widespread predictive feedback signal during motor learning Nat. Neurosci. 2017; 20 :727-734 Crossref Scopus (55) PubMed Google Scholar 98. Wagner, M.J. ∙ Kim, T.H. ∙ Savall, J. ... Cerebellar granule cells encode the expectation of reward Nature. 2017; 544 :96-100 Crossref Scopus (122) PubMed Google Scholar 99. Wagner, M.J. ∙ Kim, T.H. ∙ Kadmon, J. ... Shared Cortex-Cerebellum Dynamics in the Execution and Learning of a Motor Task Cell. 2019; 177 :669-682 Full Text Full Text (PDF) Scopus (13) PubMed Google Scholar ).

Section: Discussion

Supported by the conjecture that brain-wide processing of information is necessary for goal-directed behavior, we have used an operant learning task to investigate the neural basis underlying decision making in larval zebrafish. The combination of our behavioral assay with high-speed whole-brain calcium imaging based on LFM has allowed us to capture global and local brain state dynamics at cellular resolution, and their relationship to behavior at the trial-by-trial level. Our combination of brain-wide imaging and neuronal population analyses has uniquely enabled the study of dynamic changes in functional connectivity that occur on the timescale of seconds to minutes and are predictive of variability in decision timing and outcome, which could be masked by the requirement of averaging across task repetitions to reduce noise ( Figure S6 ). Based on our observations and the known connectivity of the involved brain regions, we propose a model for how sensory information is transformed into decision and motor signals, and how learning and reward prediction is facilitated in this process ( Figure 6 B). The Te ( Portavella and Vargas, 2005 78. Portavella, M. ∙ Vargas, J.P. Emotional and spatial learning in goldfish is dependent on different telencephalic pallial systems Eur. J. Neurosci. 2005; 21 :2800-2806 Crossref Scopus (62) PubMed Google Scholar ), thalamus ( Komura et al., 2001; Zhu et al., 2018 53. Komura, Y. ∙ Tamura, R. ∙ Uwano, T. ... Retrospective and prospective coding for predicted reward in the sensory thalamus Nature. 2001; 412 :546-549 Crossref Scopus (170) PubMed Google Scholar 108. Zhu, Y. ∙ Nachtrab, G. ∙ Keyes, P.C. ... Dynamic salience processing in paraventricular thalamus gates associative learning Science. 2018; 362 :423-429 Crossref Scopus (18) PubMed Google Scholar ), and Hb ( Andalman et al., 2019; Hikosaka, 2010; Lee et al., 2010; Matsumoto and Hikosaka, 2007 7. Andalman, A.S. ∙ Burns, V.M. ∙ Lovett-Barron, M. ... Neuronal Dynamics Regulating Brain and Behavioral State Transitions Cell. 2019; 177 :970-985 Full Text Full Text (PDF) Scopus (8) PubMed Google Scholar 40. Hikosaka, O. The habenula: from stress evasion to value-based decision-making Nat. Rev. Neurosci. 2010; 11 :503-513 Crossref Scopus (464) PubMed Google Scholar 56. Lee, A. ∙ Mathuru, A.S. ∙ Teh, C. ... The habenula prevents helpless behavior in larval zebrafish Curr. Biol. 2010; 20 :2211-2216 Full Text Full Text (PDF) Scopus (103) PubMed Google Scholar 67. Matsumoto, M. ∙ Hikosaka, O. Lateral habenula as a source of negative reward signals in dopamine neurons Nature. 2007; 447 :1111-1115 Crossref Scopus (690) PubMed Google Scholar ) are known to be involved in the regulation of learning, reward prediction, and internal brain states and can instruct the cerebellum on action selection. Upon heat onset, the sensory signal is relayed to the Te ( Figure 2 E), which suppresses neuroactivity in the thalamus and activates the Hb, which displays ramping-like activity during the pre-motor period. These signals, as well as other sensory and motor signals, are integrated by the cerebellum through the mossy fibers. Following movement initiation, the cerebellum sends motor information back to the thalamus, thereby forming a closed loop. Likely because our assay involves a learning and motor planning component, the overall functional circuitry spans the entire brain ( Figure 6 B), in contrast to a heat-evoked sensorimotor transformation that involves a hindbrain local circuit, yet also shows a strong response to heat in the Te and the Hb ( Haesemeyer et al., 2018 37. Haesemeyer, M. ∙ Robson, D.N. ∙ Li, J.M. ... A Brain-wide Circuit Model of Heat-Evoked Swimming Behavior in Larval Zebrafish Neuron. 2018; 98 :817-831 Full Text Full Text (PDF) Scopus (13) PubMed Google Scholar ).
This input to the cerebellum could be further amplified by the divergent mapping of the mossy fiber input to the granular cells ( Huang et al., 2013; Ito, 2006; Li et al., 2013 43. Huang, C.C. ∙ Sugino, K. ∙ Shima, Y. ... Convergence of pontine and proprioceptive streams onto multimodal cerebellar granule cells eLife. 2013; 2 :e00400 Crossref Scopus (106) PubMed Google Scholar 46. Ito, M. Cerebellar circuitry as a neuronal machine Prog. Neurobiol. 2006; 78 :272-303 Crossref Scopus (488) PubMed Google Scholar 58. Li, W.K. ∙ Hausknecht, M.J. ∙ Stone, P. ... Using a million cell simulation of the cerebellum: network scaling and task generality Neural Netw. 2013; 47 :95-102 Crossref Scopus (19) PubMed Google Scholar ) and then integrated by the eurydendroid neurons ( Ito, 2008 47. Ito, M. Control of mental activities by internal models in the cerebellum Nat. Rev. Neurosci. 2008; 9 :304-313 Crossref Scopus (615) PubMed Google Scholar ) and fed into the ARTR, i.e., the hindbrain oscillator ( Figure 6 B). The underlying divergence of this circuitry at the level of the granular cells, their abundance in the cerebellum ( Ito, 2006 46. Ito, M. Cerebellar circuitry as a neuronal machine Prog. Neurobiol. 2006; 78 :272-303 Crossref Scopus (488) PubMed Google Scholar ), and the observed pre-motor ramping activity explain our observation of the neuronal participation model ( Figure 6 B) and account for the granular cells as a main source of ramping. On the other hand, the observed contribution to the ramping by a small neuronal population with a gradual increase of activity ( Figure S5 D) can be explained by the activity of the ARTR neurons, which presumably receive input from the eurydendroid neurons. This notion is also directly supported by the observation that this small neuronal population is anatomically overlapping with the ARTR neurons ( Figure S5 E).
The bilateral relationship of the cerebellar neurodynamics that are predictive of turn direction and DT can be explained within a “competition-cooperation” framework, in which turn directions are determined by the difference in neuroactivity between the ipsilateral and contralateral hemispheres, and the rate of bi-hemispheric population ramping activity predicts the DT. After motor response, two feedback signals are sent: the inferior olive activates the contralateral Purkinje cells via climbing fibers ( Apps and Garwicz, 2005 8. Apps, R. ∙ Garwicz, M. Anatomical and physiological foundations of cerebellar information processing Nat. Rev. Neurosci. 2005; 6 :297-311 Crossref Scopus (317) PubMed Google Scholar ), while a self-excitatory ipsilateral feedback is sent to the ARTR ( Dunn et al., 2016 24. Dunn, T.W. ∙ Mu, Y. ∙ Narayan, S. ... Brain-wide mapping of neural activity controlling zebrafish exploratory locomotion eLife. 2016; 5 :e12741 Crossref PubMed Google Scholar ). The signal to the contralateral Purkinje cells can serve as an error signal that, together with inputs from other brain areas, facilitates synaptic plasticity ( Albus, 1971; Apps and Garwicz, 2005; Dempsey and Sawtell, 2016; Marr, 1969 5. Albus, J.S. A theory of cerebellar function Math. Biosci. 1971; 10 :25-61 Crossref Scopus (1487) Google Scholar 8. Apps, R. ∙ Garwicz, M. Anatomical and physiological foundations of cerebellar information processing Nat. Rev. Neurosci. 2005; 6 :297-311 Crossref Scopus (317) PubMed Google Scholar 22. Dempsey, C. ∙ Sawtell, N.B. The Timing Is Right for Cerebellar Learning Neuron. 2016; 92 :931-933 Full Text Full Text (PDF) Scopus (0) PubMed Google Scholar 66. Marr, D. A theory of cerebellar cortex J. Physiol. 1969; 202 :437-470 Crossref Scopus (2181) PubMed Google Scholar ). The preparatory activity, i.e., the neural signature underlying motor planning and decision making ( Churchland et al., 2010; Svoboda and Li, 2018 16. Churchland, M.M. ∙ Cunningham, J.P. ∙ Kaufman, M.T. ... Cortical preparatory activity: representation of movement or first cog in a dynamical machine? Neuron. 2010; 68 :387-400 Full Text Full Text (PDF) Scopus (180) PubMed Google Scholar 93. Svoboda, K. ∙ Li, N. Neural mechanisms of movement planning: motor cortex and beyond Curr. Opin. Neurobiol. 2018; 49 :33-41 Crossref Scopus (39) PubMed Google Scholar ), is not an innate feature but emerges during learning of a task that requires optimization of expected reward for different possible actions ( Wagner et al., 2019 99. Wagner, M.J. ∙ Kim, T.H. ∙ Kadmon, J. ... Shared Cortex-Cerebellum Dynamics in the Execution and Learning of a Motor Task Cell. 2019; 177 :669-682 Full Text Full Text (PDF) Scopus (13) PubMed Google Scholar ). We demonstrate this explicitly by showing that our observed cerebellar ramping activity uniquely emerges through our ROAST paradigm rather than representing an innate pre-motor activity feature of the cerebellum as it is absent in trials prior to training ( Figure 3 B, iv). In mammals, the neuronal processes underlying decision making and preparation of goal-directed movements have been mainly attributed to the cortex ( Miller, 2000; Shenoy et al., 2013; Svoboda and Li, 2018 70. Miller, E.K. The prefrontal cortex and cognitive control Nat. Rev. Neurosci. 2000; 1 :59-65 Crossref PubMed Google Scholar 88. Shenoy, K.V. ∙ Sahani, M. ∙ Churchland, M.M. Cortical control of arm movements: a dynamical systems perspective Annu. Rev. Neurosci. 2013; 36 :337-359 Crossref Scopus (247) PubMed Google Scholar 93. Svoboda, K. ∙ Li, N. Neural mechanisms of movement planning: motor cortex and beyond Curr. Opin. Neurobiol. 2018; 49 :33-41 Crossref Scopus (39) PubMed Google Scholar ), while motor coordination functions, such as fine motor control and execution, have been traditionally associated with the cerebellum ( Glickstein, 1993; Manto et al., 2012 32. Glickstein, M. Motor skills but not cognitive tasks Trends Neurosci. 1993; 16 :450-451, discussion 453–454 Full Text (PDF) PubMed Google Scholar 65. Manto, M. ∙ Bower, J.M. ∙ Conforto, A.B. ... Consensus paper: roles of the cerebellum in motor control--the diversity of ideas on cerebellar involvement in movement Cerebellum. 2012; 11 :457-487 Crossref Scopus (300) PubMed Google Scholar ). Our observations and interpretations are consistent with a number of recent studies that have challenged the traditional views of the cerebellum by providing evidence for cognitive functions such as in learning, language, evidence accumulation, and reward prediction ( Deverett et al., 2019; Giovannucci et al., 2017; Raymond and Medina, 2018; Schmahmann and Sherman, 1998; Sokolov et al., 2017; Strick et al., 2009; Timmann and Daum, 2007 23. Deverett, B. ∙ Kislin, M. ∙ Tank, D.W. ... Cerebellar disruption impairs working memory during evidence accumulation Nat. Commun. 2019; 10 :3128 Crossref Scopus (0) PubMed Google Scholar 30. Giovannucci, A. ∙ Badura, A. ∙ Deverett, B. ... Cerebellar granule cells acquire a widespread predictive feedback signal during motor learning Nat. Neurosci. 2017; 20 :727-734 Crossref Scopus (55) PubMed Google Scholar 82. Raymond, J.L. ∙ Medina, J.F. Computational Principles of Supervised Learning in the Cerebellum Annu. Rev. Neurosci. 2018; 41 :233-253 Crossref Scopus (20) PubMed Google Scholar 85. Schmahmann, J.D. ∙ Sherman, J.C. The cerebellar cognitive affective syndrome Brain. 1998; 121 :561-579 Crossref Scopus (1864) PubMed Google Scholar 89. Sokolov, A.A. ∙ Miall, R.C. ∙ Ivry, R.B. The Cerebellum: Adaptive Prediction for Movement and Cognition Trends Cogn. Sci. 2017; 21 :313-332 Full Text Full Text (PDF) Scopus (112) PubMed Google Scholar 91. Strick, P.L. ∙ Dum, R.P. ∙ Fiez, J.A. Cerebellum and nonmotor function Annu. Rev. Neurosci. 2009; 32 :413-434 Crossref Scopus (832) PubMed Google Scholar 96. Timmann, D. ∙ Daum, I. Cerebellar contributions to cognitive functions: a progress report after two decades of research Cerebellum. 2007; 6 :159-162 Crossref Scopus (172) PubMed Google Scholar ).

Section: STAR★Methods

REAGENT or RESOURCE SOURCE IDENTIFIER Experimental Models: Organisms/Strains Tg( elavl3:H2B-GCaMP6s ) ( Vladimirov et al., 2014 97. Vladimirov, N. ∙ Mu, Y. ∙ Kawashima, T. ... Light-sheet functional imaging in fictively behaving zebrafish Nat. Methods. 2014; 11 :883-884 Crossref Scopus (111) PubMed Google Scholar ) N/A Tg(gSA2AzGFF152B) ( Takeuchi et al., 2015 94. Takeuchi, M. ∙ Matsuda, K. ∙ Yamaguchi, S. ... Establishment of Gal4 transgenic zebrafish lines for analysis of development of cerebellar neural circuitry Dev. Biol. 2015; 397 :1-17 Crossref Scopus (28) PubMed Google Scholar ) N/A Tg(Huc:H2B-GCaMP6s; GAD1b:RFP) ( Freeman et al., 2014; Satou et al., 2013 27. Freeman, J. ∙ Vladimirov, N. ∙ Kawashima, T. ... Mapping brain activity at scale with cluster computing Nat. Methods. 2014; 11 :941-950 Crossref Scopus (129) PubMed Google Scholar 84. Satou, C. ∙ Kimura, Y. ∙ Hirata, H. ... Transgenic tools to characterize neuronal properties of discrete populations of zebrafish neurons Development. 2013; 140 :3927-3931 Crossref Scopus (73) PubMed Google Scholar ) N/A Tg(UAS:GCaMP6s) ( Filosa et al., 2016 26. Filosa, A. ∙ Barker, A.J. ∙ Dal Maschio, M. ... Feeding State Modulates Behavioral Choice and Processing of Prey Stimuli in the Zebrafish Tectum Neuron. 2016; 90 :596-608 Full Text Full Text (PDF) PubMed Google Scholar ) N/A Software and Algorithms μManager Open Imaging https://micro-manager.org/ MATLAB (Behavioral and imaging analysis, modeling) MathWorks https://www.mathworks.com/products/matlab.html FIJI (ImageJ) (Image Processing) NIH http://fiji.sc Custom data-processing pipeline for LFM data ( Prevedel et al., 2014 80. Prevedel, R. ∙ Yoon, Y.G. ∙ Hoffmann, M. ... Simultaneous whole-animal 3D imaging of neuronal activity using light-field microscopy Nat. Methods. 2014; 11 :727-730 Crossref Scopus (297) PubMed Google Scholar ) https://static-content.springer.com/esm/art%3A10.1038%2Fnmeth.2964/MediaObjects/41592_2014_BFnmeth2964_MOESM189_ESM.zip Demixed Principal Component Analysis (dPCA) ( Kobak et al., 2016 51. Kobak, D. ∙ Brendel, W. ∙ Constantinidis, C. ... Demixed principal component analysis of neural population data eLife. 2016; 5 :e10989 Crossref PubMed Google Scholar ) https://github.com/machenslab/dPCA t-Distributed Stochastic Neighbor Embedding (t-SNE) ( Maaten and Hinton, 2008 62. Maaten, L.V.D. ∙ Hinton, G. Visualizing Data using t-SNE J. Mach. Learn. Res. 2008; 9 :2579-2605 Google Scholar ) https://lvdmaaten.github.io/tsne/ Independent Component Analysis (FastICA) ( Hyvärinen and Oja, 2000 45. Hyvärinen, A. ∙ Oja, E. Independent component analysis: algorithms and applications Neural Netw. 2000; 13 :411-430 Crossref Scopus (5053) PubMed Google Scholar ) https://research.ics.aalto.fi/ica/fastica/ ScanImage ( Pologruto et al., 2003 77. Pologruto, T.A. ∙ Sabatini, B.L. ∙ Svoboda, K. ScanImage: flexible software for operating laser scanning microscopes Biomed. Eng. Online. 2003; 2 :13 Crossref Scopus (603) PubMed Google Scholar ) http://scanimage.vidriotechnologies.com/display/SIH/ScanImage+Home CaImAn-MATLAB ( Giovannucci et al., 2019 31. Giovannucci, A. ∙ Friedrich, J. ∙ Gunn, P. ... CaImAn an open source tool for scalable calcium imaging data analysis eLife. 2019; 8 :413 Crossref Scopus (8) Google Scholar ) https://github.com/flatironinstitute/CaImAn-MATLAB DeepLabCut 2.0 ( Nath et al., 2019 74. Nath, T. ∙ Mathis, A. ∙ Chen, A.C. ... Using DeepLabCut for 3D markerless pose estimation across species and behaviors Nat. Protoc. 2019; 14 :2152-2176 Crossref Scopus (0) PubMed Google Scholar ) https://github.com/AlexEMG/DeepLabCut Open table in a new tab
Further information and requests for resources should be directed to the lead contact, Alipasha Vaziri ( vaziri@rockefeller.edu ). This study did not generate new unique reagents.
Experiments were carried out in accordance with protocols approved by the Institutional Animal Care and Use Committee. Zebrafish ( Danio rerio ) lines used in this study for imaging and behavioral experiments were 7-9 day-post-fertilization Tg(elavl3:H2B-GCaMP6s) ( Vladimirov et al., 2014 97. Vladimirov, N. ∙ Mu, Y. ∙ Kawashima, T. ... Light-sheet functional imaging in fictively behaving zebrafish Nat. Methods. 2014; 11 :883-884 Crossref Scopus (111) PubMed Google Scholar ) in Nacre or Casper mutant background. Adult fish were housed in a facility at 28.5°C with lights on between 8 am and 10 pm. No statistical methods were used to pre-determine sample size.
7-9 day-post-fertilization zebrafish larvae were embedded in 2%–2.5% low-melting-temperature agarose in a custom-made chamber on a glass slide and then immersed in fish water. The agarose around the tail, caudal to the swim bladder, was removed to free the tail of the larvae and then incubated for 6-8 hours for further solidification. Under this head-fixed condition, larvae were placed above a camera (Grasshopper3, PointGrey) for tracking tail movements at 160 Hz and placed under a 20 × /0.5-NA water-immersion objective (Olympus) for whole-brain calcium imaging with an upright light-field microscope at 10 Hz ( Nöbauer et al., 2017; Prevedel et al., 2014 75. Nöbauer, T. ∙ Skocek, O. ∙ Pernía-Andrade, A.J. ... Video rate volumetric Ca 2+ imaging across cortex using seeded iterative demixing (SID) microscopy Nat. Methods. 2017; 14 :811-818 Crossref Scopus (31) PubMed Google Scholar 80. Prevedel, R. ∙ Yoon, Y.G. ∙ Hoffmann, M. ... Simultaneous whole-animal 3D imaging of neuronal activity using light-field microscopy Nat. Methods. 2014; 11 :727-730 Crossref Scopus (297) PubMed Google Scholar ). The tail was illuminated with a near-infrared (NIR) 950 nm light-emitting diode (LED), and GCaMP was excited with a blue LED (pe-2, CoolLED). Custom-written MATLAB (MathWorks) software was used to extract the tail angle, using the resting tail position as the reference, with positive angles representing right turns and zero degrees corresponding to a straight tail. Heat stimulus was delivered using 980-nm fiber-coupled laser (Roithner Lasertechnik), collimated via a collimator (Thorlabs, F220FC-1064) and then projected to the head of the fish along the midline, with the spot diameter of 2.0 mm (measured power: 300 mW). A 950-nm bandpass filter (FB950-10, Thorlabs) was placed in front of the Grasshopper camera to reject scattered visible light and crosstalk from the heat stimulus. Real-time heat stimuli were controlled by a data acquisition board (USB-6008, National Instruments) and modulated by the extracted tail angle exceeding a threshold (35°) in a closed loop. For movement events with multiple tail deflections, only the first deflection was considered.
Image acquisition of the LFM was controlled using Micro-Manager ( Stuurman et al., 2007 92. Stuurman, N. ∙ Amdodaj, N. ∙ Vale, R. Micro-Manager: Open Source software for light microscope imaging Microscopy Today. 2007; 15 :42-43 Crossref Google Scholar ) and triggered by the custom MATLAB software. The whole setup was controlled from a dual-CPU workstation (Z820, HP). 3D reconstruction of the LFM images was carried out offline with the volume of ~700 μm × 700 μm × 200 μm with 51 z-planes and fed into a custom-written pipeline for neuronal signal extraction based on the approach proposed by ( Mukamel et al., 2009; Prevedel et al., 2014 71. Mukamel, E.A. ∙ Nimmerjahn, A. ∙ Schnitzer, M.J. Automated analysis of cellular signals from large-scale calcium imaging data Neuron. 2009; 63 :747-760 Full Text Full Text (PDF) Scopus (298) PubMed Google Scholar 80. Prevedel, R. ∙ Yoon, Y.G. ∙ Hoffmann, M. ... Simultaneous whole-animal 3D imaging of neuronal activity using light-field microscopy Nat. Methods. 2014; 11 :727-730 Crossref Scopus (297) PubMed Google Scholar ): The reconstructed LFM data, which is a timeseries of volumetric frames, was first de-trended by dividing each volumetric frame by a slowly-varying fit to the frame means. To reduce the data to an amount tractable by Independent Component Analysis (ICA), the variance over time was computed for each voxel, and the highest-variance voxels, as well as 2-3 continuous time ranges amounting to 10% of the total recording time were selected to serve as input data to the ICA. The entire recording volume was divided into 6 slightly overlapping sub-volumes. The selected voxels and time points were factorized independently for each sub-volume using the FastICA algorithm (initialized by PCA) ( Hyvärinen and Oja, 2000 45. Hyvärinen, A. ∙ Oja, E. Independent component analysis: algorithms and applications Neural Netw. 2000; 13 :411-430 Crossref Scopus (5053) PubMed Google Scholar ), resulting in a set of spatial filters and associated temporal signals. The spatial filters were thresholded to detect regions of interest (ROIs), and ROIs compatible with shape and size of neurons were kept. Duplicate ROIs in the overlapping sub-volume regions were merged, resulting in the final set of neuron spatial filters. Finally, the corresponding neuron activity signals were extracted from the original reconstructed LFM dataset by summing (for each timestep) over the voxel brightness values in each neuron spatial filter.
We aimed to find a robust behavioral paradigm that involved learning and short-term memory while exhibiting a delay period from the onset of an instructing sensory cue to the execution of motor response, during which the neuronal basis of motor planning and decision making could be studied. While previously used assays in larval zebrafish for sensorimotor transformation lack the above features, most of the typically used assays in rodents or primates study motor planning by introducing a delay period from the onset of the stimulus to a go cue, after which the animal is trained to initiate a motor response ( Shenoy et al., 2013; Svoboda and Li, 2018 88. Shenoy, K.V. ∙ Sahani, M. ∙ Churchland, M.M. Cortical control of arm movements: a dynamical systems perspective Annu. Rev. Neurosci. 2013; 36 :337-359 Crossref Scopus (247) PubMed Google Scholar 93. Svoboda, K. ∙ Li, N. Neural mechanisms of movement planning: motor cortex and beyond Curr. Opin. Neurobiol. 2018; 49 :33-41 Crossref Scopus (39) PubMed Google Scholar ). However, motor responses of animals engaged in naturalistic action selections are self-initiated and happen in the absence of a go cue. The ROAST operant conditioning paradigm ( Figure 1 A) addresses both issues. Typically, each recording consisted of 20-25 trials and lasted for one hour. In each trial, heat stimulus was delivered 5 s after the trial started and was terminated immediately when a turn in the correct direction exceeded a threshold (35 degree). If an animal failed to make a correct movement within 100 s, the laser was switched off and the fish received a 20 s break before the start of the next trial. Otherwise, if an animal made a correct movement, the heat stimulus was turned off and the fish received a break for the rest of the 100 s trial. The full training protocol for each fish consisted of two training blocks (one left- and one right-training block), with each block containing 20-25 trials. Since individual fish exhibited a bias for a specific direction ( Li, 2013 57. Li, J.M. Identification of an operant learning circuit by whole brain functional imaging in larval zebrafish. Doctoral dissertation Harvard University, 2013 Google Scholar ), the reward direction in the first training block was chosen against this bias and was subsequently reversed in the second block. Prior to the first block, 3-5 probe trials were conducted to determine the pre-existing bias of individual fish. For “learners” (see below), the same larvae were imaged twice for two training blocks, over a total of two hours, and with a 0.5 h break in between. A given trial was classified as correct when the first heat-evoked turn of the animal was in the reward direction, and a fish was defined as a “learner” when the asymptote of the learning curve (modeled by a sigmoidal function that was fit to the outcomes) in both blocks reached a threshold of 70% correct. Fish that learned in the first but not in the second block were defined as intermediate learners and their data was not included in the data analysis. If a fish failed to learn in the first block, it was categorized as a non-learner and was not considered further for the second training block. Overall, we behaviorally trained and recorded data from 26 larvae resulting in 39% learners, 46% non-learners and 15% intermediate learners, which were not included in further analyses. In all further analyses, training blocks were analyzed separately, such that a “correct trial” always corresponded to a turn in the left or right direction.
Each neuronal time series was de-trended individually to correct for photo-bleaching, and then normalized as ΔF/F0 = (F-F0)/F0, where F is the fluorescence of the neuron at a given time point and F0 is the average fluorescence of the neuron across the entire recording. Noise was removed via total variation regularization by calculating the cumulative sum of the de-noised time derivatives ( Chartrand, 2011 13. Chartrand, R. Numerical differentiation of noisy, nonsmooth data Appl. Math. (Irvine). 2011; 2011 :164564 Google Scholar ). The de-noised time series X of each neuron were then normalized by taking the Z-score, given as (X – mean(X))/SD(X), for further analysis. This pre-processing procedure and subsequent analyses were performed using MATLAB (MathWorks).
In addition to online tracking, offline behavioral classification was used to classify the tail movements as left turns, right turns, and struggles (or swimming), using a method similar to the one described by ( Haesemeyer et al., 2018 37. Haesemeyer, M. ∙ Robson, D.N. ∙ Li, J.M. ... A Brain-wide Circuit Model of Heat-Evoked Swimming Behavior in Larval Zebrafish Neuron. 2018; 98 :817-831 Full Text Full Text (PDF) Scopus (13) PubMed Google Scholar ). Briefly, since larval zebrafish move in bouts rather than swim continuously, and since the bout duration lasts for about 250-400 ms in head-restrained fish ( Severi et al., 2014 86. Severi, K.E. ∙ Portugues, R. ∙ Marques, J.C. ... Neural control and modulation of swimming speed in the larval zebrafish Neuron. 2014; 83 :692-707 Full Text Full Text (PDF) Scopus (75) PubMed Google Scholar ), the movement bout was detected by scanning through the time series of the tracked tail angle in a sliding window of 50 frames (corresponding to ~312 ms at a frame rate of 160 Hz). Within the time window of one bout, the time of movement initiation was set to the time point when the tail angle exceeded 5° for the first time. Then, the bias of tail movements was calculated, and the bout was categorized as a unilateral ‘turn’ or a bilateral ‘struggle’ with the threshold of bias at 1.05. The turn direction was determined from the sign of the tail angle, negative or positive, for left and right turns (labeled “TurnL” and “TurnR”), respectively.
Decision time (DT) was measured as the time between heat onset to the initiation of the first turn, regardless of correct or incorrect outcome, in a given trial. Because the temperature changes from the heat stimulus became relatively stable 5 s after heat onset, only trials with DT longer than 5 s were used, to minimize stimulus-related variation across trials.
To visualize the temporal evolution of brain states toward correct versus incorrect decisions, the time-dependent correlation (Pearson’s r) was calculated between each brain state in a trial and a reference brain state determined by averaging all brain states of the same type (i.e., correct versus incorrect). Partial correlation coefficients were utilized to factor out the heat-induced neuronal contribution both in correct and incorrect trials.
The partial correlation coefficient r of X and Y while controlling for the effect of Z is given as: 𝑟 𝑋 ⁢ 𝑌 ⋅ 𝑍 = 𝑟 𝑋 ⁢ 𝑌 − 𝑟 𝑋 ⁢ 𝑍 ⁢ 𝑟 𝑌 ⁢ 𝑍 √ ( 1 − 𝑟 2 𝑋 ⁢ 𝑍 ) ⁢ ( 1 − 𝑟 2 𝑌 ⁢ 𝑍 ) Here, 𝑟 𝑋 ⁢ 𝑌 is the pairwise correlation coefficient: 𝑟 𝑋 ⁢ 𝑌 = 𝑐 ⁢ 𝑜 ⁢ 𝑣 ⁡ ( 𝑋 , 𝑌 ) 𝜎 𝑋 ⁢ 𝜎 𝑌 Partial correlation coefficients were computed in MATLAB (MathWorks), using the function partialcorr() .
t-Distributed Stochastic Neighbor Embedding (t-SNE) ( Maaten and Hinton, 2008 62. Maaten, L.V.D. ∙ Hinton, G. Visualizing Data using t-SNE J. Mach. Learn. Res. 2008; 9 :2579-2605 Google Scholar ) was applied to the sequence of brain states, where each “brain state” input vector was the activity state of all neurons at a given time point. Briefly, t-SNE transforms the structure contained in high-dimensional data into a two- or three-dimensional map by minimizing the Kullback-Leiber divergence between the Gaussian similarity matrix of the data points and the t-distributed similarity matrix of the map points. t-SNE maintains the local structure by keeping similar data points close to each other on the t-SNE map ( Maaten and Hinton, 2008 62. Maaten, L.V.D. ∙ Hinton, G. Visualizing Data using t-SNE J. Mach. Learn. Res. 2008; 9 :2579-2605 Google Scholar ). Even though t-SNE has the disadvantage of not providing the same visualization on each run of the optimizer, nor an explicit transformation matrix that would be required to establish a quantitative correspondence between the t-SNE map and neuroanatomy, it nevertheless provides an effective, exploratory tool for identifying hidden, low-dimensional structure in high-dimensional data ( Davie et al., 2018; Grün and van Oudenaarden, 2015; LeCun et al., 2015; Macosko et al., 2015 21. Davie, K. ∙ Janssens, J. ∙ Koldere, D. ... Cell. 2018; 174 :982-998 Full Text Full Text (PDF) Scopus (0) PubMed Google Scholar 35. Grün, D. ∙ van Oudenaarden, A. Design and Analysis of Single-Cell Sequencing Experiments. Cell. 2015; 163 :799-810 Full Text Full Text (PDF) Scopus (0) PubMed Google Scholar 55. LeCun, Y. ∙ Bengio, Y. ∙ Hinton, G. Deep learning. Nature. 2015; 521 :436-444 Crossref Scopus (0) PubMed Google Scholar 63. Macosko, E.Z. ∙ Basu, A. ∙ Satija, R. ... Highly Parallel Genome-wide Expression Profiling of Individual Cells Using Nanoliter Droplets. Cell. 2015; 161 :1202-1214 Full Text Full Text (PDF) Scopus (0) PubMed Google Scholar ). Brain states consisting of 25,000 to 35,000 input vectors were mapped onto a 2D t-SNE map using value of 1000 for the “perplexity,” which is a critical hyper-parameter in t-SNE. Other values for perplexity, such as 500-2000, gave similar results. t-SNE maps from different animals were normalized to [0,1] in both the x- and y- dimension. Pairwise distances of all pairs of brain states were measured by their Euclidian distance in the 2D t-SNE map.
To highlight task-relevant activity, we embedded regressors of the behavior and the heat stimulus into the neuronal space as “baits.” We defined four regressors: “Turn L,” “Turn R,” “Heat ON” and “Heat OFF,” obtained by convolving the actual time series of each regressor with the temporal response kernel of our calcium sensor (NL-GCaMP6s). Then t-SNE was applied to the “neuronal space,” where each input vector was the normalized time series of one neuron in one recording, plus the four behavior- and stimulus regressors. 4000 to 6000 inputs were transformed into a 2D t-SNE map. Perplexity values ranging from 40 to 120 were tested and then chosen such that in the resulting map the regressors were mostly well-separated. Hierarchical clustering was then performed on the chosen t-SNE map using the criterion of Ward’s minimum variance method ( Ward, 2012 103. Ward, Jr., J.H. Hierarchical Grouping to Optimize an Objective Function J. Am. Stat. Assoc. 2012; 58 :236-244 Crossref Scopus (10060) Google Scholar ). The final number of clusters was determined as the smallest number of clusters such that the top three principal components of each cluster explained more than 80% of the variance, or the first component more than 50%, using principal component analysis (PCA).
Correlation was used as a quantitative metric of coordination and integration ( Cohen and Kohn, 2011; Kohn et al., 2016 19. Cohen, M.R. ∙ Kohn, A. Measuring and interpreting neuronal correlations Nat. Neurosci. 2011; 14 :811-819 Crossref Scopus (450) PubMed Google Scholar 52. Kohn, A. ∙ Coen-Cagli, R. ∙ Kanitscheider, I. ... Correlations and Neuronal Population Information Annu. Rev. Neurosci. 2016; 39 :237-256 Crossref Scopus (86) PubMed Google Scholar ). Brain regions were defined using the functional clusters identified using t-SNE on the neuronal space (see above). Specifically, the absolute value of the mean pre-motor correlation between all pairs of neurons across two brain regions was calculated for each trial. The period over which the correlations were calculated lasted from 10 s before heat onset to 1 s before movement initiation. Significant differences between correct and incorrect trials in all pairs of brain regions were measured using a two-tailed t test. For each pair of brain regions, the average difference in absolute correlation was calculated by comparing the average across all correct trials to all incorrect trials. Similar quantities were measured by splitting trials into pre- versus post-learning, as identified by the inflection point of the sigmoid function representing the learning curve (described above), instead of correct versus incorrect trials.
Due to individual differences in neuroactivity and learning performance, the neurons in the cerebellum and ARTR did not always end up in the same locations in the t-SNE neuronal spaces across animals. To ensure that the analysis was always performed on the medial portion of cerebellum and ARTR across animals ( Figures 4 and 5 ), the neurons in these regions were selected manually based on anatomical landmarks ( Dunn et al., 2016; Randlett et al., 2015; Takeuchi et al., 2015 24. Dunn, T.W. ∙ Mu, Y. ∙ Narayan, S. ... Brain-wide mapping of neural activity controlling zebrafish exploratory locomotion eLife. 2016; 5 :e12741 Crossref PubMed Google Scholar 81. Randlett, O. ∙ Wee, C.L. ∙ Naumann, E.A. ... Whole-brain activity mapping onto a zebrafish brain atlas Nat. Methods. 2015; 12 :1039-1046 Crossref Scopus (129) PubMed Google Scholar 94. Takeuchi, M. ∙ Matsuda, K. ∙ Yamaguchi, S. ... Establishment of Gal4 transgenic zebrafish lines for analysis of development of cerebellar neural circuitry Dev. Biol. 2015; 397 :1-17 Crossref Scopus (28) PubMed Google Scholar ).
dPCA was performed on neuronal populations, following instructions described previously ( Kobak et al., 2016 51. Kobak, D. ∙ Brendel, W. ∙ Constantinidis, C. ... Demixed principal component analysis of neural population data eLife. 2016; 5 :e10989 Crossref PubMed Google Scholar ). Briefly, dPCA decomposes the activity of a neuronal population into a few task-related components, such as different stimuli and decisions. Thereby, besides identifying the transformation and components that account for the majority of the observed variance in the data as in PCA, dPCA can also reveal the dependence of the neuroactivity on task-related parameters such as stimuli states and decisions. The goal of dPCA here was to project population dynamics into a small number of dimensions that capture more than 80% of the variance and to decode decision-dependent versus decision-independent components.
Briefly, for each neuron in a given recording, the time series was divided into correct and incorrect trials based on whether the first turn was in the correct direction. To be able to average trials of different decision times (DTs) in dPCA, time series from different trials were first aligned relative to two time points, 5 s after heat onset and after movement initiation, respectively, using a time warping process, with DT defined as 20 (a.u.) after alignment ( Figure S3 A). Note that only trials with DT ≥ 5 s were used for dPCA. The time window of each trial started 10 s before heat onset and ended 20 s after the first turn initiation. For each neuron in each trial, the average activity during the first 10 s was used as the baseline and subtracted from the time series. Because the movements were the only differing conditions across trials, two types of components were defined: decision-dependent components, from which the correct versus incorrect trials could be decoded, and decision-independent components, in which the population dynamics in correct and incorrect trials followed the same patterns.
To examine whether individual decision-dependent dPCs could decode correct versus incorrect trials with statistical significance, we used each dPC as a linear decoder to assess their classification performance ( Kobak et al., 2016 51. Kobak, D. ∙ Brendel, W. ∙ Constantinidis, C. ... Demixed principal component analysis of neural population data eLife. 2016; 5 :e10989 Crossref PubMed Google Scholar ). Cross-validation (n = 100) was used to measure time-dependent classification accuracy of the dPCs. Then a shuffling test (n = 100), which shuffled the identity of correct versus incorrect trials without changing the neuronal time series, was used to assess whether the classification accuracy was significantly above 99% of the shuffled runs in 10 consecutive time points. Time points of significant decoding were marked with thick horizontal black lines in Figures 3 A, 4 A, S4 B, and S4C. The dPCs which were able to decode correct versus incorrect trials before movement initiation were defined as pre-motor decision-dependent components.
To compare the ability for predicting decision directions between learners and non-learners, warped time series with a DT of 20 s were used and the same procedure as above was performed.
To measure the real time point of successfully predicted decision direction in learners, first warped time series were used to obtain the decoder of dPCA and the classification outcome from single-trials via cross-validation. Classification outcomes of single trials then went through an unwarping process by re-stretching back to the original DTs ( Figure S3 C). Classification accuracy from unwarped single-trial classification outcomes was obtained by aligning to the movement initiation time ( Figure S3 D (i and ii)). Error margins of classification accuracy were obtained from a shuffling test (n = 100) using the same procedure and were aligned to the movement initiation time after shuffling ( Figure S3 D (iii)). Time for predicting decision directions was defined as the earliest time point before movement initiation when the classification accuracy was significantly above 99% of shuffled runs in 10 consecutive time points ( Figure S3 D (iii)).
The first dPC of the cerebellum and ARTR showed a temporal ramping activity during the period from heat onset to movement initiation across animals. To measure the velocity of the ramping activity, i.e., the ramping rate, dPCA was first applied to neurons in the cerebellum and ARTR from both hemispheres to obtain the decoder and encoder, and then the decoder from dPCA ( Figure S3 B) was used to transform the neuroactivity (without time warping) into the low-dimensional map space. Then, a linear fit was applied onto the first dPC from heat onset to 1 s before movement initiation in each trial, thus obtaining the ramping rate at the single-trial level ( Figure S5 A). Single-trial decision time (DT) was predicted at each time point t by obtaining the ramping rate ( x ) of dPC1 via a linear fit from 0 to t s after heat onset and utilizing a log-linear model log10( DT ) = −3.94 x + 1.66 ( Figure S5 B). Subsequently the predicted turn initiation time point is calculated by using DT – t ( Figure S5 B).
In order to demonstrate the decrease in prediction accuracy resulting from averaging data across multiple trials, we randomly sampled N = 19 trials with replacement from an example fish and calculated the average ramping rate and average decision time ( Figure S6 A). An identical log-linear model as above was fit to the trial-averaged ramping rates and decision times, which was then utilized to predict the decision time in single trials ( Figure S6 B).
To investigate the degree to which an increasing pool of active neurons was the driver of the observed ramping activity, we first classified the states of activity of each neuron at a given time point in a binary fashion as “active” or “inactive” depending on whether its activity was above or below its own standard deviation (SD). We then determined the degree of neuronal participation by calculating the fraction of active neurons at each time point and compared this to the population activity, as reported by dPC1, as a function of time. We compared this to the scenario in which the ramping activity would be explained by an increasing level of activity of individual neurons. To do so, we used linear correlation to measure the similarity of activity of all individual neurons to the population ramping during the pre-motor period, obtained the correlation coefficients for each neuron, calculated the distribution of these correlations and compared this distribution to the correlation obtained between the neuronal participation and the population ramping.
To examine whether there existed interaction and competition between hemispheres, dPCA was applied to neurons in the cerebellum and ARTR from both hemispheres to obtain the decoder and encoder, and then this decoder from dPCA was used to transform the neuroactivity (without time warping) into the low dimensional space. Since the response of each neuron can in principle be tuned to both features of the stimulus and of the motor output, a bilateral differential activity between the hemispheres during the pre-motor period may be masked by other stronger signals in the cerebellum and ARTR, such as the decision-independent dPC1. Thus, to increase the sensitivity of the analysis, neuroactivity containing only the pre-motor decision-dependent component was used. To do so, only the pre-motor decision-dependent component with the corresponding encoder was used to reconstruct the neuroactivity ( Figure S4 D). With these two linear transformations, neuroactivity was obtained that was predictive for movement direction with temporal and spatial information. Then the neurons were pooled according to ipsilateral or contralateral location based on their anatomical locations in the fish brain, and their activity was averaged across pools. A time window from −4 to −2 s (note that this was the unwarped time) before turn initiation was used, which was within the time window of 5 s decision time as the threshold. The separation of 2 s from turn initiation was chosen to avoid any influence of post-turn activity from the de-noising process since de-noising by total variation regularization leads to a smoothing of the time series. The averaged activity of the ipsilateral and contralateral cerebellum and ARTR were then compared at the single-trial level.
Two-photon imaging experiments were performed on a Scientifica Slicescope platform with a 20x/1.0-NA water-immersion objective (Olympus). The two-photon excitation source (Coherent Chameleon) delivered 140-fs pulses at an 80-MHz repetition rate and 960-nm wavelength (measured power: 5-12 mW). The beam intensity was controlled via an electro-optical modulator (Conoptics) for attenuation and blanking, and fed into a galvo-based scan head (Scientifica). Fluorescence from the sample was detected by a non-descanned photomultiplier tube (PMT), which consisted of an infrared blocking filter, collection lens, 565LP dichroic, 525/50-nm and 620/60-nm emission filters, and Scientifica GaAsP (green channel) and alkali (red) PMT modules. Experiments were controlled with Scanimage (Vidrio Technologies). Typical cerebellar recordings imaged ~430 × ~215 × 80 μm with 6-8 z-planes at a volume rate ~0.8 Hz. Neuron ROIs and activity were detected using CaImAn-MATLAB ( Giovannucci et al., 2019 31. Giovannucci, A. ∙ Friedrich, J. ∙ Gunn, P. ... CaImAn an open source tool for scalable calcium imaging data analysis eLife. 2019; 8 :413 Crossref Scopus (8) Google Scholar ).
Granule cells of the cerebellum were imaged using Tg(gSA2AzGFF152B; UAS:GCaMP6s) ( Filosa et al., 2016; Knogler et al., 2017; Takeuchi et al., 2015 26. Filosa, A. ∙ Barker, A.J. ∙ Dal Maschio, M. ... Feeding State Modulates Behavioral Choice and Processing of Prey Stimuli in the Zebrafish Tectum Neuron. 2016; 90 :596-608 Full Text Full Text (PDF) PubMed Google Scholar 50. Knogler, L.D. ∙ Markov, D.A. ∙ Dragomir, E.I. ... Sensorimotor Representations in Cerebellar Granule Cells in Larval Zebrafish Are Dense, Spatially Organized, and Non-temporally Patterned Curr. Biol. 2017; 27 :1288-1302 Full Text Full Text (PDF) Scopus (31) PubMed Google Scholar 94. Takeuchi, M. ∙ Matsuda, K. ∙ Yamaguchi, S. ... Establishment of Gal4 transgenic zebrafish lines for analysis of development of cerebellar neural circuitry Dev. Biol. 2015; 397 :1-17 Crossref Scopus (28) PubMed Google Scholar ). Purkinje and eurydendroid cells were imaged using Tg(Huc:H2B-GCaMP6s; GAD1b:RFP) ( Freeman et al., 2014; Satou et al., 2013 27. Freeman, J. ∙ Vladimirov, N. ∙ Kawashima, T. ... Mapping brain activity at scale with cluster computing Nat. Methods. 2014; 11 :941-950 Crossref Scopus (129) PubMed Google Scholar 84. Satou, C. ∙ Kimura, Y. ∙ Hirata, H. ... Transgenic tools to characterize neuronal properties of discrete populations of zebrafish neurons Development. 2013; 140 :3927-3931 Crossref Scopus (73) PubMed Google Scholar ). Purkinje cells were isolated by manually selecting identified neurons expressing Gad1b:RFP in FIJI, and the remainder of the GCaMP-expressing cells in the dorsal cerebellum represented the eurydendroid cell population. Decision-dependent cells were identified by performing a t test between their distribution of single-trial pre-motor activity in correct versus incorrect trials. Single neuron average activity traces were calculated for representative fish by aligning the activity to heat onset and movement initiation and then averaging over correct or incorrect trials. The difference in average activity between correct and incorrect trials was calculated as a function of time for each neuron in order to highlight any pre- and post-motor decision-dependent changes.
Two-photon lesions of the telencephalon and habenula were performed using our Scientifica two-photon platform on fish that had learned (see criterion below) in the first training block. An area of ~25 × 25 μm was lesioned with a power of ~60 mW for ~1.2 s. If necessary, lesions in the same area were repeated until a hole in the tissue was observed. The identical procedure was performed on the both hemispheres. After lesioning, the second training block was performed with the reversed reward direction. In the control group, fish that had learned (see criterion below) in the first training block were trained in the second training block, without lesion.
Lesions of the cerebellum were performed on fish that had learned (see criterion below) in the two training blocks. The same protocol for lesion was performed. Ipsilateral lesion referred to a lesion in the training side, while contralateral lesion referred to a lesion in the opposite side of the training direction, and bilateral lesion was the same procedure for both hemispheres.
Analysis of spontaneous turn preference before and after unilateral cerebellum lesions was performed by recording turn direction in freely behaving zebrafish in 3.5cm circular chambers for 1 hour. Behavioral tracking was performed using DeepLabCut 2.0 ( Nath et al., 2019 74. Nath, T. ∙ Mathis, A. ∙ Chen, A.C. ... Using DeepLabCut for 3D markerless pose estimation across species and behaviors Nat. Protoc. 2019; 14 :2152-2176 Crossref Scopus (0) PubMed Google Scholar ) and the number of left and right turns, identified by measuring a leftward or rightward change in orientation between the start and end of each swim bout, were counted for each fish.
A total of 26 larvae were trained under the ROAST assay and 5 larvae went through spontaneous movement with LFM imaging. LFM data from two-block learners, non-learners and fish exhibiting spontaneous movements – but not the data from intermediate learners – went through the 3D reconstruction. Subsequently, our signal extraction pipeline was applied to the reconstructed LFM images. We found imaging results and data quality to be reliably reproducible and consistent, both across imaging sessions with the same animal, and across animals. All statistical tests and sample sizes in the imaging and lesion studies are described in the corresponding figure captions.
Our custom data-processing pipeline for LFM data is available for download. Software for data analysis, as well as data, is available from the corresponding author upon reasonable request.

Section: Acknowledgments

We thank M. Ahrens for sharing fish lines and general discussions and O. Skocek and C. Kirst for discussions on data analysis. We thank C. Bargmann, G. Maimon, and M.E. Hatten for suggestions on the project and comments on the manuscript. We thank H. Baier, K. Kawakami, and M. Hibi for sharing transgenic fish lines. We thank A. Kaczynska, A. Afolalu, and J. Hudspeth for housing zebrafish. Q.L. has been supported by a Leon Levy Fellowship. T.N. has been supported by a Leon Levy Fellowship and a Kavli Fellowship. This work was supported in part through funding from the US National Science Foundation (NSF) awards DBI-1707408 and PHY-1748958, the Intelligence Advanced Research Projects Activity (IARPA) via Department of Interior/Interior Business Center (DoI/IBC) contract number D16PC00002, NIH Grants R25GM067110, 5U01NS103488, 1RF1 NS113251, 1RF1NS110501, DP1HD094764, R01NS049319, U19NS104653, R43OD024879, R24NS086601, and 2R44OD024879, the Kavli Foundation, and the Gordon and Betty Moore Foundation (2919.01), and the Simons Foundation (SCGB 542973).
Q.L. performed experiments, contributed to the design of data analysis approach, analyzed data, and wrote the manuscript. J.M. performed experiments, contributed to data analysis, and assisted in preparation of the manuscript. M.H. built, tested, and characterized behavioral setup for ROAST with technical support from F.E. F.S. performed spontaneous behavior experiments. ROAST was originally designed and built by J.M.L. and D.N.R. under guidance by F.E. and A.S. T.N. built microscopy platform and image reconstruction pipeline and contributed to the final version of the manuscript. A.V. conceived and led the project, designed experiments and the data analysis approach, and wrote the manuscript.
The authors declare no competing interests. A.V. and T.N. are co-inventors of the patent US9952422B2 related to light-field microscopy.
